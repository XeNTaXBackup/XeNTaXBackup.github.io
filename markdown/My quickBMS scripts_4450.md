## Post #1
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-05-12T17:00:07+00:00
- Post Title: My quickBMS scripts

WELCOME TO MY QuickBMS GAME SCRIPTS!

I thought I'd share the quickBMS scripts I wrote with you here. From time to time I'll just edit this very post to update.
QuickBMS by Luigi Auriemma can be found here: [http://aluigi.org/quickbms.htm](http://aluigi.org/quickbms.htm)
If you're coding QuickBMS, here's a link to some tips for speeding up your scripts: [viewtopic.php?f=13&t=9594](http://forum.xentax.com/viewtopic.php?f=13&t=9594)
General scripts at the beginning, game-specific scripts at the end of each platform. 

First of all four really useful and powerful scripts to use for different purposes:
[file deinterleaver, updated version](http://forum.xentax.com/viewtopic.php?f=13&p=78284#p78284) - very useful!
[generic splitter](http://forum.xentax.com/viewtopic.php?f=13&p=45460#p45460) - very useful!
[XOR tester](http://forum.xentax.com/viewtopic.php?f=13&p=77963#p77963) - very useful!
[func_getTYPE.bms](http://forum.xentax.com/viewtopic.php?f=13&p=69577#p69577) - determine file type in memory


Microsoft Xbox:
[func_header_XADP.bms](http://forum.xentax.com/viewtopic.php?f=13&p=42405#p42405) - add an Xbox ADPCM header
[Xbox ADPCM mono to stereo merge](http://forum.xentax.com/viewtopic.php?f=13&p=61876#p61876) - needed for some games

[25 to Life (Xbox)](http://forum.xentax.com/viewtopic.php?f=13&p=71694#p71694) - *.hog
[Fable (Xbox)](http://forum.xentax.com/viewtopic.php?f=13&p=73694#p73694) - *.lug/met pairs
[Max Payne (Xbox)](http://forum.xentax.com/viewtopic.php?f=13&p=73695#p73695) - *.emm/dir pairs
[Gun (Xbox)](http://forum.xentax.com/viewtopic.php?f=13&p=73702#p73702) - *.dat/wad pairs
[The Suffering (Xbox)](http://forum.xentax.com/viewtopic.php?f=13&p=73659#p73659) - *.sdu


Microsoft Xbox 360:
[XMA converter](http://forum.xentax.com/viewtopic.php?f=17&t=9023) - converts many different XMA variants to decodable xma files
[XMA cue to WAV cue](http://forum.xentax.com/viewtopic.php?f=13&p=70513#p70513)
[*.baf extractor](http://forum.xentax.com/viewtopic.php?f=13&p=46569#p46569) (X360 only)
[UT3 engine *.SoundNodeWav to XMA converter](http://forum.xentax.com/viewtopic.php?f=13&p=39271#p39271) *old*
[RIFX converter](http://forum.xentax.com/viewtopic.php?f=13&p=40229#p40229) *old*
[RIFF/RIFX to unparsed XMA](http://forum.xentax.com/viewtopic.php?f=13&p=63096#p63096) *old*
[XMA RIFF header adder](http://forum.xentax.com/viewtopic.php?f=13&p=46731#p46731) *old*

[AFL Live 2 (2013) X360](http://forum.xentax.com/viewtopic.php?f=13&p=87971#p87971) - .wad0/.wad1
[Are You Smarter Than A 5th Grader: Make the Mark (XBLA)](http://forum.xentax.com/viewtopic.php?f=13&p=74801#p74801) - *.xen
[Armored Core V (Xbox 360)](http://forum.xentax.com/viewtopic.php?f=13&p=66614#p66614) - *.bdt/bht pairs
[Backbreaker: Vengeance (XBLA)](http://forum.xentax.com/viewtopic.php?f=13&p=74958#p74958) - *.pkh/pkd pairs
[Beyond Good & Evil HD (XBLA)](http://forum.xentax.com/viewtopic.php?f=13&p=75121#p75121) - Sally_PC_POLISH.bf
[Breach (PC & XBLA)](http://forum.xentax.com/viewtopic.php?f=13&p=75162#p75162) - *.?sp/spd pairs
[Crystal Defenders (XBLA, WiiWare, PSN, PSP mini)](http://forum.xentax.com/viewtopic.php?f=13&p=75289#p75289) - *.bin
[Dark Souls (PC/X360)](http://forum.xentax.com/viewtopic.php?f=13&p=78048#p78048) - *.bdt/bhd5
[Darksiders II (Xbox 360)](http://forum.xentax.com/viewtopic.php?f=13&p=77251#p77251) - *.pck
[Gun (Xbox 360)[/b]](http://forum.xentax.com/viewtopic.php?f=13&p=73704#p73704) - *.dat/wad pairs
[Prototype (Xbox 360)](http://forum.xentax.com/viewtopic.php?f=13&p=40196#p40196) - *.p3d
[Quake 4 (Xbox 360)](http://forum.xentax.com/viewtopic.php?f=13&p=44780#p44780) - *.xpr
[Resident Evil 6 (Xbox 360)](http://forum.xentax.com/viewtopic.php?f=13&p=40524#p40524) - correct the frequency of decoded XMA files (divide by 2)
[Sleeping Dogs (Xbox 360)](http://forum.xentax.com/viewtopic.php?f=13&p=77295#p77295)  - SFX.pck
[Sniper Elite V2 (Xbox 360)](http://forum.xentax.com/viewtopic.php?f=13&p=72550#p72550) - StreamingSounds.asrBE
[Star Wars: The Force Unleashed (Xbox 360)](http://forum.xentax.com/viewtopic.php?f=13&p=112374#p112374) - *.xp/*.xd archives
[Warriors Orochi 3 (Xbox 360)](http://forum.xentax.com/viewtopic.php?f=13&p=70414#p70414) - *.bin/idx pairs, BGMLink.g1l

[flog engine extractor (XBLA)](http://forum.xentax.com/viewtopic.php?f=13&p=70600#p70600) - flog_x360.fpg with "30GF" identifier
[FPK/FKP extractor (XBLA)](http://forum.xentax.com/viewtopic.php?f=13&p=70595#p70595) - archives with "FKP" identifier
[Tongas Pack](http://forum.xentax.com/viewtopic.php?f=13&p=73820#p73820) - *.PAK (various XBLA and other console games)


Sony Playstation:
[CDXA header adder (XA format) (PS)](http://forum.xentax.com/viewtopic.php?f=13&p=40162#p40162) - needed after manual deinterleave
[STR movie audio extract (PS)](http://forum.xentax.com/viewtopic.php?f=13&p=40773#p40773) - can also demux
[XA deinterleave (PS)](http://forum.xentax.com/viewtopic.php?f=13&p=40777#p40777) - works only for certain games
[XA extractor for deinterleaved XA packs (PS)](http://forum.xentax.com/viewtopic.php?f=13&p=75522#p75522) - will be expanded a bit further in the future

[Broken Sword: Shadow of the Templars (PS)](http://forum.xentax.com/viewtopic.php?f=13&p=71116#p71116) - *.dat/tab pairs
[WarCraft II: The Dark Saga (Saturn/PS)](http://forum.xentax.com/viewtopic.php?f=13&p=73173#p73173) - *.war, *.cud
[Broken Sword: Shadow of the Templars (PS)](http://forum.xentax.com/viewtopic.php?f=13&p=71116#p71116) - *.dat/tab pairs


Sega Saturn/Sega CD:
[CPK/SEG movies with 'FILM' id (Saturn/Sega CD)](http://forum.xentax.com/viewtopic.php?f=13&p=71395#p71395) - extract audio stream
[Sega CD *.bin movie audio demuxer](http://forum.xentax.com/viewtopic.php?f=13&p=75744#p75744) - extracts headerless data

[The Animals! (Sega CD)](http://forum.xentax.com/viewtopic.php?f=13&p=76932#p76932) - MEDIA.RES extractor
[WarCraft II: The Dark Saga (Saturn/PS)](http://forum.xentax.com/viewtopic.php?f=13&p=73173#p73173) - *.war, *.cud

Sony PS2:
[func_header_SS2.bms](http://forum.xentax.com/viewtopic.php?f=13&p=44717#p44717) - add PS2 ADPCM header
[MIC to SS2](http://forum.xentax.com/viewtopic.php?f=13&p=72665#p72665)
[SS2 0x10-byte re-interleave](http://forum.xentax.com/viewtopic.php?f=13&p=46478#p46478) - important!!!
[RWS to SS2](http://forum.xentax.com/viewtopic.php?f=13&p=71110#p71110)
[VAG to SS2 (mono-to-stereo channel joiner)](http://forum.xentax.com/viewtopic.php?f=13&p=61877#p61877)
[VAG scanner](http://forum.xentax.com/viewtopic.php?f=13&p=43263#p43263)
[AAAp (stereo vag) to ss2 converter](http://forum.xentax.com/viewtopic.php?f=13&p=79430#p79430)

[007: NightFire (PS2)](http://forum.xentax.com/viewtopic.php?f=13&p=141077#p141077) - *.sfb
[18 Wheeler: American Pro Trucker (PS2)](http://forum.xentax.com/viewtopic.php?f=13&p=76790#p76790) - *.STR
[Ace Combat Zero: The Belkan War (PS2)](http://forum.xentax.com/viewtopic.php?f=13&p=75007#p75007) - NPSF to SS2 converter
[Astro Boy: The Video Game (PS2)](http://forum.xentax.com/viewtopic.php?f=13&p=73493#p73493) - DATA.WAD/DIR pair
[Baldur's Gate: Dark Alliane (PS2)](http://forum.xentax.com/viewtopic.php?f=13&p=86343#p86343) - *.GOB, *.LMP
[Buzz! The Sports Quiz (PS2)](http://forum.xentax.com/viewtopic.php?f=13&p=86318#p86318) - *.PAK ("BPAK" ident)
[Half-Life (PS2)](http://forum.xentax.com/viewtopic.php?f=13&p=87464#p87464) - *.PAK ("PACK" ident)
[Headhunter: Redemption (PS2)](http://forum.xentax.com/viewtopic.php?f=13&p=73227#p73227) - *.DAT
[Mountain Bike Adrenaline](http://forum.xentax.com/viewtopic.php?f=13&p=80397#p80397) - BIG file
[Reservoir Dogs](http://forum.xentax.com/viewtopic.php?f=13&p=91410#p91410) - *.PS2
[SDF to SS2](http://forum.xentax.com/viewtopic.php?f=13&p=75114#p75114) - *.sdf (various PS2 games)
[Turok: Evolution (PS2)](http://forum.xentax.com/viewtopic.php?f=13&p=79427#p79427) - *.TRE


Sony PSP & PS3:
[Atrac header adder](http://forum.xentax.com/viewtopic.php?f=13&p=42999#p42999) - *.at3
[AT3+ header adder](http://forum.xentax.com/viewtopic.php?f=13&p=42883#p42883) - *.aa3 (hardly needed)
[AT3 to AA3 converter](http://forum.xentax.com/viewtopic.php?f=13&p=42443#p42443) - for codec number 0xfeff, incl. smpl extraction
[MSF converter](http://forum.xentax.com/viewtopic.php?f=13&p=43570#p43570)
[PMF AT3 to AA3](http://forum.xentax.com/viewtopic.php?f=13&p=43315#p43315) - convert headerless aa3 to playable aa3
[RSF converter](http://forum.xentax.com/viewtopic.php?f=13&p=43826#p43826)
[smpl extractor & injector](http://forum.xentax.com/viewtopic.php?f=13&p=43001#p43001) (for post-processing of decoded *.aa3 files)
[XWS extractor](http://forum.xentax.com/viewtopic.php?f=13&p=43571#p43571)

[Warhammer 40,000: Squad Command (PSP)](http://forum.xentax.com/viewtopic.php?f=13&p=74671#p74671) - *.pak
[Crystal Defenders (XBLA, WiiWare, PSN, PSP mini)](http://forum.xentax.com/viewtopic.php?f=13&p=75289#p75289) - *.bin
[Gangs of London (2006) PSP](http://forum.xentax.com/viewtopic.php?f=13&p=82178#p82178) - *.bf
[Payday 2 (2013) PS3](http://forum.xentax.com/viewtopic.php?f=13&p=99366#p99366) - all_#.bundle
[The Awakened Fate: Ultimatum (PS3, 2015)](http://forum.xentax.com/viewtopic.php?f=13&p=104608#p104608) - *.dat


Nintendo DS:
[SDAT extractor](http://forum.xentax.com/viewtopic.php?f=13&p=67817#p67817) - for standard NDS sound archives
[SWAR extractor](http://forum.xentax.com/viewtopic.php?f=13&p=67823#p67823) - for the NDS soundbanks
[*.spk extractor](http://forum.xentax.com/viewtopic.php?f=13&p=69681#p69681)
[bank.bin extractor](http://forum.xentax.com/viewtopic.php?f=13&p=67853#p67853) (for NDS roms that only contain bank.bin)
[Glob.bin extractor](http://forum.xentax.com/viewtopic.php?f=13&p=69560#p69560) (for NDS roms that only contain Glob.bin and sound_data.sdat)
["IM00" pac extractor](http://forum.xentax.com/viewtopic.php?f=13&p=69570#p69570) - *.pac

[Anpanman to Touch de Waku Waku Training (DS)](http://forum.xentax.com/viewtopic.php?f=13&p=69573#p69573) - *.pb
[Bratz (DS)](http://forum.xentax.com/viewtopic.php?f=13&p=69683#p69683) - *.pkg
[Bratz (DS)](http://forum.xentax.com/viewtopic.php?f=13&p=69685#p69685) - BigFile.bin


PC:
[9 Clues: The Secret of Serpent Creek](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=88985#p88985) - Game.cub
[XIII Century (2008) PC](http://forum.xentax.com/viewtopic.php?f=13&p=78763#p78763) - data.???.pak
[Agon: The Mysterious Codex](http://forum.xentax.com/viewtopic.php?f=13&p=73196#p73196) - *.sfl
[Alien Rage: Unlimited (2013) PC](http://forum.xentax.com/viewtopic.php?f=13&p=89498#p89498) - SNDTABLE.AFB/SNDCACHE.AFB
[Atlantis: Pearls of the Deep (2012) PC](http://forum.xentax.com/viewtopic.php?f=13&p=81778#p81778) - pearls_pc.vpb/.vpi
[Breach (PC & XBLA)](http://forum.xentax.com/viewtopic.php?f=13&p=75162#p75162) - *.?sp/spd pairs
[Crazy Chicken: Pirates (2006) PC](http://forum.xentax.com/viewtopic.php?f=13&p=81300#p81300) - datafile.dat
[Culpa Innata (2007) PC](http://forum.xentax.com/viewtopic.php?f=13&p=87328#p87328) - *.sfs
[DARK](http://forum.xentax.com/viewtopic.php?f=13&p=87773#p87773) - *.darkpack
[Dark Souls (PC/X360)](http://forum.xentax.com/viewtopic.php?f=13&p=78048#p78048) - *.bdt/bhd5
[Dino R-R-rage Defense (2014) PC](http://forum.xentax.com/viewtopic.php?f=13&p=100533#p100533) - data.dat
[FTL: Faster Than Light (2012) PC](http://forum.xentax.com/viewtopic.php?f=13&p=79766#p79766) - *.dat
[Frozen Synapse Prime (2014) PC](http://forum.xentax.com/viewtopic.php?f=13&p=101700#p101700) - FSalldata.pkdwin/.pkiwin
[Full Mojo Rampage (2013) PC](http://forum.xentax.com/viewtopic.php?f=13&p=89010#p89010) - DataPC.pak
[Half Minute Hero: Super Mega Neo Climax Ultimate Boy (2012) PC](http://forum.xentax.com/viewtopic.php?f=13&p=80011#p80011) - *.rvw
[Iron Sky: Invasion (2012) PC](http://forum.xentax.com/viewtopic.php?f=13&p=81398#p81398) - *.gpk/*_gpk.mod
[Jagged Alliance: Back in Action / Jagged Alliance: Crossfire](http://forum.xentax.com/viewtopic.php?f=13&p=74350#p74350) - *.pak
[Midnight Mysteries 4: Haunted Houdini](http://forum.xentax.com/viewtopic.php?f=13&p=73692#p73692) - Contents.dat
[Hooligans: Storm Over Europe](http://forum.xentax.com/viewtopic.php?f=13&p=67926#p67926) - *.x13
[RAW: Realms of Ancient War (2012) PC](http://forum.xentax.com/viewtopic.php?f=13&p=80071#p80071) - *.bf
[Real Warfare: 1242](http://forum.xentax.com/viewtopic.php?f=13&p=103389#p103389) - data.000.pak
[Scarygirl](http://forum.xentax.com/viewtopic.php?f=13&p=71567#p71567) - str to wav converter
[Shoot Many Robots (2012) PC](http://forum.xentax.com/viewtopic.php?f=13&p=80347#p80347) - *.sar
[StoneChess (2012) PC](http://forum.xentax.com/viewtopic.php?f=13&p=80113#p80113) - data.scp
[Strimko](http://forum.xentax.com/viewtopic.php?f=13&p=70907#p70907) - assets.pfp
[Star Wars: The Force Unleashed[/b]](http://forum.xentax.com/viewtopic.php?f=13&p=66617#p66617) - *.pcp/pcd pair
[Top Secret Finders (2012) PC](http://forum.xentax.com/viewtopic.php?f=13&p=80119#p80119) - TSF.vst
[War of the Human Tanks (2012) PC](http://forum.xentax.com/viewtopic.php?f=13&p=79773#p79773) - *.ald
[Yesterday (2012) PC](http://forum.xentax.com/viewtopic.php?f=13&p=69884#p69884) - RESOURCE.*
[Zak & Jack in Showdown at Monstertown](http://forum.xentax.com/viewtopic.php?f=13&p=77514#p77514) - resources.pak


other games:
[7 Wonders: Magical Mystery Tour (iPhone/iPad)](http://forum.xentax.com/viewtopic.php?f=13&p=67915#p67915) - Contents.dat
[The Amazing Spider-Man (all platforms)](http://forum.xentax.com/viewtopic.php?f=13&p=79746#p79746) - *.pkz (decompressor only, no parser)
[Baldur's Gate: Dark Alliance (GC)](http://forum.xentax.com/viewtopic.php?f=13&p=86515#p86515) - *.lmp
[Big Town Shoot Out (WiiWare)](http://forum.xentax.com/viewtopic.php?f=13&p=75311#p75311) - *. PUB
[Crash Bandicoot: Nitro Kart 2 (2010) iP](http://forum.xentax.com/viewtopic.php?f=13&p=81504#p81504) - data.vfs
[Crash Bandicoot: Nitro Kart 2 (2010) iP](http://forum.xentax.com/viewtopic.php?f=13&p=81505#p81505) - *.psnd
[Crystal Defenders (XBLA, WiiWare, PSN, PSP mini)](http://forum.xentax.com/viewtopic.php?f=13&p=75289#p75289) - *.bin
[Doom 3: BFG Edition (2012)](http://forum.xentax.com/viewtopic.php?f=13&p=80125#p80125) - *.resources
[Max Payne Mobile (2012) iPhone/iPad](http://forum.xentax.com/viewtopic.php?f=13&p=81629#p81629) - MaxPayneSoundsv2.msf
[Splinter Cell: Conviction (all platforms)](http://forum.xentax.com/viewtopic.php?f=13&p=41235#p41235) - *.spk
[Wind Blood (2012) Android](http://forum.xentax.com/viewtopic.php?f=13&p=80308#p80308) - sound.pack


Wave manipulation tools: 
[frequency changer](http://forum.xentax.com/viewtopic.php?f=13&p=40524#p40524)
[func_header_PCM.bms](http://forum.xentax.com/viewtopic.php?f=13&p=71565#p71565) - RIFF header adder (supports different codecs)
[WAV scanner](http://forum.xentax.com/viewtopic.php?f=13&p=74664#p74664) - many variants supported
[WAV cue extractor & injector](http://forum.xentax.com/viewtopic.php?f=13&p=77294#p77294) - to provide markers without file or transfer to other files
[wave stream data reverser](http://forum.xentax.com/viewtopic.php?f=13&p=75270#p75270) - converts wave stream from big to little endian and vice-versa


other audio/video/archive:
[Activision BAF extractor (raw)](http://forum.xentax.com/viewtopic.php?f=13&p=79101#p79101) (e.g. 007: Blood Stone)
[CRI engine](http://forum.xentax.com/viewtopic.php?f=13&p=69584#p69584) - snd/shd pairs (contains CRI audio)
[Electronic Arts *.big extractor](http://forum.xentax.com/viewtopic.php?f=13&p=79708#p79708) - e.g. NHL 13 (Xbox 360)
[Electronic Arts mus scanner](http://forum.xentax.com/viewtopic.php?f=13&p=43847#p43847)
[Electronic Arts asf extractor (EAXA)](http://forum.xentax.com/viewtopic.php?f=13&p=39231#p39231) - e.g. Skate 3 (PC)
[Electronic Arts mus extractor (XMA)](http://forum.xentax.com/viewtopic.php?f=13&p=39165#p39165) - e.g. Skate 3 (Xbox 360)
[Electronic Arts ASF extractor (BGFA identifier)](http://forum.xentax.com/viewtopic.php?f=13&p=75711#p75711) - e.g. NCAA Football 13 (Xbox 360) - still needs enhancements
[Electronic Arts tgq video demultiplexer](http://forum.xentax.com/viewtopic.php?f=13&p=73172#p73172)
[F-22 Lightning II (1996) PC](http://forum.xentax.com/viewtopic.php?f=13&p=106871#p106871) - *.vdk movies
[Glacier Engine sound extractor](http://forum.xentax.com/viewtopic.php?f=13&p=87699#p87699) - *.whd/*.wav pairs
[Das Hexagon-Kartell (1996) PC](http://forum.xentax.com/viewtopic.php?f=13&p=106868#p106868) - *.anm movies
[Jane's Combat Simulation](http://forum.xentax.com/viewtopic.php?f=13&p=106869#p106869) - *.cb8 movies
[MJZ extractor](http://aluigi.org/papers/bms/mumbojumbo.bms) -> THANKS LUIGI!
[POD extractor (versions 2, 3 & 5)](http://forum.xentax.com/viewtopic.php?f=13&p=74993#p74993) *.pod
[PCM interleaved header adder](http://forum.xentax.com/viewtopic.php?f=13&p=41588#p41588) - *.ads (used mostly in PS2 movies)
[Unity3D engine](http://forum.xentax.com/viewtopic.php?f=13&p=77959#p77959) - *.assets
[WiiWare Extractor (enhanced)](http://forum.xentax.com/viewtopic.php?f=13&p=75310#p75310) - various formats
[Wwise sound engine](http://forum.xentax.com/viewtopic.php?f=13&p=80192#p80192) - *.pck with 'AKPK' identifier
[Wwise sound engine](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=89662#p89662) - *.bnk with 'BKHD' identifier
[Wwise sound engine](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=89690#p89690) - ogg sorter
[XNB to WAV converter](http://forum.xentax.com/viewtopic.php?f=13&p=75157#p75157) - Microsoft XNA Framework *.xnb
[XPR2 extractor](http://forum.xentax.com/viewtopic.php?f=13&p=74917#p74917) - *.xpr (various XBLA games)


some standard functions I use in my scripts:
[func_str2num.bms](http://forum.xentax.com/viewtopic.php?f=13&p=43258#p43258) - convert string to number
[func_num2hex.bms](http://forum.xentax.com/viewtopic.php?f=13&p=67820#p67820) - convert number to its hex representation string
[func_checkVAR.bms](http://forum.xentax.com/viewtopic.php?f=13&p=69586#p69586) - checks if all variables for functions are set
[func_writename.bms](http://forum.xentax.com/viewtopic.php?f=13&p=70514#p70514) - write string to memory


generic batch file to apply quickBMS scripts to multiple files
If someone isn't very adept in batch file writing, here's a batch for processing multiple files with a quickBMS script. Just replace "*.ext" with the extension you need and  "script.bms" with the script you want to apply. Save the text as *.bat and run it. Of course this only works if you've added the quickbms path with the "SET" command in Windows.
```
for %%i in (*.ext) DO quickbms.exe -o script.bms "%%i" "%CD%" 
```
Otherwise, just put the quickbms.exe into the same folder as the script and the files and substiturte "quickbms.exe" with "%CD%\quickbms.exe" in the batch.

Critic and suggestions are always welcome.
## Post #2
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-05-14T11:21:41+00:00
- Post Title: My quickBMS scripts

Thanks alot timo. 

a thanks doesn't hurt people lol.
## Post #3
- Username: shekofte
- Rank: mega-veteran
- Number of posts: 221
- Joined date: Sun Jan 18, 2009 8:45 pm
- Post datetime: 2010-05-15T07:11:48+00:00
- Post Title: My quickBMS scripts

thanks AlphaTwentyThree
so much beautiful tread   
is it possible that we request about some BMS too , here ?
## Post #4
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-05-15T07:31:33+00:00
- Post Title: My quickBMS scripts

Hm, why don't you just request in the main forum?
## Post #5
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-05-19T20:44:43+00:00
- Post Title: My quickBMS scripts

CUE section extractor and adder for WAVE files
Ever worked with cue markers? Sadly all compressed formats lack the possibility to preserve the markers of wave files. To be able to save the markers and apply them to a decoded compressed file you maybe sent someone - use the following two scripts.
This one exracts the cue section and saves it as [name of wave file].cue:
```
string NAME += ".cue"

FindLoc OFFSET string "cue" 0 ""
if OFFSET != ""
   get SIZE asize
   math SIZE -= OFFSET
   log NAME OFFSET SIZE
endif
```
This one applies a cue section to a wave file with the same name. If the file already has a cue section, it saves it as [name of wave file].cueold and substitues it with the new one. Apply the script to the wave file, it will automatically open the *.cue file.
```
string NAME += ".cueold"
FindLoc OFFSET string "cue" 0 ""
if OFFSET != ""
   get SIZE asize 0
   math SIZE -= OFFSET
   log NAME OFFSET SIZE
else
   get SIZE asize
endif
log MEMORY_FILE 0 SIZE
open FDDE CUE 1
get CSIZE asize 1
append
log MEMORY_FILE 0 CSIZE 1
append
get NAME filename  0
math SIZE += CSIZE
log NAME 0 SIZE MEMORY_FILE
```

WAVE format scanner
I already posted this inside some other topic but I'll include it here, too. Simple wave scanner. Doesn't search for the "RIFF" string as I once accidentially found it inside some other data structures where it wasn't a wave file. Instead it searches for the WAVEfmt part and extracts the file.
```
   FindLoc OFFSET STRING "WAVEfmt" 0 ""
   if OFFSET != ""
      math OFFSET -= 8
      goto OFFSET
      FindLoc DATA STRING "data" 0 ""
      math DATA += 4
      goto DATA
      get SSIZE long
      savepos HEADER
      math HEADER -= OFFSET
      set SIZE HEADER
      math SIZE += SSIZE
      get NAME basename
      string NAME += "_"
      string NAME += i
      string NAME += ".wav"
      log NAME OFFSET SIZE
   else
      cleanexit
   endif
next i
```


WMV format scanner
When I ripped Darksiders I needed to scan for WMV files but strangely I know of no file scanner that is able to scan for WMV files. So I wrote my own. 
```
   FindLoc OFFSET string \x30\x26\xb2\x75\x8e\x66\xcf\x11 0 ""
   if OFFSET != ""
      get NAME BASENAME
      string NAME += "_"
      if i < 10
         string NAME += "0"
      endif
      string NAME += i
      string NAME += ".wmv"

      set SIZE OFFSET
      math SIZE += 0x176
      goto SIZE
      get SIZE long
      math SIZE += 0x176
      
      log NAME OFFSET SIZE
   endif
next i
```
## Post #6
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-06-05T00:28:08+00:00
- Post Title: My quickBMS scripts

EA *.mus extractor
Extracts the segments from newer Electronic Arts games *.mus containers. Will soon post a pack how to decode contained xma segments from Xbox 360 games

```
string BNAME += "_"

get DUMMY long
get FILES long
	set INFO 0x1c
	math INFO *= FILES
	math INFO += 0x28
	savepos MYOFF
	goto INFO
	set DUMMY 0
	DO
		get DUMMY long
	while DUMMY == 0
	savepos INFO
	math INFO -= 0x4
goto 0x28
for i = 1 <= FILES
	get UNKNOWN long
	get NUMBER short
	get ZERO short
	get UNKNOWN long
	get OFFSET long
	reverseLong OFFSET
	math OFFSET *= 0x80
	math OFFSET += START
	get UNKNOWN long
	get SIZE long
	reverseLong SIZE
	get ZERO long
	set NAME BNAME
	string NAME += i
		savepos MYOFF
		goto INFO
		get UNKNOWN short
		get FREQ short
		reverseShort FREQ
		get ID1 byte # unknown
		get ID2 byte # segment length
		get ID3 byte # segment number
		get ID4 byte # segment type
		get ZERO long
		get ZERO long
		savepos INFO
		goto MYOFF
		# string NAME += "_"
		# string NAME += ID1
		# string NAME += "_"
		# string NAME += ID2
		string NAME += "_"
		string NAME += ID3
		string NAME += "_"
		string NAME += ID4
		string NAME += "_"
		string NAME += FREQ
	string NAME += ".ea"
	log NAME OFFSET SIZE
next i
```

Explanation: all extracted files have the format "name_#_segid_segtype_freq.ea". # is just a successing number to avoid duplicates, segid is a segment ID (shows which segments belong together) and segtype shows some information about the segment, e.g. if there's a beat at the beginning or distinguishes different beats. freq is just the frequency. You'll need it for the header in addXMARIFFHeader.bms (see below). You may un-comment the lines for ID1 and ID2 but it's not really necessary.

EAMUS segment conversion batch (Xbox 360 only)
Put ea_multi_xma.exe (by HCS), xmaparse.exe (by HCS), addXMARIFFHeader.bms (see above) and towav.exe (by xplorer) in the folder with the extracted files and run it. 

> for %%i in (*.ea) DO ea_multi_xma.exe %%i
>
> for %%i in (*.ea_stream1) DO xma_parse.exe %%i -1 -r "%%~ni.hxma"
>
> for %%i in (*.hxma) DO quickbms.exe -o addXMARIFFHeader.bms "%%i" "%CD%"
>
> @towav.exe *.*
>
> @ECHO "Deleting temporary files..."
>
> @del *.xma
>
> @del *.hxma
>
> @del *.ea_stream1
>
> @md WAV
>
> @move *.wav WAV
>
> @ECHO "Done!"
>
> pausenote 1: for XMA2 files skip the marked "-1".
note 2: adjust the sample rate in addXMARIFFHeader.bms to that of the segments
note 3: to process multilayered or multichannel streams, just add batch lines for each layer:
> for %%i in (*.ea_stream2) DO xma_parse.exe %%i -1 -r "%%~ni_l2.hxma"
>
> ...
>
> @del *.ea_stream2
## Post #7
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-06-05T09:56:46+00:00
- Post Title: My quickBMS scripts

Thanks alot Alpha.

EDIT; hmm can you adjust or tell me how to adjust the script for this mus file from the simpsons game?

[http://www.megaupload.com/?d=BAI49Z7V](http://www.megaupload.com/?d=BAI49Z7V)

They seem to extract at the FC01 flag.
## Post #8
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-06-06T11:24:28+00:00
- Post Title: My quickBMS scripts

> Reply from OrangeC
>
> EDIT; hmm can you adjust or tell me how to adjust the script for this mus file from the simpsons game?Actually, no. Someone needs to write a script that extracts the mus files according to the header and not to the flag.
## Post #9
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-06-06T12:21:01+00:00
- Post Title: My quickBMS scripts

Ahh, Well can you take a look at my mus sample?
## Post #10
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-06-06T22:40:41+00:00
- Post Title: My quickBMS scripts

Ok, updated my original post!
Now with correct *.mus extraction and whole decoding procedure for MUS files that contain XMA segments!
## Post #11
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-06-06T23:06:28+00:00
- Post Title: My quickBMS scripts

This is incredible Alpha, THX!!, this alleviates any stress with EA so far.
## Post #12
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-06-06T23:27:04+00:00
- Post Title: My quickBMS scripts

EAMUS extractor for EAXA containers
Extracts MUS containers with the new Elextronic Arts XA format and automatically adds the frequency-adjusted header. All files can be decoded with toWAV.

```
string BNAME += "_"

get DUMMY long
get FILES long
	set INFO 0x1c
	math INFO *= FILES
	math INFO += 0x28
	savepos MYOFF
	goto INFO
	set DUMMY 0
	DO
		get DUMMY long
	while DUMMY == 0
	savepos INFO
	math INFO -= 0x4
goto 0x28
for i = 1 <= FILES
	get UNKNOWN long
	get NUMBER short
	get ZERO short
	get UNKNOWN long
	get OFFSET long
	math OFFSET *= 0x80
	math OFFSET += START
	get UNKNOWN long
	get SIZE long
	get ZERO long
	set NAME BNAME
	string NAME += i
		savepos MYOFF
		goto INFO
		get UNKNOWN short
		get FREQ short
		get ID1 byte # unknown
		get ID2 byte # segment length
		get ID3 byte # segment number
		get ID4 byte # segment type
		get ZERO long
		get ZERO long
		savepos INFO
		goto MYOFF
		string NAME += "_"
		string NAME += ID3
		string NAME += "_"
		string NAME += ID4
	string NAME += ".xa"
	callfunction addEAXAheader
	log NAME 0 SIZE MEMORY_FILE
next i

startfunction addEAXAheader
	set MEMORY_FILE binary "\x3\x0\x0\x2\x8A\xEB\x2\x0\x20\x0\x0\x0\x0\x0\x0\x0\x4\x4\xBB\x80\x60\x8C\x2A\x0\x0\x0\x0\x0\x0\x0\x0\x0"
	putVarChr MEMORY_FILE 0x12 FREQ short
	putVarChr MEMORY_FILE 0x14 SIZE long
	append
	log MEMORY_FILE OFFSET SIZE
	append
	math SIZE += 0x20
endfunction

```
## Post #13
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-06-07T21:43:55+00:00
- Post Title: My quickBMS scripts

SoundNodeWave2XMA.bms
Not much to say about. The script transforms the *.SoundNodeWave files from Xbox 360 UT3 Engine games into toWAV-decodable XMA files.

```
# transforms UT3 Engine sounds and music of Xbox 360 games into decodable XMA files
# by AlphaTwentyThree 06-2010

goto 0x56
get FREQ short
reverseShort FREQ
FindLoc OFFSET STRING \xfc\x01\xc0\x01 0 ""
math OFFSET -= 0x6
get SIZE asize
math SIZE -= OFFSET
get NAME basename
string NAME += ".xma"
set CH 2

set MEMORY_FILE binary "\x52\x49\x46\x46\xb8\x59\xa7\x0\x57\x41\x56\x45\x66\x6d\x74\x20\x20\x0\x0\x0\x65\x1\x10\x0\xd6\x10\x0\x0\x1\x0\x0\x3\xe3\x9a\x0\x0\x80\xbb\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x2\x2\x0\x64\x61\x74\x61\x0\x58\xa7\x0"
set RIFFSIZE SIZE
math RIFFSIZE += 0x34
putVarChr MEMORY_FILE 0x04 RIFFSIZE long
putVarChr MEMORY_FILE 0x24 FREQ long
putVarChr MEMORY_FILE 0x31 CH byte
putVarChr MEMORY_FILE 0x38 SIZE long

append
log MEMORY_FILE OFFSET SIZE
append
math SIZE += 0x3c
log NAME 0 SIZE MEMORY_FILE
```
## Post #14
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-06-07T21:45:07+00:00
- Post Title: My quickBMS scripts

Another great script :
## Post #15
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-06-08T20:44:39+00:00
- Post Title: My quickBMS scripts

file_deinterleave.bms
Sometimes it's necessary to deinterleave certain formats, e.g. multilayer VAG files. Just adjust header (= unprocessed area), layer count and interleave inside the script. 
If you set the layer count (LAYERS) to 1 and change the skip value, you can eleminate portions of data within a file that repeat, e.g. block headers. This is the case for an AT3 format sometimes used in PS3 games (HEADER: 0, INTERL: 0x2b8, SKIP: 0x8).
Note that the last block is divided into equal parts so that the resulting files will have the same size. If the last block isn't dividable by the layer count, the script stops with an error message.

```
set INTERL 0x6000
set SKIP 0x0
set LAYERS 8
set JUMP INTERL
math JUMP *= LAYERS # JUMP = size of one block
math INTERL -= SKIP
	get TEST asize
	math TEST %= LAYERS
	if TEST != 0
		print "Illegal deinterleave parameters! Aborting..."
		cleanexit
	endif
get CYCLES asize
math CYCLES /= JUMP # number of interleave blocks
get RES asize
math RES %= JUMP # size of last interleave block
#print "residuum: %RES%"
math RES /= LAYERS # size of single last interleave

if RES != 0
	print "Warning: last block is incomplete! Check your parameters!"
endif


for i = 1 <= LAYERS
	log MEMORY_FILE 0 0
	set OFFSET i
	math OFFSET -= 1
	math OFFSET *= INTERL
	math OFFSET += HEADER
	append
	for k = 1 <= CYCLES
		log MEMORY_FILE OFFSET INTERL
		math OFFSET += JUMP
		math OFFET += SKIP
	NEXT k
	if RES != 0 # incomplete but valid last block
		set OFF i
		math OFF -= 1
		math OFF *= RES
		math OFFSET -= JUMP
		math OFFSET -= SKIP
		math OFFSET += OFF
		log MEMORY_FILE OFFSET RES
	endif
	append
	get SIZE asize MEMORY_FILE
	get NAME basename
	if LAYERS != 1
		string NAME += "_"
		string NAME += i
	endif
	log NAME 0 SIZE MEMORY_FILE
next i
```
## Post #16
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-03T20:53:44+00:00
- Post Title: Re: My quickBMS scripts

addCDXAheader.bms
Adds a PSX ADPCM header to a headerless file. These files can be played with the vgmstream plugin for Winamp afterwards.

```
# note: the format always has 37,800Hz and 2 channels

set MEMORY_FILE binary "\x52\x49\x46\x46\xe4\x4\xbe\x2\x43\x44\x58\x41\x66\x6d\x74\x20\x10\x0\x0\x0\x0\x0\x0\x0\x1\x55\x58\x41\x1\x0\x0\x00\x0\x0\x0\x0\x64\x61\x74\x61\xc0\x4\xbe\x2"

get SIZE asize
get NAME basename
string NAME += ".xa"
set RIFFSIZE SIZE
math RIFFSIZE += 0x24
putVarChr MEMORY_FILE 0x04 RIFFSIZE long
putVarChr MEMORY_FILE 0x28 SIZE long

append
log MEMORY_FILE 0 SIZE
append
math SIZE += 0x2c
log NAME 0 SIZE MEMORY_FILE
```
## Post #17
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-04T13:46:17+00:00
- Post Title: Re: My quickBMS scripts

Prototype *.p3d XMA2 extractor
This script extracts the XMA2 stream from Prototype Xbox 360 *.p3d files. The resulting file needs to be rebuilt to XMA1 (the -r option of xma_parse). Adding a 48kHz stereo header with my script results in toWAV-decodable files.

```
# version 1.1

endian big
FindLoc AUDIO string "AudioFile" 0 ""
math AUDIO += 0x0e
goto AUDIO
get NAMEL long
getDstring NAME NAMEL
get ZERO byte
get KEYL long
getDstring KEY KEYL
get ZERO byte
get DUMMY long
get XMAL long
get XMA long
savepos OFFSET
get XMA2 long
get HEADSIZE long
get DATASIZE long
math OFFSET += DATASIZE
math OFFSET += HEADSIZE
math OFFSET += 0x14
get SIZE asize
math SIZE -= OFFSET
string NAME += ".uxma"

log NAME OFFSET SIZE
```
## Post #18
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-04T22:31:22+00:00
- Post Title: Re: My quickBMS scripts

RIFX_convert.bms

This script changes the RIFX header to various other headers. Those RIFX files are normally contained inside Wwise *.bnk containers.

```
goto 0x14
get FORMAT short
get ZERO byte
get CH byte
get FREQ long
if FORMAT == 65534 # WAV
	set MEMORY_FILE binary "\x52\x49\x46\x46\x44\xde\x37\x00\x57\x41\x56\x45\x66\x6d\x74\x20\x10\x00\x00\x00\x01\x00\x02\x00\x80\xbb\x00\x00\x00\xee\x02\x00\x04\x00\x10\x00"
	get INFO long
	if INFO == 96000 # loop markers
		goto 0x48
		get SMPL long
		putVarChr MEMORY_FILE 0x24 SMPL long # append "smpl"
		set WOFFSET 0x28 # write offset (of memory file)
		for i = 0 < 15 # append reversed loop cues
			get TBR long
			reverseLong TBR
			putVarChr MEMORY_FILE WOFFSET TBR long
			math WOFFSET += 4
		next i
		set DATA 0x98
	elif INFO == 192000 # no loop markers
		set DATA 0x48
	endif
	goto DATA
	getDstring DATA 4
	#putVarChr MEMORY_FILE 
	set MEMORY_FILE binary "\x52\x49\x46\x46\x44\xde\x37\x00\x57\x41\x56\x45\x66\x6d\x74\x20\x10\x00\x00\x00\x01\x00\x02\x00\x80\xbb\x00\x00\x00\xee\x02\x00\x04\x00\x10\x00"
elif FORMAT == 65535 # OGG
	print "Wwise OGG file -> run through ww2ogg"
elif FORMAT == 2 # Wii DSP
	print "Wii ADPCM - to be implemented..."
elif FORMAT == 358 # XMA
	goto 0x4c
	get SEEKL long
	savepos MYOFF
	math MYOFF += SEEKL
	math MYOFF += 0x18 # XMAc.....JUNK
	goto MYOFF
	get JUNKL long
	savepos MYOFF
	math MYOFF += JUNKL
	goto MYOFF
	get DATA long
	get XSIZE long
	savepos OFFSET
	endian little
	get SIZE asize
	math SIZE -= OFFSET
	set RIFFSIZE SIZE
	math RIFFSIZE += 0x34

	set MEMORY_FILE binary "\x52\x49\x46\x46\xb8\x59\xa7\x00\x57\x41\x56\x45\x66\x6d\x74\x20\x20\x00\x00\x00\x65\x01\x10\x00\xd6\x10\x00\x00\x01\x00\x00\x03\xe3\x9a\x00\x00\x80\xbb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x64\x61\x74\x61\x00\x58\xa7\x00"
	putVarChr MEMORY_FILE 0x04 RIFFSIZE long
	putVarChr MEMORY_FILE 0x24 FREQ long
	putVarChr MEMORY_FILE 0x31 CH byte
	putVarChr MEMORY_FILE 0x38 SIZE long

	append
	log MEMORY_FILE OFFSET SIZE
	append
	math SIZE += 0x3c
	get NAME basename
	string NAME += ".xma"
	log NAME 0 SIZE MEMORY_FILE
else
	print "Format yet unsupported by script."
	print "Please send this file to AlphaTwentyThree at Xentax!"
endif
```
## Post #19
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-05T11:27:55+00:00
- Post Title: Re: My quickBMS scripts

FSB_scan.bms

Simply scans a file for included FSB containers. The *.xxx files of many UT3-engine based games for example can't (yet) be extracted, so it's handy to scan them for FSB containers. And of course if you're too lazy to write your own bms script for a container but you only need the contents of the contained *.fsb files, this is the way to go. Currently supports FSB3 and FSB4.

```
# ver. 1.1 by AlphaTwentyThree 07-07-2010
# scans for FSB3 and FSB4 containers

get BNAME basename
string BNAME += "_"
get FSIZE asize
set i 1
set XSIZE 0

for
	FindLoc OFFSET string "FSB" 0 ""
	if OFFSET != ""
		set SKIP 0
		goto OFFSET
		getDstring VER 4
		if VER == "FSB3"
			set HEADCORR 0x18
			elif VER == "FSB4"
			set HEADCORR 0x30
		else
			set SKIP 1
		endif
		if SKIP == 0   
			get FILES long
			get HEADER long
			math HEADER += HEADCORR
			get SIZE long
			if size > 0
				set TSIZE SIZE
				math TSIZE += XSIZE
				if TSIZE < FSIZE
					math SIZE += HEADER
					set NAME BNAME
					string NAME += i
					string NAME += ".fsb"
					log NAME OFFSET SIZE
					math i += 1
					math XSIZE += SIZE # size of extracted files
					math OFFSET += SIZE
					goto OFFSET
				endif
			endif
		endif
	else
		cleanexit
	endif
next
```
Note: The extracted files are named after their origin container.
## Post #20
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-05T13:09:56+00:00
- Post Title: Re: My quickBMS scripts

addIMAADPCMheader.bms

Adds a standard IMA ADPCM header to a headerless file. Filesizes are adjusted automatically.

```

set FREQ 44100
set CH 2

get NAME basename
get SIZE asize
string NAME += ".wav"
set RIFFSIZE SIZE
math RIFFSIZE += 0x28
putVarChr MEMORY_FILE 0x04 RIFFSIZE long
putVarChr MEMORY_FILE 0x18 FREQ long
putVarChr MEMORY_FILE 0x24 CH byte
putVarChr MEMORY_FILE 0x2c SIZE long

append
log MEMORY_FILE 0 SIZE
append
math SIZE += 0x30
log NAME 0 SIZE MEMORY_FILE
```
## Post #21
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-06T09:02:56+00:00
- Post Title: Re: My quickBMS scripts

Just corrected the FSB4 scanner. The IDENT variable apparently is the number of files in the FSB container...
## Post #22
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-07T10:09:57+00:00
- Post Title: Re: My quickBMS scripts

Another correction for the FSB4 scanner, which iss now the FSB scanner.  Supports FSB3 and FSB4 now.
## Post #23
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-09T12:53:25+00:00
- Post Title: Re: My quickBMS scripts

Corrected and updated the file deinterleaver. Now also with header skip. =)
## Post #24
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-13T11:33:26+00:00
- Post Title: Re: My quickBMS scripts

change_freq.bms
Did it ever happen to you that you ripped a lot of files by hand or added a custom header when you realize that you've set the frequency wrong? Especially when working with GENH or when you've deleted all the headerless files you worked with before it can be really annoying. This script writes the defined frequency to a defined offset. Just set quickBMS to overwrite and there you go. Very simple. 

```
set OFFSET 0x0c # offset of old frequency
get SIZE asize
putVarChr MEMORY_FILE SIZE 0
log MEMORY_FILE 0 0
append
log MEMORY_FILE 0 SIZE
append
putVarChr MEMORY_FILE OFFSET FREQ long
get NAME basename
string NAME += "_new."
get EXT extension
string NAME += EXT
log NAME 0 SIZE MEMORY_FILE
```


And here is a scrip to divide a given frequency by 2 (needed on e.g. decoded wave files from Resident Evil 6 Xbox 360):

```
goto OFFSET
get FREQ long
math FREQ /= 2
get SIZE asize
putVarChr MEMORY_FILE SIZE 0
log MEMORY_FILE 0 0
append
log MEMORY_FILE 0 SIZE
append
putVarChr MEMORY_FILE OFFSET FREQ long
get NAME basename
string NAME += "_new.wav"
log NAME 0 SIZE MEMORY_FILE
```
## Post #25
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-17T12:30:05+00:00
- Post Title: Re: My quickBMS scripts

add6chXMAHeader.bms
Ever got sick of extracting and rebuilding the three stereo channel sets of multichannel XMA2 files? Here's a script that adds a multichannel XMA2 header to a headerless file, which is then decodable by toWAV.

```
endian big
putVarChr MEMORY_FILE 0x7b4 0x78327374 long
putVarChr MEMORY_FILE 0x7b8 0x3c byte
putVarChr MEMORY_FILE 0x7c4 0x0A000100 long
putVarChr MEMORY_FILE 0x7ca 0xb4c2 short
putVarChr MEMORY_FILE 0x7d0 0xFFFF0100 long
putVarChr MEMORY_FILE 0x7e6 0x803f1600 long
putVarChr MEMORY_FILE 0x7ec 0x8026 short
putVarChr MEMORY_FILE 0x7f0 0x2601 short
putVarChr MEMORY_FILE 0x7f4 0x303f short
putVarChr MEMORY_FILE 0x7f8 0x64617461 long # data
endian little

set FREQ 48000
set BLOCKSIZE 0x3000

get NAME basename
get SIZE asize
string NAME += ".xma"
set RIFFSIZE SIZE
math RIFFSIZE += 0x7F8

putVarChr MEMORY_FILE 0x04 RIFFSIZE long
reverseLong FREQ
putVarChr MEMORY_FILE 0x20 FREQ long
reverseLong BLOCKSIZE
putVarChr MEMORY_FILE 0x2C BLOCKSIZE long
putVarChr MEMORY_FILE 0x7FC SIZE long

append
log MEMORY_FILE 0 SIZE
append
math SIZE += 0x800
log NAME 0 SIZE MEMORY_FILE
```
Note: I didn't set the memory to the actual header as most of it consists of zeroes.
## Post #26
- Username: aluigi
- Rank: VVIP member
- Number of posts: 1916
- Joined date: Thu Dec 08, 2005 7:26 pm
- Post datetime: 2010-07-17T12:46:16+00:00
- Post Title: Re: My quickBMS scripts

a tip for making the MEMORY_FILE visually shorter:
replace any \x00 with \0
## Post #27
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-17T12:50:46+00:00
- Post Title: Re: My quickBMS scripts

> Reply from aluigi
>
> a tip for making the MEMORY_FILE visually shorter:
replace any \x00 with \0Right, thanks.
## Post #28
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-07-17T13:29:18+00:00
- Post Title: Re: My quickBMS scripts

so im guessing this is the first multichannel xma2 header?
## Post #29
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-17T15:22:32+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> so im guessing this is the first multichannel xma2 header?Well it's quite old but I never took a closer look at it because my scripting skills with quickBMS were about zero at that point of time. It's from Ace Combat 6, maybe you remember the old thread where most of the XMA2 questions were solved.  But yeah I guess it's the first working program to process multichannel XMA2 files.
## Post #30
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-22T12:16:36+00:00
- Post Title: Re: My quickBMS scripts

STR_audio_extract.bms
Extracts the audio data from Playstation *.str video files as *.xa file (playable with the vgmstream plugin for Winamp). 
Note: You'll need to RAW-copy the *.str files with IsoBuster before they can be processed.
UPDATE: new revision with multistream support!  

```

callfunction detectstreams 1
set SIMPLE 1
if STREAMS > 1
	set SIMPLE 0
endif

for i = 0 < STREAMS
	callfunction getstreamsize 1
	math SSIZE *= 0x930
	if SSIZE != 0
		putVarChr MEMORY_FILE SSIZE 0
		log MEMORY_FILE 0 0
		get FSIZE asize
		set OFFSET 0
		append
		DO
			set IDENT OFFSET
			math IDENT += 0x11
			goto IDENT
			get STREAM byte
			get DAT byte
			if DAT == 0x64 # audio marker
				if SIMPLE == 1
					log MEMORY_FILE OFFSET 0x930
				else
					if STREAM == i
						log MEMORY_FILE OFFSET 0x930
					endif
				endif
			endif
			math OFFSET += 0x930
		WHILE OFFSET < FSIZE
		append
		
		callfunction CDXA 1
		get NAME basename
		if SIMPLE == 0
			string NAME += "_"
			string NAME += i
		endif
		string NAME += ".xa"
		get SIZE asize MEMORY_FILE2
		log NAME 0 SIZE MEMORY_FILE2
	endif
next i
	
startfunction detectstreams
	get FSIZE asize
	set STREAMS 0
	DO # brute-force run though whole file
		set IDENT OFFSET
		math IDENT += 0x11
		goto IDENT
		get STREAM byte
		if STREAM > STREAMS
			set STREAMS STREAM
		endif
		math OFFSET += 0x930
	WHILE OFFSET < FSIZE
endfunction

startfunction getstreamsize
	set SSIZE 0
	get FSIZE asize
	set OFFSET 0
	DO
		set IDENT OFFSET
		math IDENT += 0x11
		goto IDENT
		get STREAM byte
		if STREAM == i
			math SSIZE += 1
		endif
		math OFFSET += 0x930
	WHILE OFFSET < FSIZE
endfunction

startfunction CDXA
	log MEMORY_FILE2 0 0
	set MEMORY_FILE2 binary "\x52\x49\x46\x46\xe4\x04\xbe\x02\x43\x44\x58\x41\x66\x6d\x74\x20\x10\x0\x0\x0\x0\x0\x0\x0\x1\x55\x58\x41\x1\x0\x0\x0\x0\x0\x0\x0\x64\x61\x74\x61\xc0\x4\xbe\x2"
	get SIZE asize MEMORY_FILE
	append
	log MEMORY_FILE2 0 SIZE MEMORY_FILE
	append
	set RIFFSIZE SIZE
	math RIFFSIZE -= 8
	set DSIZE SIZE
	math DSIZE -= 0x2c
	putVarChr MEMORY_FILE2 0x04 RIFFSIZE long
	putVarChr MEMORY_FILE2 0x28 DSIZE long
endfunction
```
## Post #31
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-22T13:44:02+00:00
- Post Title: Re: My quickBMS scripts

XA_deinterleave.bms
Many Playstation games have interleaved XA files to save their music. Each interleaved XA file consists of exactly 8 or 16 layers (will need to add support). Each layer starts with [00FFFFFFFFFFFFFFFFFFFF001430][number byte][02][01][layer number byte][audio designator byte][01]. If the file is stereo, the last dword is repeated. The file interleave is always 0x930, that's the distance to each [00FFFFFFFFFFFFFFFFFFFF001430]-block. The audio designator is 0x64 if audio is present and 0x00 if the layer is empty. In this case the layer number is also 0x00. That's one of the reasons why PSX images are highly compressable.  
Each of the block headers stays intact inside the stream. If a stream is finished, the last block has either the audio designator 0xE4 and all subsequent blocks have 0x48 OR the last block is normal (0x64) and all subsequent blocks have 0x00 as designator.
In some cases (take Descent II PSX for example), the track end isn't designated at all but the last few ms of the track are repeated till the end of the layer. I haven't yet found a way to cut these file correctly.
The following script deinterleaves those streams, cuts each stream at a given stop designator and adds a CDXA header. The files are playable with in_vgmstream.dll (newest release). Currently there is no "empty layer" support yet, but I'll code that later. If there's some header present before the [00FFFFFFFFFFFFFFFFFFFF001430]-block, just adjust the HEADER variable.

```
set INTERL 0x930
set LAYERS 8
set JUMP INTERL
math JUMP *= LAYERS
get FSIZE asize
for i = 1 <= LAYERS
    log MEMORY_FILE 0 0
    set MEMORY_FILE binary "\x52\x49\x46\x46\xe4\x04\xbe\x02\x43\x44\x58\x41\x66\x6d\x74\x20\x10\x0\x0\x0\x0\x0\x0\x0\x1\x55\x58\x41\x1\x0\x0\x0\x0\x0\x0\x0\x64\x61\x74\x61\xc0\x4\xbe\x2"
    set OFFSET i
    math OFFSET -= 1
    math OFFSET *= INTERL
    math OFFSET += HEADER
    set QUIT 0
    append
    for
        set CHECK OFFSET
        math CHECK += 0x12
        goto CHECK
        get DAT byte # audio marker
    if DAT == 0x48
        set QUIT 1
        elif DAT == 0xE4
        set QUIT 2
    elif DAT == 0
        set QUIT 1
        endif
        set TEST OFFSET
        math TEST += INTERL
        if TEST == FSIZE
        set QUIT 2
        endif
        if QUIT == 0
        log MEMORY_FILE OFFSET INTERL
        math OFFSET += JUMP
        elif QUIT == 2
        log MEMORY_FILE OFFSET INTERL
        break
        elif QUIT == 1
        break
        endif
    next
    append
    get SIZE asize MEMORY_FILE
    set RIFFSIZE SIZE
    math RIFFSIZE -= 8
    set DSIZE SIZE
    math DSIZE -= 0x2c
    putVarChr MEMORY_FILE 0x04 RIFFSIZE long
    putVarChr MEMORY_FILE 0x28 DSIZE long
    get NAME basename
    string NAME += "_"
    string NAME += i
    string NAME += ".xa"
    log NAME 0 SIZE MEMORY_FILE
next i
```
## Post #32
- Username: RedDeadRedemption
- Rank: beginner
- Number of posts: 32
- Joined date: Tue Jul 13, 2010 10:23 pm
- Post datetime: 2010-07-22T15:38:51+00:00
- Post Title: Re: My quickBMS scripts

Thanks you for this great scripts!
In EA *.mus extractor, how can i join segments which belong together?
## Post #33
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-22T16:59:59+00:00
- Post Title: Re: My quickBMS scripts

> Reply from RedDeadRedemption
>
> Thanks you for this great script.
But how can i join segments which belong together?
1. please shorten your message 
2. simple answer: Manually  I deliberately left it open because it's a matter of taste how to join the segments. You could just use Winamp's DiskWriter plugin for example.
## Post #34
- Username: RedDeadRedemption
- Rank: beginner
- Number of posts: 32
- Joined date: Tue Jul 13, 2010 10:23 pm
- Post datetime: 2010-07-23T07:57:08+00:00
- Post Title: Re: My quickBMS scripts

Another question.
in addXMARIFFheader.bms, I have to try different Channels and Sample rates to find the exact one. How can i guess exact and correct Channels and sample rate of a xma file before decoding it?
## Post #35
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-23T13:09:16+00:00
- Post Title: Re: My quickBMS scripts

You actually can't distinguish between the different sample rates of headerless XMA files from seeing the code. The only thing that's reliable: if toWAV doesn't decode the file correctly, it's probably the wrong sample rate or number of channels. However, toWAV doesn't seem to distinguish between 44,100 Hz and 48,000 Hz as it decodes both variants without errors. Either you search for a soundtrack, downloadable tracks from the composer's page or some other hint among the other files via hex editor. In many cases the XMA stream has a small header that states the sample rate. But be sure to cut that portion first before adding a header.
## Post #36
- Username: Barnaby
- Rank: advanced
- Number of posts: 47
- Joined date: Tue Dec 15, 2009 12:41 am
- Post datetime: 2010-07-26T20:56:27+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #37
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-27T12:42:39+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #38
- Username: Barnaby
- Rank: advanced
- Number of posts: 47
- Joined date: Tue Dec 15, 2009 12:41 am
- Post datetime: 2010-07-27T13:05:04+00:00
- Post Title: Re: My quickBMS scripts

Would you like me to upload some of the bnk so you can update that extractor script to get filenames?
## Post #39
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-07-27T18:41:02+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Barnaby
>
> Would you like me to upload some of the bnk so you can update that extractor script to get filenames?Nope, already downloaded the image file.
## Post #40
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-08-09T11:29:48+00:00
- Post Title: Re: My quickBMS scripts

extract_spk.bms
Extracts the *.spk sound archives from Splinter Cell: Conviction. Works on both PC and Xbox 360 version. 

```
string BNAME += "_"
FindLoc DAT string \x02\x23\x00\x08 0 "" # data start (= offset correction)
set FILES DAT
math FILES -= 0x40
math FILES /= 8
goto 0x40
set OFFSET DAT
for i = 1 <= FILES
	get DUMMY long
	get SIZE long
	set NAME BNAME
	string NAME += i
	log NAME OFFSET SIZE
	math OFFSET += SIZE
next i
```
Note 1: To convert the files of the PC version further, use Zench's DecUbiSnd tool.
Note 2: To convert the Xbox 360 files, use PoP360XMA (from this forum), rebuild the XMA2 stream, add an XMA header and decode them with toWAV.
## Post #41
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-08-17T23:24:44+00:00
- Post Title: Re: My quickBMS scripts

addInterleavedPCM.bms
Adds an adjustable Interleaved PCM header to a headerless file. Playable with vgmstream afterwards. Those files are mostly the audio of PS2 movies. It's a variant of uncompressed PCM and can be transformed to non-interleaved PCM (e.g. with Winamp's DiscWriter plugin). The format itself is of course uncompressed.

```

set FREQ 44100
set CH 2

get SIZE asize
get NAME basename
string NAME += ".ads"
putVarChr MEMORY_FILE 0xc FREQ long
putVarChr MEMORY_FILE 0x10 CH long
putVarChr MEMORY_FILE 0x24 SIZE long
append
log MEMORY_FILE 0 SIZE
append
math SIZE += 0x28
log NAME 0 SIZE MEMORY_FILE
```
## Post #42
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-08-18T01:32:33+00:00
- Post Title: Re: My quickBMS scripts

Thanks 

EDIT: is the interleave adjustable on the ps2 adpcm script?
## Post #43
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-08-20T12:33:00+00:00
- Post Title: Re: My quickBMS scripts

I'm not entirely sure if the actually is an interleave... Note that this format is different from Playstation ADPCM and occurs for example when you demux *.pss videos with PSSDemux (Zophar's Domain). 
If you encounter files you have problems with, let me know and I'll take a look.
## Post #44
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-09-06T00:29:45+00:00
- Post Title: Re: My quickBMS scripts

SFD_to_ADX.bms
Demuxes Dreamcast Sofdec videos to a CRI ADX file. Change 448 to 480 and ".adx" to ".mpg" to get the video stream. 

```
endian BIG
set OFFSET 0

append
DO
	goto OFFSET
	get UNKNOWN long
	get UNKNOWN long
	get UNKNOWN long
	get IDENT long
	math OFFSET += 0x1e
	if IDENT == 448
		log MEMORY_FILE OFFSET 0x7e2
	endif
	math OFFSET += 0x7e2
WHILE OFFSET < FSIZE

get NAME basename
string NAME += ".adx"
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE
```
## Post #45
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-09-08T12:22:24+00:00
- Post Title: Re: My quickBMS scripts

addXboxADPCMheader.bms
Adds an adjustable and toWAV-decodable Xbox ADPCM header to headerless files or skips a given header area (for headers that aren't supported by toWAV). Normally those files have a simple ".wav" extension but you don't want toWAV to overwrite the original files, so I changed it to ".xba" (Xbox audio).
The new revision will adjust the header according to the channels (now also supports mono streams) and can detect the channels automatically. However, this option will only work if the stream doesn't start with a silence but with that 0x????0000 marker. 
To find out the stream start and channel count manually, open the file in a hex editor and set the column size to 0x24. If you see a 1-byte zero column, the file is mono, otherwise it's stereo (you can check that by setting the column size to 0x48, there should be two zero columns). A valid stream start is marked by a 0x0000 at the start of the first column.

```
# adds a correct Xbox ADPCM header to any data
# play with vgmstream (errornous!) or decode correctly with towav
# (c) 2012-05-29 by AlphaTwentyThree of XeNTaX

startfunction XADP
	set MEMORY_FILE binary "\x52\x49\x46\x46\x18\x51\xa3\x0\x57\x41\x56\x45\x66\x6d\x74\x20\x14\x0\x0\x0\x69\x0\x2\x0\x44\xac\x0\x0\xcc\xc1\x0\x0\x48\x0\x4\x0\x2\x0\x40\x0\x64\x61\x74\x61\xf0\x50\xa3\x0"
	set RIFFSIZE SIZE
	math RIFFSIZE += 0x28
	putVarChr MEMORY_FILE 0x04 RIFFSIZE long
	putVarChr MEMORY_FILE 0x16 CH byte
	putVarChr MEMORY_FILE 0x18 FREQ long
	set VAR1 0x3073
	math VAR1 *= CH
	if FREQ == 48000
		math VAR1 *= 44100
	else
		math VAR1 *= FREQ
	endif
	math VAR1 /= 22050
	putVarChr MEMORY_FILE 0x1c VAR1 long	
	set VAR2 0x24
	math VAR2 *= CH
	putVarChr MEMORY_FILE 0x20 VAR2 short
	putVarChr MEMORY_FILE 0x2c SIZE long
	append
	log MEMORY_FILE OFFSET SIZE
	append
	if NAME == ""
		get NAME basename
		string NAME += ".lwav"
	endif
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction
```


```
# includes a function that automatically tests data for channels 
# (c) 2012-05-29 by AlphaTwentyThree of XeNTaX

include "func_header_XADP.bms"
set OFFSET 0x0
set FREQ 22050
set CH 2
set TESTV 0 # set to zero to force channels and skip test


if TESTV == 1
	callfunction testXADP 1
endif
get SIZE asize
math SIZE -= OFFSET
callfunction XADP 1
get NAME basename
string NAME += ".xadp"
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE

# - determine channels automatically
startfunction testXADP
	set TEST OFFSET
	math TEST += 1
	goto TEST
	get VALID threebyte
	set TEST OFFSET
	math TEST += 0x27
	goto TEST
	get ZEROTEST byte
	if ZEROTEST == 0 # mono
		set CH 1
	else
		math TEST -= 0x20 # goto OFFSET+0x7
		goto TEST
		get ZEROTEST byte
		if ZEROTEST == 0
			set CH 2
		else
			print "ERROR: channels could not be determined!"
		endif
	endif
endfunction
```
## Post #46
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-09-09T16:08:55+00:00
- Post Title: Re: My quickBMS scripts

at3_to_aa3+smpl.bms
Changes an AT3+ (Atrac 3 plus) header to a valid OMA header (*.aa3) and automatically extracts the smpl area if there is one available (that's the loop points). This is the format used by most of the PSP games and seems also common among PS3 games. The resulting files can be decoded by Sony SoundForge or sometimes played by KMPlayer. The *.smpl files may be injected in decoded wave files again with my smpl_inject (link see first post). However the sample transition at3:wav isn't 1:1 so the loop points are biased and only serve as a help when editing tracks. If somebody could help me adjusting the loop points, that'd be awesome! 

```
# transforms *.at3 files with codec 
# identifier 0xfffe into aa3 (=oma) files 
# that are decodable by Sony SoundForge
#
# (c) 2012-09-04 by AlphaTwentyThree of XeNTaX

idstring "RIFF"
get SIZE asize
if SIZE == 0
	cleanexit
endif
goto 0x14
get CODEC short
if CODEC == 624
	cleanexit
endif
goto 0x3c
get INFO long
FindLoc OFFSET string "data" 0 ""
math OFFSET += 4
goto OFFSET
get SIZE long
math SIZE -= 4
get FIRST long
savepos OFFSET
set PSIZE SIZE
math PSIZE += 0x460
putVarChr MEMORY_FILE PSIZE 0
log MEMORY_FILE 0 0
set MEMORY_FILE binary "\x65\x61\x33\x3\x0\x0\x0\x0\x7\x76\x47\x45\x4f\x42\x00\x00\x01\xc6\x00\x00\x02\x62\x69\x6e\x61\x72\x79\x00\x00\x00\x00\x4f\x00\x4d\x00\x47\x00\x5f\x00\x4c\x00\x53\x00\x49\x00\x00\x00\x01\x00\x40\x00\xdc\x00\x70\x00\x08\x00\x00\x00\x00\x00\x00\x4b\x45\x59\x52\x49\x4e\x47"
putVarChr MEMORY_FILE 0x400 0x1334145 long
putVarChr MEMORY_FILE 0x404 0xffff6000 long
putVarChr MEMORY_FILE 0x420 INFO long
putVarChr MEMORY_FILE 0x460 FIRST long
append
log MEMORY_FILE OFFSET SIZE
append
get NAME basename
string NAME += ".aa3"
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE

goto 0x5c
getdstring CUE 4
if CUE == "smpl"
	get NAME basename
	string NAME += ".smpl"
	log NAME 0x5c 0x44
endif
goto 0x58
getdstring CUE 4
if CUE == "smpl"
	get NAME basename
	string NAME += ".smpl"
	log NAME 0x58 0x44
endif
goto 0x44
getdstring CUE 4
if CUE == "smpl"
	get NAME basename
	string NAME += ".smpl"
	log NAME 0x58 0x44
endif
goto 0x48
getdstring CUE 4
if CUE == "smpl"
	get NAME basename
	string NAME += ".smpl"
	log NAME 0x58 0x44
endif
```
## Post #47
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-09-14T20:59:46+00:00
- Post Title: Re: My quickBMS scripts

What if the at3 files have no header? i have encountered some of these.

Thanks for the script anyway works great
## Post #48
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-09-20T22:41:03+00:00
- Post Title: Re: My quickBMS scripts

add_aa3_header.bms
Adds a standard aa3 header to a headerless file.

```
# set CODE 0x01002417 # 44100, 1,  32
# set CODE 0x01002422 # 44100, 1,  48
# set CODE 0x0100242E # 44100, 1,  64
# set CODE 0x01002445 # 44100, 1,  96
# set CODE 0x0100245c # 44100, 1, 128
# set CODE 0x0100248B # 44100, 1, 192
# set CODE 0x01002817 # 44100, 2,  32
# set CODE 0x01002822 # 44100, 2,  48
# set CODE 0x0100282E # 44100, 2,  64
# set CODE 0x01002845 # 44100, 2,  96
set CODE 0x0100285C # 44100, 2, 128
# set CODE 0x0100288B # 44100, 2, 192
# set CODE 0x010034E8 # 44100, 6, 320
# set CODE 0x01003573 # 44100, 6, 512
# set CODE 0x01004455 # 48000, 1, 128
# set CODE 0x01004855 # 48000, 2, 128
# set CODE 0x010054AA # 48000, 6, 256
# set CODE 0x010054D5 # 48000, 6, 320
# set CODE 0x010054FF # 48000, 6, 384
# set CODE 0x01005555 # 48000, 6, 512
reverselong CODE

set OFFSET 0x0
set MEMORY_FILE binary "\x65\x61\x33\x3\x0\x0\x0\x0\x7\x76\x47\x45\x4f\x42\x00\x00\x01\xc6\x00\x00\x02\x62\x69\x6e\x61\x72\x79\x00\x00\x00\x00\x4f\x00\x4d\x00\x47\x00\x5f\x00\x4c\x00\x53\x00\x49\x00\x00\x00\x01\x00\x40\x00\xdc\x00\x70\x00\x08\x00\x00\x00\x00\x00\x00\x4b\x45\x59\x52\x49\x4e\x47"
putVarChr MEMORY_FILE 0x400 0x1334145 long
putVarChr MEMORY_FILE 0x404 0xffff6000 long
putVarChr MEMORY_FILE 0x420 CODE long
goto OFFSET
get FIRST long
putVarChr MEMORY_FILE 0x460 FIRST long
savepos DATA
get SIZE asize
math SIZE -= OFFSET
math SIZE -= 4
append
log MEMORY_FILE DATA SIZE
append
get NAME basename
string NAME += ".aa3"
math SIZE += 0x460

log NAME 0 SIZE MEMORY_FILE

```

Hope that helps, Orange
## Post #49
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-09-21T00:18:28+00:00
- Post Title: Re: My quickBMS scripts

Thanks alpha.

However it does not work for a standard stereo 48hz file i tried. Not sure if it has to do with regular atrac3 or atrac3plus. Also this file has a MSF header at the start.

[http://www.megaupload.com/?d=PYD76HDL](http://www.megaupload.com/?d=PYD76HDL)
## Post #50
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-09-24T09:31:53+00:00
- Post Title: Re: My quickBMS scripts

func_header_AT3.bms
This is a header adder function for standard RIFF at (no AT3+).
Note that Atrac files only have 66, 105 or 132 kbps. If you don't know which one of them they have, you'll have to try out, I haven't found a way to distinguish between them. As always, you'll need a headerless file. 

```
# Needed variables: OFFSET, SIZE, BITRATE, FREQ, CH
# Note that mono atrac files are non-standard and automatically saved as stereo.
# To get the original file, decode the stereo at3 to wav and change the channels via hex.
# (c) 2012-07-25 by AlphaTwentyThree of XeNTaX

startfunction AT3
	endian little
	set MEMORY_FILE binary "\x52\x49\x46\x46\x88\xb3\x6d\x0\x57\x41\x56\x45\x66\x6d\x74\x20\x20\x0\x0\x0\x70\x2\x2\x0\x80\xbb\x0\x0\x9a\x40\x0\x0\x80\x1\x0\x0\xe\x0\x1\x0\x0\x10\x0\x0\x0\x0\x0\x0\x1\x0\x0\x0\x66\x61\x63\x74\x8\x0\x0\x0\x91\x81\x24\x1\x1b\x4\x0\x0\x64\x61\x74\x61\x88\xb3\x6d\x0"
	if BITRATE == 66
		putVarChr MEMORY_FILE 0x1c 0x204d long
		putVarChr MEMORY_FILE 0x20 0xc0 long
	elif BITRATE == 105
		putVarChr MEMORY_FILE 0x1c 0x3324 long
		putVarChr MEMORY_FILE 0x20 0x130 long
	elif BITRATE == 132
		putVarChr MEMORY_FILE 0x1c 0x409a long
		putVarChr MEMORY_FILE 0x20 0x180 long
	endif
	set RIFFSIZE SIZE
	math RIFFSIZE += 0x44
	putVarChr MEMORY_FILE 0x04 RIFFSIZE long
	putVarChr MEMORY_FILE 0x18 FREQ long
	putVarChr MEMORY_FILE 0x48 SIZE long
	append
	log MEMORY_FILE OFFSET SIZE
	append
	if NAME == ""
		get NAME basename
		if CH == 1
			set CH 2
			string NAME += "_"
			string NAME += "mono"
		endif
		string NAME += ".at3"
	endif
	putVarChr MEMORY_FILE 0x16 CH byte
	
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction
```


And as always a sample main:

```

set FREQ 32000
set CH 2
set OFFSET 0x0
set BITRATE 132

get SIZE asize
math SIZE -= OFFSET
callfunction AT3 1
```
## Post #51
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-09-24T09:44:45+00:00
- Post Title: Re: My quickBMS scripts

The following two scripts are for transferring the loop points from PSP and PS3 AT3+ files to decoded wave files. Background: AT3+ needs to be traversed into OMA first to decode it with Sony SoundForge which deletes the looping cues. Use the first script to extract the cues from the *.at3 files, then write them to the decoded *.wav files with the second script. It will overwrite the files. Note that the looping cue isn't at the very right spot as I don't know how the AT3 samples are represented in the decoded WAV. It's some ms off, but if it's not at the very beginning of the stream you'll get the idea about where the cue should be.
The second procedurecan also be used to inject a *.smpl file into any wave file with the same name. If that wave file already has a "smpl" are in the header, the script automatically saves the old one as *.smpl_old and substitutes it with the new. 

at3_smpl_extract.bms

```
getdstring CUE 4
if CUE == "smpl"
	get NAME basename
	string NAME += ".smpl"
	log NAME 0x5c 0x44
endif
goto 0x58
getdstring CUE 4
if CUE == "smpl"
	get NAME basename
	string NAME += ".smpl"
	log NAME 0x58 0x44
endif
goto 0x44
getdstring CUE 4
if CUE == "smpl"
	get NAME basename
	string NAME += ".smpl"
	log NAME 0x58 0x44
endif
goto 0x48
getdstring CUE 4
if CUE == "smpl"
	get NAME basename
	string NAME += ".smpl"
	log NAME 0x58 0x44
endif
```

at3_wav_smpl_inject.bms

```
FindLoc DATA STRING "data" 0 ""

open FDDE SMPL 1 EXISTS
if EXISTS == 0
    print "no sample file available"
    cleanexit
endif
goto 0x58 0
getdstring CUE 4
if CUE == "smpl"
    get NAME basename
    string NAME += ".smpl_old"
    log NAME 0x58 0x44 0
endif
append
log MEMORY_FILE 0 0x24 # write header to memory
get SMPLSIZE asize 1
log MEMORY_FILE 0 SMPLSIZE 1 # append smpl area
get DSIZE asize 0
math DSIZE -= DATA
log MEMORY_FILE DATA DSIZE
append
get NAME basename
string NAME += ".wav"
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE

```
## Post #52
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-09-24T17:01:38+00:00
- Post Title: Re: My quickBMS scripts

Thanks alpha worked with haze.

now we just need to figure out how to parse the interleave segments and an at3 file.
## Post #53
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-09-30T08:22:58+00:00
- Post Title: Re: My quickBMS scripts

Just corrected the XA deinterleave script: [viewtopic.php?f=13&t=4450&p=40777#p40777](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=40777#p40777)
Now recognizes correct stream stops.
## Post #54
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-01T18:50:16+00:00
- Post Title: Re: My quickBMS scripts

func_str2num.bms
Function that converts a string representation of an integer to an integer varialble. Needed for func_XMA_header.bms for example. 
The string you want to convert has to be named NUM.

```
    set TONUM 0
    strlen l NUM
    for i = 0 < l
        set EXP l
        math EXP -= i
        math EXP -= 1
        set B 0xA
        math B p EXP
        getVarChr T NUM i
        math T -= 0x30
        math T *= B
        math TONUM += T
    next i
    set NUM TONUM
endfunction
```
## Post #55
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-01T20:30:55+00:00
- Post Title: Re: My quickBMS scripts

VAG_scanner.bms
Scans a file for mono VAG files, automatically names the files.

```
    FindLoc OFFSET STRING "VAGp" 0 ""
    if OFFSET != ""
        set SIZE OFFSET
        math SIZE += 0xC
        goto SIZE
        get SIZE long
        reverselong SIZE
        math SIZE += 0x30
        set NAME OFFSET
        math NAME += 0x20
        goto NAME
        get NAME string
        string NAME += ".vag"
        log NAME OFFSET SIZE
        math OFFSET += SIZE
        goto OFFSET
    else
        cleanexit
    endif
next i
```
## Post #56
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2010-10-02T11:53:55+00:00
- Post Title: Re: My quickBMS scripts

I tried use scripts and at3 converter, but SoundForge still believes .aa3 and RIFF .at3 files as empty:


Files for testing - [http://ifolder.ru/19576388](http://ifolder.ru/19576388)
## Post #57
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-02T14:12:12+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #58
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-02T16:30:19+00:00
- Post Title: Re: My quickBMS scripts

post deleted
## Post #59
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-02T16:42:41+00:00
- Post Title: Re: My quickBMS scripts

Regarding your uploaded samples: all *.mft files can bee converted with the above script. I've also looked at the other two files: 
- SND0.at3 is standard AT3+ and has to be turned into an *.aa3 with my at3toaa3.bms script before you can open it with SoundForge.
- The Audio.at3 can be parsed with the script in the next post. It's a headerless AT3+ file. The script transforms it into an *.aa3 file so that SoundForge can open it.
## Post #60
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2010-10-02T17:11:54+00:00
- Post Title: Re: My quickBMS scripts

Audio.at3 obtained through this program [http://ifolder.ru/19566825](http://ifolder.ru/19566825) (get from ps3ripkits.com)

This program can convert .pmf psp movie files and .pam ps3 movie files(if rename to .pmf) to uncompress .avi(video) and .at3(audio).
## Post #61
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-02T17:13:28+00:00
- Post Title: Re: My quickBMS scripts

pmfAT3_to_aa3.bms
Converts dumped AT3 streams from PMF movies to decodable *.aa3 files.

```
get CODE short

set INTERL 0x2b8
set SKIP 0x8
set LAYERS 1
set JUMP INTERL
math JUMP *= LAYERS
math INTERL -= SKIP
get FSIZE asize
for i = 1 <= LAYERS
    log MEMORY_FILE 0 0
    set OFFSET i
    math OFFSET -= 1
    math OFFSET *= INTERL
    math OFFSET += SKIP
    append
    DO
        log MEMORY_FILE OFFSET INTERL
        math OFFSET += JUMP
        math OFFET += SKIP
        set TEST OFFSET
        math TEST += INTERL
    WHILE TEST <= FSIZE
    if OFFSET < FSIZE # write last block
        get LB asize
        math LB -= OFFSET
        log MEMORY_FILE OFFSET LB
    endif
    append
next i

set MEMORY_FILE2 binary "\x65\x61\x33\x3\x0\x0\x0\x0\x7\x76\x47\x45\x4f\x42\x00\x00\x01\xc6\x00\x00\x02\x62\x69\x6e\x61\x72\x79\x00\x00\x00\x00\x4f\x00\x4d\x00\x47\x00\x5f\x00\x4c\x00\x53\x00\x49\x00\x00\x00\x01\x00\x40\x00\xdc\x00\x70\x00\x08\x00\x00\x00\x00\x00\x00\x4b\x45\x59\x52\x49\x4e\x47"
putVarChr MEMORY_FILE2 0x400 0x1334145 long
putVarChr MEMORY_FILE2 0x404 0xffff6000 long
putVarChr MEMORY_FILE2 0x420 0x1 byte
putVarChr MEMORY_FILE2 0x422 CODE short
goto 0 MEMORY_FILE
get FIRST long MEMORY_FILE
putVarChr MEMORY_FILE2 0x460 FIRST long
savepos DATA MEMORY_FILE
get SIZE asize MEMORY_FILE
math SIZE -= 4
print "here"
append
log MEMORY_FILE2 4 SIZE MEMORY_FILE1
append
get NAME basename
string NAME += ".aa3"
math SIZE += 0x460

log NAME 0 SIZE MEMORY_FILE2
```
## Post #62
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-02T17:22:26+00:00
- Post Title: Re: My quickBMS scripts

I've attached a program that can convert PMF to parsed AT3+ files (with RIFF header). I downloaded it from some chinese site, can't remember which one.  Use my at3toaa3.bms to convert the results into decodable aa3 files (open with SoundForge).
[pmfdemux.zip](https://xentaxbackup.github.io/file/3490_pmfdemux.zip)
## Post #63
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2010-10-02T17:29:09+00:00
- Post Title: Re: My quickBMS scripts

Thanks! Works.

pmfdemux don`t work with .pam ps3 video files(message - this is not PMF).
PMF2AVI&AT3 has APPCRASH with .pam files from another game(White Knight Chronicles EX Edition).
## Post #64
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-02T18:12:21+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #65
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-08T21:46:20+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #66
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-08T21:48:51+00:00
- Post Title: Re: My quickBMS scripts

MSF converter
Converts PS3 *.msf files into valid *.at3, *.ss2 and *.wav files. Not all variants are supported yet so if you encounter some problem, just PM me and I'll try to add support. 
Note that some MSF files with AT3 stream state the wrong frequency in the header. The script will tell you when such a file is found. You'll have to change the frequency with [viewtopic.php?f=13&p=71565#p71565](http://forum.xentax.com/viewtopic.php?f=13&p=71565#p71565).
func_header_AT3.bms: [viewtopic.php?f=13&p=42999#p42999](http://forum.xentax.com/viewtopic.php?f=13&p=42999#p42999)
func_header_SS2.bms: [viewtopic.php?f=13&p=44717#p44717](http://forum.xentax.com/viewtopic.php?f=13&p=44717#p44717)
func_headre_PCM.bms: [viewtopic.php?f=13&p=71565#p71565](http://forum.xentax.com/viewtopic.php?f=13&p=71565#p71565)

```
# converts PS3 *.msf containers to playable Atrac files
# (c) 2012-07-22 by AlphaTwentyThree of XeNTaX

include "func_header_AT3.bms"
include "func_header_PCM.bms"
include "func_header_SS2.bms"

IDstring MSF
endian big
set NAME ""
get SIGN byte
get BITSIGN long
get CH long
get SIZE long
if SIGN == 0xc9
	get DUMMY long
endif
get FREQ long
set OFFSET 0x40
math SIZE -= OFFSET
if SIGN == 0x43
	if BITSIGN >= 4
		print "Warning: frequency might be wrong!"
		set BITRATE 132
		callfunction AT3 1
		cleanexit
	endif
endif
if BITSIGN == 1 # wav PCM
	set BITS 16
	set BLOCKALIGN 1
	set CODEC 1
	callfunction PCM 1
elif BITSIGN == 3 # ss2 mono
	set INTERLEAVE 0x10
	callfunction SS2 1
elif BITSIGN == 4
	set BITRATE 66
	callfunction AT3 1
elif BITSIGN == 5
	set BITRATE 105
	callfunction AT3 1
elif BITSIGN == 6
	set BITRATE 132
	callfunction AT3 1
endif
```
## Post #67
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-08T21:53:53+00:00
- Post Title: Re: My quickBMS scripts

extractXWS.bms
Extracts the Atrac files from *.xws containers (used in some PS3 games). Header is automatically adjusted, files are playable with the Atrac codec installed. Note: DO NOT OPEN ATRAC FILES WITH SONY SOUNDFORGE - ONLY ATRAC3+ FILES!!! It somehow gets the samples of simple Atrac files totally wrong when the sample count isn't adjusted (which none of the scripts does). However, I'm not sure if it's necessary to adjust the samples because I have the feeling that the (necessarily) calculated samples of audio editors could be wrong. The samples could be the value at offset 0x8 into the "fact" area of the header. Compared to the calculated samples in Audition for example, there's quite a discrepancy. Can anyone explain or clear this?

```
getdstring IDENT 8
get UNKNOWN long
get UNKNOWN long
get FILESIZE long
get UNKNOWN long
get UNKNOWN long
get UNKNOWN long
get INFO1OFF long
get INFO2OFF long # unknown informatin

goto INFO1OFF
get UOFF long # unknown information
get CODEOFF long
get MSF long # MSFBANK

goto INFO2OFF
get UNKNOWNOFF long
get UNKNOWNOFF long
get DATASIZE long # size from MSFBANK till end

set OFF MSF
math OFF += 0x14
goto OFF

get FILES long
math OFF += 0x1c
set OFFPOS OFF
set SIZEPOS FILES
math SIZEPOS *= 4
math SIZEPOS += OFFPOS
math SIZEPOS += 0xc
get BNAME basename
string BNAME += "_"

for i = 1 <= FILES
    endian big
    goto OFFPOS
    get OFFSET long
    math OFFSET += MSF
    
    savepos OFFPOS
    goto SIZEPOS
    get SIZE long
    savepos SIZEPOS
    set NAME BNAME
    string NAME += i
    goto OFFSET
    callfunction writeAT3 1
next i

startfunction writeAT3
    
    # read info from header and adjust size
    goto OFFSET
    getDstring MSIG 4 # "MSF0" or "MSFC"
    get BITSIGN long
    get UNK long
    get SIZE long
    get FREQ long
    math OFFSET += 0x40
    
    endian little
    set MEMORY_FILE binary "\x52\x49\x46\x46\x88\xb3\x6d\x0\x57\x41\x56\x45\x66\x6d\x74\x20\x20\x0\x0\x0\x70\x2\x2\x0\x80\xbb\x0\x0\x9a\x40\x0\x0\x80\x1\x0\x0\xe\x0\x1\x0\x0\x10\x0\x0\x0\x0\x0\x0\x1\x0\x0\x0\x66\x61\x63\x74\x8\x0\x0\x0\x91\x81\x24\x1\x1b\x4\x0\x0\x64\x61\x74\x61\x88\xb3\x6d\x0"
    string NAME += ".at3"
    set RIFFSIZE SIZE
    math RIFFSIZE += 0x44
    if BITSIGN == 4 # 66kbps
        putVarChr MEMORY_FILE 0x1c 0x204d long
        putVarChr MEMORY_FILE 0x20 0xc0 long
    elif BITSIGN == 5 # 105 kbps
        putVarChr MEMORY_FILE 0x1c 0x3324 long
        putVarChr MEMORY_FILE 0x20 0x130 long
    elif BITSIGN == 6 # 132 kbps
        putVarChr MEMORY_FILE 0x1c 0x409a long
        putVarChr MEMORY_FILE 0x20 0x180 long
    endif
    putVarChr MEMORY_FILE 0x04 RIFFSIZE long
    putVarChr MEMORY_FILE 0x16 0x2 byte
    putVarChr MEMORY_FILE 0x18 FREQ long
    putVarChr MEMORY_FILE 0x48 SIZE long
    append
    log MEMORY_FILE OFFSET SIZE
    append
    math SIZE += 0x4c
    log NAME 0 SIZE MEMORY_FILE
    endian big
endfunction

```
## Post #68
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-08T22:08:40+00:00
- Post Title: Re: My quickBMS scripts

Thanks for the MSF script
## Post #69
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-08T23:02:32+00:00
- Post Title: Re: My quickBMS scripts

np
## Post #70
- Username: 1212fg
- Rank: ultra-n00b
- Number of posts: 8
- Joined date: Sun Oct 03, 2010 9:07 pm
- Post datetime: 2010-10-11T16:24:57+00:00
- Post Title: Re: My quickBMS scripts

thanks a lot AlphaTwentyThree for scripts. Im noob and until today i didn know about quickbms, but with Your scripts a had  successful extracted tracks from Skate 3 on Xbox 360. I suggest better file naming - sorting in explorer doesnt work good with this filenames, but there is always search function  Also Your header script  was useful for another rip. Is there any chance to make script which will combine WAV files? I combine one song manually and its painfull;
## Post #71
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-12T09:31:09+00:00
- Post Title: Re: My quickBMS scripts

Glad you could use some of the scripts here.  Skate 3 was actually the game I wrote the EA script for. You can change the script if you want to use the information otherwise, I just throw all the info into the filename because it shows which segments belong together.
Combining segments is only easy when the files really match, i.e. if there's no silence or click at the transition. Try it first by combining the segments with Winamp. If you play the song and don't hear any transition: play and close your eyes to be unable to see where the transitions are - if you don't hear anything, the combining is ok. Then just switch to the old DiscWriter Plugin to write the merged file to disc. I think I also wrote this into the EA segments post. If you have any questions, just ask here.
## Post #72
- Username: 1212fg
- Rank: ultra-n00b
- Number of posts: 8
- Joined date: Sun Oct 03, 2010 9:07 pm
- Post datetime: 2010-10-12T10:24:07+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Glad you could use some of the scripts here.  Skate 3 was actually the game I wrote the EA script for. You can change the script if you want to use the information otherwise, I just throw all the info into the filename because it shows which segments belong together.
Combining segments is only easy when the files really match, i.e. if there's no silence or click at the transition. Try it first by combining the segments with Winamp. If you play the song and don't hear any transition: play and close your eyes to be unable to see where the transitions are - if you don't hear anything, the combining is ok. Then just switch to the old DiscWriter Plugin to write the merged file to disc. I think I also wrote this into the EA segments post. If you have any questions, just ask here.
I forgot about this winamp plugin, it much easier than cut& paste in wave editor;)
## Post #73
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-12T10:28:05+00:00
- Post Title: Re: My quickBMS scripts

> Reply from 1212fg
>
> I forgot about winamp plugin, it much easier than cut& paste in wave editor;)
Hehe 
The plugin is neat because it stream-dumps the data onto disk DIGITALLY - unlike loop-recording with your soundcard, which is always ANALOGUE!
## Post #74
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-12T11:12:45+00:00
- Post Title: Re: My quickBMS scripts

The plugin is really useful however the segments im using are 36hz and there is no setting for that in there, is there someway i can change it or should i just use another program?
## Post #75
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-12T11:59:36+00:00
- Post Title: Re: My quickBMS scripts

The frequency is taken from the archive information, so you shouldn't change it in the first place.
## Post #76
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-12T12:40:37+00:00
- Post Title: Re: My quickBMS scripts

In single file mode the default setting is 44hz i can't remove that setting, nor is there a setting to keep the default rate of the file.
## Post #77
- Username: teresap989
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Wed Oct 13, 2010 3:01 pm
- Post datetime: 2010-10-13T07:33:51+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> at3_to_aa3.bms
Changes an AT3+ (Atrac 3 plus) header to a valid OMA header (*.aa3). This is the format used by most of the PSP games and seems also common among PS3 games. The resulting files can be decoded by Sony SoundForge or played by KMPlayer.
Code: Select allidstring RIFF
goto 0x14
get CODEC short
if CODEC == 624
	cleanexit
endif
goto 0x3c
get INFO long
FindLoc SIZE string "data" 0 ""
math SIZE += 4
goto SIZE
get SIZE long
savepos DATA
set MEMORY_FILE binary "\x65\x61\x33\x3\x0\x0\x0\x0\x7\x76\x47\x45\x4f\x42\x00\x00\x01\xc6\x00\x00\x02\x62\x69\x6e\x61\x72\x79\x00\x00\x00\x00\x4f\x00\x4d\x00\x47\x00\x5f\x00\x4c\x00\x53\x00\x49\x00\x00\x00\x01\x00\x40\x00\xdc\x00\x70\x00\x08\x00\x00\x00\x00\x00\x00\x4b\x45\x59\x52\x49\x4e\x47"
putVarChr MEMORY_FILE 0x400 0x1334145 long
putVarChr MEMORY_FILE 0x404 0xffff6000 long
putVarChr MEMORY_FILE 0x420 INFO long
get FIRST long
putVarChr MEMORY_FILE 0x460 FIRST long
math DATA += 4
math SIZE -= 4
append
log MEMORY_FILE DATA SIZE
append
get NAME basename
string NAME += ".aa3"
math SIZE += 0x460

log NAME 0 SIZE MEMORY_FILE
Thank you so much for the post. It's really informative!




__________________
[watch free movies online](http://moviesonlineworld.com)
## Post #78
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-13T11:33:52+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> In single file mode the default setting is 44hz i can't remove that setting, nor is there a setting to keep the default rate of the file.
Are you talking about the XMA or the EAXA version?
## Post #79
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-13T19:18:26+00:00
- Post Title: Re: My quickBMS scripts

EA XA version.
## Post #80
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-13T21:01:25+00:00
- Post Title: Re: My quickBMS scripts

Yeah well, as I said, the line "get FREQ long" means that the frequency is hard-coded into the container. If you really need to change it, just comment the line and substitute it by "set FREQ 44100" or whatever frequency you like. I just can't believe they coded the wrong frequency into their own container...
## Post #81
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-13T23:01:38+00:00
- Post Title: Re: My quickBMS scripts

The ea XA version im using is the old ea xa with headers, it is from Need for speed carbon and therefore i can't use your script because the old container doesn't have the same filetable structure as the new one, so i have to scan the xa headers and extract them, there native rate is 36hz. the winamp plugin file merge doesn't have a 36hz option and you can't enter your own, its strictly set to default at 44hz.

Never mind anyway i have found another app that can help me.
## Post #82
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-14T16:43:55+00:00
- Post Title: Re: My quickBMS scripts

Buzz Quiz TV.

Attached below is a headerles atrac3 with a non-riff or msf header, i think it maybe plus seeing as the standard at3 header doesn't work nor the aa3 script with 48hz set.

Take a look please? 
[BQC-ChooseEnd.rar](https://xentaxbackup.github.io/file/3531_BQC-ChooseEnd.rar)
## Post #83
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-14T16:44:32+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> the winamp plugin file merge doesn't have a 36hz option and you can't enter your own, its strictly set to default at 44hz.[](http://img215.imageshack.us/i/discwriterfreq.png/)
Nothing more to say here I guess... Please don't post about things you don't know for sure - it might confuse other users.

I'm in the structure of the old containers so I could update my script! Can you upload one of the containers please? Thanks!
## Post #84
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-14T16:57:28+00:00
- Post Title: Re: My quickBMS scripts

[http://www.megaupload.com/?d=OR8Q5IQR](http://www.megaupload.com/?d=OR8Q5IQR)
## Post #85
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-14T17:08:45+00:00
- Post Title: Re: My quickBMS scripts

rsf_to_at3.bms
Converts the *.rsf files from Buzz! Quiz TV (PS3) to playable and decodable AT3 files.

```

endian big
goto 0x4
get FREQ short
goto 0x10
get BITRATE long

endian little
set OFFSET 0x20
if BITRATE == 0xc0
    putVarChr MEMORY_FILE 0x1c 0x204d long
    putVarChr MEMORY_FILE 0x20 0xc0 long
elif BITRATE == 0x130
    putVarChr MEMORY_FILE 0x1c 0x3324 long
    putVarChr MEMORY_FILE 0x20 0x130 long
elif BITRATE == 0x180
    putVarChr MEMORY_FILE 0x1c 0x409a long
    putVarChr MEMORY_FILE 0x20 0x180 long
endif
get NAME basename
get SIZE asize
math SIZE -= OFFSET
string NAME += ".at3"
set RIFFSIZE SIZE
math RIFFSIZE += 0x44
putVarChr MEMORY_FILE 0x04 RIFFSIZE long
putVarChr MEMORY_FILE 0x18 FREQ long
putVarChr MEMORY_FILE 0x48 SIZE long

append
log MEMORY_FILE OFFSET SIZE
append
math SIZE += 0x4c
log NAME 0 SIZE MEMORY_FILE
```
## Post #86
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-14T17:12:41+00:00
- Post Title: Re: My quickBMS scripts

Thanks 

EDIT; i think its doing something wrong because when i try your script on the file it gets the channel count wrong (14 ch) also the file doesn't decode all the way, just plays a couple of seconds of music.
## Post #87
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-14T19:43:28+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> EDIT; i think its doing something wrong because when i try your script on the file it gets the channel count wrong (14 ch) also the file doesn't decode all the way, just plays a couple of seconds of music.
Upload a file where it doesn't work and I'll take a look. Works fine for the one you uploaded. And btw, don't open the files with SoundForge, it get's many things wrong with simple atrac files. Just use Audition, WaveLab or GoldWave.
## Post #88
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-14T20:04:29+00:00
- Post Title: Re: My quickBMS scripts

[http://www.megaupload.com/?d=8LU07LCN](http://www.megaupload.com/?d=8LU07LCN)

Goldwave and audition both won't import it and i have the atrac3 codec installed.
## Post #89
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-14T22:49:33+00:00
- Post Title: Re: My quickBMS scripts

Script updated, should work now.
## Post #90
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-14T22:56:12+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> http://www.megaupload.com/?d=OR8Q5IQROk, I'll see what I can do. The file has no header, so it suffices to just run a scanner...

(Forget the last post.)
## Post #91
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-14T23:29:45+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Script updated, should work now.

Strange, when import the menu track in audition it starts playing but then it cuts off and crashes the program. in explorer dbpoweramp shows a runtime of over 6minutes, that can't be right unless if the file is compressed really small.
## Post #92
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-14T23:33:16+00:00
- Post Title: Re: My quickBMS scripts

EA_ASF_scan.bms
Just scans for the older EA *.asf files. Can be used on the other *.mus containers that don't contain any header information.

```
string BNAME += "_"
set OFFSET 0

for i = 1
    goto OFFSET
    FindLoc OFFSET string "\x53\x43\x48\x6c\x2c\x0\x0\x0" 0 ""
    goto OFFSET
    FindLoc SIZE string "\x53\x43\x45\x6c\x8" 0 ""
    math SIZE += 5
    math SIZE -= OFFSET
    set NAME BNAME
    string NAME += i
    string NAME += ".asf"
    log NAME OFFSET SIZE
    math OFFSET += SIZE
next i
```
## Post #93
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-14T23:35:46+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> AlphaTwentyThree wrote:Script updated, should work now. 

Strange, when import the menu track in audition it starts playing but then it cuts off and crashes the program. in explorer dbpoweramp shows a runtime of over 6minutes, that can't be right unless if the file is compressed really small.
Ah ok, still something wrong... will take a look tomorrow.
## Post #94
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-28T22:07:43+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #95
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-10-29T13:46:40+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #96
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-10-29T14:03:13+00:00
- Post Title: Re: My quickBMS scripts

Thanks it works great!
## Post #97
- Username: mauzerX
- Rank: advanced
- Number of posts: 57
- Joined date: Thu Jul 01, 2010 8:48 pm
- Post datetime: 2010-11-04T19:20:40+00:00
- Post Title: Re: My quickBMS scripts

Hello lpha,an you write a script for converting from at3 to msf\MSF?
## Post #98
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-08T06:03:51+00:00
- Post Title: Re: My quickBMS scripts

> Reply from mauzerX
>
> Hello lpha,an you write a script for converting from at3 to msf\MSF?
Hm, I can try but some of the variables are unknown to me so I have no idea which value they should hold. But maybe it works nevertheless - I have no possibility to test it, though. Will drop you a PM when I get to coding it.
## Post #99
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-08T06:04:31+00:00
- Post Title: Re: My quickBMS scripts

Updated the script to add PS2 ADPCM (*.ss2) headers - a test was missing if the interleave and stream size fit together.
## Post #100
- Username: mauzerX
- Rank: advanced
- Number of posts: 57
- Joined date: Thu Jul 01, 2010 8:48 pm
- Post datetime: 2010-11-08T14:36:01+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> 
Hm, I can try but some of the variables are unknown to me so I have no idea which value they should hold. But maybe it works nevertheless - I have no possibility to test it, though. Will drop you a PM when I get to coding it.
Thx,I'll be waiting impatiently
## Post #101
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-09T14:16:08+00:00
- Post Title: Re: My quickBMS scripts

func_header_SS2.bms
My second and more sophisticated approach to add a custom PS2 ADPCM SS2 header for vgmstream. I've used the include function and kept the main function as small as possible so that most of the actions needed are done in the function. Thus, scripts for other PS2 headers can be very easily and quickly assembled (just some 'go' and 'get' commands). As you can see I also updated the script with a memory pre-allocation to make it _way_ faster. 

```
# needed variables: 
# OFFSET, SIZE, FREQ, CH, INTERLEAVE, NAME (optional)
# (c) 2012-04-10 by AlphaTwentyThree of XeNTaX

startfunction SS2
	set MSIZE SIZE
	math MSIZE += 0x38
	putVarChr MEMORY_FILE MSIZE 0
	log MEMORY_FILE 0 0
	set MEMORY_FILE binary "\x53\x53\x68\x64\x18\x00\x00\x00\x10\x00\x00\x00\xb0\x36\x00\x00\x02\x00\x00\x00\xc0\x2f\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\x53\x53\x62\x64\x00\xe8\x11\x00"
	append
	log MEMORY_FILE OFFSET SIZE
	append
	
	putVarChr MEMORY_FILE 0xc FREQ long
	putVarChr MEMORY_FILE 0x10 CH byte
	putVarChr MEMORY_FILE 0x14 INTERLEAVE long
	putVarChr MEMORY_FILE 0x24 SIZE long
	if NAME == ""
		get NAME basename
		string NAME += ".ss2"
	endif
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction
```


Example for external access:

```
# (c) 2012-04-10 by AlphaTwentyThree of XeNTaX

include "func_header_SS2.bms"
set FREQ 44100
set CH 2
set INTERLEAVE 0x2400
set OFFSET 0x800
set NAME ""
get SIZE asize
math SIZE -= OFFSET
callfunction SS2 1
```
## Post #102
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-11-09T19:50:12+00:00
- Post Title: Re: My quickBMS scripts

Once again OJ here with another riveting format 

Call Of Duty black ops this time around treyarch did not add any headers to there ms adpcm audio. well RIFF headers, instead there is another custom header with sample and channel count.
but can't get any other info to decode to add a proper header in genh.
[http://www.megaupload.com/?d=K9PA9KQH](http://www.megaupload.com/?d=K9PA9KQH)

Your ima adpcm header did not work.
## Post #103
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-10T00:19:51+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> Once again OJ here with another riveting format 

Call Of Duty black ops this time around treyarch did not add any headers to there ms adpcm audio. well RIFF headers, instead there is another custom header with sample and channel count.
but can't get any other info to decode to add a proper header in genh.
http://www.megaupload.com/?d=K9PA9KQH

Your ima adpcm header did not work.Of course it doesn't work when it's MS ADPCM...  Well, this finally looks like I have to write some MS_ADPCM heasder adder. Such a coincidence that I was taking a look at Two Worlds (PC), which also has a MS ADPCM header variant. But I couldn't figure it out yet, seems like some variable is in the wrong place. Playing time is correct, it's just not played properly. Don't use GENH, development has stopped there and who knows how long those *.genh files are still playable. I've changed to the original headers, too.
## Post #104
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-11-10T00:51:20+00:00
- Post Title: Re: My quickBMS scripts

aha i see now, will wait for your header.
## Post #105
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-11T17:19:47+00:00
- Post Title: Re: My quickBMS scripts

Quake_4_X360_xpr.bms
Just coded a script to extract those *.xpr sound containers of Quake 4 for the Xbox 360.  The extracted XMA files have an XMA header variant so I'll write another script that converts these to decodable XMA files with seek table.

```
endian big
get INFOSIZE long
get DATASIZE long 
get FILES long
set OFFCORR INFOSIZE
math OFFCORR += 0xc

for i = 1 <= FILES
	getDstring EXT 4
	get HEADER long
	get HEADERSIZE long
	get OFFSET long
	get SIZE long
	get NAMEPOS long
	math HEADER += 0xc
	math NAMEPOS += 0xc
	math OFFSET += OFFCORR
	savepos MYOFF
	goto NAMEPOS
	get NAME string
	string NAME += "."
	string NAME += EXT
	savepos NAMEPOS
	goto MYOFF
	log MEMORY_FILE 0 0
	append
	log MEMORY_FILE HEADER HEADERSIZE
	log MEMORY_FILE OFFSET SIZE
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
	append
next i
```
## Post #106
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-11-18T12:07:50+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #107
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-18T14:01:06+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #108
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2010-11-28T12:20:23+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #109
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-28T14:15:31+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #110
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-28T14:25:26+00:00
- Post Title: Re: My quickBMS scripts

Generic file splitter
This is a VERY powerful script if you encounter a game archive with various files of one type in it but without information table. Happens quite often in PS2 games I realized now. The script searches for occurances of a given string and splits up the file where such an occurance is found.
You find some really useful suggestions for some split types inside the script. Remember to adjust the other variables accordingly of you use one of them (see comments in script).
What you have to adjust:

set OFFSET # - offset where the first file to be written starts. If you leave it at zero, the script will also write the area before the first occurance of the search string to disk
set SKIP # - if you want to leave out bytes after the designated searchstring, put that here. Can be negative (e.g. when you don't want to distinguish between RIFF and RIFX files, just search for "WAVEfmt" and set SKIP to -8)
set NEGBIAS # - if the split identifier is at the end of a file (like stop markers), adjust this to the length of the identifier. E.g. if some file type always ends in 0xFFFFFFFFFFFFFFFF, search for \xff\xff\xff\xff\xff\xff\xff\xff and set NEGBIAS to 8.
set SIZEBIAS # - STANDARD VALUE IS -1! If you want to extract only one type of file and the file size is given in the header, set this to the according value. With this option, the script works as a file scanner (!).
set REV 0/1 - if the file size from the above offset is big endian, just set this to 1
FindLoc SIZE string # 0 "" - String or hex code to be searched. Hex code as always in C notation (see posted script)

Note 1: The first file to be written doesn't have any extension. It's the data block before the first found instance of the search string.
Note 2: If the search string isn't found, no data is written to disk
Note 3: The last extracted file always stops at the end of the file, so it usually contains more data than what you need.
Note 4: If you have an archive with more than one file type inside (multiple identifiers), run the script multiple times (first on the main archive, then on the extracted files).
Note 4: another use of this script is to split a file by zero blocks. For this, set the search string to the minimum zero block you need and set NEGBIAS to the length of the block you provided. Of course the script won't leave out zeros at the start of the next found split point but as a hint: you can run this script multiple times. 

Example to use this as a wave scanner:
set EXT ".wav"
set SIZEBIAS 4
set REV 0
set MINSIZE 0x10 (just estimated)
FindLoc SIZE string "RIFF" 0 ""

```
# very powerful for raw ripping
# (c) 2013-10-30 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

set OFFSET 0 # begin scan here
set SKIP 0x0 # skip bytes at start of search string 
           # (use negative value if search identifier is after file start)
set NEGBIAS 0x0 # search string at end of file e.g. stop markers (positive value!)
set EXT ".segs" # add this extention
set NAMEPOS "" # if all files are the same type and you know the position of the names
set SIZEBIAS 0xc # offset bias where file size is found
set REV 1 # 0 = leave, 1 = big endian
set MINSIZE 0x4 # minimal size of extracted file
set WRITEOFFSET 0 # toggle between file.ext@offset and file_#
get FSIZE asize

if SKIP < 0
	math OFFSET -= SKIP
else
	math OFFSET += SKIP
endif
set SEARCH OFFSET
set QUIT 0
set SINGLE 0
set i 0
do
	goto SEARCH
	#print "searching from offset %SEARCH%"
	#FindLoc SIZE string \x7\x0\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77 0 "" # VAG stop marker 1
	#FindLoc SIZE string \x7\x0\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x7\x0\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77 0 ""
	#FindLoc SIZE string \x00\x07\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77\x77 0 ""
	#FindLoc SIZE string \x00\x07\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0 0 ""
	#FindLoc SIZE string \xC\x3\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0 0 "" # VAG stop marker 2
	#FindLoc SIZE string \xC\x6\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0 0 "" # VAG stop marker 3
	#FindLoc SIZE string \xC\x7\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0 0 "" # VAG stop marker 4
	#FindLoc SIZE string \x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0 0 "" # 0x10 zero block
	#FindLoc SIZE string \x2\x28\x3\x3\x\x\x\x28 0 "" # ubisoft packet *.ubipack
	#FindLoc SIZE string "FUNlXMA2" 0 "" # xma2 container (Men in Black: Alien Crisis)
	#FindLoc SIZE string \x8D\x0C\x53\x4F 0 ""
	#FindLoc SIZE string \x5D\0\x\x80 0 "" # lzma signature
	#FindLoc SIZE string "MUSX" 0 ""
	#FindLoc SIZE string "MSFC" 0 ""
	#FindLoc SIZE string \xFF\xFF\x0\x0\xFF\xFF\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\x0\xFF\xFF\x0\x0\xFF\xFF\x0\x0 0 "" # Xbox ADPCM silence
	#FindLoc SIZE string \x0C\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00 0 "" # Xbox ADPCM silence
	#FindLoc SIZE string \x02\x28\x03\x03\x00\x00\x00\x28 0 "" # ubi sound pack
	#FindLoc SIZE string \x48\x00\x00\x0C\x13 0 "" # eaxma stream start
	#FindLoc SIZE string \x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00 0 "" # 32bytes of zeros
	#FindLoc SIZE string \x00\x00\x01\xBA\x44\x00\x04\x00 0 "" # PSS movie
	#FindLoc SIZE string \x30\x26\xB2\x75\x8E\x66\xCF\x11 0 "" # wmv
	#FindLoc SIZE string \x48\x00\x00\x0c 0 "" # EA
	#FindLoc SIZE string \x48\x00\x00\x0C 0 "" # EAlayer3
	#FindLoc SIZE string "FSB5" 0 ""
	#FindLoc SIZE string \x80\x00\x00\x24 0 "" # adx
	#FindLoc SIZE string \x51\x5A\x49\x50\x00\x44\x43\x5F\x49\x4E\x46\x4F 0 "" # QZIP (Heavy Rain)
	FindLoc SIZE string "segs" 0 ""
	#FindLoc SIZE string "Interplay MVE File" 0 ""
	#FindLoc SIZE string \x48\x00\x00\x0C\x16\x04 0 ""
	
	if SIZE == ""
		set QUIT 1
		get SIZE asize
		if i == 0
			cleanexit
		endif
	else
		#print "split point found at offset %SIZE%"
	endif
	math SIZE -= OFFSET
	if SIZE == 0 # no residual data at start
		math i += 1
	elif SIZE > 4
		if NAMEPOS == ""
			get NAME basename
			if WRITEOFFSET == 1
				string NAME += "@"
				string NAME += OFFSET
			else
				string NAME += "_"
				string NAME += i
			endif
			if i != 0
				if SINGLE != 1
					string NAME += EXT
				endif
			endif
		else
			savepos MYOFF
			goto NAMEPOS
			get NAME string
			savepos NAMEPOS
		endif
		math OFFSET += SKIP
		if QUIT != 1
			math SIZE -= SKIP
			math SIZE += NEGBIAS
		endif
		if SIZE >= MINSIZE
			if SIZEBIAS > 0
				savepos MY
				set GO OFFSET
				math GO += SIZEBIAS
				goto GO
				get SIZE2 long
				if REV == 1
					reverselong SIZE2
				endif
				goto MY
				log NAME OFFSET SIZE2
			else
				log NAME OFFSET SIZE
			endif
			print "found %SIZE% bytes file @ %OFFSET% (read from %GO%)"
			math i += 1
		endif
	else
	endif
	if QUIT != 1
		math OFFSET += SIZE
		set SEARCH OFFSET
		if SKIP > 0
			math OFFSET += SKIP
		else 
			math OFFSET -= SKIP
		endif
		math SEARCH += 4 # needs to be the length of the search string
		if SEARCH >= FSIZE
			set QUIT 1
		endif
	endif
while QUIT != 1
```
## Post #111
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2010-11-28T15:37:00+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #112
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-28T17:06:47+00:00
- Post Title: Re: My quickBMS scripts

The script already converts msf to playable at3 - that's why it's called msf2at3... dude, look at the files in hex.
## Post #113
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2010-11-28T17:22:32+00:00
- Post Title: Re: My quickBMS scripts

I have a problem with playing at3 files. I install Atrac3 codec, but Winamp, Windows Media Player, Media Player Classic, Sony SoundForge, SonicStage cant play audio.

At3 audio, which normal decode to aa3 cant be played in Media Player Classic.

At3 audio, which cant decode to aa3 can be played in Media Player Classic, but no music.
## Post #114
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-28T18:04:24+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Researchman
>
> I have a problem with playing at3 files. I install Atrac3 codec, but Winamp, Windows Media Player, Media Player Classic, Sony SoundForge, SonicStage cant play audio.

At3 audio, which normal decode to aa3 cant be played in Media Player Classic.

At3 audio, which cant decode to aa3 can be played in Media Player Classic, but no music.
I just checked, I can play the files with Windows Media Player. Where did you download the Atrac codec from? Can you play the file with KMPlayer?
## Post #115
- Username: mauzerX
- Rank: advanced
- Number of posts: 57
- Joined date: Thu Jul 01, 2010 8:48 pm
- Post datetime: 2010-11-28T19:36:35+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> gen_split.bms
This is a VERY useful script if you encounter a game archive with various files of one type in it but without information table. Happens quite often in PS2 games I realized now.
Great!Universal scanner
## Post #116
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-11-29T10:48:09+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> gen_split.bms
This is a VERY useful script if you encounter a game archive with various files of one type in it but without information table. Happens quite often in PS2 games I realized now. The script searches for occurances of a given string and splits up the file where such an occurance is found.
What you have to adjust:
set OFFSET # - offset where the first file to be written starts. If you leave it at zero, the script will also write the area before the first occurance of the search string to disk
math SEARCH += # - enter the length of the search string here
FindLoc SIZE string "#" 0 "" - String or hex code to be searched. Hex code as always in C notation (see posted script)
Code: Select allget BNAME basename
string BNAME += "_"
set OFFSET 0
set SEARCH OFFSET
math SEARCH += 8
set QUIT 0
for i = 1
	goto SEARCH
	FindLoc SIZE string "\x41\x48\x56\x0\x44\x0\x0\x0" 0 ""
	if SIZE == ""
		get SIZE asize
		set QUIT 1
	endif
	math SIZE -= OFFSET
	set NAME BNAME
	string NAME += i
	log NAME OFFSET SIZE
	if QUIT != 1
		math OFFSET += SIZE
		set SEARCH OFFSET
		math SEARCH += 8 # needs to be the lengh of the search string
	else
		cleanexit
	endif
next i

Example: if you don't need the information before the first occurance of "RGHJ", which is at OFFSET 0x354, the lines are
Code: Select all...
set OFFSET 0x354
...
math SEARCH += 4
....
FindLoc SIZE string "RGHJ" 0 ""

How to convert hex code to C notation format?
## Post #117
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-29T13:42:10+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> How to convert hex code to C notation format?
You can see it inside the script - that \x.. \x.. format, that's C notation. For longer sequences, use byte2hex here: [http://aluigi.altervista.org/mytoolz.htm#both](http://aluigi.altervista.org/mytoolz.htm#both) (that's what I used for the long headers). But you don't need that for those short search terms as you normally don't search for hex code that's longer than 8 bytes.

Oh and please don't just quote everything when you're referring to just one tiny subject of the post...
## Post #118
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-11-29T14:45:17+00:00
- Post Title: Re: My quickBMS scripts

Thanks so much man it worked!!

very useful script, would save me and alot of people time
## Post #119
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2010-11-29T15:00:14+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Researchman wrote:I have a problem with playing at3 files. I install Atrac3 codec, but Winamp, Windows Media Player, Media Player Classic, Sony SoundForge, SonicStage cant play audio.

At3 audio, which normal decode to aa3 cant be played in Media Player Classic.

At3 audio, which cant decode to aa3 can be played in Media Player Classic, but no music.
I just checked, I can play the files with Windows Media Player. Where did you download the Atrac codec from? Can you play the file with KMPlayer?

I download Atrac3 codec from here - [http://www.free-codecs.com/download/son ... _codec.htm](http://www.free-codecs.com/download/sony_atrac3_audio_codec.htm)
KMPlayer cant play at3 files.

Maybe I dont fully install Atrac3 codec.
## Post #120
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-29T15:11:32+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Researchman
>
> I download Atrac3 codec from here - http://www.free-codecs.com/download/son ... _codec.htm
KMPlayer cant play at3 files.

Maybe I dont fully install Atrac3 codec.Ok, last chance: send me the AT3 file that you can't play.
## Post #121
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2010-11-29T17:37:34+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #122
- Username: mono24
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2010-11-29T22:45:44+00:00
- Post Title: Re: My quickBMS scripts

Hehe that FileLoc in MultiEx Commander's MexScript used to be 

```
-------------------------------

This command searches the file from the current fileposition for a
<string> of max 40 length and saves the position (when found) in
<variable>. This way, if you know that a datafile contains only
a certain type of file with a set ID you can get the OFFSET of this
file that way. Just search for the ID and let MEX save its pos in FILEOFF.

```


in the DOS version in 1998.
## Post #123
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-30T03:30:36+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #124
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2010-11-30T16:01:06+00:00
- Post Title: Re: My quickBMS scripts

Google solves the problem with .at3 files. Now KMPlayer play at3 files from Battle Fantasia, Puzzle Fighter and Street Fighter. Zhal no aa3 decoder(Tekken: Dark Resurrection).

> Sonic Ultimate Gensesis Collection is PS2 ADPCM (seemingly mono), starting at 0x40. Will implement that into my script soon.
I will be wait.
## Post #125
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-11-30T23:46:39+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Researchman
>
> Zhal no aa3 decoder(Tekken: Dark Resurrection).I already referred to Sony SoundForge - it's the only of three Sony programs that can decode atrac3+. You may also try Sonic Stage with HiMDRenderer (both free), but it doesn't support all at3+ formats.
## Post #126
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2010-12-01T14:31:41+00:00
- Post Title: Re: My quickBMS scripts

I`m mean aa3 plugin for winamp or aa3 acm or something codec. urrently remains SoundForge.
## Post #127
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-12-01T19:28:20+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Researchman
>
> I`m mean aa3 plugin for winamp or aa3 acm or something codec. urrently remains SoundForge.
There is none. SoundForge is pretty much the only possibility to decode them.
## Post #128
- Username: mauzerX
- Rank: advanced
- Number of posts: 57
- Joined date: Thu Jul 01, 2010 8:48 pm
- Post datetime: 2010-12-05T11:13:22+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #129
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-12-05T20:28:34+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #130
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-12-19T01:47:15+00:00
- Post Title: Re: My quickBMS scripts

Alpha your rsf script problem might be multichannel related. in the file's header i see either 8 or 6 channels,but not 02 channels. I have converted a 2ch file and it worked. but when i converted a multichannel file the script still outputs the file as two channels and changing the channel count in the RIFF header doesn't work either.

[http://www.megaupload.com/?d=O0R0B0TW](http://www.megaupload.com/?d=O0R0B0TW)
## Post #131
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-12-20T01:10:40+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> Alpha your rsf script problem might be multichannel related. in the file's header i see either 8 or 6 channels,but not 02 channels. I have converted a 2ch file and it worked. but when i converted a multichannel file the script still outputs the file as two channels and changing the channel count in the RIFF header doesn't work either.

http://www.megaupload.com/?d=O0R0B0TW
I know that it doesn't read the channels because the standard atrac format only support stereo - or at least SoundForge only supports stereo files... I'm a bit confused of all these mono and multichannel atrac files. I currently don' know how to handle them, maybe there's a way to split the channels. Will try around with them some day.
## Post #132
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-12-24T16:26:52+00:00
- Post Title: Re: My quickBMS scripts

nonconform_XMA_to_XMA.bms
This script removes the seek and fact section of XMA files so that toWAV supports these afterwards. Good example are XMA files from fsb containers that have been extracted with "fsbext -a [name].fsb"

```
goto 0x16
get CH short
get FREQ long
FindLoc DAT string "data" 0 ""
math DAT += 4
goto DAT
get SIZE long
savepos OFFSET

get NAME basename
string NAME += ".xma"
set RIFFSIZE SIZE
math RIFFSIZE += 0x34
putVarChr MEMORY_FILE 0x04 RIFFSIZE long
putVarChr MEMORY_FILE 0x24 FREQ long
putVarChr MEMORY_FILE 0x31 CH byte
putVarChr MEMORY_FILE 0x38 SIZE long

append
log MEMORY_FILE OFFSET SIZE
append
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE 
```
## Post #133
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-12-26T17:05:20+00:00
- Post Title: Re: My quickBMS scripts

Playstation ADPCM 0x10 bytes re-interleave
As the title says, this script de-interleaves a PS2 ss2 file and re-interleaves it with a 0x10 byte interleave. Apparently, the PS ADPCM plugin for vgmstream has a staggering problem with incomplete last interleave blocks. As those occur very often there's no other possibility than to re-interleave the files.
The new version 1.1 automatically deletes end silence (if the file has no stop marker). Next version will also remove silence of streams with different markers.
But another GREAT use for this script is the possibility of joining segments with different interleaves with the little script below that deletes the 0x28 size headers. 
What I normally do to join files on Windows 7:
- select all files I want to join
- press F2 (rename)
- write down a single name and press Enter (Windows 7 will automatically number the files)
- use Flexible Renamer (google it!) to rename the files to the format [name].001, [name].002 and so on
- use 7zip or WinRAR to join the files
Afterwards you can just re-add a correct SS2 header with my other script.
Of course this is also very practical to split ss2 files practically everywhere. =)

```
# needed to prepare streams for joining or cutting (without decoding)

idstring "SShd"
goto 0xc
get FREQ long
get CH long
if CH == 1 # no re-interleave needed
	cleanexit
endif
goto 0x14
get INTERLEAVE long
set OFFSET 0x28
get STREAMSIZE asize
math STREAMSIZE -= OFFSET
set SBLOCK INTERLEAVE
math SBLOCK *= 2 # stereo block
set BLOCKS STREAMSIZE
math BLOCKS /= SBLOCK
set RES STREAMSIZE
math RES %= SBLOCK
math RES /= 2 # size of single channel of last block
callfunction deinterleave 1
	get SIZE1 asize MEMORY_FILE
	get SIZE2 asize MEMORY_FILE2
	if SIZE1 != SIZE2
		print "error: memory files are of different size!"
		cleanexit
	endif
callfunction reinterleave 1
callfunction addSS2header 1
get SIZE asize MEMORY_FILE4
get NAME basename
string NAME += "_0x10.ss2"
log NAME 0 SIZE MEMORY_FILE4

startfunction deinterleave
	log MEMORY_FILE 0 0
	log MEMORY_FILE2 0 0
	set DEOFF OFFSET
	append
	for k = 1 <= BLOCKS
		log MEMORY_FILE DEOFF INTERLEAVE
		math DEOFF += INTERLEAVE
		log MEMORY_FILE2 DEOFF INTERLEAVE
		math DEOFF += INTERLEAVE
	next k
	log MEMORY_FILE DEOFF RES # write last residual block
	log MEMORY_FILE2 DEOFF RES
	append
endfunction

startfunction reinterleave
	set SIZE SIZE1
	set OFFSET 0
	append
	do
		log MEMORY_FILE3 OFFSET 0x10 MEMORY_FILE
		log MEMORY_FILE3 OFFSET 0x10 MEMORY_FILE2
		math OFFSET += 0x10
	while OFFSET < SIZE
	append
endfunction

startfunction addSS2header
	set MEMORY_FILE4 binary "\x53\x53\x68\x64\x18\x00\x00\x00\x10\x00\x00\x00\xb0\x36\x00\x00\x02\x00\x00\x00\xc0\x2f\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\x53\x53\x62\x64\x00\xe8\x11\x00"
	get SIZE asize MEMORY_FILE3
	do
		math SIZE -= 0x20
		goto SIZE MEMORY_FILE3
		get TEST long MEMORY_FILE3
	while TEST == 0
	math SIZE += 0x20
	do
		math SIZE -= 0x20
		goto SIZE MEMORY_FILE3
		get TEST long MEMORY_FILE3
	while TEST == 0xc
	math SIZE += 0x20
	append
	log MEMORY_FILE4 0 SIZE MEMORY_FILE3
	append
	putVarChr MEMORY_FILE4 0xc FREQ long
	putVarChr MEMORY_FILE4 0x10 CH byte
	set INTERLEAVE 0x10
	putVarChr MEMORY_FILE4 0x14 INTERLEAVE long
	putVarChr MEMORY_FILE4 0x24 SIZE long
endfunction
```
## Post #134
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-12-28T13:17:59+00:00
- Post Title: Re: My quickBMS scripts

baf_extract.bms (X360 only!)
Extracts the XMA files from sound banks and adds a valid header for toWAV. Frequency and channels is taken from the file info table of course.

```
endian big
get UNK long
get UNK long
get FILES long
goto 0x34

for i = 1 <= FILES
	savepos OFF
	idstring "WAVE"
	get INFOSIZE long
	get HEADERSIZE long
	getDstring NAME 0x20
	string NAME += ".xma"
	get OFFSET long
	get SIZE long
	get UNK long
	get UNK long
	get FREQ long
	get UNK long
	get CH long
	endian little
	callfunction addXMAheader 1
	endian big
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
	math OFF += INFOSIZE
	goto OFF
next i

startfunction addXMAheader
	set MEMORY_FILE binary "\x52\x49\x46\x46\xb8\x59\xa7\x00\x57\x41\x56\x45\x66\x6d\x74\x20\x20\x00\x00\x00\x65\x01\x10\x00\xd6\x10\x00\x00\x01\x00\x00\x03\xe3\x9a\x00\x00\x80\xbb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x64\x61\x74\x61\x00\x58\xa7\x00"
	set RIFFSIZE SIZE
	math RIFFSIZE += 0x34
	putVarChr MEMORY_FILE 0x04 RIFFSIZE long
	putVarChr MEMORY_FILE 0x24 FREQ long
	putVarChr MEMORY_FILE 0x31 CH byte
	putVarChr MEMORY_FILE 0x38 SIZE long
	append
	log MEMORY_FILE OFFSET SIZE
	append
endfunction
```
## Post #135
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-12-30T21:49:34+00:00
- Post Title: Re: My quickBMS scripts

Just updated the 0x10-byte re-interleaver with automatic end silence removal. Will update it frequently when I encounter files that need script enhancement.
## Post #136
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2010-12-31T02:58:33+00:00
- Post Title: Re: My quickBMS scripts

Hello alpha just a suggestion on your stereo XMA header script,is it possible to add an offset option so you can specify the offset of the xma stream for xma files with custom non riff headers?
## Post #137
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2010-12-31T13:14:05+00:00
- Post Title: Re: My quickBMS scripts

add_header_XMA.bms
Adds an XMA RIFF header that is compatible with toWAV. Needed functions: [func_str2num.bms](http://forum.xentax.com/viewtopic.php?f=13&p=43258#p43258)

```
# Add XMA1 RIFF header to headerless XMA1 stream (decodable with toWAV)
# 
# If the headerless stream has the format NAME@FREQ[m/s] (e.g. track01@44100s),
# the script automatically takes the given values from the name.
# If the headerless stream has the format NAME@FREQ, func_header_XMA.bms
# will detect the channel count.
# Remember to try parsing the stream to XMA1 before adding a header.
#
# (c) 2012-03-26 by AlphaTwentyThree of XeNTaX 

include "func_header_XMA.bms"
include "func_str2num.bms"

set FREQ_DEFAULT 44100
set CH_DEFAULT 2
set OFFSET 0x0
callfunction getfreqch 1
if FREQ == 0
	set FREQ FREQ_DEFAULT
	print "No frequency given.\nDefault frequency is %FREQ%Hz."
endif
if CH == 0
	set CH CH_DEFAULT
	print "Number of channels could not be determined.\nDefault is %CH% channels."
endif

get SIZE asize
math SIZE -= OFFSET
callfunction XMA 1
set NAME NAME_BASE # see function getfreq
string NAME += ".xma"
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE


startfunction getfreqch # internal use only
	get NAME basename # search for freq and ch in file name via "@" identifier
	strlen NAMEL NAME
	set EXISTS 0
	for i = 0 < NAMEL # write name to memory
		getVarChr T NAME i
		if T == 0x40
			set EXISTS 1
		endif
		putVarChr MEMORY_FILE i T
	next i
	if EXISTS == 1 # freq info given
		getCT NAME_BASE string 0x40 MEMORY_FILE
		strlen NAMEBL NAME_BASE
		math NAMEBL += 1 # start of stream info in name
		set LENGTH NAMEL
		math LENGTH -= NAMEBL # length of string behind @
		set CH_OFF NAMEL
		math CH_OFF -= 1
		getVarChr CHANNELS NAME CH_OFF
		if CHANNELS < 0x40 # no channel count given -> determine channels
			callfunction getCH 1
		else # use channel count from file name
			math LENGTH -= 1
			if CHANNELS == 0x6d
				set CH 1
			elif CHANNELS == 0x73
				set CH 2
			endif
		endif
		goto NAMEBL MEMORY_FILE
		getDstring NUM LENGTH MEMORY_FILE # get freq as string
		callfunction str2num 1 # convert to integer
		set FREQ NUM
	else
		set FREQ 0
		callfunction getCH 1
		get NAME_BASE basename
	endif
endfunction
```

func_header_XMA.bms
Needed parameters are FREQ, OFFSET and SIZE. The channel variable CH is optional. If not given, the script will try to determine the nuber of channels automatically. However if no channel count can be determined, the default channel count is taken (important because you have to set it manually).
needs my variable test: [viewtopic.php?f=13&p=69586#p69586](http://forum.xentax.com/viewtopic.php?f=13&p=69586#p69586)

```

include "func_checkVAR.bms"
startfunction XMA
	endian little
	if CH == ""
		callfunction getCH
	endif
	callfunction checkVAR 1
		set PRESIZE RIFFSIZE # pre-alloc
		math PRESIZE += 0x38
		log MEMORY_FILE PRESIZE 0
		log MEMORY_FILE 0 0
	set MEMORY_FILE binary "\x52\x49\x46\x46\xb8\x59\xa7\x00\x57\x41\x56\x45\x66\x6d\x74\x20\x20\x00\x00\x00\x65\x01\x10\x00\xd6\x10\x00\x00\x01\x00\x00\x03\xe3\x9a\x00\x00\x80\xbb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x64\x61\x74\x61\x00\x58\xa7\x00"
	set RIFFSIZE SIZE
	math RIFFSIZE += 0x34
	putVarChr MEMORY_FILE 0x04 RIFFSIZE long
	putVarChr MEMORY_FILE 0x24 FREQ long
	putVarChr MEMORY_FILE 0x31 CH byte
	putVarChr MEMORY_FILE 0x38 SIZE long
	append
	log MEMORY_FILE OFFSET SIZE
	append
endfunction

startfunction getCH
	set CHOFF OFFSET
	math CHOFF += 7
	goto CHOFF
	get IDENT byte
	if IDENT == 1
		set CH 2
	elif IDENT == 3
		set CH 1
	elif IDENT == 0 # from multichannel stream
		set CH 2
	else
		set CH ""
	endif
endfunction
```
## Post #138
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2011-01-01T23:33:12+00:00
- Post Title: Re: My quickBMS scripts

Thanks!
## Post #139
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2011-01-04T22:24:29+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #140
- Username: Barnaby
- Rank: advanced
- Number of posts: 47
- Joined date: Tue Dec 15, 2009 12:41 am
- Post datetime: 2011-01-05T20:56:32+00:00
- Post Title: Re: My quickBMS scripts

Can you mod your EA XMA script for this please? 

[http://flameupload.com/files/0LJDWAQW/A ... _Track.xxx](http://flameupload.com/files/0LJDWAQW/Aud_Hus_Music_Track.xxx)

Thx in advance!
## Post #141
- Username: Chronic
- Rank: beginner
- Number of posts: 20
- Joined date: Thu Jan 06, 2011 7:36 pm
- Post datetime: 2011-01-06T11:48:19+00:00
- Post Title: Re: My quickBMS scripts

I've heard someone asked for something that would make Call Of Duty:Black Ops(PC) .wav's valid, so I made something (apologies if it has already been made). The tool can extract and automatically fix wavs coming from COD:BO .iwd files, just drag them in the .exe and you will get in about 4-5 minutes valid .wavs (readme is included with the download).
Download link: [http://gljivolog.com/data/releases/bo_rip_beta.rar](http://gljivolog.com/data/releases/bo_rip_beta.rar)
## Post #142
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2011-01-18T21:28:02+00:00
- Post Title: Re: My quickBMS scripts

Hey alpha does the search string for your general script have to be strictly 8 bytes? because when i try to do lower like 6 or 4 it just outputs the same archive from the first search string offset.
## Post #143
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-01-26T15:52:02+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> Hey alpha does the search string for your general script have to be strictly 8 bytes? because when i try to do lower like 6 or 4 it just outputs the same archive from the first search string offset.
You need to adjust the += value down there to the length of your search string.
## Post #144
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2011-01-26T19:07:34+00:00
- Post Title: Re: My quickBMS scripts

okay thanks!
## Post #145
- Username: TEOL
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Fri Jan 28, 2011 2:22 am
- Post datetime: 2011-01-27T18:32:37+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #146
- Username: mono24
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2011-01-30T16:41:46+00:00
- Post Title: Re: My quickBMS scripts

You can use QuickBMS scripts also in MultiEx Commander now that acts as a GUI. 

[http://www.youtube.com/watch?v=9afcbJxNvcE](http://www.youtube.com/watch?v=9afcbJxNvcE)
## Post #147
- Username: TEOL
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Fri Jan 28, 2011 2:22 am
- Post datetime: 2011-01-31T13:47:13+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Mr.Mouse
>
> You can use QuickBMS scripts also in MultiEx Commander now that acts as a GUI. 

http://www.youtube.com/watch?v=9afcbJxNvcE

What has this got to do with my Smackdown Vs Raw 2011 PS3 music.pck? It's paid software too. I want a tool that can snoop my file for free.
## Post #148
- Username: GenericRipper
- Rank: advanced
- Number of posts: 66
- Joined date: Mon Mar 22, 2010 12:41 am
- Post datetime: 2011-01-31T14:49:17+00:00
- Post Title: Re: My quickBMS scripts

Why not run this free script

> Reply from AlphaTwentyThree
>
> Code: Select allget BNAME basename
string BNAME += "_"
set OFFSET 0
set SEARCH OFFSET
math SEARCH += 4
set QUIT 0
for i = 1
	goto SEARCH
	FindLoc SIZE string "RIFX" 0 ""
	if SIZE == ""
		get SIZE asize
		set QUIT 1
	endif
	math SIZE -= OFFSET
	set NAME BNAME
	string NAME += i
	log NAME OFFSET SIZE
	if QUIT != 1
		math OFFSET += SIZE
		set SEARCH OFFSET
		math SEARCH += 4
	else
		cleanexit
	endif
next i

with a help of a free program named [QuickBMS](http://aluigi.org/papers.htm#quickbms) and convert resulting *.rifx files using a free program named [WW2OGG](http://hcs64.com/files/ww2ogg010.zip) and this batch file?
for %%a in (*.RIFX) do ww2ogg.exe "%%a"
## Post #149
- Username: mono24
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2011-01-31T16:38:58+00:00
- Post Title: Re: My quickBMS scripts

> Reply from TEOL
>
> Mr.Mouse wrote:You can use QuickBMS scripts also in MultiEx Commander now that acts as a GUI. 

http://www.youtube.com/watch?v=9afcbJxNvcE

What has this got to do with my Smackdown Vs Raw 2011 PS3 music.pck? It's paid software too. I want a tool that can snoop my file for free.

For your information, MultiEx Commander used to be freely downloadable since 1997, so about 14 years. The only reason users are asked for a small donation is to ensure the continuation of the free information at XeNTaX. 

Second, "I want" is a disrespectful attitude towards those people that work in their freetime to support new formats, such as the one you aim for. And they do this for free. And guys like you probably have no sense of the cost of things. You probably expect everything to be free, heck perhaps even demand stuff to be free. 

Like I said in my post above, you can now *also* use QuickBMS scripts in MultiEx Commander, if you feel like having a GUI to preview files you extract, and extract only those files you wish to extract. The free - original command line- option is described by AlphaTwentyThree.
## Post #150
- Username: cozy
- Rank: beginner
- Number of posts: 39
- Joined date: Tue Dec 08, 2009 5:18 am
- Post datetime: 2011-01-31T21:58:20+00:00
- Post Title: Re: My quickBMS scripts

Thanks for the scrips they are good,but is there any chance of a .aa3 to .at3(+)

cheers cozy
## Post #151
- Username: mauzerX
- Rank: advanced
- Number of posts: 57
- Joined date: Thu Jul 01, 2010 8:48 pm
- Post datetime: 2011-02-01T07:42:45+00:00
- Post Title: Re: My quickBMS scripts

> Reply from cozy
>
> Thanks for the scrips they are good,but is there any chance of a .aa3 to .at3(+)

cheers cozy
+1
It'll be great,from aa3 to RIFF AT3 \ MSF AT3
## Post #152
- Username: TEOL
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Fri Jan 28, 2011 2:22 am
- Post datetime: 2011-02-01T10:22:10+00:00
- Post Title: Re: My quickBMS scripts

> Reply from GenericRipper
>
> Why not run this free script
AlphaTwentyThree wrote:Code: Select allget BNAME basename
string BNAME += "_"
set OFFSET 0
set SEARCH OFFSET
math SEARCH += 4
set QUIT 0
for i = 1
	goto SEARCH
	FindLoc SIZE string "RIFX" 0 ""
	if SIZE == ""
		get SIZE asize
		set QUIT 1
	endif
	math SIZE -= OFFSET
	set NAME BNAME
	string NAME += i
	log NAME OFFSET SIZE
	if QUIT != 1
		math OFFSET += SIZE
		set SEARCH OFFSET
		math SEARCH += 4
	else
		cleanexit
	endif
next i

with a help of a free program named QuickBMS and convert resulting *.rifx files using a free program named WW2OGG and this batch file?
for %%a in (*.RIFX) do ww2ogg.exe "%%a"

Thanks dude. It worked. Although they are just called .files. Anyone know what I should rename them to?
## Post #153
- Username: GenericRipper
- Rank: advanced
- Number of posts: 66
- Joined date: Mon Mar 22, 2010 12:41 am
- Post datetime: 2011-02-01T10:40:47+00:00
- Post Title: Re: My quickBMS scripts

You can rename a huge number of files at once by setting a specific mask in Total Commander (or maybe other file managers but personally I prefer Total Commander). Once you cut music.pck in pieces with a help of Alpha23`s script you can highlight all the resulting files in Total Commander, go to "Files => Multi-rename tool" and change extension mask from [E] to RIFX. But if you`re not content with using paid software at all you can always rename them manually  .
## Post #154
- Username: TEOL
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Fri Jan 28, 2011 2:22 am
- Post datetime: 2011-02-01T10:53:45+00:00
- Post Title: Re: My quickBMS scripts

> Reply from GenericRipper
>
> You can rename a huge number of files at once by setting a specific mask in Total Commander (or maybe other file managers but personally I prefer Total Commander). Once you cut music.pck in pieces with a help of Alpha23`s script you can highlight all the resulting files in Total Commander, go to "Files => Multi-rename tool" and change extension mask from [E] to RIFX. But if you`re not content with using paid software at all you can always rename them manually  .

Putting .rifx at the end of my files in windows doesn't seem to work, it just gives me a 1kb .ogg file. It's just that I don't wish to pay for anything I'm likely to use only once ever. Sorry if it looked disrespectful when I said it last time.
## Post #155
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-02-01T13:12:55+00:00
- Post Title: Re: My quickBMS scripts

> Reply from cozy
>
> Thanks for the scrips they are good,but is there any chance of a .aa3 to .at3(+)

cheers cozy
That would be something like MP2 to MP3... the formats are pretty different and I only program header manipulators but no converters. So, no. :-\
## Post #156
- Username: GenericRipper
- Rank: advanced
- Number of posts: 66
- Joined date: Mon Mar 22, 2010 12:41 am
- Post datetime: 2011-02-01T13:29:13+00:00
- Post Title: Re: My quickBMS scripts

> Reply from TEOL
>
> Putting .rifx at the end of my files in windows doesn't seem to work, it just gives me a 1kb .ogg file.
I`ll try to follow your actions step by step skipping BMS script phase.
You have roughly 100 files without an extension but you rename them so that all of them have RIFX extension;
You download that Wwise RIFF OGG vorbis conversion program;
You unpack WW2OGG.ZIP in the directory containing *.RIFX;
You put this text
for %%a in (*.RIFX) do ww2ogg.exe "%%a"
in a notepad and save it as *.BAT in the directory already containing WW2OGG program files and SVR 2011 tracks;
You run the batch file and should find standard and easily playable OGG files in that folder after conversion.
## Post #157
- Username: TEOL
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Fri Jan 28, 2011 2:22 am
- Post datetime: 2011-02-01T13:42:50+00:00
- Post Title: Re: My quickBMS scripts

I had 100% success. Thanks guys for the prompt support you gave me. It was .ogg I was supposed to rename them to in Windows. A RIFX converter script gave me the instructions rename to .ogg before putting it into the ogg converter, so I did that and got the inners.
## Post #158
- Username: cozy
- Rank: beginner
- Number of posts: 39
- Joined date: Tue Dec 08, 2009 5:18 am
- Post datetime: 2011-02-01T13:56:50+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> cozy wrote:Thanks for the scrips they are good,but is there any chance of a .aa3 to .at3(+)

cheers cozy
That would be something like MP2 to MP3... the formats are pretty different and I only program header manipulators but no converters. So, no. :-\

You did a script for at3 to aa3 header why not aa3 to at3?i used your script to convert at3plus files to aa3 then used sound forge to downsample to a low bit rate justneed the at3 header putting back on?

cheers for the reply
## Post #159
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-02-01T14:23:58+00:00
- Post Title: Re: My quickBMS scripts

> Reply from cozy
>
> AlphaTwentyThree wrote:cozy wrote:Thanks for the scrips they are good,but is there any chance of a .aa3 to .at3(+)

cheers cozy
That would be something like MP2 to MP3... the formats are pretty different and I only program header manipulators but no converters. So, no. :-\

You did a script for at3 to aa3 header why not aa3 to at3?i used your script to convert at3plus files to aa3 then used sound forge to downsample to a low bit rate justneed the at3 header putting back on?

cheers for the reply
Oh lol, I didn't read properly, gg. I'll try to although I'm not sure if the values that are unprocessed in the RIFF header are important for the PS3 or PSP to play them. I'll code one later and you tell me if it works, ok?
## Post #160
- Username: cozy
- Rank: beginner
- Number of posts: 39
- Joined date: Tue Dec 08, 2009 5:18 am
- Post datetime: 2011-02-01T21:26:05+00:00
- Post Title: Re: My quickBMS scripts

]You did a script for at3 to aa3 header why not aa3 to at3?i used your script to convert at3plus files to aa3 then used sound forge to downsample to a low bit rate justneed the at3 header putting back on?

cheers for the reply [/quote]
Oh lol, I didn't read properly, gg. I'll try to although I'm not sure if the values that are unprocessed in the RIFF header are important for the PS3 or PSP to play them. I'll code one later and you tell me if it works, ok? [/quote]

Thanks   ,do you want a sample of at3 that i downsampled and the original?


 at3_samples.7z
(158.75 KiB) Downloaded 30 times



Original        =44100Hz,128kbps,16 Bit, stereo  ATRAC3+
downsampled=44100Hz,32Kbps,16 Bit, Mono, ATRAC3+
## Post #161
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-02-01T21:30:51+00:00
- Post Title: Re: My quickBMS scripts

Nope, don't need that, thanks.
## Post #162
- Username: cozy
- Rank: beginner
- Number of posts: 39
- Joined date: Tue Dec 08, 2009 5:18 am
- Post datetime: 2011-02-01T22:24:53+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> add_aa3_header.bms
Adds a standard aa3 header to a headerless file.
Code: Select all# adjust format!
# set CODE 0x01002417 # 44100, 1,  32
# set CODE 0x01002422 # 44100, 1,  48
# set CODE 0x0100242E # 44100, 1,  64
# set CODE 0x01002445 # 44100, 1,  96
# set CODE 0x0100245c # 44100, 1, 128
# set CODE 0x0100248B # 44100, 1, 192
# set CODE 0x01002817 # 44100, 2,  32
# set CODE 0x01002822 # 44100, 2,  48
# set CODE 0x0100282E # 44100, 2,  64
# set CODE 0x01002845 # 44100, 2,  96
set CODE 0x0100285C # 44100, 2, 128
# set CODE 0x0100288B # 44100, 2, 192
# set CODE 0x010034E8 # 44100, 6, 320
# set CODE 0x01003573 # 44100, 6, 512
# set CODE 0x01004455 # 48000, 1, 128
# set CODE 0x01004855 # 48000, 2, 128
# set CODE 0x010054AA # 48000, 6, 256
# set CODE 0x010054D5 # 48000, 6, 320
# set CODE 0x010054FF # 48000, 6, 384
# set CODE 0x01005555 # 48000, 6, 512
reverselong CODE

set OFFSET 0x0
set MEMORY_FILE binary "\x65\x61\x33\x3\x0\x0\x0\x0\x7\x76\x47\x45\x4f\x42\x00\x00\x01\xc6\x00\x00\x02\x62\x69\x6e\x61\x72\x79\x00\x00\x00\x00\x4f\x00\x4d\x00\x47\x00\x5f\x00\x4c\x00\x53\x00\x49\x00\x00\x00\x01\x00\x40\x00\xdc\x00\x70\x00\x08\x00\x00\x00\x00\x00\x00\x4b\x45\x59\x52\x49\x4e\x47"
putVarChr MEMORY_FILE 0x400 0x1334145 long
putVarChr MEMORY_FILE 0x404 0xffff6000 long
putVarChr MEMORY_FILE 0x420 CODE long
goto OFFSET
get FIRST long
putVarChr MEMORY_FILE 0x460 FIRST long
savepos DATA
get SIZE asize
math SIZE -= OFFSET
math SIZE -= 4
append
log MEMORY_FILE DATA SIZE
append
get NAME basename
string NAME += ".aa3"
math SIZE += 0x460

log NAME 0 SIZE MEMORY_FILE

Hope that helps, Orange

For your script to work on a headerless at3Plus you must remove the junk data from the headerless file,like the ones found when you extract the avi and at3 file from a PMF file Look at the hex in this at3 file find and remove the HEX:- 0FD0285C00000000 (i think this 128kbps)
There are 854 in this at3 file,i use a hex editor to find and replace but it takes forever to search each file ;(


So if you could add this to the script to search and remove the hex 0FD0285C00000000 from each at3 headerless file then add the aa3 header this will work!!

Hope this helps
## Post #163
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-02-02T01:30:25+00:00
- Post Title: Re: My quickBMS scripts

Not for all headerless AT3+ files I think. Nevertheless, just use my PMF_at3_to_aa3 script, that does exactly that.
## Post #164
- Username: snakemeat
- Rank: advanced
- Number of posts: 45
- Joined date: Wed Jan 28, 2009 12:00 am
- Post datetime: 2011-02-25T04:30:51+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> add_aa3_header.bms
Adds a standard aa3 header to a headerless file.
Code: Select all.
.
.
savepos DATA
get SIZE asize
math SIZE -= OFFSET
math SIZE -= 4
.
.
.
string NAME += ".aa3"
math SIZE += 0x460

math SIZE += 4 # <--- add this line

log NAME 0 SIZE MEMORY_FILE

just a quick note that the currently posted version seems to trim the last 4 bytes off the file.  Adding the line of code should fix it.
## Post #165
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2011-02-28T22:04:50+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #166
- Username: Murdiaries
- Rank: n00b
- Number of posts: 11
- Joined date: Thu Mar 03, 2011 9:40 pm
- Post datetime: 2011-03-04T12:00:39+00:00
- Post Title: Re: My quickBMS scripts

Hi,
I've used your at3_to_aa3+smpl.bms script on Hokuto Musou at3 files, and it works like a charm!

As I'd like to add original anime BGM music back to the game, upon I've saved those in .aa3, how can I go convert them to at3 to be played into PS3?

Thanks!
## Post #167
- Username: manstopper
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Tue Mar 01, 2011 6:09 am
- Post datetime: 2011-05-18T13:10:38+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> 
WAVE format scanner
I already posted this inside some other topic but I'll include it here, too. Simple wave scanner. Doesn't search for the "RIFF" string as I once accidentially found it inside some other data structures where it wasn't a wave file. Instead it searches for the WAVEfmt part and extracts the file.Code: Select allfor i = 1
   FindLoc OFFSET STRING "WAVEfmt" 0 ""
   if OFFSET != ""
      math OFFSET -= 8
      goto OFFSET
      FindLoc DATA STRING "data" 0 ""
      math DATA += 4
      goto DATA
      get SSIZE long
      savepos HEADER
      math HEADER -= OFFSET
      set SIZE HEADER
      math SIZE += SSIZE
      get NAME basename
      string NAME += "_"
      string NAME += i
      string NAME += ".wav"
      log NAME OFFSET SIZE
   else
      cleanexit
   endif
next i
Thank you!
Sorry for my English... It is not my native language.
Can you make a script for flashing these wav files back to the original file? It would be great for mods.
## Post #168
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-05-23T11:39:15+00:00
- Post Title: Re: My quickBMS scripts

Sorry, my QuickBMS skills aren't that good to perform such a task...
## Post #169
- Username: divStar
- Rank: ultra-n00b
- Number of posts: 8
- Joined date: Wed Sep 22, 2010 6:46 am
- Post datetime: 2011-06-24T15:01:05+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #170
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2011-06-24T17:39:46+00:00
- Post Title: Re: My quickBMS scripts

The contents of this post was deleted because of possible forum rules violation.
## Post #171
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-06-30T17:34:55+00:00
- Post Title: Re: My quickBMS scripts

These are just PS2 ADPCM streams with a fake AT3 header. Just use this simple script below on them and play them with the vgmstream plugin (Winamp). 
As you can see, the script only an altered version of the SS2 header adder script with some "get" commands to retrieve the fitting parameters. Anyone can adjust my scripts like that - I use that method all the time because it's so easy.   

```
goto 0x16
get CH short
get FREQ long
set INTERLEAVE 0x10
set OFFSET 0x4c

get NAME basename
string NAME += ".ss2"
callfunction SS2 1
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE

startfunction SS2
	get SIZE asize
	math SIZE -= OFFSET
	set MEMORY_FILE binary "\x53\x53\x68\x64\x18\x00\x00\x00\x10\x00\x00\x00\xb0\x36\x00\x00\x02\x00\x00\x00\xc0\x2f\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\x53\x53\x62\x64\x00\xe8\x11\x00"
	append
	log MEMORY_FILE OFFSET SIZE
	append
	putVarChr MEMORY_FILE 0xc FREQ long
	putVarChr MEMORY_FILE 0x10 CH byte
	putVarChr MEMORY_FILE 0x14 INTERLEAVE long
	putVarChr MEMORY_FILE 0x24 SIZE long
endfunction
```
## Post #172
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2011-06-30T18:36:33+00:00
- Post Title: Re: My quickBMS scripts

Hello Alpha is it possible to make like a file cutter script based by on the filesize and not in any search string?
## Post #173
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-06-30T19:15:20+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> Hello Alpha is it possible to make like a file cutter script based by on the filesize and not in any search string?
7zip can already do that - QuickBMS would be much slower.
## Post #174
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2011-06-30T19:19:28+00:00
- Post Title: Re: My quickBMS scripts

Thanks, Will try that.

Also does your file deinterleave script work for blocked files?

EDIT: NVM it worked great on that interleaved atrac3 file from full auto 2 i posted here, 0x6000 itnelreaved with 8 streams, end of the track screwes up a bit though.
## Post #175
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-09-02T00:22:54+00:00
- Post Title: Re: My quickBMS scripts

Updated my deinterleave script - there was something really wrong with it... 
It's now able to write working last blocks!
## Post #176
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2011-09-02T01:38:22+00:00
- Post Title: Re: My quickBMS scripts

Wow now i can rework my full auto 2 rip, Thanks!

EDIT: Nope it still messing up on this file. 

[http://sharebee.com/5f4b495d](http://sharebee.com/5f4b495d)

EDIT: After taking another look it is not your script, it works correctly. It is the file that something is wrong, i Manually splitted the segments and it seems the ending segments are messed up.
## Post #177
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-09-20T17:42:08+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> Wow now i can rework my full auto 2 rip, Thanks!

EDIT: Nope it still messing up on this file. 

http://sharebee.com/5f4b495d

EDIT: After taking another look it is not your script, it works correctly. It is the file that something is wrong, i Manually splitted the segments and it seems the ending segments are messed up.
How many channels does this file have? I tried different aa3 headers but found no working one...
## Post #178
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-10-11T15:43:25+00:00
- Post Title: Re: My quickBMS scripts

SoundNodeWave_to_uxma
Converts UT3-engine sounds from Xbox 360 games to unparsed XMA streams. Automatically adds the frequency to the filename for later use with my updated script for XMA RIFF headers.

```
if OFFSET == ""
	print "Error: No XMA file. Please send this file to AlphaTwentyThree at XeNTaX!"
        cleanexit
endif
endian big
goto OFFSET
get CODE short
get CH short
get FREQ long
math OFFSET += 0x34
get SIZE asize
math SIZE -= OFFSET
math SIZE -= 0x10
get NAME basename
string NAME += "@"
string NAME += FREQ
if CH == 1
	string NAME += "m"
elif CH == 2
	string NAME += "s"
endif
string NAME += ".uxma"
log NAME OFFSET SIZE
```
## Post #179
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2011-10-11T17:14:19+00:00
- Post Title: Re: My quickBMS scripts

Nice!!
## Post #180
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-10-18T17:38:14+00:00
- Post Title: Re: My quickBMS scripts

The above script didn't work right in some cases so I changed it. Also added the mono/stereo option to the script AND to the addXMAheader.bms! 
Also, when any script here doesn't work, please help me improve the scripts and upload the according file here.
## Post #181
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-11-07T18:26:54+00:00
- Post Title: Re: My quickBMS scripts

merge_mono_xadp.bms
Merges two mono Xbox ADPCM files of the same length to one stereo file. Encountered this when splitting and re-merging multichannel Xbox ADPCM files in "Disney's Cars 2: The Video Game". Each multichannel stream contains eight channels and has interleave 0x2. So deinterleaving will result in 8 mono files. As the streams actually consist of four layers, I needed to join two channels each layer. This is the script I used.
Note 1: Each file already needs to have an Xbox ADPCM header and the extension ".xadp" for the script to work 
Note 2: The script will take very long to run, so don't wonder. :-\
Note 3: Resulting files may be decoded with toWAV or renamed to *.wav and played in vgmstream (I found out that toWAV decodes the stream with higher quality - don't know why)
Note 4: The PC and PS3 version of Driver: San Francisco uses an Xbox ADPCM variant that hides behind a 0x02 code identifier (a quick look at the character distribution reveals the true codec  ). The files are 0x24-byte-interleaved mono Xbox ADPCM files and need to be transformed to xadp. So they just need deinterleaving, adding headers and joining the channels with the below script. 

```
string NAME -= 1
set NAME1 NAME
string NAME1 += "L.xadp"
set NAME2 NAME
string NAME2 += "R.xadp"
open FDSE NAME1 0
open FDSE NAME2 1
idstring "RIFF" 0
idstring "RIFF" 1
callfunction compare 1
goto 0x18 0
get FREQ long 0
get FSIZE asize 0
set OFFSET 0x30
do
	append
	log MEMORY_FILE OFFSET 0x4 0
	log MEMORY_FILE OFFSET 0x4 1
	append
	math OFFSET += 0x4
while OFFSET < FSIZE
get SIZE asize MEMORY_FILE
set CH 2
callfunction XADP 1
string NAME += ".xadp"
get SIZE asize MEMORY_FILE2
log NAME 0 SIZE MEMORY_FILE2

startfunction compare
	get SIZE1 asize 0
	get SIZE2 asize 1
	if SIZE1 != SIZE2
		print "ERROR: sizes are different!"
		cleanexit
	endif
	goto 0x14 0
	get CODE1 short 0
	goto 0x14 1
	get CODE2 short 1
	if CODE1 != CODE2
		print "ERROR: different codecs!"
		cleanexit
	endif
endfunction

startfunction XADP
	set MEMORY_FILE2 binary "\x52\x49\x46\x46\x18\x51\xa3\x0\x57\x41\x56\x45\x66\x6d\x74\x20\x14\x0\x0\x0\x69\x0\x2\x0\x44\xac\x0\x0\xcc\xc1\x0\x0\x48\x0\x4\x0\x2\x0\x40\x0\x64\x61\x74\x61\xf0\x50\xa3\x0"
	set RIFFSIZE SIZE # streamsize
	math RIFFSIZE += 0x28
	putVarChr MEMORY_FILE2 0x04 RIFFSIZE long
	putVarChr MEMORY_FILE2 0x16 CH byte
	putVarChr MEMORY_FILE2 0x18 FREQ long
	set VAR1 0x3073
	math VAR1 *= CH
	if FREQ == 48000
		math VAR1 *= 44100
	else
		math VAR1 *= FREQ
	endif
	math VAR1 /= 22050
	putVarChr MEMORY_FILE2 0x1c VAR1 long	
	set VAR2 0x24
	math VAR2 *= CH
	putVarChr MEMORY_FILE2 0x20 VAR2 short
	putVarChr MEMORY_FILE2 0x2c SIZE long
	get SIZE asize MEMORY_FILE
	append
	log MEMORY_FILE2 0 SIZE MEMORY_FILE
	append
endfunction
```


P.S.: To join multiple mono streams, use this batch file:

```
for %%i in (*L.xadp) do quickbms merge_mono_xadp.bms "%%i" "%CD%"
```
## Post #182
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-11-07T18:30:00+00:00
- Post Title: Re: My quickBMS scripts

merge_VAG_to_SS2.bms
Simple vag to ss2 merger (mono to stereo). Source files need to have the format "[name]L.vag" / "[name]R.vag" for this script to work. Resulting file will be named "[name].ss2".
Run the resulting files through the re-interleave script to play correctly and cut start and end silence.

```
get EXT extension
string NAME -= 1
set NAME1 NAME
string NAME1 += "L."
string NAME1 += EXT
set NAME2 NAME
string NAME2 += "R."
string NAME2 += EXT
open FDSE NAME1 0
open FDSE NAME2 1
set HEADER 0x40
callfunction validity_test 1
set FREQ FREQ1
reverseLong FREQ
get NAME basename
string NAME -= 1
string NAME += ".ss2"
callfunction merge 1

startfunction validity_test
	get SIZE1 asize 0
	get SIZE2 asize 1
	math SIZE1 -= HEADER
	math SIZE2 -= HEADER
	if SIZE1 != SIZE2
		print "ERROR: File sizes don't match!"
		cleanexit
	endif
	goto 0x10 0
	get FREQ1 long 0
	goto 0x10 1
	get FREQ2 long 1
	if FREQ1 != FREQ2
		print "ERROR: frequencies don't match!"
		cleanexit
	endif
endfunction

startfunction merge
	set MEMORY_FILE binary "\x53\x53\x68\x64\x18\x00\x00\x00\x10\x00\x00\x00\xb0\x36\x00\x00\x02\x00\x00\x00\xc0\x2f\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\x53\x53\x62\x64\x00\xe8\x11\x00"
	get SIZE asize 0
	math SIZE -= HEADER
	append
	log MEMORY_FILE HEADER SIZE 0 # append left channel
	log MEMORY_FILE HEADER SIZE 1 # append left channel
	append
	set INTERLEAVE SIZE
	putVarChr MEMORY_FILE 0xc FREQ long # frequency
	putVarChr MEMORY_FILE 0x10 2 byte # channels
	putVarChr MEMORY_FILE 0x14 SIZE long # interleave (= file size of mono file)
	get SIZE asize MEMORY_FILE
	putVarChr MEMORY_FILE 0x24 SIZE long # stream size
	log NAME 0 SIZE MEMORY_FILE
endfunction
```
## Post #183
- Username: TEOL
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Fri Jan 28, 2011 2:22 am
- Post datetime: 2011-11-29T12:34:22+00:00
- Post Title: Re: My quickBMS scripts

Hi there. It's me again from last year. This time I'm after the plugin to detect what the extension is for any Wii ADPCM file so I can put the .whatever onto the end of the file to play it in Winamp VGM Stream.

A Wii ADPCM to Normal ADPCM converter script would be equally as helpful as an extension detection script as long as it keeps the quality of the Wii ADPCM original that's fine with me.

Here is a Wii ADPCM from the game we are trying to get the music from this year so you can make either of the scripts to help us out.

[http://www.multiupload.com/28JP88K2C0](http://www.multiupload.com/28JP88K2C0)
## Post #184
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-12-05T16:13:29+00:00
- Post Title: Re: My quickBMS scripts

> Reply from TEOL
>
> Hi there. It's me again from last year. This time I'm after the plugin to detect what the extension is for any Wii ADPCM file so I can put the .whatever onto the end of the file to play it in Winamp VGM Stream.

A Wii ADPCM to Normal ADPCM converter script would be equally as helpful as an extension detection script as long as it keeps the quality of the Wii ADPCM original that's fine with me.

Here is a Wii ADPCM from the game we are trying to get the music from this year so you can make either of the scripts to help us out.

http://www.multiupload.com/28JP88K2C0
I'm afraid nothing of the above is possible. I haven't found a way to play Wii ADPCM files myself...
## Post #185
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2011-12-05T16:15:24+00:00
- Post Title: Re: My quickBMS scripts

RIFF/RIFX to unparsed XMA
Converts any RIFF or RIFX file that contains XMA data to a headerless and presumably unparsed XMA file with frequency and channels included in the name. Parsing and/or adding a header is pretty easy now, especially when processing multiple files.
Edit: now also with cue marker extraction. 

```
# transforms xma streams with RIFF or RIFX header to headerless XMA streams (*.uxma)
# output files have the format "<name>@FREQ[m/s].uxma"
# resulting files can be parsed if necessary
# a valid XMA header can be added with my header_adder_XMA.bms
# 
# cue markers are saved as <name>.cue
# they can be applied to the decoded wave files with my wave cue adder
# 
# 
# (c) 2012-04-07 by AlphaTwentyThree of XeNTaX

getDstring IDENT 4
if IDENT == "RIFF"
elif IDENT == "RIFX"
	endian big
else
	print "ERROR: No RIFF or RIFX header found!"
	cleanexit
endif
callfunction process 1

get NAME basename
string NAME += "@"
string NAME += FREQ
if CH == 1
	string NAME += "m"
elif CH == 2
	string NAME += "s"
endif
string NAME += ".uxma"
do
	findLoc OFFSET string "data" 0 ""
	goto OFFSET
	idstring "data"
	get SIZE long
while SIZE == 0 # skip marker section to find stream size
math OFFSET += 0x8
log NAME OFFSET SIZE

goto 0
findLoc MARKERS string "cue " 0 ""
if MARKERS != ""
	if MARKERS < OFFSET # in header
		goto MARKERS
		idstring "cue "
		get SIZE long
		math SIZE += 8
		append
		log MEMORY_FILE MARKERS SIZE
		append
		math MARKERS += SIZE
		goto MARKERS
		getDstring IDENT 4
		if IDENT == "LIST"
			get SIZE long
			math SIZE += 8
			append
			log MEMORY_FILE MARKERS SIZE
			append
		endif
		get SIZE asize MEMORY_FILE
		get NAME basename
		string NAME += ".cue"
		log NAME 0 SIZE MEMORY_FILE
	endif
endif

startfunction process
	goto 0x14
	get CODE short
	if CODE == 0x165
		goto 0x24
		get FREQ long
		goto 0x31
		get CH byte
	elif CODE == 0x166
		get CH short
		get FREQ long
	elif CODE == 0x104
		endian big
		goto 0x20
		get FREQ long
		goto 0x3c
		get CH byte
	elif CODE == 0x401
		endian big
		goto 0x20
		get FREQ long
		goto 0x3c
		get CH byte
	else
		print "No XMA file. Aborting..."
		cleanexit
	endif
	
endfunction
```
## Post #186
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-09T23:43:43+00:00
- Post Title: Re: My quickBMS scripts

Corrected the XMA header adder. The script stopped with an error message when no frequency was given in the file name... Works fine now with all uxma files.
Next step is to enhance the script with the new external exe execution feature (xxx) of QuickBMS:
automatically parse headerless xma files if the source is XMA2, automatically parse multichannel files correctly and add headers to each stereo stream. Need to include some (brute-force) blocksize detection for this.
enhance the RIFF_to_uxma script to something like XMA_to_XMA (input: xma or xma2 file with RIFF or RIFF header, output: decodable xma file or multiple stereo files respectively)
eventually an XMA scanner that automatically extracts and transforms xma streams out of an archive.
The last script will be really exciting to program because there are quite a few things to mind like the pure stream size detection via xma_parse.
Stay tuned for updates.
## Post #187
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-09T23:52:22+00:00
- Post Title: Re: My quickBMS scripts

Armored Core V Xbox 360 (bdt/bht)
Extracts the big archive from the new Armored Core V.  Only the name crcs are given, no actual file names. There seem to be groups of files, each group has a number of files associated although the file groups have no apparent meaning after extraction. You may adjust the script for your desires like only having the file number at the end of the file name. It's stored in the FNUM variable which isn't used in the below script but as I already included it to check the file count I thought I just keep it unused if anyone needs it.   
note: there are file types that can't be detected by their start. Those won't have any extension after the extraction.
UPDATE: externalized the type identification - use func_getTYPE.bms now!

```
# supported games: Armored Core V (Xbox 360)
# NOTE: make sure, both bdt and bht files have the same name before running the script!
#
# (c) 2012-03-25 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
open FDDE bhd 0
open FDDE bdt 1

endian big
idstring "BHD5" 0
get ZERO long 0
get UNK long 0
get FSIZE long 0
get GROUPS long 0 # file groups?
get UNK long 0
set FNUMB 0
for i = 1 <= GROUPS
	get FILES long 0 # number of files of same group
	get INFO long 0
	savepos MYOFF 0
	goto INFO 0
	for j = 1 <= FILES
		get NAME_CRC long 0
		get SIZE long 0
		get ZERO long 0
		get OFFSET long 0
		get NAME basename 0
		callfunction constructname 1
		endian little
		callfunction getTYPE 1
		endian big
		string NAME += EXT
		log NAME OFFSET SIZE 1
	next j
	goto MYOFF 0
next i

startfunction constructname
	math FNUMB += 1
	string NAME += "_"
	string NAME += i
	string NAME += "~"
	string NAME += FNUMB
	string NAME += "_0x"
	string NAME_CRC p= "%08x" NAME_CRC
	string NAME += NAME_CRC
endfunction
```
## Post #188
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-10T00:27:03+00:00
- Post Title: Re: My quickBMS scripts

Star Wars: The Force Unleashed PC (pcp/pcd)
Extracts the sounds from the game. Have to be post-processed with the next script.

```
open FDDE pcp 1

get UNK long 0
get UNK long 0
get FILES long 0
get NAMESTART long 0
set NAMEOFF FILES
math NAMEOFF *= 0x1c
math NAMEOFF += 0x10
math NAMEOFF += NAMESTART # only in some files
get FOLDER basename
string FOLDER += "/"
for i = 1 <= FILES
	get CRC long 0
	get OFFSET long 0
	get OFFSET2 long 0
	get SIZE long 0
	get FFFF long 0
	get UNK long 0
	get ZERO long 0
	savepos MYOFF 0
	goto NAMEOFF 0
	get NAMEL long 0
	getDstring NAME NAMEL 0
		#set NAME2 FOLDER
		#string NAME2 += NAME
		#set NAME NAME2
	savepos NAMEOFF 0
	string NAME += ".pcm"
	log NAME OFFSET SIZE 1
	goto MYOFF 0
next i
```


Star Wars: The Force Unleashed PC (pcm post-processing)
Extracted files are either uncompressed wave files or MS ADPCM.

```
if CODE == 2
	callfunction msadpcm 1
elif CODE == 1
	callfunction pcm 1
else
	print "error: unknown codec"
endif
get SIZE asize MEMORY_FILE
get NAME basename
string NAME += ".wav"
log NAME 0 SIZE MEMORY_FILE

startfunction msadpcm
	set MEMORY_FILE binary "\x52\x49\x46\x46\x9C\xA8\x80\x00\x57\x41\x56\x45\x66\x6D\x74\x20\x32\x00\x00\xff"
	# note: byte at 0x13 has to be set to 0 later
	append
	log MEMORY_FILE 0 0x32
	append
	putVarChr MEMORY_FILE 0x46 0x61746164 long # "data"
	putVarChr MEMORY_FILE 0x4a 0xffffffff long # placeholder
	putVarChr MEMORY_FILE 0x13 0 byte
	set OFFSET 0x32
	get SIZE asize
	math SIZE -= OFFSET
	append
	log MEMORY_FILE OFFSET SIZE
	append
	putVarChr MEMORY_FILE 0x4a SIZE long # actual streamsize
	get RIFFSIZE asize MEMORY_FILE
	math RIFFSIZE -= 8
	putVarChr MEMORY_FILE 4 RIFFSIZE long
endfunction

startfunction pcm
	goto 2
	get CHANNELS short
	get FREQUENCY short
	set BITS 16
	set OFFSET 0x10
	get SIZE asize
	math SIZE -= OFFSET
	set MEMORY_FILE binary "\x52\x49\x46\x46\x00\x00\x00\x00\x57\x41\x56\x45\x66\x6d\x74\x20\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x64\x61\x74\x61\xff\xff\xff\xff"
	append
	log MEMORY_FILE OFFSET SIZE
	append

	set RIFFSIZE SIZE
	math RIFFSIZE += 36
	set BLOCKALIGN BITS
	set AVGBYTES FREQUENCY
	math BLOCKALIGN /= 8
	math BLOCKALIGN *= CHANNELS
	math AVGBYTES *= BLOCKALIGN

	putvarchr MEMORY_FILE 4 RIFFSIZE long
	putvarchr MEMORY_FILE 20 1 short          # wFormatTag: Microsoft PCM Format (0x0001)
	putvarchr MEMORY_FILE 22 CHANNELS short   # wChannels
	putvarchr MEMORY_FILE 24 FREQUENCY long   # dwSamplesPerSec
	putvarchr MEMORY_FILE 28 AVGBYTES long    # dwAvgBytesPerSec
	putvarchr MEMORY_FILE 32 BLOCKALIGN short # wBlockAlign
	putvarchr MEMORY_FILE 34 BITS short       # wBitsPerSample
	putvarchr MEMORY_FILE 40 SIZE long
endfunction
```

Part of the wave header function is (c)Luigi Auriemma - thanks for that buddy
## Post #189
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-11T01:14:21+00:00
- Post Title: Re: My quickBMS scripts

Just updated the RIFF/RIFX to unparsed xma script by another file type. =)
## Post #190
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-15T01:29:39+00:00
- Post Title: Re: My quickBMS scripts

Updated the str audio extractor for Playstation movies. Also works for multistream videos now.
## Post #191
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-22T21:21:57+00:00
- Post Title: Re: My quickBMS scripts

Nintedo DS SDAT extractor
Finally finished this one. Why? BECAUSE ALL PREVIOUS EXTACTORS WERE ERRORNOUS!!! One extracted only *.strm files, one extracted no *.strm files - damn! Wrote almost three days at this; strange format. 

```
#(c) 2012-03-18 by AlphaTwentyThree of XeNTaX

idstring "SDAT"
get UNK short
get UNK short
get FILESIZE long
get INFO_AREA short # header length
get UNK short

# write sections to memory files 
get pSYMBOL long # SYMB offset
get sSYMBOL long # SYMB size
	putVarChr MEMORY_FILE sSYMBOL 0
	log MEMORY_FILE 0 0
	log MEMORY_FILE pSYMBOL sSYMBOL
get pINFO long   # INFO offset
get sINFO long   # INFO size
	putVarChr MEMORY_FILE2 sINFO 0
	log MEMORY_FILE2 0 0
	log MEMORY_FILE2 pINFO sINFO
get pFAT long    # FAT offset
get sFAT long    # FAT size
	putVarChr MEMORY_FILE3 sFAT 0
	log MEMORY_FILE3 0 0
	log MEMORY_FILE3 pFAT sFAT
get pFILE long   # FILE offset
get sFILE long   # FILE size
	putVarChr MEMORY_FILE4 sFILE 0
	log MEMORY_FILE4 0 0
	log MEMORY_FILE4 pFILE sFILE

PutArray 0 0 "/Seq/"
PutArray 0 1 "/SeqArc/"
PutArray 0 2 "/Bank/"
PutArray 0 3 "/WaveArc/"
PutArray 0 4 "/Player/"
PutArray 0 5 "/Group/"
PutArray 0 6 "/PlayerSTRM/"
PutArray 0 7 "/STRM/"

PutArray 1 0 ".sseq"
PutArray 1 1 ".ssar"
PutArray 1 2 ".sbnk"
PutArray 1 3 ".swar"
PutArray 1 4 ".ply"
PutArray 1 5 "" # different extensions
PutArray 1 6 ".strm"
PutArray 1 7 ".strm"

set FIRSTNAME 0
for i = 0 <= 7
	set INIPOS i # initial position without area bias
	math INIPOS *= 4
	math INIPOS += 8 # skip IDENT and AREA_SIZE
	
	# name information
	goto INIPOS MEMORY_FILE
	get NPOS long MEMORY_FILE
	goto NPOS MEMORY_FILE
	get FILES long MEMORY_FILE
	savepos NAME_INFO MEMORY_FILE
	
	# position of size/offset information in FAT area
	goto INIPOS MEMORY_FILE2
	get IPOS long MEMORY_FILE2
	goto IPOS MEMORY_FILE2
	get FILES2 long MEMORY_FILE2 # not needed (duplicate value)
	savepos INFO_POS MEMORY_FILE2
	
	getArray FOLDER 0 i
	getArray EXT 1 i
	get FPATH basename
	string FPATH += FOLDER
	
	# MEMORY_FILE 	: 	SYMB (names)
	# MEMORY_FILE2 	: 	INFO (pointer to offset/size)
	# MEMORY_FILE3 	: 	FAT (offset/sizes)
	# MEMORY_FILE4 	: 	FILE (binary data)
	for j = 1 <= FILES
		# get name
		goto NAME_INFO MEMORY_FILE
		get NAMEPOS long MEMORY_FILE
		savepos NAME_INFO MEMORY_FILE
		if FIRSTNAME == 0
			set FIRSTNAME NAMEPOS
		endif
		if NAMEPOS < FIRSTNAME
			do
				get NAMEPOS long MEMORY_FILE
				savepos NAME_INFO
			while NAMEPOS < FIRSTNAME
		endif
		goto NAMEPOS MEMORY_FILE
		get NAME string MEMORY_FILE
		set FNAME FPATH
		string FNAME += NAME
		string FNAME += EXT
		
		# get file ID
		goto INFO_POS MEMORY_FILE2 
		get ID_INFO long MEMORY_FILE2
		savepos INFO_POS MEMORY_FILE2
		goto ID_INFO MEMORY_FILE2
		if i == 4 # do nothing (?)
		elif i == 6 # do nothing (?)
		else
			get FILE_ID short MEMORY_FILE2
			# get offset/size
			set OFFPOS FILE_ID
			math OFFPOS *= 0x10
			math OFFPOS += 0xc # skip header
			goto OFFPOS MEMORY_FILE3
			get OFFSET long MEMORY_FILE3
			math OFFSET -= pFILE # offset it total offset in sdat
			get SIZE long MEMORY_FILE3
			if i == 5
				callfunction getEXT 1
			endif
			log FNAME OFFSET SIZE MEMORY_FILE4
		endif
	next j
next i

startfunction getEXT
	goto OFFSET MEMORY_FILE4
	getDstring IDENT 4 MEMORY_FILE4
	if IDENT == "SWAR"
		string FNAME += ".swar"
	elif IDENT == "SBNK"
		string FNAME += ".sbnk"
	elif IDENT == "SSAR"
		string FNAME += ".ssar"
	elif IDENT == "STRM"
		string FNAME += ".strm"
	endif
endfunctioni
```
## Post #192
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-22T21:43:43+00:00
- Post Title: Re: My quickBMS scripts

Function: convert number to hex string
As the new version of QuickBMS supports external functions (YAY!!!), here's an example. Save the below code as num2hex.bmsf. Accessing the function works by adding the line 
```
include "num2hex.bmsf"
```
 to the start of your script.
The number you want to convert has to be named TOHEX. When you call the function (callfunction num2hex 1), the resulting hex string is saved in the same variable.

```
	strlen LENGTH TOHEX
	if LENGTH == 8
		string TOHEX p= "0x%08x" TOHEX
	elif LENGTH == 7
		string TOHEX p= "0x%07x" TOHEX
	elif LENGTH == 6
		string TOHEX p= "0x%06x" TOHEX
	elif LENGTH == 5
		string TOHEX p= "0x%05x" TOHEX
	elif LENGTH == 4
		string TOHEX p= "0x%04x" TOHEX
	elif LENGTH == 3
		string TOHEX p= "0x%03x" TOHEX
	elif LENGTH == 2
		string TOHEX p= "0x%02x" TOHEX
	elif LENGTH == 1
		string TOHEX p= "0x%01x" TOHEX
	endif
endfunction
```
## Post #193
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-22T22:47:56+00:00
- Post Title: Re: My quickBMS scripts

Nintendo DS SWAR extractor
Extracts *.swav files out of swar archives (WaveArc). Playable with vgmstream. I know that VGMTrans can export swar files to dls instrument collections but there are sometimes other *.swar files that either aren't used in the banks or are completely stand-alone e.g. when there's no bank/seq area in the sdat. Experienced in GemQuest: 4 Elements and 7th Dragon so far but there are surely many others.

```
# (c) 2012-02-22 by AlphaTwentyThree of XeNTaX

idstring "SWAR"
get MAGIC long # 0xfffe0001
get SIZE long # file size
get HEADER short # SWAR size
get BLOCKS short # always 1
idstring "DATA"
get DSIZE long # size of DATA area
savepos MYOFF
math MYOFF += 0x20
goto MYOFF
get FILES long
for i = 1 <= FILES
	get OFFSET long
	if i != FILES
		savepos MYOFF
		get SIZE long
		goto MYOFF
	else
		get SIZE asize
	endif
	math SIZE -= OFFSET
	get NAME basename
	string NAME += "_"
	string NAME += i
	string NAME += ".swav"
	callfunction SWAV 1
next i


startfunction SWAV
	set MEMORY_FILE binary "\x53\x57\x41\x56\xFF\xFE\x00\x01\xA8\x61\x0F\x00\x10\x00\x01\x00\x44\x41\x54\x41\x98\x61\x0F\x00"
	append
	log MEMORY_FILE OFFSET SIZE
	append
	math SIZE += 0x8
	putVarChr MEMORY_FILE 0x14 SIZE long
	get SIZE asize MEMORY_FILE
	putVarChr MEMORY_FILE 0x8 SIZE long
	log NAME 0 SIZE MEMORY_FILE
endfunction
```
## Post #194
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-22T23:43:16+00:00
- Post Title: Re: My quickBMS scripts

IMPORTANT UPDATE:
Just had to update my sdat extractor because there seem to be sdat files where the area with the file name pointers contains some unused information and the script searched for the name at the wrong offset. Fixed that problem with a little nasty work-around. Seems to work.
## Post #195
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-23T06:14:36+00:00
- Post Title: Re: My quickBMS scripts

Nintendo DS bank.bin extractor
This extractor is for those NDS roms that only contain that one bank.bin file. There may be other formats to adjust the extension for and I'll update the script as soon as I find another game with this format.
Needs my func_getTYPE.bms to get file types.

```
# this is for NDS roms that only contain one single bin file
# supported games (more to come):
# - 1 vs 100
# - A Prendre ou A Laisser (FR)
# - Affari Tuoi (IT)
# - Dolphin Island: Underwater Adventures
# - Imagine: Teacher: Class Trip
# - Totally Spies! 3 - Sectet Agents
# 
# (c) 2012-03-19 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
get ZERO long
get DATASTART long
set FILES DATASTART
math FILES -= 8
math FILES /= 8
for i = 1 <= FILES
	get OFFSET long
	get SIZE long
	get NAME basename
	string NAME += "_"
	string NAME += i
	callfunction getTYPE 1
	string NAME += EXT
	log NAME OFFSET SIZE
next i
```


Here's a guide how to get the music from these games:
I suppose you know how to extract *.nds roms, otherwise you wouldn't be here. 
1. Extract the bin file and locate the *.xm tracker files
2. Open all xm files with a hex editor
3. Scroll to the end of each xm file to locate the sample list. The samples are named "XMSMP_000.snd" up to a number you need to locate. They _should_ be sequentially named but don't be too sure about this. Look, how many samples occur in the xm files. Note that they start at zero, so if the highest sample is "XMSMP_030.snd", there are 31 samples in total.
4. Make a new folder and copy the above number of files from the end to that folder. These should only have the extensions *.dat or *.ez
5. You may need to decompress the *.ez files (as soon as somebody cracks the compression).
6. To keep track of the samples, rename them to the names needed (XMSMP_####.raw).
7. All the files are normally uncompressed PCM files. The frequency isn't given, so you should try some possibilities. So far I only encountered 11025 Hz mono 16bit, but there may be games which use others. Import the samples to any audio editor with the given specs. Save them as wav.
7. Open each xm file in Modplug Tracker and add as many samples as given in the sample list (check again via hex if you forgot). Import the wav samples from the xm sample list. IMPORTANT: keep the same order as in the list!
8. Save the file with Ctrl+S. Modplug Tracker will create an ImpulseTracker (*.it) file from the xm.
## Post #196
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-23T06:46:52+00:00
- Post Title: Re: My quickBMS scripts

And another update for the SDAT extractor.
This time I encountered a file where the number of file pointers was excessively higher than the actual files (Ace Attorney Investigations: Miles Edgeworth). But as the pointer to the file name was zero in those cases, I could just add another if case.
## Post #197
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-23T23:52:24+00:00
- Post Title: Re: My quickBMS scripts

7 Wonders: Magical Mystery Tour (iPhone/iPad) - Contents.dat Extractor
The archive includes uncompiled *.lua scipts. =)

```
get INFOPOS long
goto INFOPOS
get FILES long
set NAMEOFF FILES
math NAMEOFF *= 0x10
math NAMEOFF += INFOPOS
math NAMEOFF += 8
for i = 1 <= FILES # files and folders
	get IDENT long
	get OFFSET long
	get SIZE long
	get NAMEPOS long
	math NAMEPOS += NAMEOFF
	savepos MYOFF
	goto NAMEPOS
	get NAME string
	goto MYOFF
	if IDENT == 0 # file
		log NAME OFFSET SIZE
	endif
next i
```
## Post #198
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-24T03:33:52+00:00
- Post Title: Re: My quickBMS scripts

Hooligans: Storm Over Europe *.x13 extractor
Little known game. Only wrote this to get the music.

```
# archive type: *.x13
# (c) 2012-02-24 by AlphaTwentyThree of XeNTaX

idstring "PACK"
get INFO long
get FILES asize
math FILES -= INFO
math FILES /= 0x40
goto INFO
for i = 1 <= FILES
	getDstring NAME 0x38
	get OFFSET long
	get SIZE long
	log NAME OFFSET SIZE
next i
```
## Post #199
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-24T03:47:14+00:00
- Post Title: Re: My quickBMS scripts

Hitman: Blood Money (PC) *.str extractor
I just merged the two scripts I wrote for the game some weeks ago, so the final script is quite big. Nice example for the use of functions and memory pre-allocation. I know I could have written this differently by using external functions but I'm too lazy to update this at the moment. 

```
# format: *.str
# (c) 2012-02-24 by AlphaTwentyThree of XeNTaX

idstring "IOISNDSTREAM"
goto 0x10
get INFO long
get FILES long
get HEADERSIZE long
goto INFO
for i = 1 <= FILES
   get FILENUMBER long
   get ZERO long
   get OFFSET long
   get ZERO long
   get SIZE long
   get ZERO long
   get INFOPOS long
   get ZERO long
   get INFOLENGTH long
   get UNK long
   get NAMEL long
   get ZERO long
   get NAMEPOS long
   get ZERO long
   get UNK long
   get UNK long
   get ZERO long
   get ZERO long
   savepos MYOFF
   goto NAMEPOS
   getDstring NAME NAMEL
   log MEMORY_FILE 0 0
   set HEADERSIZE INFOLENGTH
   math HEADERSIZE += 8
   PutVarChr MEMORY_FILE 0 0x56415752 long # RWAV
   PutVarChr MEMORY_FILE 4 HEADERSIZE long
   append
   log MEMORY_FILE INFOPOS INFOLENGTH
   log MEMORY_FILE OFFSET SIZE
   append
   callfunction RWAV 1
   goto MYOFF
next i


startfunction RWAV
	savepos TEMP_OFF
	goto 0 MEMORY_FILE
	idstring "RWAV" MEMORY_FILE
	get OFFSET long MEMORY_FILE
	get SIZE asize MEMORY_FILE
	math SIZE -= OFFSET
	get TYPE long MEMORY_FILE
	get UNK long MEMORY_FILE
	get CH long MEMORY_FILE
	get FREQ long MEMORY_FILE
	get BITS long MEMORY_FILE
	   
	if TYPE == 2 # uncompressed PCM, 0x18 header
	   set TYPE "WAV"
	elif TYPE == 0x11
	   set TYPE "WAV"
	elif TYPE == 3 # IMA ADPCM, 0x20 header
	   set TYPE "IMA"
	elif TYPE == 4 # ogg
	   set TYPE "OGG"
	endif

	if TYPE == "WAV"
	   get BLOCKALIGN long MEMORY_FILE
	   callfunction PCM 1
	   get SIZE asize MEMORY_FILE2
	   string NAME += ".wav"
	   log NAME 0 SIZE MEMORY_FILE2
	elif TYPE == "IMA"
	   get INTERLEAVE long MEMORY_FILE
	   get UNK long MEMORY_FILE
	   callfunction IMA 1
	   get SIZE asize MEMORY_FILE2
	   string NAME += ".lwav"
	   log NAME 0 SIZE MEMORY_FILE2
	elif TYPE == "OGG"
	   string NAME += ".ogg"
	   log NAME OFFSET SIZE MEMORY_FILE
	endif
endfunction

startfunction PCM
   set PRE SIZE
   math PRE += 0x2c
   putVarChr MEMORY_FILE2 PRE 0
   log MEMORY_FILE2 0 0
   set MEMORY_FILE2 binary "\x52\x49\x46\x46\x00\x00\x00\x00\x57\x41\x56\x45\x66\x6d\x74\x20\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x64\x61\x74\x61\xff\xff\xff\xff"
   append
   log MEMORY_FILE2 OFFSET SIZE MEMORY_FILE
   append
   set RIFFSIZE SIZE
   math RIFFSIZE += 36
   set AVGBYTES FREQ
   math AVGBYTES *= BLOCKALIGN

   putvarchr MEMORY_FILE2 4 RIFFSIZE long
   putvarchr MEMORY_FILE2 20 1 short          # wFormatTag: Microsoft PCM Format (0x0001)
   putvarchr MEMORY_FILE2 22 CH short   # wChannels
   putvarchr MEMORY_FILE2 24 FREQ long   # dwSamplesPerSec
   putvarchr MEMORY_FILE2 28 AVGBYTES long    # dwAvgBytesPerSec
   putvarchr MEMORY_FILE2 32 BLOCKALIGN short # wBlockAlign
   putvarchr MEMORY_FILE2 34 BITS short       # wBitsPerSample
   putvarchr MEMORY_FILE2 40 SIZE long
endfunction

startfunction IMA
   set PRE SIZE
   math PRE += 0x2c
   putVarChr MEMORY_FILE2 PRE 0
   log MEMORY_FILE2 0 0
   set MEMORY_FILE2 binary "\x52\x49\x46\x46\x28\xCC\x0B\x00\x57\x41\x56\x45\x66\x6D\x74\x20\x14\x00\x00\x00\x11\x00\x01\x00\x44\xAC\x00\x00\x94\x83\x01\x00\x00\x04\x04\x00\x02\x00\x40\x00\x64\x61\x74\x61\x00\xCC\x0B\x00"
   set RIFFSIZE SIZE
   math RIFFSIZE += 0x28
   putVarChr MEMORY_FILE2 0x4 RIFFSIZE long
   putVarChr MEMORY_FILE2 0x16 CH short
   putVarChr MEMORY_FILE2 0x18 FREQ long
   putVarChr MEMORY_FILE2 0x20 INTERLEAVE short
   putVarChr MEMORY_FILE2 0x2C SIZE long
   append
   log MEMORY_FILE2 OFFSET SIZE
   append
endfunction
```
## Post #200
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-24T04:12:41+00:00
- Post Title: Re: My quickBMS scripts

func_header_PCM.bms

Adds a PCM header to any data. Resulting wave file is stored in MEMORY_FILE and can easily be written (see example script below). Thans for the "include" update Luigi! =)
Needed variables: SIZE, OFFSET, FREQ, CH, BITS

```
# input variables: SIZE, OFFSET, FREQ, CH, BITS, BLOCKALIGN (?), NAME (optional), CODEC (optional)
# (c) 2012-04-16 by AlphaTwentyThree of XeNTaX

startfunction PCM
	endian little
	set BLOCKALIGN 1
	set PRE SIZE
	math PRE += 0x2c
	putVarChr MEMORY_FILE PRE 0
	log MEMORY_FILE 0 0
	set MEMORY_FILE binary "\x52\x49\x46\x46\x20\xC0\xB1\x00\x57\x41\x56\x45\x66\x6D\x74\x20\x10\x00\x00\x00\x01\x00\x02\x00\x44\xAC\x00\x00\x10\xB1\x02\x00\x04\x00\x10\x00\x64\x61\x74\x61\xFC\xBF\xB1\x00"
	append
	log MEMORY_FILE OFFSET SIZE
	append
	set RIFFSIZE SIZE
	math RIFFSIZE += 36
	set AVGBYTES FREQ
	math AVGBYTES *= BLOCKALIGN
	
	putvarchr MEMORY_FILE 0x04 RIFFSIZE long
	putvarchr MEMORY_FILE 0x14 CODEC short          # wFormatTag: Microsoft PCM Format (0x0001)
	putvarchr MEMORY_FILE 0x16 CH short   # wChannels
	putvarchr MEMORY_FILE 0x18 FREQ short   # dwSamplesPerSec
	putvarchr MEMORY_FILE 0x1c AVGBYTES long    # dwAvgBytesPerSec
	putvarchr MEMORY_FILE 0x20 BLOCKALIGN short # wBlockAlign
	putvarchr MEMORY_FILE 0x22 BITS short       # wBitsPerSample
	putvarchr MEMORY_FILE 0x28 SIZE long
	if NAME == ""
		get NAME basename
		string NAME += ".wav"
	endif
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction
```

PCM header adder (example):

```
set OFFSET 0
get SIZE asize
math SIZE -= OFFSET
set FREQ 44100
set CH 2
set BITS 16
set CODEC 0x1 # see codec list for others
callfunction PCM 1
get SIZE asize MEMORY_FILE
get NAME basename
string NAME += ".wav"
log NAME 0 SIZE MEMORY_FILE
```
## Post #201
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-02-24T05:32:42+00:00
- Post Title: Re: My quickBMS scripts

As some of you may have noticed already, I've begun to update some scripts to function and stand-alone usage. If you're using my scripts, stay tuned, update the scripts and put them in a central location!
Just updated:
XMA RIFF header adder to func_XMA_header.bms
str2num function to func_str2num.bms
I'll post here whenever I've made an update.
## Post #202
- Username: brendan19
- Rank: ultra-veteran
- Number of posts: 389
- Joined date: Thu Aug 12, 2010 3:15 pm
- Post datetime: 2012-02-28T03:18:08+00:00
- Post Title: Re: My quickBMS scripts

Alpha23, could you update your SoundNode2XMA script to search for these XMA flags as well:

FC038000
FC03C001 - Usually Mono but can also be Stereo
## Post #203
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-16T00:07:48+00:00
- Post Title: Re: My quickBMS scripts

Just updated my NDS bank.bin script by three games.
## Post #204
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-18T18:27:50+00:00
- Post Title: Re: My quickBMS scripts

Another important update for the NDS sdat extractor: now the files in th "Group" directory have the correct extension. =)
## Post #205
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-18T19:24:38+00:00
- Post Title: Re: My quickBMS scripts

Just encountered  a DS game where the main music isn't stored in the sound_data.sdat but in a Glob.bin that holds all other game files. As I guess that this format is used by other DS games I'll take a look at in the future I wrote this script. Took me unusually long because the needed information have to be gathered by workarounds.

```
# that only consist of this very file and the sound_data.sdat
#
# supported games:
# - Are You Smarter than a 5th Grader? Back to School
#
# (c) 2012-03-18 by AlphaTwentyThree of XeNTaX

callfunction checkBIN 1 # check if bin correct
callfunction getNAMEPOS 1 # determine offset of GlobFiles.txt
# string NAMEPOS p= "%08x" NAMEPOS
# print "namepos: %NAMEPOS%"
# cleanexit
goto 0
get FILES long
math FILES -= 1 # last variable in list is file size (to get last offset)
math FILES /= 0x4
goto 0
get FOLDER basename
string FOLDER += "/"

for i = 1 <= FILES
	get OFFSET long
	savepos MYOFF
	get SIZE long
	math SIZE -= OFFSET
	goto NAMEPOS			# comment these lines
	getCT NAME string 0x20	# in first run and
	math NAMEPOS += 0x40	# adjust number at beginning
	
	# get NAME basename   	# uncomment
	# string NAME += "_"  	# in first
	# string NAME += i    	# run
	goto MYOFF
	set FNAME FOLDER
	string FNAME += NAME
	log FNAME OFFSET SIZE
next i

startfunction checkBIN
	get FSIZE asize
	get SIZEOFF long
	math SIZEOFF -= 4
	goto SIZEOFF
	get TESTSIZE long
	if TESTSIZE != FSIZE
		print "ERROR: not a valid NDS *.bin file!"
		cleanexit
	endif
endfunction

startfunction getNAMEPOS
	FindLoc GLOBFILES string "GlobFiles.txt" 0 ""
	goto 0
	do
		savepos NAMEOFF
		get TESTOFF long
	while TESTOFF < GLOBFILES
	math NAMEOFF -= 4
	goto NAMEOFF
	get NAMEPOS long
endfunction
```
## Post #206
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-18T21:47:46+00:00
- Post Title: Re: My quickBMS scripts

Found three NDS games with this format so far. Don't forget the func_getTYPE.bms for this!

```
#
# supported games so far:
# - Anpanman to Asobo: ABC Kyoushitsu (NDS)
# - Anpanman to Asobo: Aiueo Kyoushitsu (NDS)
# - Bunnyz (NDS)
#
# (c) 2012-03-20 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
idstring "IM00"
get FILES long
for i = 1 <= FILES
	get OFFSET long
	if i != FILES
		savepos MYOFF
		get SIZE long
		
	else
		get SIZE asize
	endif
	math SIZE -= OFFSET
	get NAME basename
	string NAME += "_"
	string NAME += i
	log MEMORY_FILE 0 0
	log MEMORY_FILE OFFSET SIZE
	callfunction getTYPE 1
	string NAME += EXT
	log NAME 0 SIZE MEMORY_FILE
	goto MYOFF
next i
```
## Post #207
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-18T22:06:21+00:00
- Post Title: Re: My quickBMS scripts

Another one where I don't know if it's game-specific. Will post it under this category until I find another game with this format.

```
#
# supported games:
# - Anpanman to Touch de Waku Waku Training (DS)
# 
# (c) 2012-03-18 by AlphaTwentyThree of XeNTaX

idstring "PAK0"
set NAMEPOS ""
get INFOSIZE short
get FILES short
get FNAME basename
if FNAME == "Sound"
	get NAMEPOS long
	goto 8
elif FNAME == "flxResource"
	get NAMEPOS long
	goto 8
endif
for i = 1 <= FILES
	get OFFSET long
	savepos MYOFF
	get SIZE long
	math SIZE -= OFFSET
	if NAMEPOS == ""
		get NAME basename
		string NAME += "_"
		string NAME += i
	else
		if i == 1
			set NAME "#NAME_INFO"
		else
			goto NAMEPOS
			getCT NAME string 0x0a
			savepos NAMEPOS
		endif
	endif
	log NAME OFFSET SIZE
	goto MYOFF
next i
```
## Post #208
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-19T00:22:39+00:00
- Post Title: Re: My quickBMS scripts

func_getTYPE.bms

Ok, this post is extremely long overdue. When extracting files there's often no extension given, so I normally would test for the extensions that exist in the archive and just adjust a function at the end of the script. Lately I've run into too many GRAFs with no names or extensions and I think it's time to get some automation going here. 
I'll slowly update the below script with different heuristics as I encounter more and more file types. I know that there are file scanners for all kinds of types but I need this to determine the type inside MEMORY_FILE to adjust the extension on-the-fly. 
So you can go from

```
log NAME OFFSET SIZE
...
```

to

```
...
log MEMORY_FILE OFFSET SIZE
callfunction getTYPE 1
string NAME += EXT
log NAME 0 SIZE MEMORY_FILE
...
```

There's also the ZNAME variable which holds the filename in some file types (e.g. *.vag). Obviously, add

```
if ZNAME != ""
    string NAME += "_"
    string NAME += ZNAME
endif
string NAME += EXT
...
```
 for this (or just "set NAME ZNAME" if you want to leave out theID/CRC/TOC name).

Of course there are thousands of file types and many of them cannot be identified clearly, e.g. txt/inf/log/lua etc.

If you encounter any file type that isn't included in this script, just PM me and I'll see what I can do.
[func_getTYPE (rev 2014-12-12).zip](https://xentaxbackup.github.io/file/8265_func_getTYPE (rev 2014-12-12).zip)
## Post #209
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-19T01:34:21+00:00
- Post Title: Re: My quickBMS scripts

I guess that's something CRI specific but as always, I'm not sure until I find another game with this structure.
Also supports those *.snd files without a shd header file.
Note that it needs the func_getTYPE.bms!

```
#
# supported games:
# - Arasuji de Kitaeru Hayamimi no Susume DS
# 
# (c) 2012-03-19 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
open FDDE SHD 0 EXISTS
open FDDE SND 1
if EXISTS == 1 # diff qualities
	set QUALPOS 0
	set INFOPOS 0x20
	for i = 1 <= 4
		log MEMORY_FILE 0 0
		goto QUALPOS 0
		get OFFSET long	0
		get SIZE long 0
		savepos QUALPOS 0
		log MEMORY_FILE2 OFFSET SIZE 1
		goto INFOPOS 0
		get STARTPOS long 0
		get FILES long 0
		math FILES /= 8
		savepos INFOPOS 0
		math STARTPOS += 0x20
		goto STARTPOS 0
		
		for j = 1 <= FILES
			get OFFSET long 0
			get SIZE long 0
			log MEMORY_FILE OFFSET SIZE MEMORY_FILE2
			callfunction getname 1
			callfunction getTYPE 1
			string NAME += EXT
			log NAME 0 SIZE MEMORY_FILE
		next j
	next i
else
	open FDDE SND 0
	get FILES long
	math FILES /= 8
	goto 0
	for i = 1 <= FILES
		get OFFSET long
		get SIZE long
		log MEMORY_FILE OFFSET SIZE
		callfunction getTYPE 1
		get NAME basename
		string NAME += "_"
		string NAME += i
		string NAME += EXT
		log NAME 0 SIZE MEMORY_FILE
	next i
endif

startfunction getname
	get NAME basename 0
	string NAME += "_"
	string NAME += i
	string NAME += "_"
	string NAME += j
endfunction
```
## Post #210
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-19T01:41:24+00:00
- Post Title: Re: My quickBMS scripts

func_testvariables.bms
Checks if needed variables are set (used in various functions).

```
	if CH == ""
		print "ERROR: channels (CH) not given"
		cleanexit
	elif FREQ == ""
		print "ERROR: frequency (FREQ) not given"
		cleanexit
	elif INTERL == ""
		print "ERROR: interleave (INTERL) not given"
		cleanexit
	elif BITS == ""
		print "ERROR: bits (BITS) not given"
		cleanexit
	elif SIZE == ""
		print "ERROR: size (SIZE) not given"
		cleanexit
	elif OFFSET == ""
		print "ERROR: offset (OFFSET) not given"
		cleanexit
	endif
endfunction
```
## Post #211
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-19T01:50:33+00:00
- Post Title: Re: My quickBMS scripts

Just did a major update with the PCM and XMA header. Now with correct use of functions!
## Post #212
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-20T01:36:09+00:00
- Post Title: Re: My quickBMS scripts

NDS SPK extractor
Extracts the *.spk sound packs from NDS games. These usually contain *.swav files. Don't forget to include the func_getTYPE.bms.

```
idstring "SMPK"
get FILES long
goto 0x10
for i = 1 <= FILES
	get TYPE long
	get OFFSET long
	get SIZE long
	get ZSIZE long
	log MEMORY_FILE 0 0
	log MEMORY_FILE OFFSET SIZE
	callfunction getTYPE 1
	get NAME basename
	string NAME += "_"
	string NAME += i
	string NAME += EXT
	log NAME 0 SIZE MEMORY_FILE
next i
```
## Post #213
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-20T02:09:00+00:00
- Post Title: Re: My quickBMS scripts

Bratz DS pkg extractor
Extractor for three of the Bratz games for Nintendo DS.

```
# - Bratz: 4 Real (DS)
# - Bratz: Forever Diamondz (DS)
# - Bratz: Girlz Really Rock (DS)
# (c) 2012-03-20 by AlphaTwentyThree of XeNTaX

idstring "pkg"
comtype gzip
goto 8
get FILES long
goto 0x30
for i = 1 <= FILES
	getDstring NAME 0x20
	get FNUMB short
	get COMP short
	get ZSIZE long
	get SIZE long
	get OFFSET long
	get ZERO long
	if COMP == 0
		log NAME OFFSET SIZE
	elif COMP == 1
		clog NAME OFFSET SIZE ZSIZE
	endif
next i
```
## Post #214
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-20T02:41:20+00:00
- Post Title: Re: My quickBMS scripts

BigFile.bin Extractor for Bratz DS
Thanks to comtype_scan2.bms, I got the compression type easily! =)

```
# - Bratz Kidz: Party (DS)
# - Bratz Kidz: Slumber Party (DS)
# - Bratz Ponyz (DS)
#
# (c) 2012-03-20 by AlphaTwentyThree of XeNTaX

comtype PUYO_LZ01
get FILES long
for i = 1 <= FILES
	get OFFSET threebyte
	get COMP byte
	get ZSIZE long
	get SIZE long
	savepos MYOFF
	math MYOFF += 0x20
	get NAME string
	goto MYOFF
	get ZERO long
	get UNK long
	if COMP == 1
		clog NAME OFFSET SIZE ZSIZE
	else
		log NAME OFFSET SIZE
	endif
next i
```
## Post #215
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-24T00:54:02+00:00
- Post Title: Re: My quickBMS scripts

Yesterday RESOURCE extractor
Extracts the files from the new Pendulo Studios game. Make sure you have the latest func_getTYPE.bms (extended and corrected again)!

```
#
# (c) 2012-03-24 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
set EXT ""
get FILES long
get SUFFIX extension
set TEST ""
getVarChr T SUFFIX 0
putVarChr TEST 0 T
getVarChr T SUFFIX 1
putVarChr TEST 1 T
if TEST == "S0"
	callfunction type1 1
else
	callfunction type2 1
endif

startfunction type1
	for i = 1 <= FILES
		get OFFSET long
		get SIZE long
		get ZERO long
		get FILETYPE byte
		if SIZE != 0x2c # only header, i.e. empty stream
			log MEMORY_FILE 0 0
			log MEMORY_FILE OFFSET SIZE
			get NAME basename
			string NAME += "."
			get SUFFIX extension
			string NAME += SUFFIX
			string NAME += "_"
			string NAME += i
			callfunction getTYPE 1
			string NAME += EXT
			log NAME 0 SIZE MEMORY_FILE
		endif
	next i
endfunction

startfunction type2 # all but sounds
	set SIZEOFF FILES
	math SIZEOFF += 4
	math FILES /= 4
	for i = 1 <= FILES
		get OFFSET long
		savepos MYOFF
		goto SIZEOFF
		get SIZE long
		savepos SIZEOFF
		if SIZE != 0
			log MEMORY_FILE 0 0
			log MEMORY_FILE OFFSET SIZE
			get NAME basename
			string NAME += "."
			get SUFFIX extension
			string NAME += SUFFIX
			string NAME += "_"
			string NAME += i
			callfunction getTYPE 1
			string NAME += EXT
			log NAME 0 SIZE MEMORY_FILE
		endif
		goto MYOFF
	next i
endfunction
```
## Post #216
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-25T15:47:16+00:00
- Post Title: Re: My quickBMS scripts

Just updated func_getTYPE and my Armored Core V script.
## Post #217
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-03-26T19:26:43+00:00
- Post Title: Re: My quickBMS scripts

Had to correct the header_adder_XMA.bms due to a wrong if case when reading the channel count from the file name. Works now.
## Post #218
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-01T18:39:18+00:00
- Post Title: Re: My quickBMS scripts

POD5  extractor
I guess there are other games with this format.

```
#
# supported games:
# Kinect Star Wars (Xbox 360)
# Country Dance All-Stars (Xbox 360)
#
# (c) 2012-04-04 by AlphaTwentyThreee of XeNTaX

idstring "POD5"
goto 0x58
get FILES long
goto 0x108
get INFO long
set NAMEOFF FILES
math NAMEOFF *= 0x1c
math NAMEOFF += INFO
goto INFO
for i = 1 <= FILES
	get NAMEPOS long
	math NAMEPOS += NAMEOFF
	get SIZE long
	get OFFSET long
	get ZSIZE long
	get ZERO long
	get UNK long
	get UNK long
	savepos MYOFF
	goto NAMEPOS
	get NAME string
	if SIZE == ZSIZE
		log NAME OFFSET SIZE
	else
		clog NAME OFFSET SIZE ZSIZE
	endif
	goto MYOFF
next i
```
## Post #219
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-01T22:18:38+00:00
- Post Title: Re: My quickBMS scripts

Warriors Orochi 3 (Xbox 360) - [g1l] & [idx/bin]

The BGMLink.g1l contains the music (6ch XMA2).

```
#
# (c) 2012-04-01 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
idstring "G1L_0000"
endian big
get FILESIZE long
get DATASTART long
get UNK long
get FILES long
for i = 1 <= FILES
	get OFFSET long
	if i != FILES
		savepos MYOFF
		get SIZE long
		goto MYOFF
	else
		get SIZE asize
	endif
	math SIZE -= OFFSET
	log MEMORY_FILE SIZE 0 # pre-alloc
	log MEMORY_FILE 0 0
	log MEMORY_FILE OFFSET SIZE
	callfunction getTYPE 1
	get NAME basename
	string NAME += "_"
	string NAME += i
	string NAME += EXT
	endian little
	log NAME 0 SIZE MEMORY_FILE
	endian big
next i
```


The bin files contain all other game files including the sounds as XMA (large packs at the end of the archive).

```
#
# (c) 2012-04-02 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
open FDDE IDX 0
open FDDE BIN 1
endian big
set FN 1
get ENTRIES asize 0
math ENTRIES /= 0x20
for i = 1 <= ENTRIES
	get ZERO long 0
	get OFFSET long 0
	get ZERO long 0
	get UNK long 0
	get ZERO long 0
	get SIZE long 0
	get ZERO long 0
	get UNK long 0
	if SIZE > 1
		log MEMORY_FILE SIZE 0 # pre-alloc
		log MEMORY_FILE 0 0
		log MEMORY_FILE OFFSET SIZE 1
		endian little
		callfunction getTYPE 1
		endian big
		get NAME basename 0
		string NAME += "_"
		string NAME += FN
		math FN += 1
		string NAME += EXT
		log NAME 0 SIZE MEMORY_FILE
	endif
next i
```
## Post #220
- Username: mono24
- Rank: Moderator
- Number of posts: 2602
- Joined date: Sun May 18, 2008 10:01 pm
- Post datetime: 2012-04-01T22:36:44+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Warriors Orochi 3 (Xbox 360) - [g1l] & [idx/bin]

The BGMLink.g1l contains the music (6ch XMA2).
Code: Select all# extracts the BGMLink.g1l from Warriors Orochi 3 (Xbox 360)
#
# (c) 2012-04-01 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
idstring "G1L_0000"
endian big
get FILESIZE long
get DATASTART long
get UNK long
get FILES long
for i = 1 <= FILES
	get OFFSET long
	if i != FILES
		savepos MYOFF
		get SIZE long
		goto MYOFF
	else
		get SIZE asize
	endif
	math SIZE -= OFFSET
	log MEMORY_FILE 0 0
	log MEMORY_FILE OFFSET SIZE
	callfunction getTYPE 1
	get NAME basename
	string NAME += "_"
	string NAME += i
	string NAME += EXT
	endian little
	log NAME 0 SIZE MEMORY_FILE
	endian big
next i

The bin files contain all other game files including the sounds as XMA (large packs at the end of the archive).
Code: Select all# Extracts the contents of the bin/idx pairs from Warriors Orochi 3 (Xbox 360)
#
# (c) 2012-04-02 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
open FDDE IDX 0
open FDDE BIN 1
endian big
set FN 1
get ENTRIES asize 0
math ENTRIES /= 0x20
for i = 1 <= ENTRIES
	get ZERO long 0
	get OFFSET long 0
	get ZERO long 0
	get UNK long 0
	get ZERO long 0
	get SIZE long 0
	get ZERO long 0
	get UNK long 0
	if SIZE > 1
		log MEMORY_FILE 0 0
		log MEMORY_FILE SIZE 0 # pre-alloc
		log MEMORY_FILE OFFSET SIZE 1
		endian little
		callfunction getTYPE 1
		endian big
		get NAME basename 0
		string NAME += "_"
		string NAME += FN
		math FN += 1
		string NAME += EXT
		log NAME 0 SIZE MEMORY_FILE
	endif
next i

if you decompress the xex file you should be able to spot the file table without much trouble.
## Post #221
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-03T16:04:11+00:00
- Post Title: Re: My quickBMS scripts

I've decompressed some xex files and I didn't find a list of files inside archives. Can you explain further please?
## Post #222
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-03T19:09:24+00:00
- Post Title: Re: My quickBMS scripts

convert XMA cue markers to WAVE cue marers
Wrote this one when I encountered XMA2 files with markers (Kinect Star Wars). The script takes the xma cue file, reads available information into an array and constructs a new cue file from scratch, including the ltxt section per marker. Conversion from big to little endian is also implemented.
Find the func_writename.bms in the post below.

```
# 
# (c) 2012-04-03 by AlphaTwentyThree of XeNTaX

include "func_writename.bms"
endian big
idstring "cue "
get CUESIZE long
if CUESIZE >= 0x100000 # work-around
	endian little
endif
get MARKERS long
for i = 1 <= MARKERS
	get MID long # marker ID
	get MSAMP1 long # always same as MSAMP2 (?)
	idstring "data"
	get ZERO long
	get ZERO long
	get MSAMP2 long
	putArray 0 MID MSAMP1 long
	putArray 1 MID MSAMP2 long
	putArray 2 MID "" string # reset
next i
idstring "LIST"
get LISTSIZE long
if LISTSIZE == 0 # lables are optional
	callfunction wavcue 1
	cleanexit
endif
idstring "adtl" # table, empty in XMA markers
get CSIZE asize
math CSIZE -= 1 # last byte is 0
do
	get IDENT long
	if IDENT == 0x6c6162
		savepos MYOFF
		math MYOFF += 1
		goto MYOFF
	endif
	get LSIZE long
	get MID long
	set MNAMEL LSIZE
	math MNAMEL -= 4
	getDstring MNAME MNAMEL
	putArray 2 MID MNAME string
	savepos TEST
while TEST < CSIZE
callfunction wavcue 1

startfunction wavcue
	endian little
	putVarChr MEMORY_FILE 0 0x20657563 long # "cue "
	set CUESIZE MARKERS
	math CUESIZE *= 0x18
	math CUESIZE += 4
	putVarChr MEMORY_FILE 4 CUESIZE long
	putVarChr MEMORY_FILE 8 MARKERS long
	set WPOS CUESIZE
	math WPOS += 8
	putVarChr MEMORY_FILE WPOS 0x5453494c long # "LIST"
	math WPOS += 4
	set LISTSZ WPOS # position of LIST size
	math WPOS += 4
	putVarChr MEMORY_FILE WPOS 0x6c746461 long # "adtl"
	math WPOS += 4
	set LTXTPOS WPOS
	set WPOS 0xc
	for i = 1 <= MARKERS # "cue " section
		putVarChr MEMORY_FILE WPOS i long # MID
		math WPOS += 4
		getArray MSAMP1 0 i
		putVarChr MEMORY_FILE WPOS MSAMP1 long
		math WPOS += 4
		putVarChr MEMORY_FILE WPOS 0x61746164 long # "data"
		math WPOS += 0xc
		getArray MSAMP2 1 i
		putVarChr MEMORY_FILE WPOS MSAMP2 long
		math WPOS += 4
		set NXT i
		math NXT -= 1
		math NXT *= 0x1c
		math NXT += LTXTPOS
		putVarChr MEMORY_FILE NXT 0x7478746c long # "ltxt"
		math NXT += 4
		putVarChr MEMORY_FILE NXT 0x14 long
		math NXT += 4
		putVarChr MEMORY_FILE NXT i long
		math NXT += 8
		putVarChr MEMORY_FILE NXT 0x206e6772 long # "rgn "
	next i
	set WPOS NXT
	math WPOS += 0xc
	for i = 1 <= MARKERS
		getArray LABEL 2 i
		if LABEL != ""
			putVarChr MEMORY_FILE WPOS 0x6c62616c long # "labl"
			math WPOS += 4
			strlen LABSIZE LABEL
			math LABSIZE += 5
			putVarChr MEMORY_FILE WPOS LABSIZE long
			math WPOS += 4
			putVarChr MEMORY_FILE WPOS i long # MID
			math WPOS += 4
			set STRPOS WPOS
			set NAME LABEL
			callfunction writename 1
			get WPOS asize MEMORY_FILE
			putVarChr MEMORY_FILE WPOS 0 byte
			math WPOS += 1
		endif
	next i
	get SIZE asize MEMORY_FILE
	set PUTLSIZE SIZE
	math PUTLSIZE -= LISTSZ
	math PUTLSIZE -= 4
	putVarChr MEMORY_FILE LISTSZ PUTLSIZE long
	get NAME basename
	string NAME += ".wcue"
	log NAME 0 SIZE MEMORY_FILE
endfunction
```
## Post #223
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-03T19:10:22+00:00
- Post Title: Re: My quickBMS scripts

func_writename.bms
Write a string to memory. Isn't implemented in QuickBMS but needed sometimes.

```
#
# (c) 2012-04-03 by AlphaTwentyThree of XeNTaX

startfunction writename
	strlen NAMESZ NAME
	for z = 0 < NAMESZ
		set TMP STRPOS
		math TMP += z
		getvarchr CHR NAME z
		putvarchr MEMORY_FILE TMP CHR byte
	next z
endfunction

```
## Post #224
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-04T18:15:56+00:00
- Post Title: Re: My quickBMS scripts

*.fpk "FKP" extractor
Found one game so far that uses this format but I guess there are others.

```
#
# supported games:
# - Flock!
#
# (c) 2012-04-04 by AlphaTwentyThree of XeNTaX

idstring "FKP"
get IDENT byte
goto 8
get FILES long
get UNK long
for i = 1 <= FILES
	savepos MYOFF
	getCT NAME string 0xcc
	math MYOFF += 0x30
	goto MYOFF
	get UNK long
	get UNK long
	get SIZE long
	get OFFSET long
	log NAME OFFSET SIZE
next i
```
## Post #225
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-04T19:43:58+00:00
- Post Title: Re: My quickBMS scripts

Important update on the func_getTYPE.bms! Update your files!
## Post #226
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-04T19:46:03+00:00
- Post Title: Re: My quickBMS scripts

XBLA flog_x360.fpg extractor
Two games found so far. The sg2 files inside the archives hold their file name each which is pretty neat. 
Update your func_getTYPE.bms for that option!

```
#
# supported games:
# - Super Puzzle Fighter II Turbo - HD Remix (XBLA)
# - Super Street Fighter II Turbo - HD Remix (XBLA)
#
# (c) 2012-04-04 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
idstring "30GF"
get FILES long
goto 0x800
for i = 1 <= FILES
	get NAME_CRC long
	string NAME_CRC p= "%08x" NAME_CRC
	get OFFSET long
	get SIZE long
	get ZSIZE long
	if SIZE == ZSIZE
		putVarChr MEMORY_FILE SIZE 0
		log MEMORY_FILE 0 0
		log MEMORY_FILE OFFSET SIZE
	else
		putVarChr MEMORY_FILE ZSIZE 0
		log MEMORY_FILE 0 0
		clog MEMORY_FILE OFFSET SIZE ZSIZE
		set SIZE ZSIZE
	endif
	callfunction getTYPE 1
	if ZNAME != ""
		set NAME ZNAME
	else
		get NAME basename
		string NAME += "_0x"
		string NAME += NAME_CRC
	endif
	string NAME += EXT
	log NAME 0 SIZE MEMORY_FILE
next i
```
## Post #227
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-08T04:46:44+00:00
- Post Title: Re: My quickBMS scripts

PFP extractor

```
# supported games:
# - Strimko (PC)
# - Witch Hunters: Stolen Beauty (PC, BigFish Games)
# - Strange Cases: The Secret of Grey Mist Lake (PC, 2012, BigFish Games)
#
# (c) 2012-04-08 by AlphaTwentyThree of XeNTaX

idstring "PFPK"
get FILES long
for i = 1 <= FILES
	get NAMEL byte
	getDstring NAME NAMEL
	get OFFSET long
	get SIZE long
	log NAME OFFSET SIZE
next i
```
## Post #228
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-08T04:52:17+00:00
- Post Title: Re: My quickBMS scripts

Resident Evil: Operation Raccoon City (Xbox 360) - streamed.pck
I know that other games use this format, too but I need to find out how to automatically retrieve those variables behind the goto commands first. 
For now, you can use this just for one game. I'll update this post when I update the script.
func_getTYPE.bms: [viewtopic.php?f=13&p=69577#p69577](http://forum.xentax.com/viewtopic.php?f=13&p=69577#p69577)

```
#
# (c) 2012-04-07 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
idstring "AKPK"
endian big
set FOLDEROFF 0x58
goto 0x18
for i = 0 <= 7
	get DUMMY long
	get INDEX long
	savepos MYOFF
	goto FOLDEROFF
	for k = 0 < INDEX
		get FOLDERNAME string
	next k
	putArray 0 INDEX FOLDERNAME
	goto MYOFF
next i

goto 0xa4
get FILES long
for i = 1 <= FILES
	get NAME_CRC long
	string NAME_CRC p= "%08x" NAME_CRC
	get MULTIPLIER long
	get SIZE long
	get OFFSET long
	math OFFSET *= MULTIPLIER
	get TYPE long # folder number
	get FNAME basename
	string FNAME += "_0x"
	string FNAME += NAME_CRC
	getArray WNAME 0 TYPE
	string WNAME += "/"
	string WNAME += FNAME
	log MEMORY_FILE OFFSET SIZE
	callfunction getTYPE 1
	endian big
	string WNAME += EXT
	log WNAME 0 SIZE MEMORY_FILE
next i
```
## Post #229
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-10T18:38:34+00:00
- Post Title: Re: My quickBMS scripts

Just updated my SS2 header adder to a more sophisticated script with the use of the include function. The old onw still works but this additionally has a memory preallocation and thus is multiple times faster. Practical when you batch big files.
## Post #230
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-10T18:57:02+00:00
- Post Title: Re: My quickBMS scripts

rws_to_ss2.bms
Some PS2 games use the rws header. Those files can be played with vgmstream but the plugin doesn't take the name from the RWS header. My script does. 
This is a good example how easy header manipulations get with my adjusted func_header_SS2.bms! 

```
# (c) 2012-04-10 by AlphaTwentyThree of XeNTaX

include "func_header_SS2.bms"
idstring \xd\x8\x0\x0
goto 0x48
get OFFSET long
goto 0x68
get NAME string
string NAME += ".ss2"
goto 0x90
get SIZE long
goto 0xD4
get INTERLEAVE short
goto 0xE4
get FREQ short
goto 0xF1
get CH byte
callfunction SS2 1
```
## Post #231
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-10T21:10:50+00:00
- Post Title: Re: My quickBMS scripts

Extractor for Broken Sword: Shadow of the Templars
Another good example for the use of external scripts.

```
# Broken Sword: Shadow of the Templars (PSX)
# (c) 2012-04-10 by AlphaTwentyThree of XeNTaX

include "func_header_SS2.bms"
open FDDE DAT 0
open FDDE TAB 1
get FILES asize 1
math FILES /= 0x8
for i = 1 <= FILES
	get OFFSET long 1
	math OFFSET *= 0x800
	get SIZE long 1
	if SIZE == 0xffffffff
	elif SIZE == 0
	else
		set FREQ 11025
		set CH 1
		set INTERLEAVE 0x10
		get NAME basename 1
		string NAME += "_"
		string NAME += i
		string NAME += ".ss2"
		callfunction SS2 1
	endif
next i
```
## Post #232
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-14T00:00:15+00:00
- Post Title: Re: My quickBMS scripts

CPK/SEG "FILM" audio extractor

While working on several older console games, I encountered this format first in Saturn, then in Sega CD games. The audio has no info, but there's some infor area after the block info, which is saved. Sometimes the audio is just Motorola (big endian) raw PCM, normally mono but I also encountered an audio format which I have never seen.
Used a workaround to pre-allocate the memory file, so it's pretty fast for bigger files, too.

```
# e.g. found in:
# - 3 Ninjas Kick Back (SCD)
# - Shellshock (SS)
# - Tomb Raider (SS)
# - X-Men: Children of the Atom (SS)
# (c) 2012-08-09 by AlphaTwentyThree of XeNTaX

endian big
idstring "FILM"
get BIAS long
getDstring VER 4
get ZERO long
idstring "FDSC"
get STAB_OFF long
math STAB_OFF += 0x10
goto STAB_OFF

idstring "STAB"
get STAB_SIZE long
get UNK long
get ENTRIES long
savepos MYOFF
set OFF_HEADER ENTRIES
math OFF_HEADER *= 0x10
math OFF_HEADER += MYOFF
set SIZE_HEADER BIAS
math SIZE_HEADER -= OFF_HEADER

set PSIZE 0
for p = 0 < 2
	for i = 1 <= ENTRIES
		get OFFSET long
		math OFFSET += BIAS
		get SIZE long
		get UNK long
		get TYPE long
		if TYPE == 1 # audio
			if p == 0
				math PSIZE += SIZE
			else
				append
				log MEMORY_FILE OFFSET SIZE
				append
			endif
		endif
	next i
	if p == 0
		putVarChr MEMORY_FILE PSIZE 0
		log MEMORY_FILE 0 0
	endif
	goto MYOFF
next p
get SIZE asize MEMORY_FILE
get NAME basename
string NAME += ".raw"
log NAME 0 SIZE MEMORY_FILE
get NAME basename
string NAME += ".info"
log NAME OFF_HEADER SIZE_HEADER
```
## Post #233
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-16T03:56:13+00:00
- Post Title: Re: My quickBMS scripts

func_header_PCM.bms
Like the name tell you: just a header adder for standard wave pcm. Somehow I forgot to post it here.  
BTW: standard wave files have CODEC 1, BITS 16, but the BLOCKALIGN may vary between 1 and 4.

```
# input variables: SIZE, OFFSET, FREQ, CH, BITS, BLOCKALIGN, CODEC, NAME (or set to "")
# (c) 2012-10-16 by AlphaTwentyThree of XeNTaX

startfunction PCM
	endian little
	set PRE SIZE
	math PRE += 0x2c
	putVarChr MEMORY_FILE PRE 0
	log MEMORY_FILE 0 0
	set MEMORY_FILE binary "\x52\x49\x46\x46\x20\xC0\xB1\x00\x57\x41\x56\x45\x66\x6D\x74\x20\x10\x00\x00\x00\x01\x00\x02\x00\x44\xAC\x00\x00\x10\xB1\x02\x00\x04\x00\x10\x00\x64\x61\x74\x61\xFC\xBF\xB1\x00"
	append
	log MEMORY_FILE OFFSET SIZE
	append
	set RIFFSIZE SIZE
	math RIFFSIZE += 36
	set AVGBYTES FREQ
	if CODEC != 2
		math AVGBYTES *= BLOCKALIGN
	endif
	
	putvarchr MEMORY_FILE 0x04 RIFFSIZE long
	putvarchr MEMORY_FILE 0x14 CODEC short          # wFormatTag: Microsoft PCM Format (0x0001)
	putvarchr MEMORY_FILE 0x16 CH short   # wChannels
	putvarchr MEMORY_FILE 0x18 FREQ short   # dwSamplesPerSec
	putvarchr MEMORY_FILE 0x1c AVGBYTES long    # dwAvgBytesPerSec
	putvarchr MEMORY_FILE 0x20 BLOCKALIGN short # wBlockAlign
	putvarchr MEMORY_FILE 0x22 BITS short       # wBitsPerSample
	putvarchr MEMORY_FILE 0x28 SIZE long
	if NAME == ""
		get NAME basename
		if CODEC == 2
			string NAME += ".lwav"
		else
			string NAME += ".wav"
		endif
	endif
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction
```


Example script to add a header to a file:

```
set OFFSET 0
get SIZE asize
math SIZE -= OFFSET
set CODEC 1
set FREQ 44100
set CH 2
set BITS 16
set BLOCKALIGN 4
set NAME ""
callfunction PCM 1
```
## Post #234
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-16T04:23:24+00:00
- Post Title: Re: My quickBMS scripts

Scarygirl *.str to *.wav
What a lazy format... 

```
# (c) 2012-04-16 by AlphaTwentyThree of XeNTaX

include "func_header_PCM.bms"
get CODEC short
get CH short
get FREQ long
get AVGBYTES long
get BLOCKALIGN short
get BITS short
get UNK long
get UNK long
savepos OFFSET
get SIZE asize
math SIZE -= OFFSET
set NAME ""
callfunction PCM 1
```
## Post #235
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-17T22:52:17+00:00
- Post Title: Re: My quickBMS scripts

25 to Life *.hog extractor
Works for the Xbox version. Will update as soon as I get my hands on the other platforms.

```
# 25 to Life (Xbox)
# (c) 2012-04-18 by AlphaTwentyThree of XeNTaX

get IDENT long
if IDENT != 0x20001
	cleanexit
endif
get INFO long
goto 0x10
get FILES long
goto INFO
for i = 1 <= FILES
	get NAMEPOS long
	get OFFSET long
	get SIZE long
	get DUMMY long
	savepos MYOFF
	goto NAMEPOS
	get NAME string
	goto MYOFF
	log NAME OFFSET SIZE
next i
```
## Post #236
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2012-04-19T16:26:22+00:00
- Post Title: Re: My quickBMS scripts

Hello alpha can you look at the attached file from prototype 2 archive? Your script probably needs editing to handle prototype 2. 
[sample.rar](https://xentaxbackup.github.io/file/5331_sample.rar)
## Post #237
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-20T16:10:24+00:00
- Post Title: Re: My quickBMS scripts

Scarface engine *.rcf extractor for Xbox 360

Nothing to say here, just a normal extractor. Haven't tested on older games but should work as well. 

*EDIT* something's badly wrong with the names - need to check the script again...
## Post #238
- Username: Tosyk
- Rank: double-veteran
- Number of posts: 1027
- Joined date: Thu Oct 22, 2009 5:24 pm
- Post datetime: 2012-04-21T10:07:51+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> POD5  extractor
I guess there are other games with this format.
Code: Select all# extracts POD5 archives
#
# supported games:
# Kinect Star Wars (Xbox 360)
# Country Dance All-Stars (Xbox 360)
...it's not working for me, just nothing happen, i'm trying to unpack star wars kinect pod files

edit: my bad, works fine
## Post #239
- Username: WrappedInBlack
- Rank: ultra-n00b
- Number of posts: 9
- Joined date: Fri Apr 27, 2012 5:51 am
- Post datetime: 2012-04-29T15:44:29+00:00
- Post Title: Re: My quickBMS scripts

So does anyone have a p3d converter?
## Post #240
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-04-30T23:31:09+00:00
- Post Title: Re: My quickBMS scripts

Sniper Elite V2 - StreamingSounds.asrBE extractor
Strange file table, but works with a dumb work-around.

```
# (c) 2012-05-01 by AlphaTwentyThree of XeNTaX

idstring "Asura   STSA"
endian big
get FSIZE long
get UNK long
get ZERO long
get FILES long
get DUMMY byte
goto 0x1d
for i = 1 <= FILES
	get NAME string
	if i != FILES
		FindLoc NXT string "sounds" 0 ""
	else
		FindLoc NXT string "RIFF" 0 ""
	endif
	math NXT -= 8
	goto NXT
	get SIZE long
	get OFFSET long
	log NAME OFFSET SIZE
next i
```
## Post #241
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-03T13:17:23+00:00
- Post Title: Re: My quickBMS scripts

*.mic to *.ss2 converter
Encountered in Sniper Elite for PS2.

```
# known games with this format:
# - Sniper Elite (PS2)
# - Worms Forts: Under Siege (PS2)
# (c) 2012-05-03 by AlphaTwentyThree of XeNTaX

include "func_header_SS2.bms"
get OFFSET long
get UNK long
get CH long
get FREQ long
get INTERLEAVE long
get SIZE asize
math SIZE -= OFFSET
set NAME ""
callfunction SS2 1
```
## Post #242
- Username: mono24
- Rank: Moderator
- Number of posts: 955
- Joined date: Mon Mar 28, 2011 3:42 am
- Post datetime: 2012-05-03T20:18:39+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Sniper Elite V2 - StreamingSounds.asrBE extractor
Strange file table, but works with a dumb work-around.
Code: Select all# extracts the StreamingSounds.asrBE from Sniper Elite V2 (Xbox 360)
# (c) 2012-05-01 by AlphaTwentyThree of XeNTaX

idstring "Asura   STSA"
endian big
get FSIZE long
get UNK long
get ZERO long
get FILES long
get DUMMY byte
goto 0x1d
for i = 1 <= FILES
	get NAME string
	if i != FILES
		FindLoc NXT string "sounds" 0 ""
	else
		FindLoc NXT string "RIFF" 0 ""
	endif
	math NXT -= 8
	goto NXT
	get SIZE long
	get OFFSET long
	log NAME OFFSET SIZE
next i

Does it also work for X360 AV2010 text containning files pls ?
## Post #243
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-04T12:08:00+00:00
- Post Title: Re: My quickBMS scripts

Nope. I'd have written otherwise.
## Post #244
- Username: ebbelein
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Sun May 06, 2012 4:08 am
- Post datetime: 2012-05-05T20:43:01+00:00
- Post Title: Re: My quickBMS scripts

Alpha,
could you by any chance do a script for extracting towav-compatible xma from aux files (found in Kinect Disneyland Adventures)... I got the orchestral score from a former vgm rip, but Id also like to extract the voice elements and park bgm from my disc...

Thanks a lot
ebbelein
## Post #245
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-07T12:58:47+00:00
- Post Title: Re: My quickBMS scripts

> Reply from ebbelein
>
> Alpha,
could you by any chance do a script for extracting towav-compatible xma from aux files (found in Kinect Disneyland Adventures)... I got the orchestral score from a former vgm rip, but Id also like to extract the voice elements and park bgm from my disc...

Thanks a lot
ebbelein
That's no extraction, that's a complete manipulation. I don't remember the header of those aux files but I guess they have RIFF headers, so procedure is the same as always:
- strip the header with RIFF_to_uxma
- parse with xma_parse (if it doesn't work, try 0x10000 blocksize)
- add header with my script
Resulting files are decodable with toWAV.
## Post #246
- Username: ebbelein
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Sun May 06, 2012 4:08 am
- Post datetime: 2012-05-09T20:05:28+00:00
- Post Title: Re: My quickBMS scripts

thanks, alpha - i tried your method and it worked well, but only for a few files...

All of the aux files have a rifx wave fmt header or are bkhd files containing rifx wave fmt... Some of the files could be decoded with your method, some files got compatible for towav by just replacing the rifx header with a riff header in hex editor...
but on some of the files (like the one in the attached screenshot) i had no sucess with either method... Theres only digital noise after decoding it with towav... Perharps you could take a look on the file screenshots attached and give me a hint, what makes the left file so "special"...

thanks a lot...
[None](https://xentaxbackup.github.io/file/5424_None)
## Post #247
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-17T02:15:05+00:00
- Post Title: Re: My quickBMS scripts

Electronic Arts TGQ video demultiplexer
Tested with Need for Speed and WarCraft II: Dark Sage for Saturn.
I know there are other games that use the format so the script may be extended in the future.

```
# if audio is PCM, a valid header will automatically be added
# (c) 2012-05-17 by AlphaTwentyThree of XeNTaX

endian big
idstring "1SNh"
get SIZE_HEADER long
getDstring CODEC 4
if CODEC != "EACS"
	print "non-recognizable codec"
	cleanexit
endif
	# audio specs
	get FREQ long
	reverseLong FREQ
	get CH byte
	get BLOCKALIGN byte
	get CODEC byte
	if CODEC == 1 # some ADPCM
		reverselong FREQ
	endif
	set BITS 0x10
	
log MEMORY_FILE 0 0 # reserved for audio header
log MEMORY_FILE2 0 0 # 1SNd - audio
log MEMORY_FILE3 0 0 # pQGT (little endian)/TGVk (big endian) - video
set SIZE_VIDEO 0
set SIZE_AUDIO 0
get FSIZE asize


for i = 0 < 2
	set OFFSET SIZE_HEADER
	append
	do
		goto OFFSET
		getDstring TYPE 3
		get DUMMY byte
		get SIZE long
		if TYPE == "pQG"
			reverselong SIZE
		endif
		math OFFSET += 8
		math SIZE -= 8
		if TYPE == "TGV"
			if i == 0
				math SIZE_VIDEO += SIZE
			else
				log MEMORY_FILE3 OFFSET SIZE
			endif
		elif TYPE == "pQG"
			if i == 0
				math SIZE_VIDEO += SIZE
			else 
				log MEMORY_FILE3 OFFSET SIZE
			endif
		elif TYPE == "1SN"
			if i == 0
				math SIZE_AUDIO += SIZE
			else
				log MEMORY_FILE2 OFFSET SIZE
			endif
		else
			print "ERROR: block not recognizable - check file for consistency."
			cleanexit
		endif
		math OFFSET += SIZE
		math j += 1
	while OFFSET != FSIZE
	append
	if i == 0 # prealloc memory
		putVarChr MEMORY_FILE2 SIZE_AUDIO 0
		putVarChr MEMORY_FILE3 SIZE_VIDEO 0
		log MEMORY_FILE2 0 0
		log MEMORY_FILE3 0 0
		set SSIZE SIZE_AUDIO
		math SSIZE += SIZE_VIDEO
	else
		get NAME basename
		set SIZE SIZE_AUDIO
		set OFFSET 0
		if CODEC == 0
			string NAME += ".wav"
			callfunction PCM 1
		elif CODEC == 1
			string NAME += "_"
			string NAME += FREQ
			string NAME += "Hz_"
			string NAME += CH
			string NAME += "ch.aud"
			log NAME 0 SIZE MEMORY_FILE2
		endif
	
		get VNAME basename
		string VNAME += ".vid"
		log VNAME 0 SIZE_VIDEO MEMORY_FILE3
	endif
next i

startfunction PCM
	endian little
	set PRE SIZE
	math PRE += 0x2c
	putVarChr MEMORY_FILE PRE 0
	log MEMORY_FILE 0 0
	set MEMORY_FILE binary "\x52\x49\x46\x46\x20\xC0\xB1\x00\x57\x41\x56\x45\x66\x6D\x74\x20\x10\x00\x00\x00\x01\x00\x02\x00\x44\xAC\x00\x00\x10\xB1\x02\x00\x04\x00\x10\x00\x64\x61\x74\x61\xFC\xBF\xB1\x00"
	append
	log MEMORY_FILE OFFSET SIZE MEMORY_FILE2
	append
	set RIFFSIZE SIZE
	math RIFFSIZE += 36
	set AVGBYTES FREQ
	math AVGBYTES *= BLOCKALIGN
	
	putvarchr MEMORY_FILE 0x04 RIFFSIZE long
	putvarchr MEMORY_FILE 0x14 1 short          # wFormatTag: Microsoft PCM Format (0x0001)
	putvarchr MEMORY_FILE 0x16 CH short   # wChannels
	putvarchr MEMORY_FILE 0x18 FREQ short   # dwSamplesPerSec
	putvarchr MEMORY_FILE 0x1c AVGBYTES long    # dwAvgBytesPerSec
	putvarchr MEMORY_FILE 0x20 BLOCKALIGN short # wBlockAlign
	putvarchr MEMORY_FILE 0x22 BITS short       # wBitsPerSample
	putvarchr MEMORY_FILE 0x28 SIZE long
	if NAME == ""
		get NAME basename
		string NAME += ".wav"
	endif
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction
```
## Post #248
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-17T02:31:43+00:00
- Post Title: Re: My quickBMS scripts

BIGF extractor for WarCraft II: The Dark Saga (PSX/Saturn)

Extracts the *.war and *.cud archives from the game. Automatically adds a *.bank extension to the soundbanks for postprocessing. Had to use a little workaround for truncated archives.

```
# WarCraft II: The Dark Saga (Playstation & Saturn)
# (c) 2012-05-17 by AlphaTwentyThree of XeNTaX

idstring "BIGF"
# endian big # un-comment for Saturn version
get UNK long
get FILES long
get FSIZE asize
set i 1
for
	get OFFSET long
	if OFFSET == 0xadf0adf0
		cleanexit
	elif OFFSET == 0xf0adf0ad
		cleanexit
	endif
	get SIZE long
	set TEST SIZE
	math TEST += OFFSET
	if TEST > FSIZE # corrupt file end
		print "Warning: Last file may be truncated"
		get SIZE asize
		math SIZE -= OFFSET
	endif
	if SIZE != 0xffffffff
		get NAME basename
		string NAME += "_"
		string NAME += i
		savepos MYOFF
		goto OFFSET
		getDstring TYPE 4
		if TYPE == "BANK"
			string NAME += ".bank"
		endif
		goto MYOFF
		log NAME OFFSET SIZE
		math i += 1
	endif
next
```
## Post #249
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-17T02:52:23+00:00
- Post Title: Re: My quickBMS scripts

BANK extractor for WarCraft II: The Dark Saga (Playstation)

Just to have the sound extraction complete. 

```
# WarCraft II: The Dark Sagea (Playstation)
# (c) 2012-05-17 by AlphaTwentyThree of XeNTaX

idstring "BANK"
get FILES long
set BIAS FILES
math BIAS *= 0x10
math BIAS += 8
for i = 1 <= FILES
	getDstring NAME 8
	get OFFSET long
	math OFFSET += BIAS
	get SIZE long
	log NAME OFFSET SIZE
next i
```
## Post #250
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-17T15:21:00+00:00
- Post Title: Re: My quickBMS scripts

Agon *.sfl extractor
Extracts the main archives from Agon. Subfolder creation for better batch processing. 

```
# (c) 2012-05-17 by AlphaTwentyThree of XeNTaX

idstring "SFL10"
get UNK long
get INFO long
get NAMEOFF long
get UNK long
get FILES threebyte
goto INFO
for i = 1 <= FILES
	get NAMEPOS long
	math NAMEPOS += NAMEOFF
	get DUMMY byte
	get FILE_NUMBER long
	get OFFSET long
	get SIZE long
	savepos MYOFF
	goto NAMEPOS
	get NAME string
	goto MYOFF
	get FNAME basename
	string FNAME += "/"
	string FNAME += NAME
	log FNAME OFFSET SIZE # use NAME to disable subfolder
next i
```
## Post #251
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-18T18:45:29+00:00
- Post Title: Re: My quickBMS scripts

Headhunter: Redemption (PS2) - *.DAT extractor
Unfortunately the file names are only saved as CRC so you have to post-process all files. 
Main videos and some music is in FSKOLME.DAT, sounds, music and cutscenes are in FSPIENI.DAT. VAG interleave i 0x1000 if you're wondering. 

If anyone can provide me with a sample of the Xbox version, I'd be happy to check if it works for this console, too.  PM me.

```
# (c) 2012-05-18 by AlphaTwentyThree of XeNTaX

get INFO asize
math INFO -= 0x800
goto INFO
get UNK long
get INFOSIZE long
get FILES long
math INFOSIZE /= 0x800
math INFOSIZE += 1
math INFOSIZE *= 0x800
math INFO -= INFOSIZE
goto INFO
for i = 1 <= FILES
	get NAME_CRC long
	string NAME_CRC p= "0x%08x" NAME_CRC
	get OFFSET long
	get SIZE long
	math OFFSET *= 0x800
	math OFFSET += 0x200000
	get NAME basename
	string NAME += "_"
	string NAME += NAME_CRC
	log NAME OFFSET SIZE
next i
```
## Post #252
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-23T22:58:30+00:00
- Post Title: Re: My quickBMS scripts

Astro Boy: The Video Game (2009) PS2

```
# (c) 2012-05-24 by AlphaTwentyThree of XeNTaX

open FDDE DIR 0
open FDDE WAD 1
get FILES long 0
for i = 1 <= FILES
	getDstring NAME 0x40 0
	get SIZE long 0
	get OFFSET long 0
	math OFFSET *= 0x800
	log NAME OFFSET SIZE 1
next i
```
## Post #253
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2012-05-24T00:50:19+00:00
- Post Title: Re: My quickBMS scripts

Hi alpha!

I am currently stuck trying to parse this particular XMA file from max Payne 3. Will Pm you the file 

As far as this structure goes, It appears to be a mono stream with dual channels blocked or interleave in a certain way. These blocked Intelreaved mono channels are also packed into packets separated by zeroes in the file. Some packets within a file have 2 channels in a packet but some have 12 channels. The first packet of every audio file has the mono XMA flag FC038000 which you can then identify and extract the channels easy of h first packet but the other packets don't have this flag and therefore have to find the interleaving. I tried to assume that the interleaving found in the first packet is the interleaving for all but such as not the case because when playing back the files it gives errors and the channels do not align right. So something is choking there. Hell im not even sure the FC038000 flag even states the correct interleaving in the first packet.
## Post #254
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-25T05:52:50+00:00
- Post Title: Re: My quickBMS scripts

POD3 extractor

```
# BloodRayne (PS2)
# (c) 2012-05-25 by AlphaTwentyThree of XeNTaX

idstring "POD3"
goto 0x58
get FILES long
goto 0x108
get INFO long
goto INFO
set NAMEBIAS FILES
math NAMEBIAS *= 0x14
math NAMEBIAS += INFO
for i = 1 <= FILES
	get NAMEPOS long
	math NAMEPOS += NAMEBIAS
	get SIZE long
	get OFFSET long
	get UNK long
	get UNK long
	savepos MYOFF
	goto NAMEPOS
	get NAME string
	goto MYOFF
	log NAME OFFSET SIZE
next i
```
## Post #255
- Username: Teancum
- Rank: veteran
- Number of posts: 99
- Joined date: Wed Nov 28, 2007 3:30 am
- Post datetime: 2012-05-25T18:13:47+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Headhunter: Redemption (PS2) - *.DAT extractor
Unfortunately the file names are only saved as CRC so you have to post-process all files. 
Main videos and some music is in FSKOLME.DAT, sounds, music and cutscenes are in FSPIENI.DAT. VAG interleave i 0x1000 if you're wondering. 

If anyone can provide me with a sample of the Xbox version, I'd be happy to check if it works for this console, too.  PM me.

I've got it on the Xbox. I'll check it out sometime soon.
## Post #256
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-28T23:04:23+00:00
- Post Title: Re: My quickBMS scripts

sdu extractor for "The Suffering" (Xbox)
Uses my new version of the Xbox ADPCM header adder, so be sure to update that!
XMV movies can be converted with VGM Toolbox (at least in most cases).
Remember to decode the *.lwav files with toWAV because the vgmstream playback is errornous!

```
# (c) 2012-05-29 by AlphaTwentyThree of XeNTaX

include "func_header_XADP.bms" # be sure to have this file in the same directory!
idstring "SRSC"
get UNK byte
get UNK byte
get INFO long
get ENTRIES long # head/file/tail entries
goto INFO
get EXT extension
if EXT == "sdu"
	callfunction sdu 1
elif EXT == "vdu"
	callfunction vdu
endif


startfunction sdu
	for i = 1 <= ENTRIES
		get SIG byte # head/data/tail
		get UNK2 byte #always 3?
		get FILE_ID short
		get UNK4 short # some identifier
		get OFFSET long
		get SIZE long
		if SIG == 2
			if FILE_ID != 0
				savepos MYOFF
				math OFFSET += 0x2c
				goto OFFSET
				get CH short
				get BITS short # always 4
				get FREQ long
				goto MYOFF
			endif
		elif SIG == 4
			get NAME basename
			string NAME += "_"
			string NAME += FILE_ID
			#string NAME += "_"
			#string NAME += UNK4
			string NAME += ".lwav"
			callfunction XADP 1
		elif SIG == 5 # some file tail - do nothing?
		endif
	next i
endfunction

startfunction vdu
	for i = 1 <= ENTRIES
		get SIG byte # head/data/tail
		get UNK2 byte #always 3?
		get FILE_ID short
		get UNK4 short # some identifier
		get OFFSET long
		get SIZE long
		if SIG != 66
			get NAME basename
			string NAME += "_"
			string NAME += FILE_ID
			string NAME += ".xmv"
			if FILE_ID != 0
				log NAME OFFSET SIZE
			endif
		endif
	next i
endfunction
```
## Post #257
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-29T13:11:22+00:00
- Post Title: Re: My quickBMS scripts

Midnight Mysteries 4: Haunted Houdini (PC) - Contents.dat extractor

```
# Midnight Mysteries 4: Haunted Houdini (PC)
# (c) 2012-05-29 by AlphaTwentyThree of XeNTaX

idstring \xce\xde\xed\xec
get UNK long
get INFO long
goto INFO
get FILES long
set NAMEBIAS FILES
math NAMEBIAS *= 0x10
math NAMEBIAS += INFO
math NAMEBIAS += 8

for i = 1 <= FILES
	get UNK long # always 0 or 1
	get OFFSET long
	get SIZE long
	get NAMEPOS long
	if SIZE != 0 # folder
		math NAMEPOS += NAMEBIAS
		savepos MYOFF
		goto NAMEPOS
		get NAME string
		goto MYOFF
		log NAME OFFSET SIZE
	endif
next i
```
## Post #258
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-29T14:32:05+00:00
- Post Title: Re: My quickBMS scripts

Fable (Xbox) - lug/met soundbank extractor

```
# (c) 2012-05-29 by AlphaTwentyThree of XeNTaX

open FDDE met 0
open FDDE lug 1

get DUMMY long 0
get FILES long 0
goto 0 0
for i = 1 <= FILES
	get DUMMY long 0
	get DUMMY long 0
	get FILE_ID long 0
	get NAMEL long 0
	getDstring NAME NAMEL 0
	get SIZE long 0
	get OFFSET long 0
	get CH short 0
	get CODEC short 0
	get FREQ long 0
	log NAME OFFSET SIZE 1
next i
```
## Post #259
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-29T16:05:22+00:00
- Post Title: Re: My quickBMS scripts

Max Payne Xbox sound extractor
Files without extension in the SPU.EMM are soundbanks containing the main sfx. Split at the 0x20 zero bytes and add an SS2 header.

```
# (c) 2012-05-29 by AlphaTwentyThree of XeNTaX

open FDDE EMM 0
open FDDE DIR 1
get BNAME basename

get FILES long 1
for i = 1 <= FILES
	get NAME_CRC long 1
	if BNAME == "SOUND"
		get FREQ long 1
	endif
	get OFFSET long 1
	get SIZE long 1
	savepos MYOFF 1
	callfunction NAME 1
	goto OFFSET 0
	get IDENT long 0
	if IDENT == 0x70474156
		string NAME += ".vag"
	elif IDENT == 0x64685353
		string NAME += ".ss2"
	endif
	log NAME OFFSET SIZE 0
	goto MYOFF 1
next i

startfunction NAME
	get NAME basename 1
	string NAME += "_"
	if i < 100
		string NAME += "0"
	endif
	if i < 10
		string NAME += "0"
	endif
	string NAME += i
	string NAME_CRC p= "_0x%08x" NAME_CRC
	string NAME += NAME_CRC
endfunction
```
## Post #260
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-29T23:35:46+00:00
- Post Title: Re: My quickBMS scripts

Gun (Xbox) sound/music extractor

As far as I remember, the PC version uses the same structure but uses another codec. As soon as I get my hands on that one, I'll update this script. 

```
# (c) 2012-05-30 by AlphaTwentyThree of XeNTaX

get BNAME basename
set NAME0 BNAME
set NAME1 BNAME
set NAME2 BNAME
string NAME0 += "0.wad"
string NAME1 += "1.wad"
string NAME2 += "2.wad"

open FDSE NAME0 1
open FDSE NAME1 2
if BNAME == "stream_pcm"
	open FDSE NAME2 3
endif
log MEMORY_FILE 0 0

idstring "PDAW" 0
get UNK long 0
get FILES long 0
get UNK long 0
for i = 1 <= FILES
	get NAME_CRC long 0
	get FILE long 0
	get OFFSET long 0
	get SIZE long 0
	get CODE short 0
	get CH short 0
	get FREQ long 0
	get UNK long 0
	get INTERLEAVE short 0
	get BITS short 0 # always 4 (Xbox ADPCM)
	get UNK long 0
	set NAME BNAME
	string NAME += "_"
	string NAME += i
	string REST p= "_0x%08x.lwav" NAME_CRC
	string NAME += REST
	if FILE == 0
		log MEMORY_FILE2 OFFSET SIZE 1
	elif FILE == 1
		log MEMORY_FILE2 OFFSET SIZE 2
	elif FILE == 2
		log MEMORY_FILE2 OFFSET SIZE 3
	endif
	savepos MYOFF 0
	callfunction XADP 1
	goto MYOFF 0
next i

startfunction XADP
	set MEMORY_FILE binary "\x52\x49\x46\x46\x18\x51\xa3\x0\x57\x41\x56\x45\x66\x6d\x74\x20\x14\x0\x0\x0\x69\x0\x2\x0\x44\xac\x0\x0\xcc\xc1\x0\x0\x48\x0\x4\x0\x2\x0\x40\x0\x64\x61\x74\x61\xf0\x50\xa3\x0"
	set RIFFSIZE SIZE
	math RIFFSIZE += 0x28
	putVarChr MEMORY_FILE 0x04 RIFFSIZE long
	putVarChr MEMORY_FILE 0x16 CH byte
	putVarChr MEMORY_FILE 0x18 FREQ long
	set VAR1 0x3073
	math VAR1 *= CH
	if FREQ == 48000
		math VAR1 *= 44100
	else
		math VAR1 *= FREQ
	endif
	math VAR1 /= 22050
	putVarChr MEMORY_FILE 0x1c VAR1 long	
	set VAR2 0x24
	math VAR2 *= CH
	putVarChr MEMORY_FILE 0x20 VAR2 short
	putVarChr MEMORY_FILE 0x2c SIZE long
	append
	log MEMORY_FILE 0 SIZE MEMORY_FILE2
	append
	if NAME == ""
		get NAME basename
		string NAME += ".lwav"
	endif
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction
```
## Post #261
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-05-30T00:38:45+00:00
- Post Title: Re: My quickBMS scripts

Gun (Xbox 360) wad/dat sound extractor
Old script of mine. Not pretty but it did work back then. 

```
# (c) 2012-05-30 by AlphaTwentyThree of XeNTaX

endian big
open FDDE dat 0
open FDDE wad 1
get FILES long 0

for i = 1 <= FILES
	endian big
	set MEMORY_FILE binary "\x52\x49\x46\x46\xb8\x59\xa7\x00\x57\x41\x56\x45\x66\x6d\x74\x20\x20\x00\x00\x00\x65\x01\x10\x00\xd6\x10\x00\x00\x01\x00\x00\x03\xe3\x9a\x00\x00\x80\xbb\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x64\x61\x74\x61\x00\x58\xa7\x00"
	get NAME_CRC long 0
	get OFFSET long 0
	get SIZE long 0
	get FREQ long 0
	get UNK byte 0
	get ZERO short 0
	get CH byte 0
	append
	log MEMORY_FILE OFFSET SIZE 1
	append
	set RIFFSIZE SIZE
	math RIFFSIZE += 0x34
	endian little
	putVarChr MEMORY_FILE 0x24 FREQ long
	putVarChr MEMORY_FILE 0x31 CH byte
	putVarChr MEMORY_FILE 0x04 RIFFSIZE long
	putVarChr MEMORY_FILE 0x38 SIZE long
	math SIZE += 0x3c
	get NAME basename 0
	string NAME += "_"
	string NAME += i
	string NAME += ".xma"
	log NAME 0 SIZE MEMORY_FILE
next i
```
## Post #262
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-06-02T02:33:18+00:00
- Post Title: Re: My quickBMS scripts

Tongas Pack extractor (supports v1, v2 & v3)

Works for all three versions. 

```
# supported games:
# - 3D Ultra Minigolf Adventures (XBLA) v1
# - 3D Ultra Minigolf Adventures 2 (XBLA) v2
# - Arkadian Warriors (XBLA) v1
# - Assault Heroes (PC/XBLA) v1
# - Assault Heroes 2 (XBLA) v1
# - Ice Age 4: Continental Drift (Xbox 360) v3
# - Tetris (PS3/PSN) v3
#
# (c) 2012-07-01 by AlphaTwentyThree of XeNTaX

comtype COMP_LZMA_86HEAD
getDstring IDENT 13 # "tongas_pack_v" in v2 & v3
if IDENT == "00#%&W&N$(0FL"
	set VER 1
	goto 0x12
	get FILES long
else
	getDstring VER 5
	if VER == "20000"
		set VER 2
	elif VER == "30000"
		set VER 3
	else
		print "Tongas pack version not supported! PM me at XeNTaX!"
	endif
	get FILES long
	get UNK long
endif

for i = 1 <= FILES
	get OFFSET long
	get SIZE long
	if VER == 3
		get COMP long
	else
		set COMP 1
	endif
	get NAMEL long
	getDstring NAME NAMEl
	if VER == 1
		string NAME -= 4 # remove ".wzm" at end
	endif
	savepos MYOFF
	if COMP == 1
		goto OFFSET
		get UNK long
		get DUMMY byte
		get ZSIZE long
		math ZSIZE *= 0x10
		clog NAME OFFSET SIZE ZSIZE
	else
		log NAME OFFSET SIZE
	endif
	goto MYOFF
next i
```
## Post #263
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-06-16T14:14:30+00:00
- Post Title: Re: My quickBMS scripts

Jagged Alliance: Back in Action / Jagged Alliance: Crossfire - PAK extractor
Works for the unencrypted files. 

```
# (c) 2012-06-16 by AlphaTwentyThree of XeNTaX

idstring "PKLE"
get UNK long
get DATASTART long # attention: last file name ends directly here!
get ZERO long
get UNK long
get ZERO long
do
	get FIDENT long # folder ident, always 1 at start
	get NAMEL long
	get FILES long # files in folder
	get ZERO long
	getDstring FOLDER NAMEL
	for i = 1 <= FILES
		get NAMEL long
		get SIZE long
		get ZERO long
		get OFFSET long
		get ZERO long
		get HASH long
		get ZERO long
		getDstring FNAME NAMEL
		set NAME FOLDER
		string NAME += FNAME
		log NAME OFFSET SIZE
	next i
	savepos MYOFF
while MYOFF < DATASTART
```
## Post #264
- Username: aluigi
- Rank: VVIP member
- Number of posts: 1916
- Joined date: Thu Dec 08, 2005 7:26 pm
- Post datetime: 2012-06-17T00:29:32+00:00
- Post Title: Re: My quickBMS scripts

you can use my script for Jagged Alliance BIA, it supports also encrypted archives:
[http://aluigi.org/papers/bms/jagged_alliance_bia.bms](http://aluigi.org/papers/bms/jagged_alliance_bia.bms)
## Post #265
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-06-19T14:20:35+00:00
- Post Title: Re: My quickBMS scripts

> Reply from aluigi
>
> you can use my script for Jagged Alliance BIA, it supports also encrypted archives:
http://aluigi.org/papers/bms/jagged_alliance_bia.bms
Didn't check on your scripts - thanks for the info. 
Is there an easy way to determine those crypt keys?
## Post #266
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-06-19T14:21:58+00:00
- Post Title: Re: My quickBMS scripts

Just updated:
func_header_AT3.bms: [viewtopic.php?f=13&t=4450&p=42999#p42999](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=42999#p42999)
msf2at3.bms: [viewtopic.php?f=13&p=43570#p43570](http://forum.xentax.com/viewtopic.php?f=13&p=43570#p43570)
## Post #267
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-06-25T20:28:25+00:00
- Post Title: Re: My quickBMS scripts

WAVE format scanner

Long overdue script for a proper wave scanner. I know there are many raw scanner which have a *.wav option but they only find very certain wave files. I've encountered none that supports big endian wave files with RIFX identifier so far.
My old script didn't work properly and I had to change almost the whole script. Features of this script:
supports little and big endian headers (RIFF and RIFX)
automatic filesize correction in header (!)
file name retrieval from first marker nameI've added comments about what happens in each line, so it's a nice example for getting familiar with QuickBMS. 

Tip: Scanning the EN.pck from Darksiders II (PC, 2012) will get you the original file names which aren't saved in the file table at the start of the archive! 

```
# RIFF and RIFX header supported
# note: There are wave files with a wrong file size after RIFF/RIFX
#       This script takes the stream size, adds the header size and writes the correct size after RIFF/RIFX
# (c) 2012-06-26 by AlphaTwentyThree
#
# future update plans:
# - option to also write data between found wave files to disk
# - option to automatically transform the file to a playable or at least decodable format

for i = 1								# run through loop with count variable i
	FindLoc OFFSET string "WAVE" 0 ""	# search for "WAVE", save position as variable OFFSET
	if OFFSET == ""						# when nothing is found
		cleanexit						# the script exits (e.g. at end of file)
	endif
	math OFFSET -= 8					# jump to possible
	goto OFFSET							# RIFF/RIFX file start
	getDstring IDENT 4					# read string of 4 bytes, save variable as IDENT
	if IDENT == "RIFX"					# differentiate between header possibilities
		endian big						# set endianness to big, if file has RIFX identifier
		callfunction write 1			# see function section below
	elif IDENT == "RIFF"				# endianness stays little
		callfunction write 1			# also run function
	else								# string "WAVE" found, but doesn't belong to wave file
		set SIZE 0xc					# do as if something with 0xc bytes was found to continue search from the right position
	endif
	set SEARCH OFFSET					# set marker to position from where to search next
	math SEARCH += SIZE					# (that would be after the file that was found)
	if SEARCH == FSIZE					# in case the last found file ends with the main file, we exit
		cleanexit
	endif
	goto SEARCH							# if we haven't exited the script above, we set out cursor to after the last found file
next i

startfunction write						# function "write" starts here, is called when a wave file is found above
	get NAME basename					# save name without extension under variable NAME
	string NAME += "_"					# add underscore to the name
	string NAME += i					# add the loop variable to the name
	goto OFFSET							# set cursor to the beginning of the found file
	get DUMMY long						# RIFF/RIFX identifier, not needed
	get DUMMY long						# riff size, not needed
	get DUMMY long						# "WAVE", not needed, we arrive at the "fmt " section
	for									# loop search for the "data" section at the start of the stream (get the stream size from there)
		getDstring AREA_NAME 4			# name of area in header
		get AREA_SIZE long				# size of area in header
		savepos MYOFF					# save position we are at
		if AREA_NAME == "data"			# when we arrive at the needed "data" area:
			break						# we exit the loop
		else							# otherwise:
			if AREA_NAME == "LIST"		# that's the area of the marker names
				callfunction retrievename 1 # see below
			endif
			math MYOFF += AREA_SIZE		# not reached "data" area -> adjust cursor position...
			goto MYOFF					# ... and go there
		endif
	next								# remember: the cursor is now directly at the stream start
	set STREAMSIZE AREA_SIZE			# the last AREA_SIZE is the size we need (size of the audio stream)
	set HEADERSIZE MYOFF				# 
	math HEADERSIZE -= OFFSET			# calculate the size of the stream header (offset - offset = size)
	set SIZE HEADERSIZE					# 
	math SIZE += STREAMSIZE				# calculate complete file size (header + stream = file)
	log MEMORY_FILE OFFSET SIZE			# write file to memory
	math SIZE -= 8						# subtract 8 bytes to get the riff size
	putVarChr MEMORY_FILE 4 SIZE long 	# write the correct riff size to the header inside the memory
	string NAME += ".wav"				# add extension to the name (the name could contain the name of the first marker if the file has markers)
	math SIZE += 8						# add the subtracted 8 bytes again
	log NAME 0 SIZE MEMORY_FILE			# write file in memory to disk
endfunction								# remember that we continue with our next i now!

startfunction retrievename				# get possible file name from first marker name, rmember: our cursor is after the size of the LIST area
	get DUMMY long 						# always "adtl", not needed
	get DUMMY long						# always "labl", not needed
	get MSIZE long						# size of the label area for this marker
	math MSIZE -= 4						# subtracting 4 bytes leaves us with the length of the marker label
	get DUMMY long						# marker type, not needed
	getDstring MNAME MSIZE				# cursor is at the beginning of the label name, now get the marker name with the desired length MSIZE
	string NAME += "~"
	string NAME += MNAME				# add the marker name to the file name
endfunction
```
## Post #268
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-06-25T23:42:49+00:00
- Post Title: Re: My quickBMS scripts

Warhammer 40,000: Squad Command (PSP) - *.pak extractor

```
# (c) 2012-06-26 by AlphaTwentyThree of XeNTaX

get DATASTART long
get ENTRIES long
set INFO DATASTART
math INFO -= 4
goto INFO
get NAMEPOS long
goto NAMEPOS
get FILES long
savepos NAMEPOS
goto 8
for i = 1 <= FILES
	get UNK long
	get SIZE long
	get UNK long
	get UNK byte
	get OFFSET long
	savepos MYOFF
	goto NAMEPOS
	get NAMEL short
	getDstring NAME NAMEL
	savepos NAMEPOS
	log NAME OFFSET SIZE
	goto MYOFF
next i
```
## Post #269
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-06-28T16:25:45+00:00
- Post Title: Re: My quickBMS scripts

Just updated the Tongas Pack extractor with version 2!
## Post #270
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-06-28T23:24:12+00:00
- Post Title: Re: My quickBMS scripts

Found a Tongas Pack v1 and updated the script!
## Post #271
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-06-29T00:48:36+00:00
- Post Title: Re: My quickBMS scripts

XEN archive extractor

Found this in an XBLA game. A little bit more elaborate format, but not much. 

```
# supported games:
# - Are You Smarter Than A 5th Grader: Make the Mark (XBLA)
#
# (c) 2012-06-29 by AlphaTwentyThree of XeNTaX

endian big
get UNK long
get DATASTART long
get UNK long
get FILES long

get POS_INFO long
math POS_INFO *= 0x1000
get POS_UNK long
get UNK long
get COMP_SIZE long

goto 0x28
get POS_NAMES long
math POS_NAMES *= 0x1000

get FNAME basename
string FNAME += "/"
goto 0x3c
get DEC_SIZE long
if DEC_SIZE != 0 # compressed data
	get OFFSET asize
	math OFFSET -= COMP_SIZE
	putVarChr MEMORY_FILE 0x15f 0 byte # produce bias of 0x160 bytes
	append
	clog MEMORY_FILE OFFSET COMP_SIZE DEC_SIZE
	append
else
	get SIZE asize
	append
	log MEMORY_FILE 0 SIZE
	append
endif
goto POS_INFO MEMORY_FILE
for i = 1 <= FILES
	get OFFSET long MEMORY_FILE
	math OFFSET *= 0x1000
	get CRC long MEMORY_FILE
	get SIZE long MEMORY_FILE
	get NAMEPOS long MEMORY_FILE
	math NAMEPOS += POS_NAMES
	get UNK long MEMORY_FILE # 0 or 1
	get UNK long MEMORY_FILE # multiple of 4 or 0
	get ZSIZE long MEMORY_FILE
	get ZERO long MEMORY_FILE
	savepos MYOFF MEMORY_FILE
	goto NAMEPOS MEMORY_FILE
	get NAME string MEMORY_FILE
	goto MYOFF MEMORY_FILE
	if SIZE != 0
		set WNAME FNAME
		string WNAME += NAME
		log WNAME OFFSET SIZE MEMORY_FILE
	endif
next i
```
## Post #272
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-01T14:47:54+00:00
- Post Title: Re: My quickBMS scripts

XPR2 extractor

Will need to further compare this with the Quake 4 X360 version, maybe there's some identifier and I can join the two scripts.
I guess there are other games that use this format. I'll update the script info at the start as soon as I encounter more so this script can be found when searching for a game inside XeNTaX. 

```
# (note: these are different than the ones from Quake 4 X360)
#
# games that use XPR2 archives:
# Astropop XBLA
# Bejeweled 2 XBLA
# Contra XBLA
#
# (c) 2012-07-01 by AlphaTwentyThree of XeNTaX

IDSTRING "XPR2"
endian big
get FILESIZE long # minus 0xc
get FSIZE asize
math FSIZE -= 0xc
if FSIZE != FILESIZE
	print "XPR archive not supported. Please contact me on XeNTaX!"
	cleanexit
endif
get ZERO long
get FILES long

for i = 1 <= FILES
	getDstring UNK 4
	get OFFSET long
	math OFFSET += 0xc
	get SIZE long
	get NAMEPOS long
	math NAMEPOS += 0xc
	savepos MYOFF
	goto NAMEPOS
	get NAME string
	goto MYOFF
	log NAME OFFSET SIZE
next i
```
## Post #273
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-02T01:53:16+00:00
- Post Title: Re: My quickBMS scripts

Backbreaker: Vengeance (XBLA) pkd extractor

```
# (c) 2012-07-02 by AlphaTwentyThree of XeNTaX

open FDDE pkh 0
open FDDE pkd 1
get FILES long 0
get UNK long 0
for i = 1 <= FILES
	get NAMEL long 0
	getDstring NAME NAMEL 0
	get OFFSET long 0
	get SIZE long 0
	log NAME OFFSET SIZE 1
next i
```
## Post #274
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-02T17:55:19+00:00
- Post Title: Re: My quickBMS scripts

POD archive extractor

Just encountered a POD2 archive and decided to merge the existing scripts I coded for POD archives so far into one single script. 
If anyone has a POD1 or POD4 sample, please PM me.

```
# supported games:
# Blair Witch Vol.I - Vol.III (PC) v2
# BloodRayne (PS2) v3
# Country Dance All-Stars (X360, 2012) v5
# Kinect Star Wars (X360, 2012) v5
# Toy Story Mania (X360, 2012) v5
# The Walking Dead: Survival Instinct (2013) v5
#
# (c) 2012-11-05 by AlphaTwentyThree of XeNTaX

idstring "POD"
getDstring VER 1
if VER == "1"
   print "POD version not supported yet! Please contact me via PM!"
   cleanexit
elif VER == "4"
   print "POD version not supported yet! Please contact me via PM!"
   cleanexit
endif
goto 0x58
get FILES long
if VER == "2"
   set HEADER 0x60
else
   goto 0x108
   get HEADER long
endif
set NAMEBIAS FILES
if VER == "5"
	math NAMEBIAS *= 0x1c
else
	math NAMEBIAS *= 0x14
endif
math NAMEBIAS += HEADER
goto HEADER

for i = 1 <= FILES
   get NAMEPOS long
   math NAMEPOS += NAMEBIAS
   get SIZE long
   get OFFSET long
   if VER == "5"
      get ZSIZE long
      get ZERO long
   else
      set ZSIZE SIZE
   endif
   get UNK long
   get UNK long
   savepos MYOFF
   goto NAMEPOS
   get NAME string

   if SIZE == ZSIZE
      log NAME OFFSET SIZE
   else
      clog NAME OFFSET SIZE ZSIZE
   endif
   goto MYOFF
next i
```
## Post #275
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-03T02:37:41+00:00
- Post Title: Re: My quickBMS scripts

Ace Combat Zero: The Belkan War (PS2) - npsf to ss2 converter

Split the BGM.PAC with my generic splitter ("NPSF") and convert them with this script to ss2 afterwards (playable with Winamp & vgmstream). Luckily, NPSF files contain song names. 

```
# (c) 2012-07-03 by AlphaTwentyThree of XeNTaX

include "func_header_SS2.bms"
idstring "NPSF"
goto 0x10
get INTERLEAVE long
get UNK long
get FREQ long
set CH 2
goto 0x34
getCT NAME string 0x2e
string NAME += ".ss2"
set OFFSET 0x800
get SIZE asize
math SIZE -= OFFSET
callfunction SS2 1
```
## Post #276
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-04T12:31:22+00:00
- Post Title: Re: My quickBMS scripts

SDF to SS2 converter

Request from mauzerX. 
Needs [func_header_SS2.bms](http://forum.xentax.com/viewtopic.php?f=13&p=44717#p44717) in the same folder.
Don't forget to run the files through my 0x10 bytes reinterleaver before playing!

```
# 
# supported games:
# - Doomsday Racers (PS2)
# - Obliterate (PS2)
# - X-Treme Quads (PS2)
#
# (c) 2012-07-04 by AlphaTwentyThree of XeNTaX

include "func_header_SS2.bms"
idstring "SDF"
goto 8
get SIZE long
get FREQ long
get CH long
get INTERLEAVE long
set OFFSET 0x18
set NAME ""
callfunction SS2 1
```
## Post #277
- Username: mauzerX
- Rank: advanced
- Number of posts: 57
- Joined date: Thu Jul 01, 2010 8:48 pm
- Post datetime: 2012-07-04T12:59:53+00:00
- Post Title: Re: My quickBMS scripts

Great! Thanks
## Post #278
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-04T14:30:01+00:00
- Post Title: Re: My quickBMS scripts

> Reply from mauzerX
>
> Great! Thanks
You're welcome - just ask.
## Post #279
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-04T14:31:15+00:00
- Post Title: Re: My quickBMS scripts

Beyond Good & Evil HD (XBLA) - bf extractor

Extracts the main archive. Careful, more than 8000 files in this archive. 

```
# (c) 2012-07-04 by AlphaTwentyThree of XeNTaX

idstring "BIG"
goto 0x8
get FILES long
set OFF_INFO 0x15abc
goto 0x44
for i = 1 <= FILES
	get OFFSET long
	math OFFSET += 4
	get UNK short
	get UNK short
	savepos MYOFF
	goto OFF_INFO
	get UNK byte # always 0xfc
	get SIZE threebyte
	math SIZE *= 0x100
	get ID1 long
	get ID2 long
	get CAT short # category
	get ZERO short
	get UNK long
	getDstring NAME 0x40
	get UNK long
	savepos OFF_INFO
	goto MYOFF
	log NAME OFFSET SIZE
next i
```
## Post #280
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-04T22:42:08+00:00
- Post Title: Re: My quickBMS scripts

Just updated the PCM wave header adder because it had an error. You can now also change codecs, but beware: sometimes it won't work. Stay with PCM to be safe.
## Post #281
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-04T22:43:52+00:00
- Post Title: Re: My quickBMS scripts

XNB to WAV

Be sure you have the newest func_header_PCM.bms ([viewtopic.php?f=13&t=4450&p=71565#p71565](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=71565#p71565))

```
# (c) 2012-10-14 by AlphaTwentyThree of XeNTaX

include "func_header_PCM.bms"
idstring "XNBw"
goto 0x47
get CODEC short
get CH short
get FREQ long
get UNK long
get BLOCKALIGN short
get BITS short
get JUMP short
savepos MYOFF
math MYOFF += JUMP
goto MYOFF
get SIZE long
savepos OFFSET
set NAME ""
callfunction PCM 1
```
## Post #282
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-05T00:20:23+00:00
- Post Title: Re: My quickBMS scripts

Breach xsp/spd extractor

I first thought that some ID sorting was referring to the names so I hazzled around to get it right - only to realize that it's something game-internal and apparently not needed for extraction. 
Works for PC and XBLA version. The archives are the same except for the extension.

```
# (c) 2012-07-05 by AlphaTwentyThree of XeNTaX

open FDDE spd 0
idstring "SPDv1.04" 0
open FDDE xsp 1 EXIST
if EXIST == 0
	open FDDE psp 1 EXIST
	if EXIST == 0
		cleanexit
	endif
endif

endian big
get SIZE_HEADER long 0
get ZERO long 0
get FILES long 0
get OFF_INFO long 0
set OFF_IDS FILES # sorting of info above (game-internal)
math OFF_IDS *= 0x38
math OFF_IDS += OFF_INFO
set OFF_NAMEPOS FILES # pointer to file name
math OFF_NAMEPOS *= 4
math OFF_NAMEPOS += OFF_IDS
set OFFBIAS_NAMES FILES
math OFFBIAS_NAMES *= 4
math OFFBIAS_NAMES += OFF_NAMEPOS

goto 0 1
endian little
get DUMMY long 1 # FILES again
for i = 1 <= FILES
	get OFFSET long 1
	savepos MYOFF 1
	if i < FILES
		get SIZE long 1
		goto MYOFF 1
	else
		get SIZE asize 1
	endif
	math SIZE -= OFFSET
	goto OFFBIAS_NAMES 0
	get NAME string 0
	string NAME += ".wav"
	savepos OFFBIAS_NAMES 0
	log NAME OFFSET SIZE 1
next i
```
## Post #283
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2012-07-07T05:24:30+00:00
- Post Title: Re: My quickBMS scripts

Try use Beyond Good & Evil HD (XBLA) - bf extractor on TMNT.bf(ABE header). I think archive format is similar, but need fix something in script for work:
## Post #284
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-07T15:25:04+00:00
- Post Title: Re: My quickBMS scripts

The general problem with this format is that I couldn't find a way to calculate the OFF_INFO and had to manually set it to 0x15abc just for this one archive. So it won't work for any other .bf file.
## Post #285
- Username: Evin
- Rank: ultra-veteran
- Number of posts: 348
- Joined date: Sat Aug 05, 2006 9:04 pm
- Post datetime: 2012-07-07T18:34:29+00:00
- Post Title: Re: My quickBMS scripts

Older BGEHD script: [viewtopic.php?f=10&t=7886&hilit=evil+hd ... nd+good+hd](http://forum.xentax.com/viewtopic.php?f=10&t=7886&hilit=evil+hd+good+and+evil+hd+beyond+good+hd)
## Post #286
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-07T19:27:14+00:00
- Post Title: Re: My quickBMS scripts

Wave data reverser
Sometimes you encounter wave files that just play static but you can see that they are normal PCM files. Those are big endian streams with a little endian header. Normal process would be to strip the header, save the data as raw, open as big endian in an audio editor and save as PCM again. As this process can be pretty exhausting, I've written a little script that just reverses the wave data. The header stays untouched.
Note that the input has to be a standard PCM file with 4-byte block align.

```
# (c) 2012-07-07 by AlphaTwentyThree of XeNTaX

idstring "RIFF"
do
	findLoc HEADER string "data" 0 ""
	goto HEADER
	idstring "data"
	get SIZE long
while SIZE == 0
math HEADER += 0x8

get SIZE asize
putVarChr MEMORY_FILE SIZE 0
log MEMORY_FILE 0 0
set LOOPS SIZE
math LOOPS -= HEADER
math LOOPS /= 2
append
log MEMORY_FILE 0 HEADER # write header
set OFFSET HEADER
goto OFFSET
for i = 1 <= LOOPS
	get WRITE short
	reverseShort WRITE
	putVarChr MEMORY_FILE OFFSET WRITE short
	math OFFSET += 2
next i
append
get NAME basename
string NAME += "_littled"
string NAME += ".wav"
log NAME 0 SIZE MEMORY_FILE

```
## Post #287
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-08T00:27:08+00:00
- Post Title: Re: My quickBMS scripts

Crystal Defenders bin extractor

Works for XBLA, WiiWare, PSN and PSP mini. 

```
#
# (c) 2012-07-08 by AlphaTwentThree of XeNTaX

get IDENT long
get FILES long
goto 0x20
if IDENT == 0x58424201 # XBLA
	endian big
	callfunction XBB 1
elif IDENT == 0x01424258 # PSP/PSN
	callfunction XBB 1
else
	get FSIZE asize
	math FSIZE -= 0x20
	reverseLong IDENT
	if IDENT == FSIZE # WiiWare
		endian big
		reverseLong FILES
		callfunction Wii_bin
	else
		cleanexit
	endif
endif

startfunction XBB
	for i = 1 <= FILES
		get OFFSET long
		get SIZE long
		get NAMEPOS long
		get NAME_CRC long
		if NAMEPOS != 0
			savepos MYOFF
			goto NAMEPOS
			get NAME string
			goto MYOFF
		else
			string NAME_CRC p= "_%08x" NAME_CRC
			get NAME basename
			string NAME += NAME_CRC
		endif
		log NAME OFFSET SIZE
	next i
endfunction
startfunction Wii_bin
	set OFFSET 0x20
	for i = 1 <= FILES
		goto OFFSET
		get SIZE long
		get NAME basename
		string NAME += "_"
		string NAME += i
		log NAME OFFSET SIZE
		math OFFSET += SIZE
	next i
endfunction
```
## Post #288
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2012-07-08T13:38:56+00:00
- Post Title: Re: My quickBMS scripts

> Reply from evin
>
> Older BGEHD script: viewtopic.php?f=10&t=7886&hilit=evil+hd ... nd+good+hd
aluigi's script also have this:
## Post #289
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-08T18:59:35+00:00
- Post Title: Re: My quickBMS scripts

Enhanced WiiWare extractor
As I wasn't quite satisfied with the procedure to extract the contents of extracted WiiWare *.wad images, I wrote my own script. The basis is just a U-8 archive extractor, but it does more than just extract/decompress it's contents:
- it searches for a U-8 archive within a file, dumps the data before the found identifier and processes the U-8
- it analyzes the content of each file from the U-8 after dumping it into memory:
   -> if the data has an "LZ77" identifier, it automatically decompresses the contents
   -> if the data has an "IMD5" identifier, it looks for either a "BNS " (sound) or "LZ77" identifier. If the latter is found, it decompresses the content
- the above two steps also apply to files that are no U-8 archives but have these three identifiers.
If you have ever worked with WAD WiiWare images, you know that the process of extracting everything can be rather tedious. This script will fasten the process a bit. 
Just to get an idea what the potential is:
- when you extract the 00000000.app, the banner.bin, icon.bin and sound.bin are already decompressed. If the sound.bin wasn't compressed, it's already named sound.bin.bns and ready to be played in Winamp with the vgmstream input
- when you extract some other U-8 archive, all the contents will be fully decompressed, even if they start with the LZ77 identifier and not with 0x10/0x11.
- you can throw in LZ77-compressed files with either 0x10/0x11 or "LZ77" identifier and decompress them. Any found data with IMD5 identifier will be analyzed further.
- you can throw in files with "IMD5" identifier and the content will be decompressed.
So after all, this is quite a powerful script. 

```
# supported formats: U-8 archives, LZ77-compressed files ("LZ77" or 0x10/0x11 identifier) and files with "IMD5" identifier
# - if LZ77-compressed data is found in an IMD5 file within a U-8 archive or if the IMD5 file is the input, it is automatically decompressed
# - if a BNS sound file is found in a IMD5 file within a U-8 archive or if the IMD5 file is the input, it is automatically extracted
# - if the input is an LZ77-compressed file (all identifiers), it is decompressed and analyzed further with the above criteria
# (c) 2012-07-08 by AlphaTwentyThree of XeNTaX

set SUBFOLDER 1 # decide if you want to take the archive name as root folder (U-8 only)
if SUBFOLDER == 1
	get AFOLDER basename
	string AFOLDER += "/"
endif

endian big
comtype COMP_LZ77WII
FindLoc OFFSET string \x55\xaa\x38\x2d 0 ""
get SIZE asize
if OFFSET == "" # something else -> test in MEM2
	log MEMORY_FILE 0 0
	goto 0
	get TEST byte
	if TEST == 0x10
		endian little
		get ZSIZE threebyte
		endian big
		clog MEMORY_FILE2 0 SIZE ZSIZE
	elif TEST == 0x11
		get ZSIZE threebyte
		clog MEMORY_FILE2 0 SIZE ZSIZE
	else
		log MEMORY_FILE2 0 SIZE
	endif
	get WNAME basename
	callfunction testMEM2 1
else
	if OFFSET != 0
		get NAME basename
		string NAME += ".dump"
		if SUBFOLDER == 1
			set WNAME AFOLDER
			string WNAME += NAME
		else
			set WNAME NAME
		endif
		log WNAME 0 OFFSET
	endif
	math SIZE -= OFFSET
	putVarChr MEMORY_FILE SIZE 0
	log MEMORY_FILE 0 0
	append
	log MEMORY_FILE OFFSET SIZE # plain U-8 archive
	append
	callfunction processU8 1
endif


startfunction processU8
	goto 0 MEMORY_FILE
	idstring \x55\xaa\x38\x2d MEMORY_FILE # U-8
	get OFF_INFO long MEMORY_FILE
	get INFOSIZE long MEMORY_FILE
	get UNK long MEMORY_FILE
	callfunction getFiles 1 # number of files
	set OFFNAMES FILES
	math OFFNAMES *= 0xc
	math OFFNAMES += OFF_INFO
	set FOLDER ""
	for i = 1 <= FILES
		goto OFF_INFO MEMORY_FILE # FID in main U-8
		get FIDENT byte MEMORY_FILE
		get OFF_NAME threebyte MEMORY_FILE
		get OFFSET long MEMORY_FILE
		get SIZE long MEMORY_FILE # compressed size
		savepos OFF_INFO MEMORY_FILE # continue from here after if
		math OFF_NAME += OFFNAMES
		goto OFF_NAME MEMORY_FILE
		get NAME string MEMORY_FILE
		if FIDENT == 1
			callfunction setFolder 1
		else # file decompression or copy to MEMORY_FILE2
			set WNAME FOLDER
			string WNAME += NAME # complete name
			goto OFFSET MEMORY_FILE
			get IDENT byte MEMORY_FILE
			log MEMORY_FILE2 0 0
			if IDENT == 0x10
				endian little
				get ZSIZE threebyte MEMORY_FILE
				endian big
				clog MEMORY_FILE2 OFFSET SIZE ZSIZE MEMORY_FILE # decompress to MEM2
				print "ok"
			elif IDENT == 0x11
				get ZSIZE threebyte MEMORY_FILE
				clog MEMORY_FILE2 OFFSET SIZE ZSIZE MEMORY_FILE
				print "ok"
			else # no matter what else
				log MEMORY_FILE2 OFFSET SIZE MEMORY_FILE
				print "ok"
			endif
			get SIZE asize MEMORY_FILE2
			if SIZE >= 4
				callfunction testMEM2 1
			else
				log WNAME 0 SIZE MEMORY_FILE2
			endif
		endif
	next i
endfunction

startfunction testMEM2
	get SIZE asize MEMORY_FILE2
	set OFFSET 0
	goto 0 MEMORY_FILE2
	getDstring IDENT 4 MEMORY_FILE2
	if IDENT == "IMD5" # test for BNS or LZ77
		goto 0x20 MEMORY_FILE2
		getDstring IDENT 4 MEMORY_FILE2
		if IDENT = "BNS "
			set OFFSET 0x20
			math SIZE -= OFFSET
			string WNAME += ".bns"
			log WNAME OFFSET SIZE MEMORY_FILE2
		elif IDENT == "LZ77"
			set OFFSET 0x24
			math SIZE -= OFFSET
			get TYPE byte MEMORY_FILE2
			if TYPE == 0x10
				endian little
			endif
			get ZSIZE threebyte MEMORY_FILE2
			endian big
			string WNAME += ".decomp"
			clog WNAME OFFSET SIZE ZSIZE MEMORY_FILE2
		else
			set OFFSET 0x20
			math SIZE -= OFFSET
			string WNAME += ".imd"
			log WNAME OFFSET SIZE MEMORY_FILE2 # change nothing
		endif
	else
		if IDENT == "BNS "
			string WNAME += ".bns"
		endif
		get SIZE asize MEMORY_FILE2
		log WNAME 0 SIZE MEMORY_FILE2 # change nothing
	endif
endfunction

startfunction setFOLDER
	if SUBFOLDER == 1
		set FOLDER AFOLDER
		string FOLDER += NAME
		if NAME != ""
			string FOLDER += "/"
		endif
	else
		if NAME != ""
			set FOLDER NAME
			string FOLDER += "/"
		else set FOLDER ""
		endif
	endif
endfunction

startfunction getFiles
	set TEST OFF_INFO
	goto TEST MEMORY_FILE
	for
		get IDENT1 byte MEMORY_FILE
		get IDENT2 byte MEMORY_FILE
		if IDENT2 > 0
			break
		else
			math TEST += 0xc
			goto TEST MEMORY_FILE
		endif
	next
	savepos FILES MEMORY_FILE
	math FILES -= 2
	math FILES -= OFF_INFO
	math FILES /= 0xc
endfunction
```
## Post #290
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-08T19:52:35+00:00
- Post Title: Re: My quickBMS scripts

WiiWare: Big Town Shoot Out *. PUB extractor

```
# (c) 2012-07-08 by AlphaTwentyThree of XeNTaX

comtype COMP_LZ77WII
endian big
goto 0x24
get FILES long
get INFO long
goto INFO
for i = 1 <= FILES
	get NAME_CRC long
	string NAME_CRC p= "_0x%08x" NAME_CRC
	get OFFSET long
	get UNK long
	get SIZE long
	get ZSIZE long
	get ZERO long
	get UNK long
	get NAME basename
	string NAME += NAME_CRC
	if SIZE == ZSIZE
		log NAME OFFSET SIZE
	else
		clog NAME OFFSET SIZE ZSIZE
	endif
next i
```
## Post #291
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-10T21:05:59+00:00
- Post Title: Re: My quickBMS scripts

Just a little update on what I'm currently doing: I've encountered several *.brsar sound archives from WiiWare games now (the Bit.Trip series to be precise) and as there's currently no extractor available, I'm trying to write my own.  
The structure reminds of the *.sdat files from Nintendo DS games, but not as sophisticated. Still, it's no simple extraction because there are several sections with different infos (like in the SDATs). Additionally, the files are divided into RWAR packs, each containing numbers of files. I'm currently searching for a way to link the names to the files. I guess, there's some ID for every file and somewhere there are pointers from the offsets to the files. Else, I didn't yet figure out why there are more names than RWAV entries - they probably correlate to the pack names. Some analyzing to do but I think it'll be worth the effort and many games will be correctly rippable from then on!
## Post #292
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-14T03:58:12+00:00
- Post Title: Re: My quickBMS scripts

Playstation XA extractor
This script splits deinterleaved XA files to playable XA files. 
To get a correctly deinterleaved XA files:
- raw-copy the big XA to your HD (i.e. with ISOBuster)
- open the file with a hex editor, set the jump parameter to 0x930, look at the byte at cursor +0x11, it will increase each 0x930 jump
- as soon as the counter reaches 00 again, you have your desired layer count (highest number plus one as the counting starts at zero) - always a power of two (normally either 0x4, 0x8 or 0x10)
- set your deinterleave parameters accordingly with INTERLEAVE 0x930 and the above layer count and deinterleave with my script or any program that can do this operation
Each of the deinterleaved files will be the same size of course and will contain a number of xa streams, which you can extract with this sript. Don't worry if the size of the extracted files is by far smaller than the size of the layer - that's because there's plenty of filling bytes and the main reason why PSX images can be compressed with such a high ratio.
I might extend this script to do all of the above steps automatically but I'm too lazy at the moment. 
As you can see, the script is just a simplified version of my generic file splitter. Remember to put the needed func_header_CDXA.bms into the same directory as this script.

```
# extracts playable cdxa files from deinterleaved xa packs
# (c) 2012-07-14 by AlphaTwentyThree of XeNTaX

include "func_header_CDXA.bms"
set OFFSET 0x0
set NEGBIAS 4
set EXT ".xa"
set SEARCH OFFSET
set QUIT 0
set SINGLE 0
set i 1
do
	goto SEARCH
	FindLoc SIZE string \xA2\xF1\xA6\x1B 0 "" # negbias 4 (CDXA split marker)
	if SIZE == ""
		set QUIT 1
		get SIZE asize
		if i == 0
			goto 0
			set SINGLE 1
		endif
	endif
	math SIZE -= OFFSET
	get NAME basename
	if SINGLE != 1
		string NAME += "_"
		string NAME += i
		if i != 0
			string NAME += EXT
		endif
	else
		string NAME += EXT
	endif
	if QUIT != 1
		math SIZE += NEGBIAS
	endif
	if SIZE > 0x930
		callfunction CDXA 1
		math i += 1
	endif
	if QUIT != 1
		math OFFSET += SIZE
		set SEARCH OFFSET
		math SEARCH += 4
	endif
while QUIT != 1
```
## Post #293
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-17T13:27:45+00:00
- Post Title: Re: My quickBMS scripts

Electronic Arts AST archive extractor (BGFA identifier)
For those big ast archives with BGFA identifier. Only tested with BGFA version 1.05, but enough work to figure out the format, which was quite a hazzle because the length of the variables varies between archives, which is really uncommon. 
No file names but if getTYPE doesn't recognize the type the internal type is used as an extension (although I'm not entirely sure if that's really the file type  ). If you encounter any ast archive that doesn't work with this script or if you need other extensions implemented, post here. I've only looked for extensions that the games I tested use.
Newest func_getTYPE.bms needed!

```
# (c) 2012-09-17 by AlphaTwentyThree of XeNTaX

set SUBFOLDER 1
include "func_getTYPE.bms"
idstring "BGFA"
getDstring VER 4
if VER != "1.05"
	print "Unsupported BGFA version (%VER%)! Please contact me at XeNTaX"
endif
goto 0x21 # determine information per file
	get LENGTH_FTYPE byte # boolean (?)
	if LENGTH_FTYPE == 0
		set FTYPE == ""
		set SUBFOLDER 1
	endif
	get LENGTH_HASH byte
	get LENGTH_OFFSET byte
	get LENGTH_ZSIZE byte
	get LENGTH_SIZE byte # 0 -> only uncompressed data
	
	math LENGTH_INFO = 1
	math LENGTH_INFO += LENGTH_FTYPE
	math LENGTH_INFO += LENGTH_HASH
	math LENGTH_INFO += LENGTH_OFFSET
	math LENGTH_INFO += LENGTH_ZSIZE
	math LENGTH_INFO += LENGTH_SIZE
	if LENGTH_SIZE != 0
		set MULTI_OFF 0x10
		if LENGTH_OFFSET == 3
			set MULTI_OFF 4
		endif
		if LENGTH_ZSIZE == 0
			set MULTI_OFF 1
		endif
	endif

goto 0x10
get HEADER long
goto 0x28
get JUMP long
math JUMP *= 4

goto 0x18
get LENGTH_TOC long # file table plus unknown 4byte variable at start
math LENGTH_TOC -= HEADER
	#set FILES LENGTH_TOC
	#math FILES /= LENGTH_INFO
set OFF_INFO HEADER
math OFF_INFO += JUMP
goto 0xc
get FILES long
goto OFF_INFO

for i = 0 < FILES
    get DUMMY byte # always
	if LENGTH_FTYPE == 1
		get FTYPE byte
	endif
	if LENGTH_HASH == 8
		get HASH longlong
	elif LENGTH_HAS == 4
		get HASH long
	endif
	if LENGTH_OFFSET == 2
		get OFFSET short
	elif LENGTH_OFFSET == 3
		get OFFSET threebyte
	elif LENGTH_OFFSET == 4
		get OFFSET long
	endif
	if LENGTH_ZSIZE == 2
		get ZSIZE short
	elif LENGTH_ZSIZE == 3
		get ZSIZE threebyte
	elif LENGTH_ZSIZE == 4
		get ZSIZE long
	endif
	if LENGTH_SIZE == 2
		get SIZE short
	elif LENGTH_SIZE == 3
		get SIZE threebyte
	elif LENGTH_SIZE == 4
		get SIZE long
	endif
	math OFFSET *= MULTI_OFF
	putVarChr MEMORY_FILE ZSIZE 0
	log MEMORY_FILE 0 0
    if LENGTH_SIZE != 0 # if compressed data present
		if SIZE == 0
			log MEMORY_FILE OFFSET ZSIZE
		else
			math SIZE += ZSIZE
			
			clog MEMORY_FILE OFFSET ZSIZE SIZE
		endif
	else # only uncompressed data
		log MEMORY_FILE OFFSET ZSIZE
	endif
	savepos MYOFF
	callfunction getTYPE 1
	goto MYOFF
	get NAME basename
	string NAME += "_"
	string NAME += i
	if EXT == ""
		string NAME += "."
		string NAME += FTYPE
		if FTYPE == 11
			string NAME += ".xml"
		elif FTYPE == 0
			string NAME += ".xml"
		endif
	else
		string NAME += EXT
	endif
	set WNAME ""
	if SUBFOLDER == 1
		get WNAME basename
		string WNAME += "/"
	endif
	#string WNAME += FTYPE
	#string WNAME += "/"
	string WNAME += NAME
	get SIZE asize MEMORY_FILE
	log WNAME 0 SIZE MEMORY_FILE
next i
```
## Post #294
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-17T21:43:15+00:00
- Post Title: Re: My quickBMS scripts

Sega CD *.bin movie audio demuxer
I have no idea about the audio format, never seen something like that. The header doesn't hold any information about the audio data so currently I'm stuck with a raw demux feature.

```
# tested games:
# The Amazing Spider-Man vs. The Kingpin
#
# (c) 2012-07-17 by AlphaTwentyThree of XeNTaX

idstring "CONF"
endian big
set OFFSET 0
do
	goto OFFSET
	getDstring IDENT 4
	get SIZE long
	math OFFSET += 8
	math SIZE -= 8
	if IDENT == "AUDI"
		append
		log MEMORY_FILE OFFSET SIZE
		append
	endif
	math OFFSET += SIZE
while IDENT != "MEND"
get SIZE asize MEMORY_FILE
set OFFSET 0
get NAME basename
string NAME += ".raw"
log NAME OFFSET SIZE MEMORY_FILE
```
## Post #295
- Username: SnarbleBarb
- Rank: n00b
- Number of posts: 17
- Joined date: Thu Dec 15, 2011 4:24 pm
- Post datetime: 2012-07-18T20:33:14+00:00
- Post Title: Re: My quickBMS scripts

Hi AlphaTwentyThree,

Thanks so much for giving some attention to the EA .AST archives! I tried your AST script on NCAA Football '13 (XBOX360) and I'm having some errors extracting the files. 

"qkl_heisman1.AST" and "qkl_heisman2.AST" works great. They both spit out a bunch of .vp6 files. "qkl_interface.AST" spits out 618 smaller .AST files and a lot of system beeps. However,

"qkl_boot.AST" gives me the following error:

```
             <get MEMORY_FILE (27) "MEMORY_FILE"
             <get OFFSET (23) 0x00001890
             <get ZSIZE (25) 0x00000f92
             <get SIZE (26) 0x000037b3
- create a memory file from offset 00001890 of 14259 bytes

Error: the compressed zlib/deflate input is wrong or incomplete (-3)

Error: there is an error with the decompression
       the returned output size is negative (-1)

```


"qkl_fe2ig.AST" gives the same error:

```
             <get MEMORY_FILE (27) "MEMORY_FILE"
             <get OFFSET (23) 0x001abac4
             <get ZSIZE (25) 0x00000049
             <get SIZE (26) 0x0000005e
- create a memory file from offset 001abac4 of 94 bytes

Error: the compressed zlib/deflate input is wrong or incomplete (-3)

Error: there is an error with the decompression
       the returned output size is negative (-1)
```


"qkl_stream.AST" does the same with some added system beeps when it fails:

```
             <get MEMORY_FILE (27) "MEMORY_FILE"
             <get OFFSET (23) 0x092f3d60
             <get ZSIZE (25) 0x0000f551
             <get SIZE (26) 0x000c8c88
- create a memory file from offset 092f3d60 of 822408 bytes

Error: the compressed zlib/deflate input is wrong or incomplete (-3)

Error: there is an error with the decompression
       the returned output size is negative (-1)
```


For sanity's sake, I'm using quickbms.exe 0.5.13 in this manner: ">quickbms.exe -v ncaa.bms qkl_boot.AST outputfolder" where I named your script as ncaa.bms.

Any ideas of what I may have done wrong or how I can help you debug it?

Thanks!!
## Post #296
- Username: mono24
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2012-07-18T23:16:32+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Sega CD *.bin movie audio demuxer
I have no idea about the audio format, never seen something like that. The header doesn't hold any information about the audio data so currently I'm stuck with a raw demux feature.

Does [http://wiki.multimedia.cx/index.php?tit ... er-Man_BIN](http://wiki.multimedia.cx/index.php?title=Amazing_Spider-Man_BIN) help any with this format? (you may want to spend some time looking around this wiki, BTW; Multimedia Mike has reversed a huge number of audio/video formats and documented his findings there)
## Post #297
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2012-07-19T06:05:02+00:00
- Post Title: Re: My quickBMS scripts

> Reply from SnarbleBarb
>
> 
For sanity's sake, I'm using quickbms.exe 0.5.13 in this manner: ">quickbms.exe -v ncaa.bms qkl_boot.AST outputfolder" where I named your script as ncaa.bms.

Any ideas of what I may have done wrong or how I can help you debug it?

Thanks!!

try

```
quickbms -9 "ncaa.bms" "qkl_boot.AST" "C:\Out"
```
## Post #298
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-19T13:44:25+00:00
- Post Title: Re: My quickBMS scripts

Hm, well I got the same problem with the boot archive, but all the others worked fine. I don't have the image anymore so I can't research the problem with the boot file. There's one possibility though. You may change the script so that it doesn't try to decompress the files but just dumps the compressed files to disk and then use comtype_scan2 to figure out the compression used there. Another possibility could be that the script tries to decompress a file that isn't compressed, but then there would be something wrong with the script altogether. Maybe some variable length problem. That format basically just p***** me off. 
For your running question: I've linked *.bms files to open with QuickBMS, I don't use any options when running a script. Works fine for me that way.
## Post #299
- Username: SnarbleBarb
- Rank: n00b
- Number of posts: 17
- Joined date: Thu Dec 15, 2011 4:24 pm
- Post datetime: 2012-07-19T17:27:43+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Ekey
>
> 
try
Code: Select allquickbms -9 "ncaa.bms" "qkl_boot.AST" "C:\Out"

Thanks Ekey, but same output from that command.

> Reply from AlphaTwentyThree
>
> There's one possibility though. You may change the script so that it doesn't try to decompress the files but just dumps the compressed files to disk and then use comtype_scan2 to figure out the compression used there.

OK I tried this. I swapped this line:

```
clog MEMORY_FILE OFFSET ZSIZE SIZE
```


with

```
log MEMORY_FILE OFFSET ZSIZE
```


(I've tried SIZE instead of ZSIZE too, same output files)

qkl_fe2ig.AST and qkl_stream.AST both extracted into lots of files (with lots of system beeps!). I ran many of them through the comtype_scan2 and couldn't find anything that resembled a 4byte header in any of the output files. COMP_LZFU_RAW (#219) came the closest because the files had references to fonts (New Times Roman, Sans Serif, etc.) and colors (red, blue, etc.) in them in plain English, but no 4byte Header.

> Reply from AlphaTwentyThree
>
> I don't have the image anymore so I can't research the problem with the boot file.

If I can help with this, would you take a peek at the fe2ig and stream files? I don't know which one the models and textures are in... that's all that I want.

> Reply from AlphaTwentyThree
>
> That format basically just p***** me off.

I'm right there with ya!!!

Frustrated. What's the next step?
## Post #300
- Username: Apollo
- Rank: veteran
- Number of posts: 145
- Joined date: Sat Oct 21, 2006 7:58 pm
- Post datetime: 2012-07-22T13:18:17+00:00
- Post Title: Re: My quickBMS scripts

Just a small note on CDXA, there are actually XA files using 18,900khz stereo playback rates too than just 37,800Hz and 2 channels which is admittedly more common.

Like for example the PSX versions of C&C RA1.

As for ima adpcm header adder, you would need to add the various default block sizes as per each khz in default MS encoder.

mono
8khz/11khz/16khz= 256

22khz/32khz=512

44khz/48khz=1024

for stereo previous apply except double the block size so 8khz stereo=512

xbox adpcm uses always 36 mono or 72 stereo blocksizes regardless of khz but such small block sizes waste tons of space.

fact chunk can be left unwritten but the last field before it or data is sadly demanded by most players too except vlc.
## Post #301
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-22T13:43:48+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Apollo
>
> Just a small note on CDXA, there are actually XA files using 18,900khz stereo playback rates too than just 37,800Hz and 2 channels which is admittedly more common.

Like for example the PSX versions of C&C RA1.

As for ima adpcm header adder, you would need to add the various default block sizes as per each khz in default MS encoder.

mono
8khz/11khz/16khz= 256

22khz/32khz=512

44khz/48khz=1024

for stereo previous apply except double the block size so 8khz stereo=512

xbox adpcm uses always 36 mono or 72 stereo blocksizes regardless of khz but such small block sizes waste tons of space.

fact chunk can be left unwritten but the last field before it or data is sadly demanded by most players too except vlc.
OMG, thans a lot for all this information!!! I'll definitely look into implementing that! :):)
18,900khz stereo? Only encountered mono so far. Anyway, the header should be the same as channels and frequency isn't stated at all.
## Post #302
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-07-22T13:47:45+00:00
- Post Title: Re: My quickBMS scripts

Just updated my MSF converter by some variants and formats: [viewtopic.php?f=13&t=4450&p=43570#p43570](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=43570#p43570)
## Post #303
- Username: radical dreamer
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Sun Jul 15, 2012 7:16 pm
- Post datetime: 2012-07-22T17:15:10+00:00
- Post Title: Re: My quickBMS scripts

Darn, I was hoping the MSF converter update would successfully convert my msf's from Castlevania HoD (PS3) but it's giving me at3's that don't play and ss2's that give errors in MFAudio. ("Specified format is not supported or cannot be translated")

Here are some examples of msf's that I'm trying to convert if you have time to look at them.  [http://www.mediafire.com/?km5qeflgmzeep9j](http://www.mediafire.com/?km5qeflgmzeep9j)
And there are a bunch more I can provide if it interests you.
## Post #304
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-07T16:58:30+00:00
- Post Title: Re: My quickBMS scripts

18 Wheeler: American Pro Trucker (PS2) *.str extractor

```
# (c) 2012-08-07 by AlphaTwentyThree of XeNTaX

include "func_header_SS2.bms"
get FILES long
goto 0x10
for i = 1 <= FILES
	getDstring NAME 0x20
	get OFFSET long
	get SIZE long
	get UNK long
	get CH short
	get FREQ short
	get INTERLEAVE long
	callfunction SS2 1
next i
```
## Post #305
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-09T00:21:07+00:00
- Post Title: Re: My quickBMS scripts

UPDATE

Just made a major update for my [CPK/SEG movie 'FILM' id audio extractor (Saturn/Sega CD)](http://forum.xentax.com/viewtopic.php?f=13&p=71395#p71395).  The previous version eventually produced wrong results.
## Post #306
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-10T13:49:51+00:00
- Post Title: Re: My quickBMS scripts

The Animals! (Sega CD) - MEDIA.RES extractor

One of the few Sega CD games that doesn't contain audio tracks. The MEDIA.RES can only be extracted with IsoBuster as the file system is non-standard.
And yes, those *.seg movies can be demultiplexed with my tool. 

```
# (c) 2012-10-18 by AlphaTwentyThree of XeNTaX

goto 0x14
get BIAS long
math BIAS *= 0x800
goto 0x20
for i = 1 <= 0xa50
	getDstring NAME 0x10
	get OFFSET1 long
	get SIZE1 long
	get SIZE long
	get OFFSET long
	math OFFSET += BIAS
	log NAME OFFSET SIZE
next 
```
## Post #307
- Username: Graczdari
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Sat Mar 26, 2011 6:47 am
- Post datetime: 2012-08-14T01:24:32+00:00
- Post Title: Re: My quickBMS scripts

Welcome. Could you write a script that allows you to rework "PCM" to "msf"? or "PCM" to "AA3" and then "AA3" to "msf"? I really depend on that.

Thanks for possible help
## Post #308
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-16T09:19:35+00:00
- Post Title: Re: My quickBMS scripts

Darksiders II *.pck extractor

Don't forget the current func_getTYPE.bms: [viewtopic.php?f=13&p=69577#p69577](http://forum.xentax.com/viewtopic.php?f=13&p=69577#p69577)

```
# (c) 2012-08-16 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
idstring "AKPK"
get BNAME basename
string BNAME += "_"
endian big
goto 0xc
get INFO long
math INFO += 0x20
goto INFO
for i = 1
	get DUMMY long # 0/1
	get NAME_CRC long
	if NAME_CRC == 0
		cleanexit
	endif
	get MULTI long
	get SIZE long
	get OFFSET long
	math OFFSET *= MULTI
	string NAME_CRC p= "%08x" NAME_CRC
	set NAME BNAME
	string NAME += i
	string NAME += "_0x"
	string NAME += NAME_CRC
	log MEMORY_FILE OFFSET SIZE
	savepos MYOFF 0
	callfunction getTYPE 1
	endian big
	goto MYOFF 0
	string NAME += EXT
	log NAME 0 SIZE MEMORY_FILE
next i
```
## Post #309
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2012-08-16T12:32:11+00:00
- Post Title: Re: My quickBMS scripts

Hello alpha can you post the full auto 2 script you sent me a while back?
## Post #310
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-16T19:33:47+00:00
- Post Title: Re: My quickBMS scripts

Wave cue extractor and injector

Needed when decoding from non-standard wave headers to save the cue marker section. Can be imported with the second script later-on.
Very practical if you want to add comments to a compressed file, e.g. mp3 or ogg. Just take the decoded file, add your markers and export them. You can later on decode the compressed file again and inject the markers from before. Works with every marker type.
Also needed when working with rifx files from the Wwise system as RIFX files containing ogg streams can contain markers. So to get the markers to their correct positions, you just need to extract them from the original rifx, transform the rifx with ww2ogg and revorb, decode the ogg to wav and inject the cue markers again. 

Extractor:

```
# RIFF and RIFX header supported
# (c) 2012-08-16 by AlphaTwentyThree of XeNTaX

getDstring HEAD 4
if HEAD == "RIFX"
	endian big
endif

get NAME basename
string NAME += ".cue"

FindLoc OFFSET1 string "cue" 0 ""
if OFFSET1 != ""
	goto OFFSET1
	idstring "cue "
	get SIZE1 long
	math SIZE1 += 0x8
	set OFFSET2 OFFSET1
	math OFFSET2 += SIZE1
	goto OFFSET2
	getDstring LIST_test 0x4
	set SIZE SIZE1
	if LIST_test = "LIST"
		get SIZE2 long
		math SIZE2 += 0x8
		math SIZE += SIZE2
	endif
	set OFFSET OFFSET1
	log NAME OFFSET SIZE
endif
```


Injector:

```
# (c) 2012-08-16 by AlphaTwentyThree of XeNTaX


get NAME basename 0
string NAME += ".cueold"
FindLoc OFFSET string "cue " 0 ""
if OFFSET != ""
   get SIZE asize 0
   math SIZE -= OFFSET
   log NAME OFFSET SIZE
else
   get SIZE asize
endif
log MEMORY_FILE 0 SIZE
open FDDE CUE 1
get CSIZE asize 1
append
log MEMORY_FILE 0 CSIZE 1
append
get NAME filename  0
math SIZE += CSIZE
set RIFFSIZE SIZE
math RIFFSIZE -= 8
putVarChr MEMORY_FILE 4 RIFFSIZE long
log NAME 0 SIZE MEMORY_FILE
```
## Post #311
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-16T19:43:47+00:00
- Post Title: Re: My quickBMS scripts

Sleeping Dogs (Xbox 360) - SFX.pck extractor

First folder contains sfx, the second one music and ambients.

```
# (c) 0212-08-16 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
idstring "AKPK"
endian big
goto 0x28
set FOLDER "SFX_1/"
callfunction extract_folder 1
goto 0x3dac
set FOLDER "SFX_2/"
callfunction extract_folder 1


startfunction extract_folder
	get FILES long
	for i = 1 <= FILES
		get NAME_CRC long
		get MULTI long
		get ZERO long
		get SIZE long
		get OFFSET long
		get ZERO long
		math OFFSET *= MULTI
		putVarChr MEMORY_FILE SIZE 0
		log MEMORY_FILE 0 0
		log MEMORY_FILE OFFSET SIZE
		callfunction getTYPE 1
		get NAME basename
		set WNAME FOLDER
		string NAME_CRC p= "%08x" NAME_CRC
		string NAME += "_"
		string NAME += i
		string NAME += "_0x"
		string NAME += NAME_CRC
		string NAME += EXT
		endian big
		string WNAME += NAME
		log WNAME OFFSET SIZE
	next i
endfunction
```
## Post #312
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-20T21:14:53+00:00
- Post Title: Re: My quickBMS scripts

Zak & Jack in Showdown at Monstertown (PC, 2006) - resources.pak extractor

```
# (c) 2012-08-20 by AlphaTwentyThree of XeNTaX

get DUMMY long
get FILES long
get NAMEOFF long
math NAMEOFF += 0x10
get ZERO long
for i = 1 <= FILES
	get NAMEL long
	get OFFSET long
	get SIZE long
	get ZSIZE long
	get ZERO long
	savepos MYOFF
	goto NAMEOFF
	getDstring NAME NAMEL
	savepos NAMEOFF
	if SIZE == ZSIZE
		log NAME OFFSET SIZE
	else
		clog NAME OFFSET SIZE ZSIZE
	endif
	goto MYOFF
next i
```
## Post #313
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-26T22:54:48+00:00
- Post Title: Re: My quickBMS scripts

Just found out that my pak script for Jagged Alliance: Back in Action also works for the new Jagged Alliance: Crossfire!
## Post #314
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-27T19:36:19+00:00
- Post Title: Re: My quickBMS scripts

MJZ extractor
If anyone encounters another game that uses this format, let me know. 

```
# (c) 2012-08-27 by AlphaTwentyThree of XeNTax

comtype "COMP_ZLIB_NOERROR"
idstring "MJZ0"
get UNK long
get FILES long
get ENTRIES long
for i = 1 <= FILES
	get TYPE long
	get OFFSET long
	get DSIZE long
	get CSIZE long
	get NAMEL byte
	getDstring NAME NAMEL
	if TYPE == 0
		log NAME OFFSET DSIZE
	elif TYPE == 0xa
		clog NAME OFFSET CSIZE DSIZE
	endif
next i
```
## Post #315
- Username: aluigi
- Rank: VVIP member
- Number of posts: 1916
- Joined date: Thu Dec 08, 2005 7:26 pm
- Post datetime: 2012-08-27T19:43:47+00:00
- Post Title: Re: My quickBMS scripts

MJZ0 is used for Mumbo Jumbo archives, I have a complete script for them supporting all the known variants:
[http://aluigi.org/papers/bms/mumbojumbo.bms](http://aluigi.org/papers/bms/mumbojumbo.bms)
## Post #316
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-28T14:45:05+00:00
- Post Title: Re: My quickBMS scripts

hehe, cool - will change the link in the topic starter.
## Post #317
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-28T16:27:59+00:00
- Post Title: Re: My quickBMS scripts

Unity3D Engine *.assets extractor

Couldn't find an extractor anywhere, so I wrote my own.  Long overdue but wasn't motivated enough to go through the pain of the format. 
If you experience any problems, pm me and I'll take a look. The outsorted file types are only the ones I found.
Else, if anyone can identify some of the missing extensions, I'd be grateful!

lateste updates:
- if type 49 contains png or xml, it is recognized and the size adjusted
- included variant with file tale at the end (some resources.assets use those)
- mp3 detection included

```
# (c) 2012-10-15 by AlphaTwentyThree of XeNTaX

get EXT extension
if EXT == "resS" # no TOC -> scan
	cleanexit
endif
endian big
get FSIZE asize

goto 0xc
get BIAS long
if BIAS != 0 # var1
	endian little
	goto 0x28
	get FILES long
else # var2
	goto 0
	get INFOSIZE long
	get INFO long # actually file size
	math INFO -= INFOSIZE
	math INFO += 0x15
	goto INFO
	endian little
	get FILES long
endif

for i = 1 <= FILES
	set SKIP 0
	set EXT ""
	set FNAME ""
	set WNAME ""
	get FID long
	get OFFSET long
	math OFFSET += BIAS # zero in var2
	get SIZE long
	get TYPE long
	get DUMMY long # same as TYPE (?)
	savepos MYOFF
	callfunction distTYPE 1
	if SKIP == 0
		if EXT = ""
			set EXT "."
			string EXT += TYPE
		endif
		get FOLDERNAME basename
		string FOLDERNAME += "/"
		if FNAME == ""
			get FNAME basename
			string FNAME += "_"
			string FNAME += FID
		endif
		string FNAME += EXT
		set WNAME FOLDERNAME
		string WNAME += FNAME
		if FID == FILES # probably not needed, just a precaution
			get SIZE asize
			math SIZE -= OFFSET
		endif
		log WNAME OFFSET SIZE
	endif
	goto MYOFF
next i

startfunction distTYPE
	if TYPE == 1
		elif TYPE == 2
		elif TYPE == 3
		elif TYPE == 4
		elif TYPE == 5
		elif TYPE == 6
		elif TYPE == 7
		elif TYPE == 8
		elif TYPE == 9
		elif TYPE == 10
		elif TYPE == 11
		elif TYPE == 12
		elif TYPE == 13
		elif TYPE == 14
		elif TYPE == 15
		elif TYPE == 16
		elif TYPE == 17
		elif TYPE == 18
		elif TYPE == 19
		elif TYPE == 20
		elif TYPE == 21
			callfunction getname 1
			set EXT ".mat"
		elif TYPE == 23
		elif TYPE == 26
		elif TYPE == 28
			callfunction getname 1
			set EXT ".tex"
		elif TYPE == 33
		elif TYPE == 43
			callfunction getname 1
		elif TYPE == 48
			callfunction getname 1
			set EXT ".shader"
			goto OFFSET
			get SIZE long
			math OFFSET += 4
		elif TYPE == 49 # ingame movies/xml/backgrounds
			callfunction getname 1
			callfunction getType 1
		elif TYPE == 54
		elif TYPE == 64
		elif TYPE == 65
		elif TYPE == 74
			callfunction getname 1
			set EXT ".ani"
		elif TYPE == 82
		elif TYPE == 83 # can be empty (some pointer maybe)
			callfunction getname 1
			set TEST SIZE
			math TEST -= 0x18
			if TEST == 0
				set SKIP 1
			else
				math OFFSET += 0x10
				goto OFFSET
				get SIZE long
				savepos OFFSET
				getDstring TYPE2 3
				if TYPE2 == "RIF"
					set EXT ".wav"
				elif TYPE2 == "Ogg"
					set EXT ".ogg"
				elif TYPE2 == "ID3"
					set EXT ".mp3"
				else
					goto OFFSET
					get TYPE2 byte
					if TYPE2 == 0xff
						set EXT ".mp3"
					endif
				endif
			endif
		elif TYPE == 89
			callfunction getname 1
		elif TYPE == 96
		elif TYPE == 108
		elif TYPE == 111
		elif TYPE == 115
			callfunction getname 1
		elif TYPE == 123
		elif TYPE == 128
			callfunction getname 1
			set EXT ".ttf"
		elif TYPE == 131
		elif TYPE == 135
		elif TYPE == 150
		elif TYPE == 152
			callfunction getname 1
			math OFFSET += 0x10
			math SIZE -= 0x10
			set EXT ".ogm"
		elif TYPE == 159
			callfunction getname 1
		elif TYPE == 198
		elif TYPE == 199
		elif TYPE == 3584 # last file
		else
	endif
endfunction
	
startfunction getname
	goto OFFSET
	get NAMEL long
	set TEST NAMEL
	math TEST %= 4
	if TEST != 0 # round to next 4byte
		math NAMEL /= 4
		math NAMEL += 1
		math NAMEL *= 4
	endif
	getDstring FNAME NAMEL
	savepos NBIAS
	math NBIAS -= OFFSET
	math OFFSET += NBIAS
	math SIZE -= NBIAS
endfunction

startfunction getType
	goto OFFSET
	get DUMMY long
	get TYPE long
	if TYPE == 0x6d783f3c
		math OFFSET += 4
		set SIZE DUMMY
		set EXT ".xml"
	elif TYPE == 0x474e5089
		math OFFSET += 4
		set SIZE DUMMY
		set EXT ".png"
	endif
endfunction
```
## Post #318
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-28T17:34:11+00:00
- Post Title: Re: My quickBMS scripts

XOR test

Just writes the first 2KB of a given file with 1 < XOR < 256 to determine the needed setting for a future parser more easily. You can change the setting if you want to.
Exremely simple script practically not really worth posting - but for those who are totally lost, get it here. 

```
	filexor i
	get NAME basename
	string NAME += "_xor"
	string NAME += i
	log NAME 0 0x1000
next i
```
## Post #319
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-08-30T11:49:25+00:00
- Post Title: Re: My quickBMS scripts

Dark Souls bdt/bhd5 extractor

This is the same type of archive than the one used in Armored Core V, just little endian. Somehow I got an error with the old script minus the "endian big", so I wrote a new one which works. 
Be sure to grab the newest func_getTYPE.bms ([viewtopic.php?f=13&p=69577#p69577](http://forum.xentax.com/viewtopic.php?f=13&p=69577#p69577)) - I've added new formats and corrected one stupid error which prevented a bunch of formats to be recognized.

```
# tested on: Dark Souls: Prepare to Die Edition (PC, X360)
# NOTE: make sure both bdt and bht5 files have the same name before running the script!
#
# (c) 2012-10-31 by AlphaTwentyThree of XeNTaX

set X360 1
include "func_getTYPE.bms"
open FDDE bhd5 0
open FDDE bdt 1

if X360 == 1
	endian big
endif

idstring "BHD5" 0
get UNK long 0 # 00000000 (?)
get FOLDERS long 0
get NOF long 0 # number of files (not needed for loop)
get GROUPS long 0
get UNK long 0
for i = 1 <= GROUPS
	get FIG long 0 # files in group/folder
	get OFF_INFO long 0
	savepos MYOFF 0
	goto OFF_INFO 0
	for j = 1 <= FIG
		get NAME_CRC long 0
		get SIZE long 0
		get OFFSET long 0
		get ZERO long 0
		if X360 == 1
			set OFFSET ZERO
		endif
		get FOLDER basename 0
		string FOLDER += "/"
		set NAME i
		string NAME += "_"
		string NAME += j
		string NAME += "_"
		string NAME_CRC p= "0x%08x" NAME_CRC
		string NAME += NAME_CRC
		putVarChr MEMORY_FILE SIZE 0
		log MEMORY_FILE 0 0
		log MEMORY_FILE OFFSET SIZE 1
		callfunction getTYPE 1
		if X360 == 1
			endian big
		endif
		string NAME += EXT
		set WNAME FOLDER
		string WNAME += NAME
		log WNAME 0 SIZE MEMORY_FILE
	next j
	goto MYOFF 0
next i
```
## Post #320
- Username: nitoiviorel
- Rank: beginner
- Number of posts: 21
- Joined date: Fri Oct 07, 2011 6:37 pm
- Post datetime: 2012-09-03T06:17:04+00:00
- Post Title: Re: My quickBMS scripts

THANKS
## Post #321
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-03T18:59:51+00:00
- Post Title: Re: My quickBMS scripts

file deinterleaver (new version)

Split files into alternating blocks of the same size. Used when manipulating audio formats with more than one channel. E.g. stereo wave streams have an interleave of 2 bytes, i.e. each two bytes the channel information switches 2xL,2xR,2xL and so on. The blocksize of this structure would be 4 (two times the interleave size). If the stream has four channels, the interleave would stay at 2, but the blocksize would be 8. So if you split the channels you need to deinterleave the file and this script does exactly that, according to the parameters you set.
Additionally you can specify a SKIP variable, which denotes an area at the start of each block not to process during the deinterleaving. A good example is the "disguised" Playstation ADPCM format in some Electronic Arts PS2 games, where some dummy marker is set each block. So, just set the layer count to one and adjust the SKIP variable.

This is an extremely powerful script! Play around with different files to get the idea what you can do with this. Most common use is channel splitting, but you can do all kinds of adjustments to your files. Easiest example would be to split audio formats into mono channels, splitting multichannel files into stereo pairs or deleting regularly occurring chunks of data inside a file.

This is a long overdue update of my [old deinterleave script](http://forum.xentax.com/viewtopic.php?f=13&p=39344#p39344), which was rather cryptic and above all really really slow. This new one boosts the running time x300 and has some additional options:
- you can choose to add the original header to the deinterleaved files
- the header can be manipulated
- the variables are now better to understand (just header, blocksize, interleave size, layer and skip)

UPDATE 2016-05-16

The script now supports incomplete last blocks! 


Here's a little example

Source file:
- header of 0x10 bytes
- four channels
- 4 byte dummy each 0x14 bytes
- you want to split the channels and know that one complete block is 0x14 bytes

Variables to set:
- HEADER 0x10
- SKIP 4
- LAYERS 4
- BLOCKSIZE 0x14 (alternatively BLOCKSIZE 0 and INTSIZE 4)
- to add the original header to each deinterleaved file, set PRESERVE to 1
- leave ADJUST at 0 if you're not familiar with QuickBMS

Let's say we have the same file, but the dummy occur for every channel interleave block. Then we have to run the script two times:
- first run, delete the dummy bytes: HEADER 0x10, PRESERVE 1, SKIP 4, LAYERS 1, BLOCKSIZE 0, INTSIZE 0x14 (or BLOCKSIZE 0x50) -> produces one smaller file
- second run, deinterleave channels: HEADER 0x10, PRESERVE 1, SKIP 0, LAYERS 4, BLOCKSIZE 0x40 (or 0 and INTSIZE 0x10) -> produces four files which are exactly 1/4th of the above file

```
# (c) 2016-05-16 by AlphaTwentyThree of XeNTaX

# notes:
# HEADER - area which is untouched by the deinterleaving
# PRESERVE 0/1			-	set to 1 to write the skipped area from 
#            				HEADER to each deinterleaved file
# ADJUST 0/1 			- 	if the header needs to be adjusted, set 
#              				this to 1 and write your code to the function 
#              				"adjustheader" at the end of this script
# SPLIT_LAST_BLOCK 0/1	-	set to 1 to split an incomplete last block equally 
#							between layers. If set to 0, the script will ter-
#							minate if it finds an incomplete last block.
#							HANDLE WITH CARE!
# BLOCKSIZE 			-	size of one complete interleave block 
# LAYERS				-	the numbers of (equal-sized) files you want 
#							to deinterleave to
# SKIP					-	number of bytes to skip at the start of each block
#
# examples:
# split channels of stereo wave file: # HEADER 0x2c, PRESERVE 1, ADJUST 1 (adjust function), BLOCKSIZE 4, LAYERS 2, SKIP 0
# leave out 2 bytes each 0x10 bytes: # BLOCKSIZE 0x10, LAYERS 1, SKIP 2
# split channels of Playstation ADPCM file: # HEADER 0x2c, PRESERVE 1, ADJUST 1 (adjust function), BLOCKSIZE 2*Interleave, SKIP 0

set HEADER 0xe0 # zero if skip is at end of block, otherwise = first skip at start
set PRESERVE 0
set ADJUST 0
set SPLIT_LAST_BLOCK 1
set BLOCKSIZE 0 # size of one complete block
set INTSIZE 0x5800 # if BLOCKSIZE is set to 0, the interleave size is taken to calculate the blocksize
set LAYERS 2
set SKIP_START 0 # area at start of each block to skip
set SKIP_END 0 # area at end of each block to skip

if BLOCKSIZE == 0
	xmath BLOCKSIZE "(INTSIZE * LAYERS) + SKIP_START + SKIP_END"
endif
if INTSIZE == 0
	xmath INTSIZE "BLOCKSIZE / LAYERS"
endif

xmath WSIZE "(BLOCKSIZE - SKIP_START - SKIP_END) / LAYERS" # data to write: (BLOCKSIZE - SKIP_START - SKIP_END)/LAYERS
get CYCLES asize
xmath CYCLES "(CYCLES - HEADER) / BLOCKSIZE"

get LASTBLOCK asize
xmath LASTBLOCK "(LASTBLOCK - HEADER) % BLOCKSIZE"
xmath LASTINT "LASTBLOCK / LAYERS"

callfunction testparameters 1
get EXT extension
callfunction deinterleave

startfunction testparameters
	# test 1: (BLOCKSIZE-SKIP_START-SKIP_END)/LAYERS must be integer (one block must be dividable into skip and layers)
	xmath TEST "BLOCKSIZE - SKIP_START - SKIP_END"
	math TEST %= LAYERS # single layer -> always ok
	if TEST != 0
		print "Error: blocksize minus skip isn't dividable by layer count! Aborting..."
		cleanexit
	endif
	
	# test 2: test for incomplete last block
	get TEST asize
	math TEST -= HEADER
	math TEST %= BLOCKSIZE
	if TEST != 0
		if SPLIT_LAST_BLOCK == 1
			print "Warning: file size minus header isn't dividable by blocksize! Last block will be equally split between layers!"
			print "Last chunks will have size of %LASTINT% bytes each."
		else
			print "ERROR: file size minus header isn't dividable by blocksize! Aborting..."
			cleanexit
	endif
	
	# test 3: ASIZE-HEADER-BLOCKSIZE must be greater null (at least one deinterleave cycle)
	get TEST asize
	xmath TEST "TEST - HEADER - BLOCKSIZE"
	if FSIZE <= 0
		print "Error: file too small to deinterleave! Aborting..."
		cleanexit
	endif
endfunction
	
startfunction deinterleave
	xmath PSIZE "CYCLES * WSIZE + LASTINT"
	if PRESERVE == 1
		math PSIZE += HEADER
		goto 0
		getDstring HDATA HEADER
	endif
	
	
	for i = 1 <= LAYERS
		putVarChr MEMORY_FILE PSIZE 0
		log MEMORY_FILE 0 0
		get NAME basename
		string NAME += "_"
		string NAME += i
		if PRESERVE == 1
			putDstring HDATA HEADER MEMORY_FILE
			string NAME += "."
			string NAME += EXT
		endif
		xmath BIAS_A "(i - 1) * WSIZE + SKIP_START"# bias at start
		xmath BIAS_B "BLOCKSIZE - BIAS_A - WSIZE" # bias at end
	
		xmath RES_BIAS_A "(i - 1) * LASTINT + SKIP_START"
		xmath RES_BIAS_B "LASTBLOCK - RES_BIAS_A - LASTINT"
		goto HEADER
		for k = 1 <= CYCLES
			getDstring DUMMY BIAS_A
			getDstring WDATA WSIZE
			putDstring WDATA WSIZE MEMORY_FILE
			getDstring DUMMY BIAS_B
		next k
		if LASTBLOCK != 0
			getDstring DUMMY RES_BIAS_A
			getDstring WDATA LASTINT
			putDstring WDATA LASTINT MEMORY_FILE
			getDstring DUMMY RES_BIAS_B
		endif
		get SIZE asize MEMORY_FILE
		if ADJUST == 1
			callfunction adjustheader 1
		endif
		log NAME 0 SIZE MEMORY_FILE
	next i
endfunction

startfunction adjustheader
	putVarChr MEMORY_FILE 0x10 1 long
	get SSIZE asize MEMORY_FILE
	math SSIZE -= HEADER
	putVarChr MEMORY_FILE 0x24 SSIZE long
endfunction

```
## Post #322
- Username: mono24
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2012-09-03T22:32:13+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> file deinterleaver (new version)

Also long overdue update of my deinterleave script, which was rather cryptic and above all really really slow. This new one boosts the running time x300 and has some additional options:
- you can choose to add the original header to the deinterleaved files
- the header can be manipulated
- the variables are now better to understand (just header, blocksize, layer and skip)
This is an extremely powerful script! Play around with different files to get the idea what you can do with this. Most common use is channel splitting, but you can do all kinds of adjustments to your files. Easiest example would be to split audio formats into mono channels, e.g. Playstation ADPCM files.

Perhaps link to your old one, for learning/comparison/case study purposes (assuming there's anyone interested in such a thing)?
## Post #323
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-03T23:55:02+00:00
- Post Title: Re: My quickBMS scripts

Done so in the text. Quite embarassing looking at my coding back then.  So many improvements now! =)
## Post #324
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-04T00:33:50+00:00
- Post Title: Re: My quickBMS scripts

If anyone is interested, I've added a link to my topic with tips how to speed up your scripts. It can be found here: [viewtopic.php?f=13&t=9594](http://forum.xentax.com/viewtopic.php?f=13&t=9594)  Hope that helps some people.
## Post #325
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-04T12:21:29+00:00
- Post Title: Re: My quickBMS scripts

Just corrected the at3_to_aa3 script. Seemed to have some serious mistake... Also added pre-allocation although you'll probably only notice the difference when converting large amounts of at3 files.
## Post #326
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2012-09-04T16:53:29+00:00
- Post Title: Re: My quickBMS scripts

Alpha pertaining to your updated deinterleaving script would there be a possible option to add a scanning function to determine if the file's interleave possibly changes to another interleave cycle and the option can also print out the offset where we would need to cut the file segment with the new interleave?
## Post #327
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-05T00:23:04+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> Alpha pertaining to your updated deinterleaving script would there be a possible option to add a scanning function to determine if the file's interleave possibly changes to another interleave cycle and the option can also print out the offset where we would need to cut the file segment with the new interleave?
How should that work? There's absolutely NO way to determine such an extremely generic thing automatically.
## Post #328
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2012-09-05T18:13:59+00:00
- Post Title: Re: My quickBMS scripts

Your right.

Oh well maybe it can Print out the difference in size if its not divisible by the given blocksize/interleave?
## Post #329
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-05T19:20:09+00:00
- Post Title: Re: My quickBMS scripts

> Reply from OrangeC
>
> Your right.

Oh well maybe it can Print out the difference in size if its not divisible by the given blocksize/interleave?
Sure, just add %TEST% somwhere inside the two error print commands.
## Post #330
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-14T13:03:38+00:00
- Post Title: Re: My quickBMS scripts

XIII Century *.pak extractor

Easy format that can be used to get aquainted to QuickBMS. =)

```
# (c) 2012-09-14 by AlphaTwentyThree of XeNTaX

idstring "PACK"
get ZERO long
get INFO long
get ZERO long
get FILES long
goto INFO
for i = 1 <= FILES
	get OFFSET long
	get ZERO long
	get SIZE long
	get ZERO long
	get NAMEL long
	math NAMEL -= 1
	get UNK long # always 2?
	get UNK byte # always 0x2e?
	getDstring NAME NAMEL
	log NAME OFFSET SIZE
next i
```
## Post #331
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-17T13:14:23+00:00
- Post Title: Re: My quickBMS scripts

Just made a really extensive update for both the [EA ast extractor](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=75711#p75711) and [func_getTYPE.bms](http://forum.xentax.com/viewtopic.php?f=13&p=69577#p69577) (faster and more sophisticated)! Extreme enhancements FTW!
## Post #332
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-21T16:02:33+00:00
- Post Title: Re: My quickBMS scripts

The script for the Unity3D engine was somewhat faulty, so I made some major updates: [viewtopic.php?f=13&t=4450&p=77959#p77959](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=77959#p77959)
I'm not sure about the internal "type", this could also be some folder because e.g. type 49 contains various types of files. Inside the script you find a list of types I've encountered so far and as I'm no specialist in this and don't recognize certain types, it would be cool if you contribute here and tell me some of the types I haven't adjusted the extraction process yet.
## Post #333
- Username: AlphaTwentyThree
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2012-09-21T19:54:05+00:00
- Post Title: Re: My quickBMS scripts

Also put a spot light on Facebook [http://www.facebook.com/permalink.php?s ... 8469022795](http://www.facebook.com/permalink.php?story_fbid=431091233594901&id=143458469022795)
## Post #334
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-22T15:06:24+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Mr.Mouse
>
> Also put a spot light on Facebook http://www.facebook.com/permalink.php?s ... 8469022795
Yay!
## Post #335
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-25T09:38:20+00:00
- Post Title: Re: My quickBMS scripts

Raw Activision BAF extractor

This script will just append the data to the header info at the start of the baf archive and write it to disk for post-processing. This is practical if the audio format can't e played yet but you want to extract the baf files nevertheless, e.g. Sony ADPCM variant from 007: Blood Stone (PC).

```
# this script only extracts the raw data from baf files (header, cue markers, stream data)
# to be used for later post-processing of the contained audio files (saved as *.wavl)
# (c) 2012-09-25 by AlphaTwentyThree of XeNTaX

idstring "BANK"
get SINFO long
if SINFO != 0x34
	endian big
	reverselong SINFO
endif
get UNK long
get FILES long
goto SINFO
savepos HOFF
for i = 1 <= FILES
	idstring "WAVE"
	get HSIZE long
	get UNK0 long
	getDstring NAME 0x20
	get SOFF long # stream start
	math SOFF -= 8
	get SSIZE long
	set COFF HOFF
	math COFF += HSIZE
	goto COFF
	getDstring CID 4
	if CID == "CUE "
		get CSIZE long
	else
		set CSIZE 0
	endif
	set SIZE HSIZE
	math SIZE += CSIZE
	math SIZE += SSIZE
	putVarChr MEMORY_FILE SIZE 0
	log MEMORY_FILE 0 0
	goto HOFF
	getDstring HDATA HSIZE
	putDstring HDATA HSIZE MEMORY_FILE
	if CSIZE != 0
		goto COFF
		getDstring CDATA CSIZE
		putDstring CDATA CSIZE MEMORY_FILE
	else
		set CSIZE 0
	endif
	goto SOFF
	getDstring SDATA SSIZE
	putDstring SDATA SSIZE MEMORY_FILE
	string NAME += ".wavel"
	log NAME 0 SIZE MEMORY_FILE
	math HSIZE += CSIZE
	math HOFF += HSIZE
	goto HOFF
next i
```
## Post #336
- Username: mono24
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2012-09-25T19:56:38+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Code: Select all# (c) 2021-09-25 by AlphaTwentyThree of XeNTaX
Time traveling now, are we?
## Post #337
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-25T21:46:41+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Dinoguy1000
>
> AlphaTwentyThree wrote:Code: Select all# (c) 2021-09-25 by AlphaTwentyThree of XeNTaX
Time traveling now, are we?
See, THAT'S how advanced my scripts are!
## Post #338
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-09-30T21:34:32+00:00
- Post Title: Re: My quickBMS scripts

Just added ogm video detection to my [Unity3D engine](http://forum.xentax.com/viewtopic.php?f=13&p=77959#p77959) script!
## Post #339
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-01T23:03:01+00:00
- Post Title: Re: My quickBMS scripts

Turok: Evolution *.tre extractor

This doesn't look so special, but believe me, it was really some hazzle to figure out the format because the files in the TOC are sorted by file crc and din't have any names. I ran many many tests - and finally found a file with the file names (sorted by offset, so the new sortarray function came it pretty handy  ) 
This is a script I'm really really proud of! 
(Just for your info: The old script from some years only extracted the files without names.)

```
# note: CORRECT NAMES!!!
# (c) 2012-10-02 by AlphaTwentyThree of XeNTaX

get FILES long
for i = 0 < FILES
	get OFFSET long
	get SIZE long
	get DATA_CRC long
	get NAME_CRC long
	putArray 0 i OFFSET
	putArray 1 i SIZE
next i
print "sorting array"
sortarray 0 1
getArray NAMEOFF 0 2
goto NAMEOFF
for i = 0 < FILES
	getCT NAME string 0x0d
	get DUMMY byte
	getArray OFFSET 0 i
	getArray SIZE 1 i
	log NAME OFFSET SIZE
next i
```

Just for completeness' sake, here's the version for archives where no names are given. Note that sorting is still needed. Needs the newest func_getTYPE.bms (see link list)

```
# note: for the main STREE.TRE use my other script!
# (c) 2012-10-02 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
get FILES long
for i = 0 < FILES
	get OFFSET long
	get SIZE long
	get DATA_CRC long
	get NAME_CRC long
	putArray 0 i OFFSET
	putArray 1 i SIZE
	putarray 2 i NAME_CRC
next i
print "sorting array"
sortarray 0 1
get BNAME basename
string BNAME += "_"
for i = 0 < FILES
	getArray OFFSET 0 i
	getArray SIZE 1 i
	getArray CRC 2 i
	putVarChr MEMORY_FILE SIZE 0
	log MEMORY_FILE 0 0
	append
	log MEMORY_FILE OFFSET SIZE
	append
	string CRC p= "_0x%08x" CRC
	set NAME BNAME
	string NAME += i
	string NAME += CRC
	callfunction getTYPE 1
	if EXT != ""
		string NAME += EXT
	endif
	log NAME 0 SIZE MEMORY_FILE
next i
```
## Post #340
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-01T23:58:06+00:00
- Post Title: Re: My quickBMS scripts

PS2 stereo vag (AAAp) to ss2 converter

I don't know the actual extension of the files (extracted, no names given), I guess it's also *.vag, only stereo. Could easily be included in vgmstream if someone knows the original extension.
Don't forget to put the func_header.bms ([viewtopic.php?f=13&p=44717#p44717](http://forum.xentax.com/viewtopic.php?f=13&p=44717#p44717)) in the same directory - as always. 

```
# (c) 2012-10-02 by AlphaTwentyThree of XeNTaX

include "func_header_SS2.bms"
idstring "AAAp"
get INTERLEAVE short
get CH short
goto 0x1a
get FREQ short
reverseshort FREQ
set OFFSET 0x68
get SIZE asize
math SIZE -= OFFSET
set NAME ""
callfunction SS2 1
```
## Post #341
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-07T18:30:15+00:00
- Post Title: Re: My quickBMS scripts

Improvements never stop: Updated the Unit3D extractor by mp3 detection and included an archive variant sometimes used by the big resources.assets. Just encountered in Frederic: Resurrection of Music (Mac, 2012)
Find the updated script here: [viewtopic.php?f=13&t=4450&p=77959#p77959](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=77959#p77959) =)
## Post #342
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-08T18:47:50+00:00
- Post Title: Re: My quickBMS scripts

Electronic Arts *.big extractor

I know there are many different archives in use by EA - this is one of them at least (identifier "BE"). For the PC version, just delete the "endian big" - I guess. 
Nice example for the use of the array, which comes in quite handy here. Thanks Luigi for the implementation of the chunklzx unpack function. 

```
# tested with NHL 13 (X360)
# (c) 2012-10-08 by AlphaTwentyThree of XeNTaX

comtype xmemdecompress
idstring \x45\x42\x00\x03
endian big
goto 4
get FILES long
get UNK long # some size
get OFF_NAMES long # plus random bias of zeros
get SIZE_NAMES long
get NAMEL_FILE byte
get NAMEL_FOLDER byte
get ZERO byte
get FOLDERS byte
set OFF_FOLDERS FILES
math OFF_FOLDERS *= NAMEL_FILE
math OFF_FOLDERS += OFF_NAMES
math OFF_FOLDERS x= 0x10 # round to next 0x10 bytes
math NAMEL_FILE -= 2 # short for folder number

goto 0x30
for i = 1 <= FILES
	get OFFSET long
	math OFFSET *= 0x10
	get ZERO long
	get SIZE long
	get HASH long
	putArray 0 i OFFSET
	putArray 1 i SIZE
next i
goto OFF_NAMES
for i = 1 <= FILES
	get FOLDER_NUMBER short
	getDstring NAME NAMEL_FILE
	savepos MYOFF
	set OFF_FOLDERNAME FOLDER_NUMBER
	math OFF_FOLDERNAME *= NAMEL_FOLDER
	math OFF_FOLDERNAME += OFF_FOLDERS
	goto OFF_FOLDERNAME
	getDstring FOLDER NAMEL_FOLDER
	set FNAME FOLDER
	string FNAME += "/"
	string FNAME += NAME
	getArray OFFSET 0 i
	getArray SIZE 1 i
	goto OFFSET
	getDstring COMP 8
	if COMP == "chunklzx"
		callfunction unpack 1
		log FNAME 0 SIZE MEMORY_FILE
	else
		log FNAME OFFSET SIZE
	endif
	goto MYOFF
next i

startfunction unpack # (c) Luigi Auriemma
    get DUMMY long
    get FULLSIZE long
    get SIZE long
    get CHUNKS long
    get DUMMY long
    get DUMMY long
    get DUMMY long
    get DUMMY long
    log MEMORY_FILE 0 0
    append
    savepos OFFSET
    for j = 0 < CHUNKS
        math OFFSET x= 0x8
        for # very lame, made on the fly
            math T = OFFSET
            math T %= 0x10
            if T == 8
                break
            endif
            math OFFSET += 8
        next
        goto OFFSET
        get ZSIZE long
        get DUMMY long
        savepos OFFSET
        clog MEMORY_FILE OFFSET ZSIZE SIZE
        math OFFSET += ZSIZE
    next j
    append
    get MYSIZE asize MEMORY_FILE
    if MYSIZE != FULLSIZE
        print "Alert: MEMORY_FILE %MYSIZE% != %FULLSIZE%"
    endif
	set SIZE FULLSIZE
endfunction
```
## Post #343
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-09T14:05:54+00:00
- Post Title: Re: My quickBMS scripts

The Amazing Spider-Man *.pkz decompressor

Decompresses the pkz archives from the game and writes the header and decompressed data to disk. I can't make any sense of the given offsets in the header, but if anyone wants to take a look, I can provide a sample.
Nothing special here, so again, it's just another example for the QuickBMS-curious (comments provided). 

```
# no extraction of individual files at the moment (TOC offsets don't fit)
# (c) 2012-10-09 by AlphaTwentyThree of XeNTaX

comtype zlib_noerror
get IDENT long
if IDENT == 0xb0b1bEbA
	endian big
elif IDENT == 0xbabeb1b0
else
	cleanexit
endif
get DATA_OFF long              # start of compressed data
get NAME basename
string NAME += ".header"
log NAME 0 DATA_OFF            # write header to disk for later research
get BLOCKSIZE long             # length of one zlib block
get LOOPS asize                # calculate the number of loops
math LOOPS -= DATA_OFF
math LOOPS /= BLOCKSIZE
# memory pre-allocation
get SIZE asize
math SIZE -= DATA_OFF
math SIZE *= 10
putVarChr MEMORY_FILE SIZE 0
log MEMORY_FILE 0 0
set OFFSET DATA_OFF  # initialize first offset
set SIZE BLOCKSIZE
math SIZE *= 10      # set decompressed size to some default
append
for i = 1 <= LOOPS
	clog MEMORY_FILE OFFSET BLOCKSIZE SIZE # decompress block to memory
	math OFFSET += BLOCKSIZE               # jump to next block
next i
append
get NAME basename
string NAME += ".decomp"
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE
```
## Post #344
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-09T14:53:24+00:00
- Post Title: Re: My quickBMS scripts

Found a quite stupid mistake in my generic splitter which I won't explain any further. 
Be sure to grab the updated script here: [viewtopic.php?f=13&t=4450&p=45460#p45460](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=45460#p45460)!
## Post #345
- Username: mono24
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2012-10-09T21:05:46+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Code: Select allset BIAS OFF_FOLDERS
math BIAS %= 0x10
if BIAS != 0
	math OFF_FOLDERS /= 0x10
	math OFF_FOLDERS += 1
	math OFF_FOLDERS *= 0x10
endif
I have a feeling that there's some better way to do this (since, according to my understanding, it's basically just a ceil() function with a custom "cutoff"), but my maths isn't strong enough to pick it out (I think bit-shifting would play a role, though... does QuickBMS actually support bit-wise manipulations?). =/
## Post #346
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-09T21:12:22+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Dinoguy1000
>
> AlphaTwentyThree wrote:I have a feeling that there's some better way to do this (since, according to my understanding, it's basically just a ceil() function with a custom "cutoff"), but my maths isn't strong enough to pick it out (I think bit-shifting would play a role, though... does QuickBMS actually support bit-wise manipulations?). =/Damn, should have looked inside the documentation better... it's only called "alignment" there, which is nothing else than a ceil. Will change it in the scripts.
## Post #347
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-09T21:17:36+00:00
- Post Title: Re: My quickBMS scripts

Faster than Light dat extractor

All those easy formats provide excellent learning scripts. 

```
# (c) 2012-10-09 by AlphaTwentyThree of XeNTaX

get FILES long
for i = 1 <= FILES
	get OFFSET long
	if OFFSET == 0
		cleanexit
	endif
	savepos MYOFF
	goto OFFSET
	get SIZE long
	get NAMEL long
	getDstring NAME NAMEL
	savepos OFFSET
	log NAME OFFSET SIZE
	goto MYOFF
next i
```
## Post #348
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-09T22:02:08+00:00
- Post Title: Re: My quickBMS scripts

War of the Human Tanks (2012, PC) - ald extractor

Bears a striking resemblance to the above format...

```
# (c) 2012-10-10 by AlphaTwentyThree of XeNTaX

get UNK threebyte
get FSIZE asize
for i = 1
	get OFFSET threebyte
	math OFFSET *= 0x100
	set TEST FSIZE
	math TEST -= OFFSET
	if TEST <= 0x20
		cleanexit
	endif
	savepos MYOFF
	goto OFFSET
	get HEADER long
	get SIZE long
	get HASH longlong
	getDstring NAME 0x10
	math OFFSET += HEADER
	log NAME OFFSET SIZE
	goto MYOFF
next i
```
## Post #349
- Username: mono24
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2012-10-10T04:30:23+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Dinoguy1000 wrote:AlphaTwentyThree wrote:I have a feeling that there's some better way to do this (since, according to my understanding, it's basically just a ceil() function with a custom "cutoff"), but my maths isn't strong enough to pick it out (I think bit-shifting would play a role, though... does QuickBMS actually support bit-wise manipulations?). =/Damn, should have looked inside the documentation better... it's only called "alignment" there, which is nothing else than a ceil. Will change it in the scripts.
Of course, I'm an idiot; "ceil() with a custom 'cutoff'" is just a rounding function. =D
## Post #350
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-10T15:27:56+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Dinoguy1000
>
> Of course, I'm an idiot;Ladies and gentlemen, listen to the admin!
## Post #351
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-10T15:37:31+00:00
- Post Title: Re: My quickBMS scripts

Added some more formats to the Unity3D extractor. Thanks nefarel.
## Post #352
- Username: mono24
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2012-10-10T22:57:49+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Dinoguy1000 wrote:Of course, I'm an idiot; Ladies and gentlemen, listen to the admin!

Hardly the first time; I've been practicing digital self-deprecation since 2003.
## Post #353
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-11T10:04:51+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Dinoguy1000
>
> AlphaTwentyThree wrote:Dinoguy1000 wrote:Of course, I'm an idiot; Ladies and gentlemen, listen to the admin! 

Hardly the first time; I've been practicing digital self-deprecation since 2003.
Well... kudos then, lol. ^^
## Post #354
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-14T18:38:42+00:00
- Post Title: Re: My quickBMS scripts

Just updated the XNB to WAV script ([viewtopic.php?f=13&t=4450&p=75157#p75157](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=75157#p75157)). Now supports other formats than uncompressed PCM.
## Post #355
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-15T16:52:09+00:00
- Post Title: Re: My quickBMS scripts

And another update for the Unity3D extractor: [viewtopic.php?f=13&t=4450&p=77959#p77959](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=77959#p77959)
Now detects xml and png files in type 49 files.
## Post #356
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-16T22:06:33+00:00
- Post Title: Re: My quickBMS scripts

Half Minute Hero rwv converter

Converts the MSADPCM streams from the game to *.lwav files, playable with vgmstream. You'll need the newest func_header_PCM.bms for this: [viewtopic.php?f=13&t=4450&p=71565#p71565](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=71565#p71565)

```
# needed func_header_PCM version: 2012-10-16
# (c) 2012-10-16 by AlphaTwentyThree of XeNTaX

include "func_header_PCM.bms"
idstring "fmt "
findLoc OFFSET string "data" 0 ""
math OFFSET += 8
findLoc SAMPLE string "smpl" 0 ""
if SAMPLE != ""
	get NAME basename
	string NAME += ".smpl"
	get SIZE asize
	math SIZE -= 0xc
	math SIZE -= SAMPLE
	log NAME SAMPLE SIZE
	set SIZE SAMPLE
else
	get SIZE asize
	math SIZE -= 0xc
endif
math SIZE -= OFFSET
goto 0x8
get CODEC short
get CH short
get FREQ long
get UNK long
get BLOCKALIGN short
get BITS short
set NAME ""
callfunction PCM 1
```
## Post #357
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-19T00:20:45+00:00
- Post Title: Re: My quickBMS scripts

RAW: Reals of Ancient War - *.bf extractor

```
# (c) 2012-10-19 by AlphaTwentyThree of XeNTaX

get DATASTART long
get FILES long
for i = 1 <= FILES
	get HASH longlong
	get NAME string
	get OFFSET long
	get SIZE long
	log NAME OFFSET SIZE
next i
```
## Post #358
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-20T14:45:37+00:00
- Post Title: Re: My quickBMS scripts

StoneChess (2012) PC - data.scp extractor

Now they are really getting lazy with their GRAFs...

```
# (c) 2012-10-20 byAlphaTwentyThree of XeNTaX

get FILES long
get DATASTART long
get UNK long
for i = 1 <= FILES
	get NAME string
	get SIZE long
	log NAME OFFSET SIZE
	math OFFSET += SIZE
next i
```
## Post #359
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-20T16:21:13+00:00
- Post Title: Re: My quickBMS scripts

Top Secret Finders (2012) PC - TSF.vst extractor

```
# (c) 2012-10-20 by AlphaTwentyThree of XeNTaX

get INFO asize
math INFO -= 4
goto INFO
get INFO long
goto INFO
get FILES long
for i = 1 <= FILES
	get NAMEL long
	getDstring NAME NAMEL
	get OFFSET long
	get ZSIZE long
	savepos MYOFF
	goto OFFSET
	get TEST byte
	goto MYOFF
	if TEST == 0x78
		set SIZE ZSIZE
		math SIZE *= 0xffffff
		clog NAME OFFSET ZSIZE SIZE
	else 
		log NAME OFFSET ZSIZE
	endif
next i
```
## Post #360
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-20T18:26:35+00:00
- Post Title: Re: My quickBMS scripts

Doom 3: BFG Edition (2012) PC - *.resources

Should work on all platforms.

```
# (c) 2012-10-20 by AlphaTwentyThree of XeNTaX

endian big
get DUMMY long
get INFOPOS long
goto INFOPOS
get FILES long
for i = 1 <= FILES
	get NAMEL long
	reverselong NAMEL
	getDstring NAME NAMEL
	get OFFSET long
	get SIZE long
	log NAME OFFSET SIZE
next i
```
## Post #361
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-22T21:11:34+00:00
- Post Title: Re: My quickBMS scripts

Wwise sound engine *.pck/AKPK extractor

Finally had the motivation to write a (hopefully) working script for this format now. Most games that use the Wwise engine also use that format - which applies to tons of games from the '10 era.
Sadly, the names are only saved as a CRC value. :-\
Be sure to grab the newest func_getTYPE.bms, I've changed some basic things regarding the detection of RIFF/RIFX-headered files. Detects xWMA, ms_adpcm, ima_adpcm, xbox_adpcm and Wwise ogg now.

```
# newest func_getTYPE.bms is located at http://forum.xentax.com/viewtopic.php?f=13&p=69577#p69577
# (c) 2012-12-10 by AlphaTwentyThree of XeNTaX
#
# tested and working on
# ---------------------
# Kinect Rush: A Disney Pixar Adventure (X360, 2012)
# Assassin's Creed III (PC, 2012)
# Dishonored (PC, 2012)
# Warhammer 40,000: Space Marine (PC, 2012)
# Halo 4 (X360, 2012)
# Assasin's Creed: Revelations (PC, 2011)
# BioShock: Infinite (PC/PS3/X360, 2013)

include "func_getTYPE.bms"
getDstring IDENT 4
if IDENT == "AKPK"
elif IDENT == "1KCP" # The Saboteur (PC)
else
	print "Error: no valid Wwise sound pack"
	cleanexit
endif
set PC 0
endian big
get SIZE_HEADER long # data start offset
get TEST long
get FSIZE asize
if TEST != 1
	reverselong SIZE_HEADER
	endian little
	set PC 1
endif
get BNAME basename
string BNAME += "/"

goto 0xc
get IDENT long
set FOLDER_NAMES 1
if IDENT == 0xc6
	set NBIAS 0x18
elif IDENT == 0x14
	set NBIAS 0x1c
	set PC 1
else
	set NBIAS 0x1c # also in PC versions
endif
goto NBIAS
get NUM_FOLDERS long
if NUM_FOLDERS > 10
	math NBIAS -= 4
	goto NBIAS
	get NUM_FOLDERS long
endif
savepos MYOFF
set INFO NUM_FOLDERS
math INFO *= 8
math INFO += MYOFF # = start of names, will hold offset to jump to for TOC
set ALLNAMES 0 # for ceil after names

for i = 0 < NUM_FOLDERS
	goto MYOFF
	get OFF_NAME_FOLDER long
	math OFF_NAME_FOLDER += NBIAS
	get ID_FOLDER long
	savepos MYOFF
	goto OFF_NAME_FOLDER
	if PC == 0
		get NAME_FOLDER string
	else
		callfunction getPCstring 1
	endif
		strlen LENGTH NAME_FOLDER
		math ALLNAMES += LENGTH
		math ALLNAMES += 1
	string NAME_FOLDER += "/"
	string NAME_FOLDER += BNAME
	putArray 0 ID_FOLDER NAME_FOLDER
next i
if PC == 1
	math ALLNAMES *= 2
	math INFO += ALLNAMES
else
	savepos INFO
	math INFO x= 4
endif
goto INFO
set RUNS 1
callfunction extract 1
cleanexit

startfunction getPCstring
	set NAME_FOLDER ""
	for s = 0
		get CHAR byte
		get NULL byte
		putVarChr NAME_FOLDER s CHAR
		if CHAR == 0
			break
		endif
	next s
endfunction
	
startfunction extract
	savepos INFO
	get NUM_FILES long
	if NUM_FILES == 0
		if RUNS == 1
			get NUM_FILES long
		else
			cleanexit
		endif
	endif
	print "extracting %NUM_FILES% files (number at offset %INFO%)"
	for i = 1 <= NUM_FILES
		get NAME_CRC long
		get MULTI long # in certain cases only
		get SIZE long
		if SIZE == 0
			get SIZE long
		endif
		get OFFSET long
		get ID_FOLDER long
		if OFFSET == 0
			set OFFSET ID_FOLDER
			get ID_FOLDER long
		endif
		string NAME_CRC p= "0x%08x" NAME_CRC		
		if MULTI != 0
			math OFFSET *= MULTI
		endif
		
		savepos MYOFF
		getArray NAME_FOLDER 0 ID_FOLDER
		set NAME NAME_FOLDER
		#string NAME += "/"
		#string NAME += RUNS
		#string NAME += "/"
		string NAME += NAME_CRC
		putVarChr MEMORY_FILE SIZE 0
		log MEMORY_FILE 0 0
		append
		log MEMORY_FILE OFFSET SIZE
		append
		callfunction getTYPE 1
		if PC == 0
			endian big
		endif
		string NAME += EXT
		log NAME 0 SIZE MEMORY_FILE
	next i
	math RUNS += 1
	callfunction extract 1
endfunction
```
## Post #362
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-26T11:59:55+00:00
- Post Title: Re: My quickBMS scripts

Just updated the above script and added PC version support (little endian). Not quite sure if it works, it's just a workaround. Just try it on some files to check. At least it works for the PC version of Borderlands 2...
## Post #363
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2012-10-26T17:24:41+00:00
- Post Title: Re: My quickBMS scripts

Alpha, dont works again on PC .pcks yet.
[wwise_pck(pc)_errors_again_win7x64.rar](https://xentaxbackup.github.io/file/5924_wwise_pck(pc)_errors_again_win7x64.rar)
## Post #364
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2012-10-26T18:11:44+00:00
- Post Title: Re: My quickBMS scripts

I now getting errors from all wwwise packs that i try to test on, creed 3 is giving me the array element error without extracting anything and other pck that use to work will not now extract and gives me "incomplete file number 0 can't read from 1 bytes"
## Post #365
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-26T19:43:05+00:00
- Post Title: Re: My quickBMS scripts

I've updated the script, can you check if it works now?
## Post #366
- Username: OrangeC
- Rank: double-veteran
- Number of posts: 868
- Joined date: Sun Apr 20, 2008 9:58 am
- Post datetime: 2012-10-26T19:48:26+00:00
- Post Title: Re: My quickBMS scripts

Nope same errors as before. I have even updated quickbms to latest version and have the latest func_getTYPE.bms
## Post #367
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2012-10-27T02:34:28+00:00
- Post Title: Re: My quickBMS scripts

Dont understand why dont works in any version script.

Alpha, could I send some files for tests in PM?
[pck_1.2.rar](https://xentaxbackup.github.io/file/5926_pck_1.2.rar)
## Post #368
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-27T15:23:47+00:00
- Post Title: Re: My quickBMS scripts

Wind Blood (2012) Android - sound.pack extractor

```
# (c) 2012-10-27 by AlphaTwentyThree of XeNTaX

get FSIZE asize
goto -0xe
get FILES short
set OFFSET 0
goto OFFSET
for i = 1 <= FILES
	idstring "GBMP"
	math OFFSET += 0x12
	goto OFFSET
	get ZSIZE long
	get SIZE long
	get NAMEL long
	getDstring NAME NAMEL
	savepos OFFSET
	if SIZE == ZSIZE
		log NAME OFFSET ZSIZE
	else
		clog NAME OFFSET SIZE ZSIZE
	endif
	math OFFSET += SIZE
	if OFFSET < FSIZE
		goto OFFSET
	endif
next i
```
## Post #369
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-28T17:18:26+00:00
- Post Title: Re: My quickBMS scripts

Shoot Many Robots *.sar extractor

```
# (c) 2012-10-28 by AlphaTwentyThree of XeNTaX

idstring \x7f\xda\x0\x0
get FSIZE asize
get UNK long
get INFO long
goto INFO
for
	get OFFSET long
	get ZERO long
	get SIZE long
	get ZERO long
	get NAMEL long
	getDstring NAME NAMEL
	savepos TEST
	log NAME OFFSET SIZE
	if TEST == FSIZE
		cleanexit
	endif
next
```
## Post #370
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2012-10-29T19:36:50+00:00
- Post Title: Re: My quickBMS scripts

[viewtopic.php?p=71018#p71018](http://forum.xentax.com/viewtopic.php?p=71018#p71018)
## Post #371
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-29T20:02:23+00:00
- Post Title: Re: My quickBMS scripts

Yay, thanks.
## Post #372
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-29T20:44:29+00:00
- Post Title: Re: My quickBMS scripts

Mountain Bike Adrenaline - BIG extractor

```
# (c) 2012-10-29 by AlphaTwentyThree of XeNTaX

get FILES long
get UNK long
get MULTI long
savepos INFO
set NAMEBIAS FILES
math NAMEBIAS *= 0x14
math NAMEBIAS += INFO
for i = 1 <= FILES
	get NAMEPOS long
	math NAMEPOS += NAMEBIAS
	get OFFSET long
	math OFFSET *= MULTI
	get FILE_END long
	get TYPE long
	get SIZE long
	savepos MYOFF
	goto NAMEPOS
	get NAME string
	goto MYOFF
	log NAME OFFSET SIZE
next i
```
## Post #373
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-30T08:35:18+00:00
- Post Title: Re: My quickBMS scripts

UPDATE

Updated the func_getTYPE.bms once more.  Added five or six new types and corrected a stupid mistake that sometimes prevented it from working correctly.
## Post #374
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-10-31T02:31:44+00:00
- Post Title: Re: My quickBMS scripts

Added X360 support to the bdt/bht5 extractor. I don't know if the switch between offset and 4byte zero is connected to the endianness. I'd need other games to check this with.
[viewtopic.php?f=13&t=4450&p=78048#p78048](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=78048#p78048)
## Post #375
- Username: SnarbleBarb
- Rank: n00b
- Number of posts: 17
- Joined date: Thu Dec 15, 2011 4:24 pm
- Post datetime: 2012-11-09T21:42:52+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Just made a really extensive update for both the EA ast extractor and func_getTYPE.bms (faster and more sophisticated)! Extreme enhancements FTW!

I heart you AlphaTwentyThree! I haven't check this in months thinking that you may have given up on it, but lo and behold! It finally extracts all of the BIG .AST files! Out of curiosity, is there a recursive function to extract the resultant .ast files from the big one?
## Post #376
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-11-12T01:57:55+00:00
- Post Title: Re: My quickBMS scripts

UPDATE
Don't ask me why but I forgot to add mp3 to my type detection script... 

> Reply from SnarbleBarb
>
> I heart you AlphaTwentyThree! I haven't check this in months thinking that you may have given up on it, but lo and behold! It finally extracts all of the BIG .AST files! Out of curiosity, is there a recursive function to extract the resultant .ast files from the big one?Not that I know of. Glad you like the updates.
## Post #377
- Username: SnarbleBarb
- Rank: n00b
- Number of posts: 17
- Joined date: Thu Dec 15, 2011 4:24 pm
- Post datetime: 2012-11-12T06:31:32+00:00
- Post Title: Re: My quickBMS scripts

Yes I greatly appreciate you putting more time into this one!

Unfortunately, the output isn't quite usable yet... no 3d models or textures. There are a lot of additional .AST files that get spewed out from the big ones. Trying to extract those results in more .AST files. If you keep extracting them, you essentially see a pattern where the results are the same as all of the .AST files in the top level directory. So a tiny .AST file could extract into many many .AST files that are much larger than the tiny one that you started from which includes a copy of itself. (That sounds a little wordy to me, hopefully it makes sense!)

Some thoughts on some of the resultant file types:

Any idea what the .XPR files are? I tried your Quake 4 XPR bms script, but it didn't work (couldn't read 1 byte).

You mention in the func_getTYPE.bms that you are unsure of the usage of .GD files. Looking at them in a hex editor, they look like animation scripts of some sort. They contain some variable declarations and then mention animation parameters. I'm sure that you've already looked at that though, but just in the odd case that you haven't... maybe that could help diagnose their usage?   

I heart you AlphaTwentyThree!
## Post #378
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-11-12T16:26:22+00:00
- Post Title: Re: My quickBMS scripts

Well, to check this phenomenon I'd need something that only you have on your HDD... all those AST files that is. I wrote the script for one game and it seemed to work ok, so I didn't bother anymore. :-\
## Post #379
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-11-26T20:24:44+00:00
- Post Title: Re: My quickBMS scripts

```
# (c) 2012-11-26 by AlphaTwentyThree of XeNTaX

idstring "MHP XXL"
goto 0x50
for 
	getDstring NAME 0x40
	if NAME == "****"
		cleanexit
	endif
	get OFFSET long
	get SIZE long
	get ZERO long
	get ZERO long
	log NAME OFFSET SIZE
next 
```
## Post #380
- Username: Urbana
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Wed Nov 28, 2012 8:03 pm
- Post datetime: 2012-11-28T21:12:10+00:00
- Post Title: Re: My quickBMS scripts

Hi there,

Would it be possible to port the Sleeping Dogs script to work on the PC version?  Happy to provide any info on folder layout, filenames etc.

Thanks
## Post #381
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-11-29T13:59:28+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Urbana
>
> Hi there,

Would it be possible to port the Sleeping Dogs script to work on the PC version?  Happy to provide any info on folder layout, filenames etc.

ThanksNot sure atm. PM me.
## Post #382
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-11-29T14:36:55+00:00
- Post Title: Re: My quickBMS scripts

UPDATE

I just made some corrections in the Wwise pck/AKPK script. 
- doesn't terminate in an error message
- supports those pck files with only one folder (sfx)
- added sub-folders with the archive name inside the internal folder names (to identify where a certain language file came from)
The PC support was only some really uncertain work-around and made the script extremely messy, so I've deleted that for now. Will add the correct lines as soon as I get my hands on a sample.
## Post #383
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2012-11-29T21:43:36+00:00
- Post Title: Re: My quickBMS scripts

Works if .pck archives dont have much files. Problem .pcks - sounds_eng.pck, sounds_sfx.pck (Assasin`s Creed III (Xbox 360)). QuickBMS error - this BMS script uses more array elements than how much supported (0.5.15b).
Dont work with soundstream.pck (Halo 4) - dont do extracting (extracted 0 files from 0).
## Post #384
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-11-30T17:34:01+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Researchman
>
> Works if .pck archives dont have much files. Problem .pcks - sounds_eng.pck, sounds_sfx.pck (Assasin`s Creed III (Xbox 360)). QuickBMS error - this BMS script uses more array elements than how much supported (0.5.15b).
Dont work with soundstream.pck (Halo 4) - dont do extracting (extracted 0 files from 0).Without samples, I can't check the new script I'm afraid... :-\
## Post #385
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-11-30T17:35:44+00:00
- Post Title: Re: My quickBMS scripts

Iron Sky: Invasion (2012) PC

All file information is stored in an XML file, so parsing is a bit more ugly than usual.

```
# (c) 2012-11-30 by AlphaTwenyThree of XeNTaX

idstring "<?xml"
get NAME filename
string NAME -= 8
string NAME += ".gpk"
open FDSE NAME 1

for i = 0
	FindLoc POS string "<File alias=" 0 ""
	if POS == ""
		break
	endif
	math POS += 0x12
	goto POS 0
	getCT NAME string 0x22 0
	FindLoc POS string "size=" 0 ""
	math POS += 10
	goto POS 0
	get TEST byte 0
	if TEST != 0x20
		goto MYOFF 0
	endif
	getCT NUM string 0x22 0
	callfunction str2num 1
	set ZSIZE NUM
	FindLoc POS string "originalSize=" 0 ""
	math POS += 18
	goto POS 0
	get TEST byte 0
	if TEST != 0x20
		goto MYOFF 0
	endif
	getCT NUM string 0x22 0
	callfunction str2num 1
	set SIZE NUM
	FindLoc POS string "offset=" 0 ""
	math POS += 12
	goto POS 0
	get TEST byte 0
	if TEST != 0x20
		goto MYOFF
	endif
	getCT NUM string 0x22 0
	callfunction str2num 1
	set OFFSET NUM
	if SIZE != ZSIZE
		savepos MYOFF 0
		goto OFFSET 1
		callfunction decompress 1
		get SIZE asize MEMORY_FILE
		log NAME 0 SIZE MEMORY_FILE
		goto MYOFF 0
	else
		log NAME OFFSET ZSIZE 1
	endif
next i

startfunction str2num
	endian little
    set TONUM 0
    strlen l NUM
    for s = 0 < l
        set EXP l
        math EXP -= s
        math EXP -= 1
        set B 0xA
        math B p EXP
        getVarChr T NUM s
        math T -= 0x30
        math T *= B
        math TONUM += T
    next s
    set NUM TONUM
endfunction

startfunction decompress
	get DUMMY long 1
	get HEADERSIZE long 1
	reverselong HEADERSIZE
	get BLOCKS long 1
	get UNK long 1
	get ZSIZE long 1
	get SIZE long 1
	putVarChr MEMORY_FILE SIZE 0
	log MEMORY_FILE 0 0
	for k = 1 <= BLOCKS
		get ZSIZE long 1
		get ZOFFSET long 1
		math ZOFFSET += OFFSET # relative to file start
		set SIZE ZSIZE
		math SIZE *= 0x200
		append
		clog MEMORY_FILE ZOFFSET ZSIZE SIZE 1
		append
	next k
endfunction
```
## Post #386
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-12-05T22:32:36+00:00
- Post Title: Re: My quickBMS scripts

Crash Bandicoot: Nitro Kart 2 - data.vfs

You'll need the newest func_getTYPE.bms for this to work properly. Note that some files remain zlib-compressed after extraction. They have been compressed two times in a row and this script doesn't extract recursively. They all contain *.pif files.

```
# (c) 2012-12-05 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
idstring "FUFS"
get UNK long
get FILES long
for i = 1 <= FILES
	get OFFSET long
	get NAME_CRC long
	get SIZE long
	savepos MYOFF
	goto OFFSET
	get TEST byte
	set COMP 0
	if TEST == 0x78
		set COMP 1
		set ZSIZE SIZE
		math ZSIZE *= 0x300
	elif TEST == 0x50
		goto OFFSET
		getDstring TEST 4
		if TEST == "PLZP"
			set COMP 1
			get ZSIZE long
			math ZSIZE *= 0x10
			math OFFSET += 0xc
		endif
	else
		putVarChr MEMORY_FILE SIZE 0
		log MEMORY_FILE 0 0
		append
		log MEMORY_FILE OFFSET SIZE
		append
	endif
	if COMP == 1
		putVarChr MEMORY_FILE ZSIZE 0
		log MEMORY_FILE 0 0
		append
		clog MEMORY_FILE OFFSET SIZE ZSIZE
		append
	endif
	callfunction getTYPE 1
	get NAME basename
	string NAME_CRC p= "_0x%08x" NAME_CRC
	string NAME += NAME_CRC
	string NAME += EXT
	log NAME 0 SIZE MEMORY_FILE
	goto MYOFF
next i
```
## Post #387
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-12-05T22:34:34+00:00
- Post Title: Re: My quickBMS scripts

Crash Bandicoot: Nitro Kart 2 - *.psnd

```
# converts the *.psnd files from Crash Bandicoot: Nitro Kart 2 (iP, 2010) to playable wave files
# find the func_header_PCM.bms at http://forum.xentax.com/viewtopic.php?f=13&p=71565#p71565
# (c) 2012-12-05 by AlphaTwentyThree of XeNTaX

include "func_header_PCM.bms"
idstring "PSND"
get UNK long
get UNK long
get FREQ short
get CH byte
get BITS byte
savepos OFFSET
get SIZE asize
math SIZE -= OFFSET
set BLOCKALIGN 1
set CODEC 1
set NAME ""
callfunction PCM 1
```
## Post #388
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-12-13T01:35:10+00:00
- Post Title: Re: My quickBMS scripts

Max Payne Mobile - MaxPayneSoundsv2.msf extractor

```
# (c) 2012-12-13 by AlphaTwentyThree of XeNTaX

endian big
get UNK long
get UNK long
get FILES long
for i = 1 <= FILES
	get OFFSET long
	get SIZE long
	get NAMEL byte
	getDstring NAME NAMEL
	log NAME OFFSET SIZE
next i
```
## Post #389
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2012-12-23T01:51:29+00:00
- Post Title: Re: My quickBMS scripts

Atlantis: Pearls of the Deep - pearls_pc.vpb/.vpi extractor

```
# (c) 2012-12-23 by AlphaTwentyThree of XeNTaX

open FDDE vpi 0
open FDDE vpb 1
for
	FindLoc NXT string "File " 0 ""
	if NXT == ""
		cleanexit
	endif
	math NXT += 6
	goto NXT
	getCT NAME binary 0x22
	get DUMMY byte
	getCT OFFSET binary 0x20
	getCT SIZE binary 0x0d
	
	set NUM OFFSET
	callfunction str2num 1
	set OFFSET NUM
	
	set NUM SIZE
	callfunction str2num 1
	set SIZE NUM
	
	log NAME OFFSET SIZE 1
next

startfunction str2num
	endian little
    set TONUM 0
    strlen l NUM
    for i = 0 < l
        set EXP l
        math EXP -= i
        math EXP -= 1
        set B 0xA
        math B p EXP
        getVarChr T NUM i
        math T -= 0x30
        math T *= B
        math TONUM += T
    next i
    set NUM TONUM
endfunction
```
## Post #390
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-01-09T17:48:45+00:00
- Post Title: Re: My quickBMS scripts

Gangs of London (2006) PSP - *.bf

```
# (c) 2013-01-09 by AlphaTwentyThree of XeNTaX

include "func_getTYPE.bms"
callfunction parse 1

startfunction parse
	idstring "BFFB"
	get UNK long
	get FILES long
	get IDENT long # 1 -> only one compressed file
	get INFO long
	get DATASTART long
	goto INFO
	if IDENT == 0
		callfunction extract_list
	elif IDENT == 1
		log MEMORY_FILE 0 DATASTART
		set OFFSET DATASTART
		get SIZE asize
		math SIZE -= OFFSET
		set ZSIZE SIZE
		math ZSIZE *= 0x100
		clog MEMORY_FILE2 OFFSET SIZE ZSIZE
		get SIZE asize MEMORY_FILE2
		append
		log MEMORY_FILE 0 SIZE MEMORY_FILE2
		append
		putVarChr MEMORY_FILE 0xc 0 long
		get NAME basename
		string NAME += "_dec.bf"
		get SIZE asize MEMORY_FILE
		log NAME 0 SIZE MEMORY_FILE
		open FDSE NAME
		goto 0
		callfunction parse 1
	endif
endfunction

startfunction extract_list
	for i = 1 <= FILES
		get NAME_CRC long
		get OFFSET long
		get SIZE threebyte
		get UNK byte
		if UNK != 0x80
			savepos MYOFF
			math MYOFF -= 4
			goto MYOFF
			get SIZE long
		endif
		get ZSIZE long
		string NAME p= "0x%08x" NAME_CRC
		if SIZE == ZSIZE
			log MEMORY_FILE OFFSET SIZE
		else
			clog MEMORY_FILE OFFSET SIZE ZSIZE
		endif
		callfunction getTYPE 1
		string NAME += EXT
		get WNAME basename
		string WNAME += " - "
		string WNAME += EXT
		string WNAME += "/"
		string WNAME += NAME
		get SIZE asize MEMORY_FILE
		log WNAME 0 SIZE MEMORY_FILE
	next i
endfunction
```
## Post #391
- Username: zouzou69
- Rank: n00b
- Number of posts: 17
- Joined date: Thu Mar 10, 2011 6:46 pm
- Post datetime: 2013-01-18T09:57:31+00:00
- Post Title: Re: My quickBMS scripts

can someone know how to edit the sbs et sbr files from fifa games ?

i would edit this files for pc version and xbox version of fifa 13 to change the audio ..the sbs contains probably xma files



here the exemple of the two files.

if someone could transform this ..thks a lot

[http://www.datafilehost.com/download-5b1f42f3.html](http://www.datafilehost.com/download-5b1f42f3.html)

THANKS A LOT .i think the files contains xma
## Post #392
- Username: FinalBlast
- Rank: advanced
- Number of posts: 52
- Joined date: Tue Dec 29, 2009 1:35 am
- Post datetime: 2013-01-21T11:19:01+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Researchman wrote:Works if .pck archives dont have much files. Problem .pcks - sounds_eng.pck, sounds_sfx.pck (Assasin`s Creed III (Xbox 360)). QuickBMS error - this BMS script uses more array elements than how much supported (0.5.15b).
Dont work with soundstream.pck (Halo 4) - dont do extracting (extracted 0 files from 0).Without samples, I can't check the new script I'm afraid... :-\

Mr. Alpha, I have provided a 5 MB sample of the PC version of AC3 sounds_sfx.pck I hope it helps to make the script work on PC ver. 

[http://www.mediafire.com/?u89884l48xpy3ky](http://www.mediafire.com/?u89884l48xpy3ky)
## Post #393
- Username: Researchman
- Rank: mega-veteran
- Number of posts: 315
- Joined date: Fri Jun 11, 2010 7:08 pm
- Post datetime: 2013-05-16T20:31:33+00:00
- Post Title: Re: My quickBMS scripts

Dont sure, but I dont found func_header_CDXA.bms(use addCDXAheader.bms from here - [viewtopic.php?f=13&p=40162#p40162](http://forum.xentax.com/viewtopic.php?f=13&p=40162#p40162) ).

Try use Playstation XA extractor on XA_STR from japan version 1.0 of Castlevania: Symphony of the Night, but its dont work. Maybe because, in this file contain some SEQ files(PS1 MIDI).
## Post #394
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-06-26T16:16:17+00:00
- Post Title: Re: My quickBMS scripts

Buzz! The Sports Quiz (PS2, 2006)

```
# (c) 2013-06-26 by AlphaTwentyThree of XeNTaX

idstring BPAK
get OFF_DATA long
goto 0x10
get FILES long
get TOC long
goto TOC
for i = 0 < FILES
	get CRC long
	get OFF_NAME long
	get OFFSET long
	get SIZE long
	savepos MYOFF
	goto OFF_NAME
	get NAME string
	goto MYOFF
	log NAME OFFSET SIZE
next i
```
## Post #395
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-06-28T09:27:48+00:00
- Post Title: Re: My quickBMS scripts

Baldur's Gate: Dark Alliance (PS2) - *.GOB/*.LMP

```
# (c) 2013-06-28 by AlphaTwentyThree of XeNTaX

for
	getDstring NAME 0x20
	get OFFSET long
	get SIZE long
	if NAME == ""
		cleanexit
	endif
	log NAME OFFSET SIZE
next
```


```
# (c) 2013-06-28 by AlphaTwentyThree of XeNTaX

get FILES long
for i = 1 <= FILES
	getDstring NAME 0x38
	get OFFSET long
	get SIZE long
	log NAME OFFSET SIZE
next i
```
## Post #396
- Username: mono24
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2013-06-28T09:34:14+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Baldur's Gate: Dark Alliane (PS2) - *.GOB/*.LMP

That's supposed to be "Dark Alliance", right?
## Post #397
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-06-28T15:20:21+00:00
- Post Title: Re: My quickBMS scripts

of course - changed.
## Post #398
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-07-03T10:49:15+00:00
- Post Title: Re: My quickBMS scripts

Baldur's Gate: Dark Alliance (GC) - *.lmp

Structure is similar to the PS2 lmp files, only big endian and with an identifier. Those lmp files hold most of the game's files.

```
# Baldur's Gate: Dark Alliance (Gamecube, 2001)
# (c) 2013-07-03 by AlphaTwentyThree of XeNTaX

endian big
idstring LUMP
get FILES long
get BNAME basename
string BNAME += "/"
for i = 1 <= FILES
	getDstring NAME 0x38
	get OFFSET long
	get SIZE long
	set WNAME BNAME
	string WNAME += NAME
	log WNAME OFFSET SIZE
next i
```
## Post #399
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-07-09T07:18:31+00:00
- Post Title: Re: My quickBMS scripts

UPDATE

Just made another update of [func_getTYPE.bms](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=69577#p69577) with some more file types and heuristics.
## Post #400
- Username: shekofte
- Rank: mega-veteran
- Number of posts: 221
- Joined date: Sun Jan 18, 2009 8:45 pm
- Post datetime: 2013-07-27T10:48:32+00:00
- Post Title: Re: My quickBMS scripts

here are .snd files that show ripple shapes data :
[viewtopic.php?f=16&t=10632](http://forum.xentax.com/viewtopic.php?f=16&t=10632)

i want to see , how you will write a Qbms script for extracting of wave from them ?
What a wonderful this would be for me , because my knowledge on sound data is low ...
just as a teaching session !

Yours sincerely
## Post #401
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-07-27T13:51:38+00:00
- Post Title: Re: My quickBMS scripts

> Reply from shekofte
>
> here are .snd files that show ripple shapes data :
viewtopic.php?f=16&t=10632

i want to see , how you will write a Qbms script for extracting of wave from them ?
What a wonderful this would be for me , because my knowledge on sound data is low ...
just as a teaching session !

Yours sincerely
Well, these are .VAB archives with PS2 ADPCM streams inside. Can't remember if I ever wrote an extractor for these. ATM I don't have time but for all I can see at first glance the format isn't complicated.
## Post #402
- Username: shekofte
- Rank: mega-veteran
- Number of posts: 221
- Joined date: Sun Jan 18, 2009 8:45 pm
- Post datetime: 2013-07-27T15:03:27+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> shekofte wrote:here are .snd files that show ripple shapes data :
viewtopic.php?f=16&t=10632

i want to see , how you will write a Qbms script for extracting of wave from them ?
What a wonderful this would be for me , because my knowledge on sound data is low ...
just as a teaching session !

Yours sincerely  
Well, these are .VAB archives with PS2 ADPCM streams inside. Can't remember if I ever wrote an extractor for these. ATM I don't have time but for all I can see at first glance the format isn't complicated.

anyway thanks for your allusion
## Post #403
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-08-15T17:48:41+00:00
- Post Title: Re: My quickBMS scripts

Culpa Innata (2007) PC - *.sfs

Different from the sfs files of IL-2.

```
 # (c) 2013-08-15 by AlphaTwentyThree of XeNTaX

idstring "SFS1"
get FILES short
for i = 1 <= FILES
	get NAMEL short
	getDstring NAME NAMEL
	get OFFSET long
	savepos MYOFF
	goto OFFSET
	get SIZE long
	math OFFSET += 4
	goto MYOFF
	log NAME OFFSET SIZE
next i
```
## Post #404
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-08-21T12:24:22+00:00
- Post Title: Re: My quickBMS scripts

Half-Life (2001) PS2 - *.pak

```
 #(c) 2013-08-21 by AlphaTwentyThree of XeNTaX

idstring PACK
get NAMESOFF long
get FILES long
goto NAMESOFF
for i = 1 <= FILES
	getDstring NAME 0x38
	get OFFSET long
	get SIZE long
	log NAME OFFSET SIZE
next i
```
## Post #405
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-08-30T21:04:18+00:00
- Post Title: Re: My quickBMS scripts

Glacier engine - WHD/WAV pairs

Games like the Hitman series, Freedom Fighters or Kane & Lynch. You will need to put all whd/wav pairs as well as the streams.wav (if available) into the same folder.
Not all tested, though. So if you have problems with any of the Glacier games, post here.

```
# needs the streams.wav in the same folder as the whd/wav pair(s)
# tested with Hitman 2: Silent Assassin (Xbox, PS2)
# (c) 2013-08-30 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

open FDDE WHD 0
open FDDE WAV 1
open FDSE "streams.wav" 2 EXISTS
if EXISTS == 0
	open FDSE "STREAMS.WAV" 2 EXISTS
endif
get TOCSIZE long 0
get WHDSIZE long 0
if WHDSIZE == 0x18
	cleanexit
endif
get UNK longlong 0
do
	get NAME string 0
	savepos MYOFF 0
	math MYOFF x= 4
	goto MYOFF 0
	get UNK long 0
	get UNK long 0
	get CODEC threebyte 0
	get FILE byte 0
	get FREQ long 0
	get BITS long 0
	get UNK long 0
	get SIZE long 0
	get CH long 0
	get OFFSET long 0
	get UNK long 0
	get INTERLEAVE long 0
	get UNK long 0
	savepos MYOFF 0
	if FILE == 0
		if CODEC == 0x69
			string NAME += ".lwav"
			callfunction XADP 1
		elif CODEC == 1
			set BLOCKALIGN 4
			callfunction PCM_1 1
		elif CODEC == 0x12
			string NAME += ".genh"
			set CODEC 9
			if CH == 1
				set INTERLEAVE 0
			endif
			callfunction GENH 1
		else
			print "Error: unknown codec. Aborting..."
			cleanexit
		endif
	elif FILE == 0x80
		if EXISTS == 1
			set BLOCKALIGN 4
			callfunction PCM_2 1
		endif
	endif
while MYOFF < TOCSIZE

startfunction XADP
	set MEMORY_FILE binary "\x52\x49\x46\x46\x18\x51\xa3\x0\x57\x41\x56\x45\x66\x6d\x74\x20\x14\x0\x0\x0\x69\x0\x2\x0\x44\xac\x0\x0\xcc\xc1\x0\x0\x48\x0\x4\x0\x2\x0\x40\x0\x64\x61\x74\x61\xf0\x50\xa3\x0"
	set RIFFSIZE SIZE
	math RIFFSIZE += 0x28
	putVarChr MEMORY_FILE 0x04 RIFFSIZE long
	putVarChr MEMORY_FILE 0x16 CH byte
	putVarChr MEMORY_FILE 0x18 FREQ long
	set VAR1 0x3073
	math VAR1 *= CH
	if FREQ == 48000
		math VAR1 *= 44100
	else
		math VAR1 *= FREQ
	endif
	math VAR1 /= 22050
	putVarChr MEMORY_FILE 0x1c VAR1 long	
	set VAR2 0x24
	math VAR2 *= CH
	putVarChr MEMORY_FILE 0x20 VAR2 short
	putVarChr MEMORY_FILE 0x2c SIZE long
	append
	log MEMORY_FILE OFFSET SIZE 1
	append
	if NAME == ""
		get NAME basename
		string NAME += ".lwav"
	endif
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction

startfunction PCM_1
	set PRE SIZE
	math PRE += 0x2c
	putVarChr MEMORY_FILE PRE 0
	log MEMORY_FILE 0 0
	set MEMORY_FILE binary "\x52\x49\x46\x46\x20\xC0\xB1\x00\x57\x41\x56\x45\x66\x6D\x74\x20\x10\x00\x00\x00\x01\x00\x02\x00\x44\xAC\x00\x00\x10\xB1\x02\x00\x04\x00\x10\x00\x64\x61\x74\x61\xFC\xBF\xB1\x00"
	append
	log MEMORY_FILE OFFSET SIZE 1
	append
	set RIFFSIZE SIZE
	math RIFFSIZE += 36
	set AVGBYTES FREQ
	if CODEC != 2
		math AVGBYTES *= BLOCKALIGN
	endif
	
	putvarchr MEMORY_FILE 0x04 RIFFSIZE long
	putvarchr MEMORY_FILE 0x14 CODEC short
	putvarchr MEMORY_FILE 0x16 CH short
	putvarchr MEMORY_FILE 0x18 FREQ short
	putvarchr MEMORY_FILE 0x1c AVGBYTES long
	putvarchr MEMORY_FILE 0x20 BLOCKALIGN short
	putvarchr MEMORY_FILE 0x22 BITS short
	putvarchr MEMORY_FILE 0x28 SIZE long
	if NAME == ""
		get NAME basename
		string NAME += ".wav"
	endif
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction

startfunction PCM_2
	set PRE SIZE
	math PRE += 0x2c
	putVarChr MEMORY_FILE PRE 0
	log MEMORY_FILE 0 0
	set MEMORY_FILE binary "\x52\x49\x46\x46\x20\xC0\xB1\x00\x57\x41\x56\x45\x66\x6D\x74\x20\x10\x00\x00\x00\x01\x00\x02\x00\x44\xAC\x00\x00\x10\xB1\x02\x00\x04\x00\x10\x00\x64\x61\x74\x61\xFC\xBF\xB1\x00"
	append
	log MEMORY_FILE OFFSET SIZE 2
	append
	set RIFFSIZE SIZE
	math RIFFSIZE += 36
	set AVGBYTES FREQ
	if CODEC != 2
		math AVGBYTES *= BLOCKALIGN
	endif
	
	putvarchr MEMORY_FILE 0x04 RIFFSIZE long
	putvarchr MEMORY_FILE 0x14 CODEC short
	putvarchr MEMORY_FILE 0x16 CH short
	putvarchr MEMORY_FILE 0x18 FREQ short
	putvarchr MEMORY_FILE 0x1c AVGBYTES long
	putvarchr MEMORY_FILE 0x20 BLOCKALIGN short
	putvarchr MEMORY_FILE 0x22 BITS short
	putvarchr MEMORY_FILE 0x28 SIZE long
	if NAME == ""
		get NAME basename
		string NAME += ".wav"
	endif
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction

startfunction GENH
	set SAMPLES SIZE
	math SAMPLES *= 8
	math SAMPLES /= BITS

	set FSIZE SIZE
	math FSIZE += 0x1000
	putVarChr MEMORY_FILE FSIZE 0
	log MEMORY_FILE 0 0
	putVarChr MEMORY_FILE 0 0x484e4547 long
	putVarChr MEMORY_FILE 0x4 CH long
	putVarChr MEMORY_FILE 0x8 INTERLEAVE long
	putVarChr MEMORY_FILE 0xc FREQ long
	putVarChr MEMORY_FILE 0x10 0xffffffff long
	putVarChr MEMORY_FILE 0x14 SAMPLES long
	putVarChr MEMORY_FILE 0x18 CODEC long
	putVarChr MEMORY_FILE 0x1c 0x1000 long # offset; == stream start if no header
	putVarChr MEMORY_FILE 0x20 0x1000 long
	putVarChr MEMORY_FILE 0x300 FSIZE long
	putVarChr MEMORY_FILE 0x304 0x32304756 long
	putVarChr MEMORY_FILE 0xfff 0 byte
	math FSIZE -= 0x1000
	append
	log MEMORY_FILE OFFSET FSIZE 1
	append
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction
```
## Post #406
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-09-02T08:32:37+00:00
- Post Title: Re: My quickBMS scripts

DARK (2013) PC - *.darkpack

Very very easy archive format.

```
# (c) 2013-09-02 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

idstring "DARKPACK"
goto 8
get TOC_SIZE long
get FILES long
for i = 1 <= FILES
	get OFFSET long
	get ZERO long
	get CRC long
	get ZERO long
	get SIZE long
	get NAMEL long
	getDstring NAME NAMEL
	log NAME OFFSET SIZE
next i
```
## Post #407
- Username: arg274
- Rank: beginner
- Number of posts: 27
- Joined date: Mon Aug 26, 2013 3:05 am
- Post datetime: 2013-09-03T18:13:22+00:00
- Post Title: Re: My quickBMS scripts

Hey alphatwentythree,can u whip off a bms for scanning and ripping *.pmf files from an unknown archive?or,can you at least tell me the read size at offset value so that i can use it with JN?
## Post #408
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-09-03T19:59:31+00:00
- Post Title: Re: My quickBMS scripts

> Reply from arg274
>
> Hey alphatwentythree,can u whip off a bms for scanning and ripping *.pmf files from an unknown archive?or,can you at least tell me the read size at offset value so that i can use it with JN?
Here's my old PMF scanner. 

```
	FindLoc OFFSET string "PSMF00" 0 ""
	if OFFSET == ""
		cleanexit
	endif
	goto OFFSET
	get DUMMY long
	get DUMMY long
	get DUMMY long
	get SIZE long
	get NAME basename
	string NAME += "_"
	string NAME += i
	string NAME += ".pmf"
	log NAME OFFSET SIZE
	math OFFSET += SIZE
	goto OFFSET
next i
```
## Post #409
- Username: arg274
- Rank: beginner
- Number of posts: 27
- Joined date: Mon Aug 26, 2013 3:05 am
- Post datetime: 2013-09-04T16:00:40+00:00
- Post Title: Re: My quickBMS scripts

thnx man,thumbs up!
## Post #410
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-09-08T12:20:33+00:00
- Post Title: Re: My quickBMS scripts

AFL Live 2 (2013) X360 - .wad0/.wad1

Be sure to get the latest func_getTYPE.bms for this one!

```
# (c) 2013-09-08 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

include "func_getTYPE.bms"
open FDDE wad0 0
open FDDE wad1 1
endian big
get FILES long 0
get UNK long 0
set BIAS files
math BIAS *= 0x10
math BIAS += 8
for i = 1 <= FILES
	get NAME long # crc
	string NAME p= "0x%08x" NAME
	get SIZE long
	get FILE long
	get OFFSET long
	putVarChr MEMORY_FILE SIZE 0
	log MEMORY_FILE 0 0
	append
	append
	if FILE == 0
		math OFFSET += BIAS
		log MEMORY_FILE OFFSET SIZE 0
	elif FILE == 1
		log MEMORY_FILE OFFSET SIZE 1
	endif
	callfunction getType 1
	endian big
	string NAME += EXT
	log NAME 0 SIZE MEMORY_FILE
next i
```
## Post #411
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-10-05T15:41:21+00:00
- Post Title: Re: My quickBMS scripts

9 Clues: The Secret of Serpent Creek - Game.cub

xor150 first, then apply this script.

```
# (c) 2013-10-05 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

idstring \x63\x75\x62\x00\x31\x2E\x30\x00
get FILES long
goto 0x10c
for i = 1 <= FILES
	getDstring NAME 0x100
	get OFFSET long
	get SIZE long
	log NAME OFFSET SIZE
next i
```
## Post #412
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-10-05T23:07:20+00:00
- Post Title: Re: My quickBMS scripts

Full Mojo Rampage (2013) PC - DataPC.pak

```
# (c) 2013-10-06 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

idstring KCAP
endian big
goto 0xc
get FILES long
set BIAS FILES
math BIAS *= 0x120
math BIAS += 0x20
get OFF asize
math OFF -= BIAS
goto OFF
for i = 1 <= FILES
	getDstring NAME 0x100
	get ZSIZE long
	get SIZE long
	get OFFSET long
	get IDENT long
	getDstring DUMMY 0x10
	if IDENT == 1
		clog NAME OFFSET SIZE ZSIZE
	else
		log NAME OFFSET SIZE
	endif
next i
```
## Post #413
- Username: arg274
- Rank: beginner
- Number of posts: 27
- Joined date: Mon Aug 26, 2013 3:05 am
- Post datetime: 2013-10-12T10:53:23+00:00
- Post Title: Re: My quickBMS scripts

can u do a GZip scanning bms,alpha?i only need a scanner one,no need to create a decomprssor too.
## Post #414
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-10-12T13:41:31+00:00
- Post Title: Re: My quickBMS scripts

> Reply from arg274
>
> can u do a GZip scanning bms,alpha?i only need a scanner one,no need to create a decomprssor too.Well... I don't know the specs, but maybe offzip works? You can also try to use my generic splitter.
## Post #415
- Username: arg274
- Rank: beginner
- Number of posts: 27
- Joined date: Mon Aug 26, 2013 3:05 am
- Post datetime: 2013-10-12T15:31:45+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> arg274 wrote:can u do a GZip scanning bms,alpha?i only need a scanner one,no need to create a decomprssor too.Well... I don't know the specs, but maybe offzip works? You can also try to use my generic splitter.
meh,tried offzip quite some time ago but somehow,didnt work for me.i'll give your splitter a try.
## Post #416
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-10-20T18:50:58+00:00
- Post Title: Re: My quickBMS scripts

Alien Rage Unlimited (2013) PC - SNDTABLE.AFB/SNDCACHE.AFB

```
# extracts the sounds from the SNDTABLE.AFB/SNDCACHE.AFB
# (c) 2013-10-20 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

open FDSE "SNDTABLE.AFB" 0
open FDSE "SNDCACHE.AFB" 1

get FILES long 0
for i = 1 <= FILES
	get OFFSET long 0
	get SIZE long 0
	get NAMEL long 0
	math NAMEL *= 2
	getDstring UNINAME NAMEL 0
	set NAME unicode UNINAME
	callfunction transname 1
	string NAME += ".ogg"
	log NAME OFFSET SIZE 1
next i

startfunction transname
	math NAMEL /= 2
	for k = 0 < NAMEL
		getVarChr TEST NAME k
		if TEST == 0x2e
			putVarChr NAME k 0x2f
		endif
	next k
endfunction
```
## Post #417
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-10-28T14:00:33+00:00
- Post Title: Re: My quickBMS scripts

Wwise *.bnk soundbank extractor

Somehow I never posted this...

```
# (c) 2013-10-28 by AlphaTwentyThree of Xentax
# script for QuickBMS http://quickbms.aluigi.org

include "func_getTYPE.bms"
idstring "BKHD"
get SIZE_HEADER long
savepos MYOFF
math MYOFF += SIZE_HEADER
get FSIZE asize
if MYOFF == FSIZE
	print "bnk is empty"
	cleanexit
endif
goto MYOFF
idstring "DIDX"
get SIZE_DIDX long
set FILES SIZE_DIDX
math FILES /= 0xc
set BIAS MYOFF # complete header
math BIAS += SIZE_DIDX
math BIAS += 16
get BNAME basename
for i = 1 <= FILES
	get DIDX long
	get OFFSET long
	math OFFSET += BIAS
	get SIZE long
	set NAME DIDX
	string NAME += " ("
	string NAME += BNAME
	string NAME += ")"
	putVarChr MEMORY_FILE SIZE 0
	log MEMORY_FILE 0 0
	append
	log MEMORY_FILE OFFSET SIZE
	append
	callfunction getTYPE 1
	string NAME += EXT
	log NAME OFFSET SIZE
next i
```
## Post #418
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-10-29T20:23:16+00:00
- Post Title: Re: My quickBMS scripts

Simple audio file sorter

This could come in helpful when you rip a game with the Wwise engine and have thousands of files but don't know what type of sound the file is (music, sfx, ambience, speech etc.).
Just run all the files through the script, it will sort them according to their frequency and channels. Will save you a LOT of time when it comes to music processing!
Also: Good script for beginners. 

```
if IDENT == "OggS"
	goto 0x27
	get CH byte
	get FREQ short
elif IDENT == "RIFF"
	goto 0x16
	get CH short
	get FREQ long
endif
get FNAME filename
string NAME p= "%d_%d/%s" FREQ CH FNAME
get SIZE asize
log NAME 0 SIZE
```
## Post #419
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2013-10-30T10:34:07+00:00
- Post Title: Re: My quickBMS scripts

UPDATE

Just updated my generic file splitter with an additional option that makes it a generic filetype scanner (!!!).
Funny thing is that it was really easy to implement, I just didn't see the obvious.
## Post #420
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2014-01-05T16:14:26+00:00
- Post Title: Re: My quickBMS scripts

Reservoir Dogs (PS2) - *.PS2

The sounds in this game are wav/wav.str pairs. Maybe I'll take a look at these some other time.

```
# (c) 2014-01-05 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

goto 0xc
get FILES long
get OFF_INFO long
math OFF_INFO *= 0x800
goto 0x28
get OFF_NAMES long
math OFF_NAMES *= 0x800
goto OFF_INFO
for i = 1 <= FILES
	get OFFSET long
	get CRC long
	get SIZE long
	get NAMEPOS long
	math NAMEPOS += OFF_NAMES
	get UNK long # always 1
	get UNK long # 0 or 4
	get UNK long
	get UNK long
	
	math OFFSET *= 0x800
	savepos MYOFF
	goto NAMEPOS
	get NAME string
	goto MYOFF
	
	get WNAME basename
	string WNAME += "/"
	string WNAME += NAME
	log WNAME OFFSET SIZE
next i
```
## Post #421
- Username: Prince_of_Peace
- Rank: beginner
- Number of posts: 29
- Joined date: Fri May 26, 2006 1:41 pm
- Post datetime: 2014-01-25T23:29:32+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Wwise sound engine *.pck/AKPK extractor
This is not a re-importable script is it?
## Post #422
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2014-01-26T14:36:43+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Prince_of_Peace
>
> AlphaTwentyThree wrote:Wwise sound engine *.pck/AKPK extractor
This is not a re-importable script is it?No, sorry :/
## Post #423
- Username: Teancum
- Rank: veteran
- Number of posts: 99
- Joined date: Wed Nov 28, 2007 3:30 am
- Post datetime: 2014-02-12T17:50:10+00:00
- Post Title: Re: My quickBMS scripts

How hard would this psuedocode be to translate into BMS script?

// 1) Read bytes 0x10-0x13, store as num_files[]
// 2) Go to 0x30-0x33, store files_start_offset[], jump to files_start_offset[]
// 3) For each item in num_files[]
// 4) Read first four bytes as file_offset[]
// 5) Read next four bytes as file_size[]
// 6) Jump forward 12 bytes
// 7) Read 16 bytes as file_name[]
//  Go to file_offset[]
// 9) Select from file_offset[] to file_offset[]+file_size[]
// 10) Save selection as file_name[]
// 11) num_files[]+=1
// 12) files_start_offset[]+=84 bytes
// 13) fetch next
## Post #424
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2014-02-12T17:58:17+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Teancum
>
> How hard would this psuedocode be to translate into BMS script?

// 1) Read bytes 0x10-0x13, store as num_files[]
// 2) Go to 0x30-0x33, store files_start_offset[], jump to files_start_offset[]
// 3) For each item in num_files[]
// 4) Read first four bytes as file_offset[]
// 5) Read next four bytes as file_size[]
// 6) Jump forward 12 bytes
// 7) Read 16 bytes as file_name[]
//  Go to file_offset[]
// 9) Select from file_offset[] to file_offset[]+file_size[]
// 10) Save selection as file_name[]
// 11) num_files[]+=1
// 12) files_start_offset[]+=84 bytes
// 13) fetch next

```
get num_files long
goto 0x30
get files_start_offset long
goto files_start_offset
savepos MYOFF
for i = 0 < num_files
   goto MYOFF
   get file_offset long
   get file_size long
   getDstring dummy 12
   getDstring file_name 16
   log file_name file_offset file_size
   math MYOFF += 84
next i
```
## Post #425
- Username: Teancum
- Rank: veteran
- Number of posts: 99
- Joined date: Wed Nov 28, 2007 3:30 am
- Post datetime: 2014-02-12T19:46:26+00:00
- Post Title: Re: My quickBMS scripts

I'm getting an error, it may be my problem:

```
Error: incomplete input file number 0, can't read 4 bytes.
```


Here's the offsets 0x10 and 0x30, maybe I'm reading those wrong, are those the correct addresses.



***EDIT***

Here's the basic file structure: [http://wiki.xentax.com/index.php?title= ... Apocalypse](http://wiki.xentax.com/index.php?title=X-Men_Legends_2_-_Rise_Of_Apocalypse) -- I'm just getting "Number Of Items In Directory 1", then "Offset To Directory Data 3". From there I would grab the data I need (offset, size, name), then jump to the actual files. I can manually rip them, but it's hundreds of files. 

Incidentally, directories 4-7 in the wiki don't actually exist in the files. I'm not sure if anyone can edit that data or not.
## Post #426
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2014-02-13T00:24:39+00:00
- Post Title: Re: My quickBMS scripts

Sorry to ask but why do you need a BMS script when Game Extractor already supports the archive type?
## Post #427
- Username: Teancum
- Rank: veteran
- Number of posts: 99
- Joined date: Wed Nov 28, 2007 3:30 am
- Post datetime: 2014-02-13T08:17:34+00:00
- Post Title: Re: My quickBMS scripts

It doesn't, though. Supposedly it does, but the table structure is platform-specific, so GameExtractor can only do one platform. A QuickBMS script would allow me to adjust sizes and offsets should I ever need to. The Unknown{4} in the // Directory Data 3 is a different size on each platform. For example, the 360 is 12 bytes instead of 4.
## Post #428
- Username: MacDougal
- Rank: ultra-n00b
- Number of posts: 4
- Joined date: Tue Mar 04, 2014 7:20 am
- Post datetime: 2014-03-04T22:33:56+00:00
- Post Title: Re: My quickBMS scripts

Is there any chance of a script for the pak & bin files of LOTR Conquest?
## Post #429
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2014-03-05T09:47:09+00:00
- Post Title: Re: My quickBMS scripts

> Reply from MacDougal
>
> Is there any chance of a script for the pak & bin files of LOTR Conquest?
Only if they contain the music, which is what I'm after.
## Post #430
- Username: Kein
- Rank: advanced
- Number of posts: 66
- Joined date: Fri Nov 06, 2009 7:57 pm
- Post datetime: 2014-04-02T00:38:27+00:00
- Post Title: Re: My quickBMS scripts

Any chance you could update XNB to WAV to support [XNA 4.0 XNB format?](http://forum.xentax.com/viewtopic.php?f=10&t=11376)
## Post #431
- Username: Milesgboy
- Rank: advanced
- Number of posts: 44
- Joined date: Sun Jul 04, 2010 12:02 am
- Post datetime: 2014-04-30T00:02:11+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> The Amazing Spider-Man *.pkz decompressor

Decompresses the pkz archives from the game and writes the header and decompressed data to disk. I can't make any sense of the given offsets in the header, but if anyone wants to take a look, I can provide a sample.
Nothing special here, so again, it's just another example for the QuickBMS-curious (comments provided). 
Code: Select all# decompresses the *.pkz files from The Amazing Spider-Man (PC)
# no extraction of individual files at the moment (TOC offsets don't fit)
# (c) 2012-10-09 by AlphaTwentyThree of XeNTaX

comtype zlib_noerror
get IDENT long
if IDENT == 0xb0b1bEbA
	endian big
elif IDENT == 0xbabeb1b0
else
	cleanexit
endif
get DATA_OFF long              # start of compressed data
get NAME basename
string NAME += ".header"
log NAME 0 DATA_OFF            # write header to disk for later research
get BLOCKSIZE long             # length of one zlib block
get LOOPS asize                # calculate the number of loops
math LOOPS -= DATA_OFF
math LOOPS /= BLOCKSIZE
# memory pre-allocation
get SIZE asize
math SIZE -= DATA_OFF
math SIZE *= 10
putVarChr MEMORY_FILE SIZE 0
log MEMORY_FILE 0 0
set OFFSET DATA_OFF  # initialize first offset
set SIZE BLOCKSIZE
math SIZE *= 10      # set decompressed size to some default
append
for i = 1 <= LOOPS
	clog MEMORY_FILE OFFSET BLOCKSIZE SIZE # decompress block to memory
	math OFFSET += BLOCKSIZE               # jump to next block
next i
append
get NAME basename
string NAME += ".decomp"
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE

Any chance you'll ever be able to figure this out so we can have some modding scene go on for these games. So many of their Spiderman games use PKZ and so many costumes that could be ported now into each game now. Surprised no one has figured this out yet. Since ASM2 just came out recently and nothing seems to have changed.
## Post #432
- Username: namquang93
- Rank: veteran
- Number of posts: 115
- Joined date: Mon Apr 09, 2012 3:40 pm
- Post datetime: 2014-07-01T03:51:42+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> The Amazing Spider-Man *.pkz decompressor

Decompresses the pkz archives from the game and writes the header and decompressed data to disk. I can't make any sense of the given offsets in the header, but if anyone wants to take a look, I can provide a sample.
Nothing special here, so again, it's just another example for the QuickBMS-curious (comments provided). 
Code: Select all# decompresses the *.pkz files from The Amazing Spider-Man (PC)
# no extraction of individual files at the moment (TOC offsets don't fit)
# (c) 2012-10-09 by AlphaTwentyThree of XeNTaX

comtype zlib_noerror
get IDENT long
if IDENT == 0xb0b1bEbA
	endian big
elif IDENT == 0xbabeb1b0
else
	cleanexit
endif
get DATA_OFF long              # start of compressed data
get NAME basename
string NAME += ".header"
log NAME 0 DATA_OFF            # write header to disk for later research
get BLOCKSIZE long             # length of one zlib block
get LOOPS asize                # calculate the number of loops
math LOOPS -= DATA_OFF
math LOOPS /= BLOCKSIZE
# memory pre-allocation
get SIZE asize
math SIZE -= DATA_OFF
math SIZE *= 10
putVarChr MEMORY_FILE SIZE 0
log MEMORY_FILE 0 0
set OFFSET DATA_OFF  # initialize first offset
set SIZE BLOCKSIZE
math SIZE *= 10      # set decompressed size to some default
append
for i = 1 <= LOOPS
	clog MEMORY_FILE OFFSET BLOCKSIZE SIZE # decompress block to memory
	math OFFSET += BLOCKSIZE               # jump to next block
next i
append
get NAME basename
string NAME += ".decomp"
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE

I used this script with THE AMAZING SPIDER MAN 2. But get error! Can you updated for new pkz format? Thanks in advance!
## Post #433
- Username: DoubleDare
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Wed Jul 02, 2014 2:48 am
- Post datetime: 2014-07-02T06:21:49+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> AFL Live 2 (2013) X360 - .wad0/.wad1

Be sure to get the latest func_getTYPE.bms for this one!
Code: Select allsnip

Hey A23!

Thank you so much for your time and effort 

I am a little stuck and maybe you can help?

When I run your great qBMS script, I am able to extract:
XMA - Which I have already used your other great XMA decoder script for ToWav and works greatDDS - All of the textures are great and works a treat

The only problem is that there are no 3D model files extracted  I can see there are a lot of '.000000xx' files, which I presume some are the model files.

How can I go about exploring these files to see?

Thanks so much!
## Post #434
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2014-07-03T10:24:40+00:00
- Post Title: Re: My quickBMS scripts

Well, you could look at them using a hex editor but you probably have to write your own conversion script to access them with a 3D program. As I'm neither familiar with nor interested in model files I wish you luck with your quest.
## Post #435
- Username: FASTandFURIOUS
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Thu Aug 14, 2014 4:48 pm
- Post datetime: 2014-08-14T09:54:46+00:00
- Post Title: Re: My quickBMS scripts

AlphaTwentyThree, you can make a script to unpack the archives of the game Midnight club Los Angeles for Xbox 360?
## Post #436
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-08-31T08:14:38+00:00
- Post Title: Re: My quickBMS scripts

> Reply from FASTandFURIOUS
>
> AlphaTwentyThree, you can make a script to unpack the archives of the game Midnight club Los Angeles for Xbox 360?
[http://tmacdev.com](http://tmacdev.com)
## Post #437
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2014-10-11T00:01:18+00:00
- Post Title: Re: My quickBMS scripts

Haven't checked with the Xbox 360 version. You'll probably only have to remove the two "endian big" entries.

```
# written by AlphaTwentyThree 2014-10-09
# script for QuickBMS http://aluigi.org/papers.htm#quickbms

include "func_getTYPE.bms"
get NAME basename 0
string NAME p= "%s_h.bundle" NAME
open FDSE NAME 1 EXIST
if EXIST == 0
	print "Error: be sure you ust this script on an all_#.bundle file! Aborting."
	cleanexit
endif
get FSIZE asize 1
endian big
get DUMMY long 1
get CSIZE long 1 # complete decompressed size
log MEMORY_FILE 0 0
putVarChr MEMORY_FILE2 CSIZE 0
log MEMORY_FILE2 0 0
savepos OFFSET 1
callfunction decompress 1
goto 0 MEMORY_FILE2
get SIZE_TOC long MEMORY_FILE2
get CRC long MEMORY_FILE2
get FILES long MEMORY_FILE2
get FILES long MEMORY_FILE2
get UNK long MEMORY_FILE2
get UNK long MEMORY_FILE2
get UNK long MEMORY_FILE2
get BNAME basename 0
for i = 1 <= FILES
	get FID long MEMORY_FILE2
	get OFFSET long MEMORY_FILE2
	get SIZE long MEMORY_FILE2
	if SIZE != 0
		log MEMORY_FILE OFFSET SIZE 0
		callfunction getTYPE 1
		endian big
		string NAME p= "%s/%s_%d%s" BNAME BNAME FID EXT
		log NAME 0 SIZE MEMORY_FILE
	endif
next i


startfunction decompress
	append
	do
		goto OFFSET 1
		get SIZE long 1
		savepos OFFSET 1
		xmath ZSIZE "SIZE * 100"
		clog MEMORY_FILE2 OFFSET SIZE ZSIZE 1
		math OFFSET += SIZE
	while OFFSET < FSIZE
	append
endfunction
```
## Post #438
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2014-11-11T13:17:15+00:00
- Post Title: Re: My quickBMS scripts

Dino R-R-rage Defense - data.dat

```
#
# (c) 2014-11-11 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

get UNK long
idstring "gepack"
get FILES long
for i = 1 <= FILES
	get NAMEL long
	math NAMEL *= 2
	getDstring NAME NAMEL
	set NAME unicode NAME
	get SIZE long
	get OFFSET long
	get DUMMY long
	get DUMMY byte
	log NAME OFFSET SIZE
next i
```
## Post #439
- Username: Heavymetalz
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Fri Sep 27, 2013 10:38 am
- Post datetime: 2014-11-21T08:19:30+00:00
- Post Title: Re: My quickBMS scripts

Hi AlphaTwentyThree: .. regarding Midnight Club L.A. , if you are planning on making a script for this game, I can get you some source files to work with if you need them ( xbox360 version)
## Post #440
- Username: XeRoX
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Wed Nov 26, 2014 1:54 am
- Post datetime: 2014-11-25T17:57:24+00:00
- Post Title: Re: My quickBMS scripts

Hi there,

im new to this forum, and I am actually looking for a script to unpack PAK files for the game titles Legend of Edda Global Edition.
Wonder if there is anyone who can help me out with?

Many thanks in advance!
## Post #441
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2014-12-12T20:59:11+00:00
- Post Title: Re: My quickBMS scripts

Frozen Synapse Prime ~ 2014 ~ PC - FSalldata.pkdwin/.pkiwin

Grab the func_getTYPE.bms from here: [viewtopic.php?f=13&t=4450&p=69577#p69577](http://forum.xentax.com/viewtopic.php?f=13&t=4450&p=69577#p69577)

```
# (c) 2014-12-12 by AlphaTwentyThree
# script for QuickBMS http://quickbms.aluigi.org

include "func_getTYPE.bms"
open FDDE "pkiwin" 0
open FDDE "pkdwin" 1
get INFOSIZE long 0
get ZERO long 0
get FILES long 0
get FOLDER basename
for i = 1 <= FILES
	get SIZE long 0
	get OFFSET long 0
	get CRC long 0
	putVarChr MEMORY_FILE SIZE 0
	log MEMORY_FILE 0 0
	append
	log MEMORY_FILE OFFSET SIZE 1
	append
	callfunction getTYPE 1
	string NAME p= "%s/0x%08x%s" FOLDER CRC EXT
	log NAME 0 SIZE MEMORY_FILE
next i

```
## Post #442
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2015-02-02T00:17:18+00:00
- Post Title: Re: My quickBMS scripts

Real Warfare: 1242 - data.000.pak

```
# written by AlphaTwentyThree 2015-02-02
# script for QuickBMS http://aluigi.org/papers.htm#quickbms

idstring "PACK"
get UNK long
get INFO long
get UNK long
get FILES long
get SIZE asize
math SIZE -= INFO
log MEMORY_FILE INFO SIZE
goto 0 MEMORY_FILE
for i = 1 <= FILES
	get OFFSET longlong MEMORY_FILE
	get SIZE longlong MEMORY_FILE
	get NAMEL long MEMORY_FILE
	get UNK long MEMORY_FILE
	savepos MYOFF MEMORY_FILE
	getDstring NAME NAMEL MEMORY_FILE
	math MYOFF += NAMEL
	goto MYOFF MEMORY_FILE
	log NAME OFFSET SIZE
next i
```
## Post #443
- Username: eriger777
- Rank: beginner
- Number of posts: 26
- Joined date: Thu Sep 25, 2014 5:30 am
- Post datetime: 2015-02-05T01:24:59+00:00
- Post Title: Re: My quickBMS scripts

Could you take a look at this file format?
[viewtopic.php?f=21&t=12572&p=103469#p103469](http://forum.xentax.com/viewtopic.php?f=21&t=12572&p=103469#p103469)
## Post #444
- Username: makcar
- Rank: veteran
- Number of posts: 154
- Joined date: Tue May 13, 2014 5:41 am
- Post datetime: 2015-02-16T01:53:30+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Iron Sky: Invasion (2012) PC

All file information is stored in an XML file, so parsing is a bit more ugly than usual.
Code: Select all# Iron Sky: Invasion (2012) PC - *.gpk extractor ( input file: *.mod)
# (c) 2012-11-30 by AlphaTwenyThree of XeNTaX
reimport?
## Post #445
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2015-02-16T13:05:01+00:00
- Post Title: Re: My quickBMS scripts

> Reply from makcar
>
> AlphaTwentyThree wrote:Iron Sky: Invasion (2012) PC

All file information is stored in an XML file, so parsing is a bit more ugly than usual.
Code: Select all# Iron Sky: Invasion (2012) PC - *.gpk extractor ( input file: *.mod)
# (c) 2012-11-30 by AlphaTwenyThree of XeNTaX

reimport?
No clue, sorry... :\
## Post #446
- Username: A20Group
- Rank: beginner
- Number of posts: 22
- Joined date: Fri Nov 28, 2014 12:36 am
- Post datetime: 2015-03-01T16:15:13+00:00
- Post Title: Re: My quickBMS scripts

> Reply from Milesgboy
>
> AlphaTwentyThree wrote:The Amazing Spider-Man *.pkz decompressor

Decompresses the pkz archives from the game and writes the header and decompressed data to disk. I can't make any sense of the given offsets in the header, but if anyone wants to take a look, I can provide a sample.
Nothing special here, so again, it's just another example for the QuickBMS-curious (comments provided). 
Code: Select all# decompresses the *.pkz files from The Amazing Spider-Man (PC)
# no extraction of individual files at the moment (TOC offsets don't fit)
# (c) 2012-10-09 by AlphaTwentyThree of XeNTaX

comtype zlib_noerror
get IDENT long
if IDENT == 0xb0b1bEbA
	endian big
elif IDENT == 0xbabeb1b0
else
	cleanexit
endif
get DATA_OFF long              # start of compressed data
get NAME basename
string NAME += ".header"
log NAME 0 DATA_OFF            # write header to disk for later research
get BLOCKSIZE long             # length of one zlib block
get LOOPS asize                # calculate the number of loops
math LOOPS -= DATA_OFF
math LOOPS /= BLOCKSIZE
# memory pre-allocation
get SIZE asize
math SIZE -= DATA_OFF
math SIZE *= 10
putVarChr MEMORY_FILE SIZE 0
log MEMORY_FILE 0 0
set OFFSET DATA_OFF  # initialize first offset
set SIZE BLOCKSIZE
math SIZE *= 10      # set decompressed size to some default
append
for i = 1 <= LOOPS
	clog MEMORY_FILE OFFSET BLOCKSIZE SIZE # decompress block to memory
	math OFFSET += BLOCKSIZE               # jump to next block
next i
append
get NAME basename
string NAME += ".decomp"
get SIZE asize MEMORY_FILE
log NAME 0 SIZE MEMORY_FILE

Any chance you'll ever be able to figure this out so we can have some modding scene go on for these games. So many of their Spiderman games use PKZ and so many costumes that could be ported now into each game now. Surprised no one has figured this out yet. Since ASM2 just came out recently and nothing seems to have changed.

on THE AMAZING SPIDER MAN 2 is not working
plz new code
## Post #447
- Username: SILENTpavel
- Rank: advanced
- Number of posts: 54
- Joined date: Fri Aug 05, 2011 12:53 pm
- Post datetime: 2015-03-15T22:58:18+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Extractor for Broken Sword: Shadow of the Templars
Another good example for the use of external scripts.Something wrong with that. What i did wrong? (SPEECH .DAT/.TAB extracted with CDmage from the SLUS_004.84)

[](http://imgur.com/tME7aYS)
```
by Luigi Auriemma

- start the scanning of the input folder: E:\!BS\New folder
- open input file E:\!BS\New folder\.\SPEECH.DAT
- open script E:\!BS\BS.bms
- c_structs: "if" "NAME" "=="

Error: invalid command "if" or arguments -1 at line 25

Press RETURN to quit
```

upd: also tested with 0.6.1d = same error.
## Post #448
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2015-03-24T11:22:02+00:00
- Post Title: Re: My quickBMS scripts

> Reply from SILENTpavel
>
> AlphaTwentyThree wrote:Extractor for Broken Sword: Shadow of the Templars
Another good example for the use of external scripts.Something wrong with that. What i did wrong? (SPEECH .DAT/.TAB extracted with CDmage from the SLUS_004.84)

Code: Select allQuickBMS generic files extractor and reimporter 0.5.29
by Luigi Auriemma

- start the scanning of the input folder: E:\!BS\New folder
- open input file E:\!BS\New folder\.\SPEECH.DAT
- open script E:\!BS\BS.bms
- c_structs: "if" "NAME" "=="

Error: invalid command "if" or arguments -1 at line 25

Press RETURN to quit
upd: also tested with 0.6.1d = same error.That error doesn't correspond to my script - make sure you copied it correctly.
## Post #449
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2015-03-24T11:22:51+00:00
- Post Title: Re: My quickBMS scripts

The Awakened Fate: Ultimatum (PS3) - *.dat

Makes nice use of the array and sortarray functions. 

```
# written by AlphaTwentyThree
# script for QuickBMS http://quickbms.aluigi.org

endian big
idstring "CASN"
get VERSION short
goto 0x6
get FILES short
get FSIZE long
get DATASTART long
get TOCSIZE long
savepos NAMEPOS
math NAMEPOS += TOCSIZE
get NAMESIZE long
get UNK long
for i = 0 < FILES
	get FID short
	get OFFSET long
	get SIZE long
	putArray 0 i OFFSET
	putArray 1 i SIZE
next i
sortarray 0
for i = 0 < FILES
	get NAMEL short
	get OFFSET long
	get SIZE long
	getDstring NAME NAMEL
	putArray 2 i NAME
	get DUMMY byte # zero
next i
for i = 0 < FILES
	getArray NAME 2 i
	getArray OFFSET 0 i
	getArray SIZE 1 i
	log NAME OFFSET SIZE
next i
```
## Post #450
- Username: makcar
- Rank: veteran
- Number of posts: 154
- Joined date: Tue May 13, 2014 5:41 am
- Post datetime: 2015-06-13T11:00:30+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Glacier engine - WHD/WAV pairs

Games like the Hitman series, Freedom Fighters or Kane & Lynch. You will need to put all whd/wav pairs as well as the streams.wav (if available) into the same folder.
Not all tested, though. So if you have problems with any of the Glacier games, post here.
Code: Select all# extracts the WHD/WAV pairs from the Glacier engine
# needs the streams.wav in the same folder as the whd/wav pair(s)
# tested with Hitman 2: Silent Assassin (Xbox, PS2)
# (c) 2013-08-30 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org
Kane & Lynch: Dead Men PC version?
Example: [https://yadi.sk/d/Lzd_2w2NhEM2r](https://yadi.sk/d/Lzd_2w2NhEM2r)
## Post #451
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2015-06-14T13:57:53+00:00
- Post Title: Re: My quickBMS scripts

> Reply from makcar
>
> Kane & Lynch: Dead Men PC version?
Example: https://yadi.sk/d/Lzd_2w2NhEM2r
Tried some time ago without success. :\
## Post #452
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2015-06-14T13:59:06+00:00
- Post Title: Re: My quickBMS scripts

Das Hexagon-Kartell - *.anm movies

```
# (c) 2015-06-05 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

idstring "AN15"
get FSIZE asize
PutVarChr MEMORY_FILE FSIZE 0
log MEMORY_FILE 0 0
set FIRST 1
set OFFSET 0x48
for
	goto OFFSET
	getDstring IDENT 4
	get SIZE long
	savepos OFFSET
	#print "%OFFSET%"
	if IDENT == "SAMP"
		if SIZE > 0x10
			if FIRST == 1
				get DUMMY longlong
				get FREQ short
				get DUMMY byte
				get CH byte
				get BITS byte
				get DUMMY short
				set FIRST 0
			else
				getDstring DUMMY 0xf
			endif
			savepos OFFSET
			math SIZE -= 0xf
			append
			log MEMORY_FILE OFFSET SIZE
			append
		endif
	elif IDENT == "ENDE"
		break
	endif
	math OFFSET += SIZE
next
get SIZE asize MEMORY_FILE
set CODEC 1
set BLOCKALIGN 2

	endian little
	set PRE SIZE
	math PRE += 0x2c
	putVarChr MEMORY_FILE2 PRE 0
	log MEMORY_FILE2 0 0
	set MEMORY_FILE2 binary "\x52\x49\x46\x46\x20\xC0\xB1\x00\x57\x41\x56\x45\x66\x6D\x74\x20\x10\x00\x00\x00\x01\x00\x02\x00\x44\xAC\x00\x00\x10\xB1\x02\x00\x04\x00\x10\x00\x64\x61\x74\x61\xFC\xBF\xB1\x00"
	append
	log MEMORY_FILE2 0 SIZE MEMORY_FILE
	append
	set RIFFSIZE SIZE
	math RIFFSIZE += 36
	set AVGBYTES FREQ
	math AVGBYTES *= BLOCKALIGN
	
	putvarchr MEMORY_FILE2 0x04 RIFFSIZE long
	putvarchr MEMORY_FILE2 0x14 CODEC short          # wFormatTag: Microsoft PCM Format (0x0001)
	putvarchr MEMORY_FILE2 0x16 CH short   # wChannels
	putvarchr MEMORY_FILE2 0x18 FREQ short   # dwSamplesPerSec
	putvarchr MEMORY_FILE2 0x1c AVGBYTES long    # dwAvgBytesPerSec
	putvarchr MEMORY_FILE2 0x20 BLOCKALIGN short # wBlockAlign
	putvarchr MEMORY_FILE2 0x22 BITS short       # wBitsPerSample
	putvarchr MEMORY_FILE2 0x28 SIZE long
	get NAME basename
	string NAME += ".wav"
	get SIZE asize MEMORY_FILE2
	log NAME 0 SIZE MEMORY_FILE2

```
## Post #453
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2015-06-14T14:01:41+00:00
- Post Title: Re: My quickBMS scripts

Jane's Combat Simulation - *.cb8 movies

```
# (c) 2015-06-10 by AlphaTwentyThree
# script for QuickBMS http://quickbms.aluigi.org

idstring "DRBC"
get CH long
get UNK short
get FREQ short
get UNK long
get FSIZE asize
putVarChr MEMORY_FILE FSIZE 0
log MEMORY_FILE 0 0
set MEMORY_FILE binary "\x52\x49\x46\x46\x20\xC0\xB1\x00\x57\x41\x56\x45\x66\x6D\x74\x20\x10\x00\x00\x00\x01\x00\x02\x00\x44\xAC\x00\x00\x10\xB1\x02\x00\x04\x00\x10\x00\x64\x61\x74\x61\xFC\xBF\xB1\x00"
putVarChr MEMORY_FILE2 FSIZE 0
putVarChr MEMORY_FILE3 FSIZE 0
log MEMORY_FILE2 0 0
log MEMORY_FILE3 0 0
set OFFSET 0x40
set FIRST 1
do
	goto OFFSET
	getDstring IDENT 4
	get SIZE long
	math SIZE -= 0x8
	savepos OFFSET
	if IDENT == "MRFA"
		math OFFSET += 0x10
		math SIZE -= 0x10
		if FIRST == 1
			math OFFSET += 0x10
			math SIZE -= 0x10
			set FIRST 0
		endif
		append
		log MEMORY_FILE OFFSET SIZE
		append
	elif IDENT == "VooM"
		append
		log MEMORY_FILE2 OFFSET SIZE
		append
	elif IDENT == "MRFI"
		append
		log MEMORY_FILE3 OFFSET SIZE
		append
	else
		print "%IDENT%"
		cleanexit
	endif
	math OFFSET += SIZE
while OFFSET != FSIZE

get NAME basename

string WNAME p= "%s.wav" NAME
get SIZE asize MEMORY_FILE
set RIFFSIZE SIZE
math RIFFSIZE += 36
set AVGBYTES FREQ
if CH == 1
	set BLOCKALIGN 1
else
	set BLOCKALIGN 2
endif
set CODEC 1
set BITS 8
putvarchr MEMORY_FILE 0x04 RIFFSIZE long
putvarchr MEMORY_FILE 0x14 CODEC short          # wFormatTag: Microsoft PCM Format (0x0001)
putvarchr MEMORY_FILE 0x16 CH short   # wChannels
putvarchr MEMORY_FILE 0x18 FREQ short   # dwSamplesPerSec
putvarchr MEMORY_FILE 0x1c AVGBYTES long    # dwAvgBytesPerSec
putvarchr MEMORY_FILE 0x20 BLOCKALIGN short # wBlockAlign
putvarchr MEMORY_FILE 0x22 BITS short       # wBitsPerSample
putvarchr MEMORY_FILE 0x28 SIZE long
log WNAME 0 SIZE MEMORY_FILE

string WNAME p= "%s.VooM" NAME
get SIZE asize MEMORY_FILE2
log WNAME 0 SIZE MEMORY_FILE2

string WNAME p= "%s.mrfi" NAME
get SIZE asize MEMORY_FILE3
log WNAME 0 SIZE MEMORY_FILE3

```
## Post #454
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2015-06-14T14:05:47+00:00
- Post Title: Re: My quickBMS scripts

F-22 Lightning II - *.vdk video demultiplexer

```
# (c) 2015-06-12 by AlphaTwentyThree of Xentax
# script for QuickBMS http://quickbms.aluigi.org

idstring "xVDK"
get OFFSET long

get SIZE asize
putVarChr MEMORY_FILE SIZE 0
putVarChr MEMORY_FILE2 SIZE 0
putVarChr MEMORY_FILE3 SIZE 0
log MEMORY_FILE 0 0
log MEMORY_FILE2 0 0
log MEMORY_FILE3 0 0

do
	goto OFFSET
	getDstring IDENT 4
	#print "%IDENT%"
	get SIZE long
	savepos OFFSET
	math SIZE -= 8
	append
	if IDENT == "pVDK"
		log MEMORY_FILE OFFSET SIZE
	elif IDENT == "aVDK"
		math OFFSET += 0x10
		math SIZE -= 0x13
		log MEMORY_FILE2 OFFSET SIZE
		math SIZE += 3
	elif IDENT == "iVDK"
		log MEMORY_FILE3 OFFSET SIZE
	endif
	append
	math OFFSET += SIZE
while IDENT != ""

get FNAME basename
get SIZE asize MEMORY_FILE
if SIZE != 0
	string NAME p= "%s.pVDK" FNAME
	log NAME 0 SIZE MEMORY_FILE
endif

get SIZE asize MEMORY_FILE2
if SIZE != 0
	string NAME p= "%s.aVDK" FNAME
	log NAME 0 SIZE MEMORY_FILE2
endif

get SIZE asize MEMORY_FILE3
if SIZE != 0
	string NAME p= "%s.iVDK" FNAME
	log NAME 0 SIZE MEMORY_FILE3
endif
```
## Post #455
- Username: troler11
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Sat Aug 15, 2015 2:56 pm
- Post datetime: 2015-09-02T22:48:55+00:00
- Post Title: Re: My quickBMS scripts

please one piece warriors 3 PC
unpack,edit text
LINKDATA_EU_OS_EUNA.A
LINKDATA_EU_OS_EUNA.B
LINKDATA_EU_OS_EUNA.C
LINKDATA_EU_OS_EUNA.D
## Post #456
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2015-11-16T22:02:25+00:00
- Post Title: Re: My quickBMS scripts

Star Wars: The Force Unleashed (Xbox 360) - .xd/.xp pairs

* script on hold, need to check something *

```
# (c) 2015-11-16 by AlphaTwentyThree of Xentax
# script for QuickBMS http://quickbms.aluigi.org

open FDDE xd 0
open FDDE xp 1

endian big
get UNK long 0
get UNK long 0
get FILES long 0
get NAMESTART long 0
set NAMEOFF FILES
math NAMEOFF *= 0x1c
math NAMEOFF += 0x10
math NAMEOFF += NAMESTART # only in some files
get FOLDER basename
string FOLDER += "/"
get FSIZE asize 1
for i = 1 <= FILES
	get CRC long 0
	get OFFSET long 0
	get OFFSET2 long 0
	get SIZE long 0
	get FFFF long 0
	get UNK long 0
	get ZERO long 0
	savepos MYOFF 0
	goto NAMEOFF 0
	get NAMEL long 0
	getDstring NAME NAMEL 0
	savepos NAMEOFF 0
	math OFFSET2 -= 0x800
	xmath TEST "OFFSET2 + SIZE"
	if TEST <= FSIZE
		log NAME OFFSET2 SIZE 1
	endif
	goto MYOFF 0
next i
```
## Post #457
- Username: angelasvv
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Sun Oct 13, 2013 2:22 pm
- Post datetime: 2016-01-01T05:24:53+00:00
- Post Title: Re: My quickBMS scripts

Tokyo 7th sisters
.and file
[http://1drv.ms/1Tt07ON](http://1drv.ms/1Tt07ON)
## Post #458
- Username: AnonBaiter
- Rank: veteran
- Number of posts: 82
- Joined date: Fri Oct 16, 2015 3:15 am
- Post datetime: 2016-02-02T20:23:15+00:00
- Post Title: Re: My quickBMS scripts

Bump in case the author of the original thread decides to show up.
## Post #459
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2016-02-03T07:14:45+00:00
- Post Title: Re: My quickBMS scripts

Well, I don't do requests here, so...
## Post #460
- Username: flowersongs
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Feb 03, 2016 2:40 am
- Post datetime: 2016-02-09T11:32:09+00:00
- Post Title: Re: My quickBMS scripts

edit
## Post #461
- Username: Peter Rodgers
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Wed Oct 15, 2014 4:09 am
- Post datetime: 2016-02-13T01:13:00+00:00
- Post Title: Re: My quickBMS scripts

Hey. I need a script to pull out all adpcm raw of file MS LASSET.MS2. The game Mortal Kombat Deception PS2. Tried to pull through PSound, but he did not adpsm raw pulls a ditch. Only converts in wav. But I need a adpcm raw. Here file [https://yadi.sk/d/k2-qRmOwoRGoz](https://yadi.sk/d/k2-qRmOwoRGoz).

Supplemented. I need a script to pull not a bunch of files is a adpcm raw, and that they are in a file mst.

announcr.mst
announcr_names.mst
bg_beetle_lair.mst
bg_dark_prison.mst

And so on.
## Post #462
- Username: flowersongs
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Feb 03, 2016 2:40 am
- Post datetime: 2016-02-18T02:31:08+00:00
- Post Title: Re: My quickBMS scripts

Okay, I have opened textures from NBA Jam on fire edition in photoshop. used xbox sdk kit to finally extract the tga files, and then bundle them back together to xpr2. This makes an xpr2 file with the same name, etc. I tried placing all the files, but the game freezes when loading a match an looking for the textures, it appears it WANTs the .AST file. 
NOW, I can someone please help me run this NBA extraction script in reverse to make an ast?  I tried running itin quickbms with the Reimport batch, but it errored saying expected BGFA, this file is XPR2. The script worked to Extract the files, now I need to inject them or re-import them to .ast ... Please help me run this script in reverse and my project is complete. 

```
# script for QuickBMS http://quickbms.aluigi.org

idstring "BGFA"
getdstring VER 4
get DUMMY long
get FILES long
get OFFSET long
goto OFFSET
getdstring DUMMY 12
for i = 0 < FILES
    getdstring DUMMY 10
    get OFFSET long
    get ZSIZE threebyte
    get SIZE threebyte
    getdstring NAME 0x2a
    math OFFSET *= 8
    if SIZE == 0
        log NAME OFFSET ZSIZE
    else
        math SIZE += ZSIZE
        clog NAME OFFSET ZSIZE SIZE
    endif
next i
```
## Post #463
- Username: AnonBaiter
- Rank: veteran
- Number of posts: 82
- Joined date: Fri Oct 16, 2015 3:15 am
- Post datetime: 2016-04-05T23:39:28+00:00
- Post Title: Re: My quickBMS scripts

So, I tried your "EA ast extractor" script on an .ast file that I discovered on an Wii game developed by EA. however, it gave me this error:


Maybe it's an undiscovered .ast file. Here's an sample:
[https://mega.nz/#!AM9XhJrJ!O11IMx0eLYqG ... 5_ucY8BZjU](https://mega.nz/#!AM9XhJrJ!O11IMx0eLYqGp-Wt8dhdhxrefAAq8Oe9p5_ucY8BZjU)

See if you can figure this out.
## Post #464
- Username: BitRain
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Wed Jun 08, 2016 2:45 am
- Post datetime: 2016-06-07T18:48:34+00:00
- Post Title: Re: My quickBMS scripts

Your Half-Life PS2 .pak extracting script only works on certain PAK files, others don't have the PAK header, maybe because they are compressed? Anyone know how to decompress/extract VALVE.PAK for example?
## Post #465
- Username: senbon
- Rank: ultra-n00b
- Number of posts: 9
- Joined date: Thu Oct 28, 2010 7:22 pm
- Post datetime: 2016-12-14T13:46:40+00:00
- Post Title: Re: My quickBMS scripts

There is some script to package the xa files extracted from the str, ie convert the pack of xa to str, as the dragon ball final bout, there is a script to extract but not to pack
?
## Post #466
- Username: Deivity
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Fri Jun 02, 2017 11:17 am
- Post datetime: 2017-06-04T22:33:42+00:00
- Post Title: Re: My quickBMS scripts

Please need a script in bms to extract the audios (xa files) of dialogs from castlevania sotn from psx, and then remount them I want to make a dubbed version of this game in portuguese can someone please create a functional script in bms thank you very much ! thank you. The path to the files is this:
SLUS_00067
SD - XA_STR1 - XA_STR1 [6] and XA_STR1 [7]
## Post #467
- Username: TokiChan
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Thu May 19, 2016 2:38 am
- Post datetime: 2017-08-06T19:25:26+00:00
- Post Title: Re: My quickBMS scripts

Hello!
I'm sorry for bother you, but I hope unpack one game from my childhood (get a models of dragons and enemies).
It named "The I of the Dragon" (or Eye of Dragon). Archives in .res format, but I can't extract it with Delphi or Reshack.
Here are files [https://drive.google.com/open?id=0B25vR ... 3VhSEluTmM](https://drive.google.com/open?id=0B25vRFsoP3Mqdi05V3VhSEluTmM)
Hope you know a way
## Post #468
- Username: oux
- Rank: n00b
- Number of posts: 14
- Joined date: Sat Jan 28, 2017 3:45 am
- Post datetime: 2017-11-05T13:01:37+00:00
- Post Title: Re: My quickBMS scripts


## Post #469
- Username: ponaromixxx
- Rank: beginner
- Number of posts: 29
- Joined date: Thu Jul 17, 2014 11:52 am
- Post datetime: 2017-11-09T04:19:52+00:00
- Post Title: Re: My quickBMS scripts


## Post #470
- Username: plodtrew
- Rank: mega-veteran
- Number of posts: 177
- Joined date: Wed Jul 18, 2007 2:14 pm
- Post datetime: 2018-02-06T06:04:16+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree
>
> Electronic Arts *.big extractor

I know there are many different archives in use by EA - this is one of them at least (identifier "BE"). For the PC version, just delete the "endian big" - I guess. 
Nice example for the use of the array, which comes in quite handy here. Thanks Luigi for the implementation of the chunklzx unpack function.

Thank you very much. This script works perfectly with the UFC 2 archives on the ps4.
## Post #471
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2018-06-04T12:41:54+00:00
- Post Title: Re: My quickBMS scripts

007: Nightfire (PS2) - *.sfb (sound archives)

```
# (c) 2013-05-05 by AlphaTwentyThree of XeNTaX
# script for QuickBMS http://quickbms.aluigi.org

get NAME basename
string NAME += ".SHF"
open FDSE NAME
get FILES long 0

for i = 0 < FILES
	get TYPE long # loop ident
	get OFFSET long
	get SIZE long
	get FREQ long
	math FREQ *= 0xc
	get UNK long
	get CH long
	get BITS long
	get UNK longlong
	get NAME basename
	string NAME += "_"
	string NAME += i
	if TYPE == 1
		string NAME += "_l"
	endif
	string NAME += ".ss2"
	
	putArray 0 i NAME
	putArray 1 i OFFSET
	putArray 2 i SIZE
	putArray 3 i FREQ
	putArray 4 i CH
next i

get NAME basename
string NAME += ".SBF"
open FDSE NAME
set CH 1
set INTERLEAVE 0x10
for i = 0 < FILES
	getArray NAME 0 i
	getArray OFFSET 1 i
	getArray SIZE 2 i
	getArray FREQ 3 i
	getArray CH 4 i
	callfunction SS2 1
next i

startfunction SS2
	endian little
	set MSIZE SIZE
	math MSIZE += 0x38
	putVarChr MEMORY_FILE MSIZE 0
	log MEMORY_FILE 0 0
	set MEMORY_FILE binary "\x53\x53\x68\x64\x18\x00\x00\x00\x10\x00\x00\x00\xb0\x36\x00\x00\x02\x00\x00\x00\xc0\x2f\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\x53\x53\x62\x64\x00\xe8\x11\x00"
	append
	log MEMORY_FILE OFFSET SIZE
	append
	
	putVarChr MEMORY_FILE 0xc FREQ long
	putVarChr MEMORY_FILE 0x10 CH byte
	putVarChr MEMORY_FILE 0x14 INTERLEAVE long
	putVarChr MEMORY_FILE 0x24 SIZE long
	if NAME == ""
		get NAME basename
		string NAME += ".ss2"
	endif
	get SIZE asize MEMORY_FILE
	log NAME 0 SIZE MEMORY_FILE
endfunction
```
## Post #472
- Username: Supurreme
- Rank: advanced
- Number of posts: 43
- Joined date: Mon Jun 05, 2017 5:50 pm
- Post datetime: 2018-07-15T03:25:45+00:00
- Post Title: Re: My quickBMS scripts

hey there, im trying to dump the files from the PC release of zero escape 999 and VLR but i cant seem to get these damn .bin files to extract with any tools i usually use :/ i was wondering if anyone happened to have a script that would work on these files specifically?
## Post #473
- Username: kilik
- Rank: mega-veteran
- Number of posts: 195
- Joined date: Sat Dec 08, 2012 6:14 pm
- Post datetime: 2018-10-03T07:24:36+00:00
- Post Title: Re: My quickBMS scripts


## Post #474
- Username: MRNLSAMPAIO
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Sat Dec 01, 2018 1:08 am
- Post datetime: 2018-11-30T17:14:09+00:00
- Post Title: Re: My quickBMS scripts

Hello

Does anyone know how to decrypt Simraceway confirmation files.

HeadPhysics.cfg
GT2_Damage.cfg
default.sfx
LMP1_michelin.tbc

I have just listed sample files.

If you can help, thank you.
## Post #475
- Username: MRNLSAMPAIO
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Sat Dec 01, 2018 1:08 am
- Post datetime: 2018-11-30T18:38:48+00:00
- Post Title: Re: My quickBMS scripts

OK folks

Is there any scryptsque that can decrypt this HeadPhysics.cfg / default.afx([http://www.mediafire.com/file/jd9ooe2dj ... hysics.cfg](http://www.mediafire.com/file/jd9ooe2djqox2p6/HeadPhysics.cfg) / [http://www.mediafire.com/file/7ue7ktjpd ... efault.afx](http://www.mediafire.com/file/7ue7ktjpd3cazg2/default.afx))

There are others that I need to decrypt, they belong to the Simraceway game.
## Post #476
- Username: Supurreme
- Rank: advanced
- Number of posts: 43
- Joined date: Mon Jun 05, 2017 5:50 pm
- Post datetime: 2018-12-27T13:57:04+00:00
- Post Title: Re: My quickBMS scripts

Do you think you could write a script to help get past the .stir compression/encryption on [these files?](https://sta.sh/0fbnwh3cfnu) the same thing is supposedly used on super mario run and animal crossing pocket camp if thats any help! ive found a python script thats supposed to do it but i cant get it to run, so i thought id ask here
## Post #477
- Username: atrina
- Rank: n00b
- Number of posts: 10
- Joined date: Fri Jun 02, 2017 7:25 am
- Post datetime: 2019-03-14T20:01:34+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree Thu Dec 13, 2012 9:35 am at Thu Dec 13, 2012 9:35 am
>
> 
Max Payne Mobile - MaxPayneSoundsv2.msf extractor
Code: Select all# extracts the main sound archive from Max Payne Mobile (2012) iP
# (c) 2012-12-13 by AlphaTwentyThree of XeNTaX

endian big
get UNK long
get UNK long
get FILES long
for i = 1 <= FILES
	get OFFSET long
	get SIZE long
	get NAMEL byte
	getDstring NAME NAMEL
	log NAME OFFSET SIZE
next i

thx 

How to Reimport *.msf files?
## Post #478
- Username: mita996
- Rank: advanced
- Number of posts: 46
- Joined date: Thu Oct 11, 2018 5:45 am
- Post datetime: 2019-03-17T13:00:01+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree Tue Oct 09, 2012 2:47 am at Tue Oct 09, 2012 2:47 am
>
> 
Electronic Arts *.big extractor

I know there are many different archives in use by EA - this is one of them at least (identifier "BE"). For the PC version, just delete the "endian big" - I guess. 
Nice example for the use of the array, which comes in quite handy here. Thanks Luigi for the implementation of the chunklzx unpack function. 
Code: Select all# extracts EA big archives with "EB" identifier
# tested with NHL 13 (X360)
# (c) 2012-10-08 by AlphaTwentyThree of XeNTaX

comtype xmemdecompress
idstring \x45\x42\x00\x03
endian big
goto 4
get FILES long
get UNK long # some size
get OFF_NAMES long # plus random bias of zeros
get SIZE_NAMES long
get NAMEL_FILE byte
get NAMEL_FOLDER byte
get ZERO byte
get FOLDERS byte
set OFF_FOLDERS FILES
math OFF_FOLDERS *= NAMEL_FILE
math OFF_FOLDERS += OFF_NAMES
math OFF_FOLDERS x= 0x10 # round to next 0x10 bytes
math NAMEL_FILE -= 2 # short for folder number

goto 0x30
for i = 1 <= FILES
	get OFFSET long
	math OFFSET *= 0x10
	get ZERO long
	get SIZE long
	get HASH long
	putArray 0 i OFFSET
	putArray 1 i SIZE
next i
goto OFF_NAMES
for i = 1 <= FILES
	get FOLDER_NUMBER short
	getDstring NAME NAMEL_FILE
	savepos MYOFF
	set OFF_FOLDERNAME FOLDER_NUMBER
	math OFF_FOLDERNAME *= NAMEL_FOLDER
	math OFF_FOLDERNAME += OFF_FOLDERS
	goto OFF_FOLDERNAME
	getDstring FOLDER NAMEL_FOLDER
	set FNAME FOLDER
	string FNAME += "/"
	string FNAME += NAME
	getArray OFFSET 0 i
	getArray SIZE 1 i
	goto OFFSET
	getDstring COMP 8
	if COMP == "chunklzx"
		callfunction unpack 1
		log FNAME 0 SIZE MEMORY_FILE
	else
		log FNAME OFFSET SIZE
	endif
	goto MYOFF
next i

startfunction unpack # (c) Luigi Auriemma
    get DUMMY long
    get FULLSIZE long
    get SIZE long
    get CHUNKS long
    get DUMMY long
    get DUMMY long
    get DUMMY long
    get DUMMY long
    log MEMORY_FILE 0 0
    append
    savepos OFFSET
    for j = 0 < CHUNKS
        math OFFSET x= 0x8
        for # very lame, made on the fly
            math T = OFFSET
            math T %= 0x10
            if T == 8
                break
            endif
            math OFFSET += 8
        next
        goto OFFSET
        get ZSIZE long
        get DUMMY long
        savepos OFFSET
        clog MEMORY_FILE OFFSET ZSIZE SIZE
        math OFFSET += ZSIZE
    next j
    append
    get MYSIZE asize MEMORY_FILE
    if MYSIZE != FULLSIZE
        print "Alert: MEMORY_FILE %MYSIZE% != %FULLSIZE%"
    endif
	set SIZE FULLSIZE
endfunction

Is it work with fifa online 4? I'm searching for the right script, that can export the right big file with (heads, hair etc), do you want a sample, master?
## Post #479
- Username: Puterboy1
- Rank: mega-veteran
- Number of posts: 204
- Joined date: Fri Mar 02, 2018 10:05 am
- Post datetime: 2019-03-19T04:03:06+00:00
- Post Title: Re: My quickBMS scripts

I was wondering if you or anyone can make an extractor for the .sdt audio archives of the Harry Potter and the Prisoner of Azkaban console versions along with a parser that gives the results proper file names. The names are located in the .ids files.
## Post #480
- Username: King of Fire
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Sat Aug 03, 2019 3:03 am
- Post datetime: 2019-08-02T19:05:28+00:00
- Post Title: Re: My quickBMS scripts

What is BMS script for pubg mobile?
## Post #481
- Username: Rmm4K
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Wed Jan 22, 2020 5:44 am
- Post datetime: 2020-01-21T23:37:20+00:00
- Post Title: Re: My quickBMS scripts

Does anybody here have the skills to make a bms script for the tekken 4 3d models?
## Post #482
- Username: marcoxD95
- Rank: n00b
- Number of posts: 10
- Joined date: Mon May 27, 2019 5:14 am
- Post datetime: 2021-05-16T12:13:22+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree Tue May 29, 2012 7:04 am at Tue May 29, 2012 7:04 am
>
> 
sdu extractor for "The Suffering" (Xbox)
Uses my new version of the Xbox ADPCM header adder, so be sure to update that!
XMV movies can be converted with VGM Toolbox (at least in most cases).
Remember to decode the *.lwav files with toWAV because the vgmstream playback is errornous!
Code: Select all# extract the *.sdu and *.vdu files from The Suffering (Xbox)
# (c) 2012-05-29 by AlphaTwentyThree of XeNTaX

include "func_header_XADP.bms" # be sure to have this file in the same directory!
idstring "SRSC"
get UNK byte
get UNK byte
get INFO long
get ENTRIES long # head/file/tail entries
goto INFO
get EXT extension
if EXT == "sdu"
	callfunction sdu 1
elif EXT == "vdu"
	callfunction vdu
endif


startfunction sdu
	for i = 1 <= ENTRIES
		get SIG byte # head/data/tail
		get UNK2 byte #always 3?
		get FILE_ID short
		get UNK4 short # some identifier
		get OFFSET long
		get SIZE long
		if SIG == 2
			if FILE_ID != 0
				savepos MYOFF
				math OFFSET += 0x2c
				goto OFFSET
				get CH short
				get BITS short # always 4
				get FREQ long
				goto MYOFF
			endif
		elif SIG == 4
			get NAME basename
			string NAME += "_"
			string NAME += FILE_ID
			#string NAME += "_"
			#string NAME += UNK4
			string NAME += ".lwav"
			callfunction XADP 1
		elif SIG == 5 # some file tail - do nothing?
		endif
	next i
endfunction

startfunction vdu
	for i = 1 <= ENTRIES
		get SIG byte # head/data/tail
		get UNK2 byte #always 3?
		get FILE_ID short
		get UNK4 short # some identifier
		get OFFSET long
		get SIZE long
		if SIG != 66
			get NAME basename
			string NAME += "_"
			string NAME += FILE_ID
			string NAME += ".xmv"
			if FILE_ID != 0
				log NAME OFFSET SIZE
			endif
		endif
	next i
endfunction

Does anybody know how to extract the .sdu and .vdu archives from the PC version of the game? I tried this script here but it didn't extract anything so my guess is, it only works with the Xbox version.

After digging some more I also found this:
[http://wiki.xentax.com/index.php/Surrea ... ot_Engine)](http://wiki.xentax.com/index.php/Surreal_Software_Archive_%28Riot_Engine%29)

I tried the Drakan bms script on it and it did work, however, I end up with a bunch of .dat, .ico and .img files. My guess is that the audio stuff is in some of these .dat files but I found no way to open/extract/playback them yet.

Does anybody here know anything by chance? I could just use the Xbox version but from my experience the Xbox audio codec is often inferior and sounds bad especially in the hights.
## Post #483
- Username: AlphaTwentyThree
- Rank: double-veteran
- Number of posts: 982
- Joined date: Tue Aug 25, 2009 5:55 am
- Post datetime: 2021-05-17T05:43:28+00:00
- Post Title: Re: My quickBMS scripts

I'm not coding anymore. Given the age of the game, they mostly used mp3 for music. It's actually inferior to the native Xbox codec (a really good ADPCM). After all, it's the direct pre-decessor of WMA.
## Post #484
- Username: marcoxD95
- Rank: n00b
- Number of posts: 10
- Joined date: Mon May 27, 2019 5:14 am
- Post datetime: 2021-05-17T13:36:49+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree Mon May 17, 2021 1:43 pm at Mon May 17, 2021 1:43 pm
>
> 
I'm not coding anymore. Given the age of the game, they mostly used mp3 for music. It's actually inferior to the native Xbox codec (a really good ADPCM). After all, it's the direct pre-decessor of WMA.

Yeah, you could be right. I have a feeling that this BMS script doesn't even work properly on these files. I also end up with many 1kb files that just seem to be corrupt. Some files do seem to contain data but this seems to be only voice acting and video audio. I was able to import these in Audacity with the raw audio import option but couldn't find anything else out. Their header doesn't seem to be recognized by anything except rarely as rare video codec. I also didn't find any music so far so my guess is, it doesn't even get extracted and I extracted multiple .sdu and .vdu files already. The PC version of The Suffering just doesn't seem to be extractable right now, only the Xbox version with your script. If nothing else works I guess I just gonna work with these but still gotta rip Ties That Bind since I was only able to find a The Suffering 1 Joshw xbox rip.

I decided to upload the PC version files in case anybody with the knowledge wanna try figuring out how to extract their data properly including the music audio. Drakan script doesn't seem to work properly since more than half of the files end up as unusable 1kb files.
[https://www.mediafire.com/file/nel7nspc ... es.7z/file](https://www.mediafire.com/file/nel7nspcodty7pq/The_Suffering_Interface_Ripped_Raw_Files.7z/file)
## Post #485
- Username: marcoxD95
- Rank: n00b
- Number of posts: 10
- Joined date: Mon May 27, 2019 5:14 am
- Post datetime: 2021-07-30T23:31:49+00:00
- Post Title: Re: My quickBMS scripts

Not sure if anybody cares but I was able to extract the PC OST of The Suffering. It isnt as good as the Xbox source so dont waste your time like me.

Furthermore, I dont know if anybody knew but the script to extract music from the Xbox version of The Suffering also works on the second game Ties That Bind. Xbox version of course. Was just a random thing I figured out. Weirdly enough didnt find a single OST rip of Ties That Bind. You btw need to extract a file named music.sdu which, at least on the Xbox, is in some weird shared folder. Furthermore it seems like that also in this case the Xbox has the highest music quality. Both PS2 and PC seem to use 22050khz files for everything. The Xbox uses 44100khz for dynamic action music and 22050khz for dark ambient music. Sometimes there also seem to be weird 32000khz or even 6000khz music files but some are also duplicates.

Just thought I leave this note to anyone wanting to rip the music from the games.
## Post #486
- Username: Eraea
- Rank: n00b
- Number of posts: 13
- Joined date: Mon May 28, 2018 9:49 pm
- Post datetime: 2021-08-20T21:39:55+00:00
- Post Title: Re: My quickBMS scripts

Hi, looking for help with extracting from a .bdt file. I tried using the func GetType bms but it didn't work. The file has a BDF4 Header unlike the Dark Souls BDF3 and the recent BDF5. The game is from PS3 called Kido Senshi Gundam Unicorn



image_2021-08-21_053842.png (2.82 KiB) Viewed 333 times
## Post #487
- Username: sanderson169
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Sun Sep 04, 2022 1:24 am
- Post datetime: 2022-09-03T18:03:51+00:00
- Post Title: Re: My quickBMS scripts

If someone is so kind, I was looking for 2 things, but I can't find a way, I found something on Alpha's side but it doesn't seem to work very well.

I was looking for 2 script for the following
- how to extract audio from a .bnk
- then once extracted, a script that is capable of being based on a "SoundBankInfo.XML" or "bnk.XML" to create the appropriate folders for AUDIO, Ambience, MUSIC etc... and rename the extracted .WEM files.
- sometimes there are some audios that are not in the XML, move them to an Unknow wwise folder.

Someone could help me? Thank you!

EDIT: I found this, but is soooo old... 

```
# script type: parser
# note 1: all *.wem files must be in the same folder as this script and the txt
# note 2: script will maintain the original folder structure
#
# (c) by AlphaTwentyThree of Zenhax
# script for QuickBMS http://quickbms.aluigi.org

get EXT extension
if EXT == "txt"
	callfunction bnk_txt 1
elif EXT == "xml"
	callfunction soundbanks 1
else
	print "script only for txt and xml"
endif

startfunction bnk_txt
	callfunction getARRAYSIZE 1
	print "columns: %COLUMNS%, lines: %LINES%, %EMPTY% of which are empty"
	xmath LINES "LINES - EMPTY"
	goto 0
	set ARRAYLINE 0
	for i = 0 <= LINES
		set HEADERLINE 0
		for j = 0 < COLUMNS
			set NEWENTRY 0
			getCT FIELD string 0x09
			#print "(%i%, %j%): %FIELD%"
			if FIELD == "ID" # check for every line in case structure changes
				set C1 j
				set HEADERLINE 1 # don't enter data
			elif FIELD == "Wwise Object Path"
				set C2 j
				set HEADERLINE 1
			endif
			if HEADERLINE == 0
				if j == C1
					putArray 0 ARRAYLINE FIELD
					set NEWENTRY 1
					#print "enter ID %FIELD% at line %ARRAYLINE%"
				elif j == C2
					#print "enter path %FIELD% at line %ARRAYLINE%"
					putArray 1 ARRAYLINE FIELD
					set NEWENTRY 1
				endif
			endif
		next j
		getCT FIELD string 0x0d
		#print "(%i%, %j%): %FIELD%"
		get DUMMY byte
		if NEWENTRY == 1
			math ARRAYLINE += 1
		endif
		#print "line %i%: %NEWENTRY%"
	next i
	#print "entries: %ARRAYLINE%"

	for i = 0 < ARRAYLINE
		getArray IDX 0 i
		getArray NAME 1 i
		string NAME += ".wem"
		string IDX += ".wem"
		open FDSE IDX 1 EXIST
		if EXIST == 1
			get SIZE asize 1
			log NAME 0 SIZE 1
		endif
	next i
endfunction

startfunction getARRAYSIZE
	FindLoc SEARCHLINEEND string \x0d\x0a 0 ""
	getDstring FIRSTLINE SEARCHLINEEND
	strlen LENGTH FIRSTLINE
	set COLUMNS 0
	for i = 0 < LENGTH
		getVarChr TEST FIRSTLINE i byte
		if TEST == 0x09
			math COLUMNS += 1
		endif
	next i
	set LINES 0
	set LINEEND 0
	
	set EMPTY 0
	for
		goto LINEEND
		savepos MYOFF
		FindLoc LINEEND string \x0d\x0a 0 ""
		if LINEEND == ""
			break
		endif
		xmath TEST "LINEEND - MYOFF"
		math LINES += 1
		if TEST == 0
			print "line %LINES% is empty"
			math EMPTY += 1
		endif
		math LINEEND += 2
	next
	goto -4
	get TEST long
	if TEST == 0x0a0d0a0d
		math LINES -= 1
	endif
endfunction

startfunction soundbanks
	for i = 1
		FindLoc SEARCH string "<File Id=" 0 ""
		if SEARCH == ""
			cleanexit
		endif
		goto SEARCH
		getDstring DUMMY 10
		getCT DIDX string 0x22
		string DIDX += ".wem"
		getDstring TEST 3 # sometimes the file id tag is empty
		if TEST != " />"
			math SEARCH += 12
			goto SEARCH
			FindLoc SEARCH string "<Path>" 0 ""
			goto SEARCH
			getDstring DUMMY 6
			getCT FNAME string 0x3c
			string FNAME -= 13
			open FDSE DIDX 1 EXIST
			if EXIST == 1
				get SIZE asize 1
				log MEMORY_FILE 0 0
				log MEMORY_FILE 0 SIZE 1
				string FNAME += ".wem"
				log FNAME 0 SIZE MEMORY_FILE
			endif
		endif
		math SEARCH += 10
		goto SEARCH
	next i
endfunction
```
## Post #488
- Username: moonsarito1
- Rank: ultra-n00b
- Number of posts: 5
- Joined date: Mon Jul 03, 2023 9:45 am
- Post datetime: 2023-07-03T01:47:46+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree Thu Dec 06, 2012 6:32 am at Thu Dec 06, 2012 6:32 am
>
> 

Can you help me?, I need to extract and compress the data.vfs file from Crash Nitro Kart 3D made by Porlabit from Zeebo, iOS, Symbian to try to create some mods like changing the 3D model, soundtrack and etc...

But I couldn't find any program that would work with this type of file.
## Post #489
- Username: Jubilee
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Thu Jul 13, 2023 12:34 pm
- Post datetime: 2023-07-19T02:18:31+00:00
- Post Title: Re: My quickBMS scripts

> Reply from AlphaTwentyThree Sun Nov 28, 2010 10:25 pm at Sun Nov 28, 2010 10:25 pm
>
> 

Is there a way to recompress files with this script?
## Post #490
- Username: touxd
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Wed Aug 30, 2023 9:43 pm
- Post datetime: 2023-09-08T17:02:24+00:00
- Post Title: Re: My quickBMS scripts

Hey, does anyone have a script for bin files from Captain Tsubasa J - Get In The Tomorrow (psx)?
